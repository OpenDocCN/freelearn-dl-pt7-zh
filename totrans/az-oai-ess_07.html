<html><head></head><body>
		<div id="_idContainer119">
			<h1 id="_idParaDest-89" class="chapter-number"><a id="_idTextAnchor088"/>7</h1>
			<h1 id="_idParaDest-90"><a id="_idTextAnchor089"/>Code Generation and Documentation</h1>
			<p>In the previous chapter, we learned about using Azure Communication Services. We practically applied this creating a synthetic chat between a helper and a customer using ChatGPT (<strong class="source-inline">gpt-3.5-turbo</strong>). We then looked at the chat to understand what <span class="No-Break">was said.</span></p>
			<p>Even though we mainly focused on written messages, it’s good to know that Azure Communication Services can do more than just text. It can handle voice, video, or even a mix of different media as inputs. This flexible approach helps us learn important information from customer content. The stats we obtain from this analysis can guide us in making our products better in the future. By trying different types of conversations, we can find where customers are having trouble and use that information to make our products and <span class="No-Break">services better.</span></p>
			<p>Imagine you’re a teacher, and you’ve got a student named Taylor who’s just starting to learn how to code. Taylor is excited but a bit confused about where <span class="No-Break">to begin.</span></p>
			<p>Now, enter your secret weapon: a smart bot powered by Azure OpenAI. This bot is like a helpful friend who can create code and explain things in simple terms. Taylor can ask it questions such as, “How do I make the computer say ‘Hello, World!’?” And boom! The bot generates the code and explains it step <span class="No-Break">by step.</span></p>
			<p>Taylor’s face lights up because they’re making the computer do cool stuff. But here’s the best part – the bot isn’t just a one-trick pony. Taylor can ask it more questions, such as “How do I make the computer do something over and over?” And the bot responds with a loop (a fancy term for repeating things) and explains how <span class="No-Break">it works.</span></p>
			<p>In this chapter, we’re going to explore how you, as a teacher, and Taylor, the eager learner, can use this magic bot to make coding easy and fun. We’ll learn together, play with different questions, and see how Azure OpenAI turns coding into a cool adventure. Get ready for a coding party where you and the bot are the VIP guests, making learning to code a blast! Let’s dive in and have <span class="No-Break">some fun!</span></p>
			<h1 id="_idParaDest-91"><a id="_idTextAnchor090"/>Technical requirements</h1>
			<p>To follow along with the practical exercises in this chapter, access the source code available in this chapter's GitHub repository <span class="No-Break">at </span><a href="https://github.com/PacktPublishing/Azure-OpenAI-Essentials/blob/main/chapter%207.ipynb"><span class="No-Break">https://github.com/PacktPublishing/Azure-OpenAI-Essentials/blob/main/chapter%207.ipynb</span></a><span class="No-Break">.</span></p>
			<p>The technical requirements are the same as for <a href="B21019_04.xhtml#_idTextAnchor059"><span class="No-Break"><em class="italic">Chapter 4</em></span></a>. As a reminder, install the following tools on your local machine to start working on <span class="No-Break">the solution:</span></p>
			<ul>
				<li>Python 3.9, 3.10, or 3.11 – <a href="https://www.python.org/downloads/"><span class="No-Break">https://www.python.org/downloads/</span></a></li>
				<li>Azure Developer CLI – Azure developer <span class="No-Break">CLI Installation</span></li>
				<li>Node.js 14+ – <a href="https://nodejs.org/en/download"><span class="No-Break">https://nodejs.org/en/download</span></a></li>
				<li>Git – <a href="https://git-scm.com/downloads"><span class="No-Break">https://git-scm.com/downloads</span></a></li>
				<li>PowerShell 7+ (<strong class="source-inline">pwsh</strong>) – <a href="https://github.com/powershell/powershell"><span class="No-Break">https://github.com/powershell/powershell</span></a></li>
			</ul>
			<p>You’ll also need <span class="No-Break">the following:</span></p>
			<ul>
				<li><strong class="bold">Azure account</strong> – If you’re new to Azure, get an Azure account for free, and you’ll get some free Azure credits to <span class="No-Break">get started.</span></li>
				<li>Azure subscription with access enabled for the Azure OpenAI service. You can request access with this <span class="No-Break">form: </span><a href="https://customervoice.microsoft.com/Pages/ResponsePage.aspx?id=v4j5cvGGr0GRqy180BHbR7en2Ais5pxKtso_Pz4b1_xUNTZBNzRKNlVQSFhZMU9aV09EVzYxWFdORCQlQCN0PWcu"><span class="No-Break">https://customervoice.microsoft.com/Pages/ResponsePage.aspx?id=v4j5cvGGr0GRqy180BHbR7en2Ais5pxKtso_Pz4b1_xUNTZBNzRKNlVQSFhZMU9aV09EVzYxWFdORCQlQCN0PWcu</span></a><span class="No-Break">.</span></li>
				<li>Azure OpenAI connection and <span class="No-Break">model information:</span><ul><li>OpenAI <span class="No-Break">API key</span></li><li>OpenAI embedding model <span class="No-Break">deployment name</span></li><li>OpenAI <span class="No-Break">API version</span></li></ul></li>
			</ul>
			<p>In addition to the system requirements mentioned here, it is crucial to have a solid foundation in fundamental Azure services and a basic proficiency in the Python programming language, equivalent to a beginner level (Python 100). These skills are vital for efficiently harnessing and leveraging Azure services in this chapter’s context. Rest assured, even if you are new to the Azure environment, we have designed this chapter to be beginner-friendly. It offers clear explanations and includes detailed screenshots to facilitate your learning and get you started on the <span class="No-Break">right track.</span></p>
			<h1 id="_idParaDest-92"><a id="_idTextAnchor091"/>Architecture diagram</h1>
			<p>For this chapter, the<a id="_idIndexMarker360"/> flow is straightforward – the user submits a prompt to the OpenAI model that we prepare, which then generates the required <span class="No-Break">code snippets:</span></p>
			<div>
				<div id="_idContainer115" class="IMG---Figure">
					<img src="image/B21019_07_1.jpg" alt="Figure 7.1: Architecture diagram"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 7.1: Architecture diagram</p>
			<p>Let’s <span class="No-Break">get started.</span></p>
			<h1 id="_idParaDest-93"><a id="_idTextAnchor092"/>Building the code generator and documenter solution</h1>
			<p>Since we have set <a id="_idIndexMarker361"/>up all the essential services in our Azure portal in our previous chapters, we can begin constructing our solution for code generation <span class="No-Break">and documentation.</span></p>
			<h2 id="_idParaDest-94"><a id="_idTextAnchor093"/>Solution using Azure OpenAI</h2>
			<p>To build this <a id="_idIndexMarker362"/>solution, we mainly need to use <span class="No-Break">two services:</span></p>
			<ul>
				<li>Azure <span class="No-Break">Cognitive Search</span></li>
				<li>Azure <span class="No-Break">OpenAI Service</span></li>
			</ul>
			<p>We explained the process to create these services in <a href="B21019_02.xhtml#_idTextAnchor023"><span class="No-Break"><em class="italic">Chapter 2</em></span></a>, in the <em class="italic">Accessing Azure OpenAI (AOAI) Service</em> section, and <a href="B21019_04.xhtml#_idTextAnchor059"><span class="No-Break"><em class="italic">Chapter 4</em></span></a>, in the <em class="italic">Developing a question answering solution using Azure OpenAI and Azure Cognitive Search index</em> section. Please refer to these chapters for <span class="No-Break">more information.</span></p>
			<p>We can begin constructing our solution. To develop the code, we will be working within a <span class="No-Break">Jupyter notebook.</span></p>
			<p>In the following sections, we are going to develop <span class="No-Break">our solution:</span></p>
			<ul>
				<li><span class="No-Break">Importing packages</span></li>
				<li>Creating<a id="_idIndexMarker363"/> code from a <span class="No-Break">user prompt</span></li>
			</ul>
			<h3>Importing packages</h3>
			<p>We need to import<a id="_idIndexMarker364"/> the required packages before we develop <span class="No-Break">the solution:</span></p>
			<pre class="source-code">
import openai
import os
from dotenv import load_dotenv</pre>			<p>You can see a variety of libraries being used in the preceding code. Let’s delve into each of these libraries in the <span class="No-Break">following table:</span></p>
			<table id="table001-5" class="No-Table-Style _idGenTablePara-1">
				<colgroup>
					<col/>
					<col/>
				</colgroup>
				<tbody>
					<tr class="No-Table-Style">
						<td class="No-Table-Style T---Body">
							<p><span class="No-Break"><strong class="bold">Imported Packages</strong></span></p>
						</td>
						<td class="No-Table-Style T---Body">
							<p><span class="No-Break"><strong class="bold">Description</strong></span></p>
						</td>
					</tr>
					<tr class="No-Table-Style">
						<td class="No-Table-Style T---Body">
							<p><span class="No-Break"><strong class="source-inline">openai</strong></span></p>
						</td>
						<td class="No-Table-Style T---Body">
							<p>The OpenAI Python library, which <a id="_idIndexMarker365"/>provides access to OpenAI’s <strong class="bold">Generative Pre-trained Transformer</strong> (<span class="No-Break"><strong class="bold">GPT</strong></span><span class="No-Break">) models.</span></p>
						</td>
					</tr>
					<tr class="No-Table-Style">
						<td class="No-Table-Style T---Body">
							<p><span class="No-Break"><strong class="source-inline">os</strong></span></p>
						</td>
						<td class="No-Table-Style T---Body">
							<p>Provides a way to interact with the operating system, including reading or setting <span class="No-Break">environment variables.</span></p>
						</td>
					</tr>
					<tr class="No-Table-Style">
						<td class="No-Table-Style T---Body">
							<p><span class="No-Break"><strong class="source-inline">dotenv.load_dotenv</strong></span></p>
						</td>
						<td class="No-Table-Style T---Body">
							<p>Loads environment variables from a <strong class="source-inline">.env</strong> file into the <span class="No-Break">script’s environment.</span></p>
						</td>
					</tr>
				</tbody>
			</table>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Table 7.1: Explanation of usage of imported packages</p>
			<p>With all the necessary packages imported and the variables configured in the <strong class="source-inline">.env</strong> file, as outlined in <a href="B21019_04.xhtml#_idTextAnchor059"><span class="No-Break"><em class="italic">Chapter 4</em></span></a>, we can now proceed to extract these variables from the <strong class="source-inline">.</strong><span class="No-Break"><strong class="source-inline">env</strong></span><span class="No-Break"> file.</span></p>
			<p>The following code loads the <strong class="source-inline">.env</strong> file and then accesses the variables and connections defined in<a id="_idIndexMarker366"/> the <strong class="source-inline">.</strong><span class="No-Break"><strong class="source-inline">env</strong></span><span class="No-Break"> file:</span></p>
			<pre class="source-code">
# Azure
load_dotenv()
OPENAI_API_KEY = os.getenv("OPENAI_API_KEY")
OPENAI_DEPLOYMENT_ENDPOINT =os.getenv("OPENAI_DEPLOYMENT_ENDPOINT")
OPENAI_DEPLOYMENT_NAME = os.getenv("OPENAI_DEPLOYMENT_NAME")
OPENAI_MODEL_NAME = os.getenv("OPENAI_MODEL_NAME")
OPENAI_API_VERSION = os.getenv("OPENAI_API_VERSION")
OPENAI_DEPLOYMENT_VERSION =os.getenv("OPENAI_DEPLOYMENT_VERSION")
server = os.getenv("DATABASESERVER")
database = os.getenv("DATABASE")
username = os.getenv("DATABASEUSERNAME")
password = os.getenv("DATABASEPASSWORD")
#init Azure OpenAI
openai.api_type = "azure"
openai.api_version = OPENAI_DEPLOYMENT_VERSION
openai.api_base = OPENAI_DEPLOYMENT_ENDPOINT
openai.api_key = OPENAI_API_KEY
load_dotenv()</pre>			<p>We get the <span class="No-Break">following output:</span></p>
			<div>
				<div id="_idContainer116" class="IMG---Figure">
					<img src="image/B21019_07_2.jpg" alt="Figure 7.2: Output to identify the loading of .env file"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 7.2: Output to identify the loading of .env file</p>
			<h3>Creating code from a user prompt</h3>
			<p>We have now<a id="_idIndexMarker367"/> loaded all the required data into <span class="No-Break">our code.</span></p>
			<p>The following code instructs an AI language model to come up with a function that can be used to add first and last names to a database, based on a provided prompt. The generated function code is then printed out <span class="No-Break">for examination:</span></p>
			<pre class="source-code">
# Prompt for creating a function to add names to the database
add_names_prompt = '''# Code to Create a function called 'nameImporter' to add a first and last name to the database'''
# Generate completion for creating a function to add names to the database
add_names_response = openai.Completion.create(
    engine=OPENAI_MODEL_NAME,
    prompt=add_names_prompt,
    temperature=1,
    max_tokens=3000,
    top_p=0.2,
)
print("Function to add names to the database:")
print(add_names_response.choices[0].text.strip())</pre>			<p>We get the <span class="No-Break">following output:</span></p>
			<div>
				<div id="_idContainer117" class="IMG---Figure">
					<img src="image/B21019_07_3.jpg" alt="Figure 7.3: Generated output for the user prompt"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 7.3: Generated output for the user prompt</p>
			<p>Now, we will create code from a user prompt on the previously generated database. This code instructs an AI language model to come up with a function that can be used to add first and last <a id="_idIndexMarker368"/>names to a database, based on a provided prompt. The generated function code is then printed out <span class="No-Break">for examination:</span></p>
			<pre class="source-code">
# Prompt for writing a SQL query to retrieve all records from the database
query_prompt = '''# Now, write a Simple SQL query to retrieve all records for the database created in add_names_response'''
# Generate completion for writing a SQL query to retrieve all records
query_response = openai.Completion.create(
    engine=OPENAI_MODEL_NAME,
    prompt=query_prompt,
    temperature=1,
    max_tokens=3000,
    top_p=0.2,
)
print("\nSQL query to retrieve all records from the database:")
print(query_response.choices[0].text.strip())</pre>			<p>We get the <a id="_idIndexMarker369"/><span class="No-Break">following output:</span></p>
			<div>
				<div id="_idContainer118" class="IMG---Figure">
					<img src="image/B21019_07_4.jpg" alt="Figure 7.4: Output of the generated query"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 7.4: Output of the generated query</p>
			<p>With this, we have explored how ChatGPT can simplify coding tasks by generating code and documentation for users through SQL <span class="No-Break">and GPT.</span></p>
			<p>The code snippets for<a id="_idIndexMarker370"/> this chapter are available on GitHub and can be accessed <span class="No-Break">here: </span><a href="https://github.com/PacktPublishing/Azure-OpenAI-Essentials/blob/main/chapter%207.ipynb"><span class="No-Break">https://github.com/PacktPublishing/Azure-OpenAI-Essentials/blob/main/chapter%207.ipynb</span></a></p>
			<h1 id="_idParaDest-95"><a id="_idTextAnchor094"/>Summary</h1>
			<p>In this chapter, we installed the necessary tools on our local machine, including Python, the Azure Developer CLI, Node.js, Git, and PowerShell. We also ensured we had an Azure account and subscription with access to the Azure OpenAI service. Additionally, we made sure to have a basic understanding of Azure services <span class="No-Break">and Python.</span></p>
			<p>Next, we focused on building the solution using Azure Cognitive Search and Azure OpenAI Service. We worked within a Jupyter notebook to develop the code. We started by importing the required packages, such as <strong class="source-inline">openai</strong>, <strong class="source-inline">os</strong>, and <strong class="source-inline">dotenv.load_dotenv</strong>. Then, we loaded the <strong class="source-inline">.env</strong> file and extracted the necessary variables, such as <strong class="source-inline">OPENAI_API_KEY</strong>, <strong class="source-inline">OPENAI_DEPLOYMENT_ENDPOINT</strong>, and others. We initialized Azure OpenAI with <span class="No-Break">these variables.</span></p>
			<p>After setting up the environment, we generated a function to add names to a database based on a provided prompt. Following that, we created a SQL query to retrieve all records from the database we had just created. Finally, we achieved a functional solution that could generate code from user prompts and interact with the <span class="No-Break">database effectively.</span></p>
		</div>
	</body></html>