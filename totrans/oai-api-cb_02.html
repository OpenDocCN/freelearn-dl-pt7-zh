<html><head></head><body>
<div id="_idContainer024" class="calibre2">
<h1 class="chapter-number" id="_idParaDest-44"><a id="_idTextAnchor044" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.1.1">2</span></h1>
<h1 id="_idParaDest-45" class="calibre5"><a id="_idTextAnchor045" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.2.1">OpenAI API  Endpoints Explained</span></h1>
<p class="calibre3"><a id="_idTextAnchor046" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.3.1">The OpenAI API is not just one endpoint, but instead a collection of different endpoints that can be used to generate text completions, images, and even transcribe audio. </span><span class="kobospan" id="kobo.3.2">In this chapter, we dive into all these use cases covering the main endpoints that are used by developers when integrating the OpenAI API into their applications. </span><span class="kobospan" id="kobo.3.3">By the end of this chapter, you will know how to use the diverse capabilities of the OpenAI API, the first step in building intelligent applications. </span><span class="kobospan" id="kobo.3.4">You’ll understand the nuances of each endpoint, ensuring that you can tailor your integration to your specific needs. </span><span class="kobospan" id="kobo.3.5">Whether you’re aiming to create dynamic text content, generate captivating visuals, or transcribe audio, you will learn how to accomplish these tasks all using </span><span><span class="kobospan" id="kobo.4.1">the API.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.5.1">Specifically, we will cover the following recipes in </span><span><span class="kobospan" id="kobo.6.1">this chapter:</span></span></p>
<ul class="calibre16">
<li class="calibre15"><span class="kobospan" id="kobo.7.1">Generating customized responses using the Chat </span><span><span class="kobospan" id="kobo.8.1">Completions endpoint</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.9.1">Creating pictures using the </span><span><span class="kobospan" id="kobo.10.1">Images endpoint</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.11.1">Generating transcripts using the </span><span><span class="kobospan" id="kobo.12.1">Audio endpoint</span></span></li>
</ul>
<h1 id="_idParaDest-46" class="calibre5"><a id="_idTextAnchor047" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.13.1">Technical requirements</span></h1>
<p class="calibre3"><span class="kobospan" id="kobo.14.1">This chapter requires you to have access to the OpenAI API (via a generated API key) and have an API client installed, such as Postman. </span><span class="kobospan" id="kobo.14.2">You can refer to the </span><em class="italic"><span class="kobospan" id="kobo.15.1">Making OpenAI API requests with Postman </span></em><span class="kobospan" id="kobo.16.1">recipe in </span><a href="B21007_01.xhtml#_idTextAnchor021" class="pcalibre1 calibre6 pcalibre"><span><em class="italic"><span class="kobospan" id="kobo.17.1">Chapter 1</span></em></span></a><em class="italic"> </em><span class="kobospan" id="kobo.18.1">for more information on how to obtain your API key and set </span><span><span class="kobospan" id="kobo.19.1">up Postman.</span></span></p>
<h1 id="_idParaDest-47" class="calibre5"><a id="_idTextAnchor048" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.20.1">Generating customized responses using the Chat Completions endpoint</span></h1>
<p class="calibre3"><span class="kobospan" id="kobo.21.1">We</span><a id="_idIndexMarker065" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.22.1"> previously explored the Chat Completions endpoint at the end of </span><a href="B21007_01.xhtml#_idTextAnchor021" class="pcalibre1 calibre6 pcalibre"><span><em class="italic"><span class="kobospan" id="kobo.23.1">Chapter 1</span></em></span></a><span class="kobospan" id="kobo.24.1">, but our request body was fairly simple and did not make use of the important parameters that we also discussed in the </span><em class="italic"><span class="kobospan" id="kobo.25.1">Running a completion request in the OpenAI Playground</span></em><span class="kobospan" id="kobo.26.1"> recipe. </span><span class="kobospan" id="kobo.26.2">For example, we learned how the Chat Log could be used to </span><em class="italic"><span class="kobospan" id="kobo.27.1">fine-tune</span></em><span class="kobospan" id="kobo.28.1"> the responses that are generated. </span><span class="kobospan" id="kobo.28.2">Additionally, the Chat Log feature can be used to deploy a chat bot inside </span><span><span class="kobospan" id="kobo.29.1">your application.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.30.1">In this recipe, we</span><a id="_idIndexMarker066" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.31.1"> will cover how to generate responses using the Chat Completions endpoint while using the Chat </span><span><span class="kobospan" id="kobo.32.1">Log parameters.</span></span></p>
<h2 id="_idParaDest-48" class="calibre7"><a id="_idTextAnchor049" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.33.1">Getting ready</span></h2>
<p class="calibre3"><span class="kobospan" id="kobo.34.1">Ensure you have an OpenAI Platform account with available usage credits. </span><span class="kobospan" id="kobo.34.2">If you don’t, please follow the </span><em class="italic"><span class="kobospan" id="kobo.35.1">Setting up your OpenAI Playground environment</span></em><span class="kobospan" id="kobo.36.1"> recipe in </span><a href="B21007_01.xhtml#_idTextAnchor021" class="pcalibre1 calibre6 pcalibre"><span><em class="italic"><span class="kobospan" id="kobo.37.1">Chapter 1</span></em></span></a><span><span class="kobospan" id="kobo.38.1">.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.39.1">Furthermore, ensure you have Postman installed, you have created a new workspace, you have created a new HTTP request, and that the </span><strong class="source-inline"><span class="kobospan" id="kobo.40.1">Headers</span></strong><span class="kobospan" id="kobo.41.1"> for that request are correctly configured. </span><span class="kobospan" id="kobo.41.2">This is important because without the </span><strong class="source-inline"><span class="kobospan" id="kobo.42.1">Authorization</span></strong><span class="kobospan" id="kobo.43.1"> configured, you will not be able to use the API. </span><span class="kobospan" id="kobo.43.2">If you don’t have Postman installed and configured as mentioned, please follow the </span><em class="italic"><span class="kobospan" id="kobo.44.1">Making OpenAI API requests with Postman</span></em><span class="kobospan" id="kobo.45.1"> recipe in </span><a href="B21007_01.xhtml#_idTextAnchor021" class="pcalibre1 calibre6 pcalibre"><span><em class="italic"><span class="kobospan" id="kobo.46.1">Chapter 1</span></em></span></a><span><span class="kobospan" id="kobo.47.1">.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.48.1">All the recipes in this chapter will have this </span><span><span class="kobospan" id="kobo.49.1">same requirement.</span></span></p>
<h2 id="_idParaDest-49" class="calibre7"><a id="_idTextAnchor050" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.50.1">How to do it…</span></h2>
<ol class="calibre14">
<li class="calibre15"><span class="kobospan" id="kobo.51.1">In Postman, create a new request by selecting the </span><strong class="bold"><span class="kobospan" id="kobo.52.1">New</span></strong><span class="kobospan" id="kobo.53.1"> button on the top-left menu bar, and then </span><span><span class="kobospan" id="kobo.54.1">select </span></span><span><strong class="bold"><span class="kobospan" id="kobo.55.1">HTTP</span></strong></span><span><span class="kobospan" id="kobo.56.1">.</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.57.1">Change the HTTP request type from </span><strong class="bold"><span class="kobospan" id="kobo.58.1">GET</span></strong><span class="kobospan" id="kobo.59.1"> to </span><strong class="bold"><span class="kobospan" id="kobo.60.1">POST</span></strong><span class="kobospan" id="kobo.61.1"> in the </span><strong class="bold"><span class="kobospan" id="kobo.62.1">Method</span></strong><span class="kobospan" id="kobo.63.1"> drop-down menu (by default, it will be set </span><span><span class="kobospan" id="kobo.64.1">to </span></span><span><strong class="bold"><span class="kobospan" id="kobo.65.1">GET</span></strong></span><span><span class="kobospan" id="kobo.66.1">).</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.67.1">Enter the following URL as the endpoint for Chat </span><span><span class="kobospan" id="kobo.68.1">Completions: </span></span><a href="https://api.openai.com/v1/chat/completions" class="pcalibre1 calibre6 pcalibre"><span><span class="kobospan" id="kobo.69.1">https://api.openai.com/v1/chat/completions</span></span></a><span><span class="kobospan" id="kobo.70.1">.</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.71.1">Select </span><strong class="bold"><span class="kobospan" id="kobo.72.1">Headers</span></strong><span class="kobospan" id="kobo.73.1"> from</span><a id="_idIndexMarker067" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.74.1"> the sub-menu and add the following key-value pairs into the table </span><span><span class="kobospan" id="kobo.75.1">below it:</span></span></li>
</ol>
<table class="no-table-style" id="table001-2">
<colgroup class="calibre10">
<col class="calibre11"/>
<col class="calibre11"/>
</colgroup>
<thead class="calibre12">
<tr class="no-table-style1">
<td class="no-table-style2">
<p class="calibre3"><span><em class="italic"><span class="kobospan" id="kobo.76.1">Key</span></em></span></p>
</td>
<td class="no-table-style2">
<p class="calibre3"><span><em class="italic"><span class="kobospan" id="kobo.77.1">Value</span></em></span></p>
</td>
</tr>
</thead>
<tbody class="calibre13">
<tr class="no-table-style1">
<td class="no-table-style2">
<p class="calibre3"><span><strong class="source-inline"><span class="kobospan" id="kobo.78.1">Content-Type</span></strong></span></p>
</td>
<td class="no-table-style2">
<p class="calibre3"><span><strong class="source-inline"><span class="kobospan" id="kobo.79.1">application/json</span></strong></span></p>
</td>
</tr>
<tr class="no-table-style1">
<td class="no-table-style2">
<p class="calibre3"><span><strong class="source-inline"><span class="kobospan" id="kobo.80.1">Authorization</span></strong></span></p>
</td>
<td class="no-table-style2">
<p class="calibre3"><strong class="source-inline"><span class="kobospan" id="kobo.81.1">Bearer &lt;your API </span></strong><span><strong class="source-inline"><span class="kobospan" id="kobo.82.1">key here&gt;</span></strong></span></p>
</td>
</tr>
</tbody>
</table>
<p class="calibre3"><span class="kobospan" id="kobo.83.1">Select </span><strong class="bold"><span class="kobospan" id="kobo.84.1">Body</span></strong><span class="kobospan" id="kobo.85.1"> from the sub-menu and then select </span><strong class="bold"><span class="kobospan" id="kobo.86.1">raw</span></strong><span class="kobospan" id="kobo.87.1"> for the request type. </span><span class="kobospan" id="kobo.87.2">Enter </span><a id="_idIndexMarker068" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.88.1">the following in </span><strong class="bold"><span class="kobospan" id="kobo.89.1">Body</span></strong><span class="kobospan" id="kobo.90.1">. </span><span class="kobospan" id="kobo.90.2">After that, </span><span><span class="kobospan" id="kobo.91.1">select </span></span><span><strong class="bold"><span class="kobospan" id="kobo.92.1">Send</span></strong></span><span><span class="kobospan" id="kobo.93.1">:</span></span></p>
<pre class="source-code"><span class="kobospan1" id="kobo.94.1">
{
  "model": "gpt-3.5-turbo",
  "messages": [
    {
      "role": "system",
      "content": "You are an assistant that creates short one-line responses to comments that users have left on your ice cream shop's Google reviews page"
    },
    {
      "role": "user",
      "content": "Comments: Great experience - I love the vanilla flavor!"
</span><span class="kobospan1" id="kobo.94.2">    }
  ]
}</span></pre> <p class="calibre3"><span class="kobospan" id="kobo.95.1">5.	</span><span class="kobospan" id="kobo.95.2">After sending the HTTP request, you should see the following response from the OpenAI API. </span><span class="kobospan" id="kobo.95.3">Note </span><a id="_idIndexMarker069" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.96.1">that your response may be different. </span><span class="kobospan" id="kobo.96.2">The section of the HTTP response </span><a id="_idIndexMarker070" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.97.1">that we particularly want to take note of is the </span><span><strong class="source-inline"><span class="kobospan" id="kobo.98.1">content</span></strong></span><span><span class="kobospan" id="kobo.99.1"> value:</span></span></p>
<pre class="source-code"><span class="kobospan1" id="kobo.100.1">
{
    "id": "chatcmpl-7l0Y7gmS2gtyxyvX7VaSCKiU2oHgB",
    "object": "chat.completion",
    "created": 1691437883,
    "model": "gpt-3.5-turbo-0613",
    "choices": [
        {
            "index": 0,
            "message": {
                "role": "assistant",
                "content": </span><strong class="bold1"><span class="kobospan1" id="kobo.101.1">"Thank you for your kind words! </span><span class="kobospan1" id="kobo.101.2">Vanilla is always a classic favorite. </span></strong><strong class="bold1"><span class="kobospan1" id="kobo.102.1">😊🍦</span></strong><strong class="bold1"><span class="kobospan1" id="kobo.103.1">"</span></strong><span class="kobospan1" id="kobo.104.1">
            },
            "finish_reason": "stop"
        }
    ],
    "usage": {
        "prompt_tokens": 47,
        "completion_tokens": 19,
        "total_tokens": 66
    }
}</span></pre> <p class="calibre3"><span class="kobospan" id="kobo.105.1">6.	</span><span class="kobospan" id="kobo.105.2">Let’s now add messages into the Chat Log (or </span><strong class="source-inline"><span class="kobospan" id="kobo.106.1">messages</span></strong><span class="kobospan" id="kobo.107.1">, as it’s referred to in the API) to modify </span><a id="_idIndexMarker071" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.108.1">and tune the responses that are generated. </span><span class="kobospan" id="kobo.108.2">Modify </span><strong class="bold"><span class="kobospan" id="kobo.109.1">Body</span></strong><span class="kobospan" id="kobo.110.1"> to the following – take note of the highlighted sections, where we have added chats to </span><a id="_idIndexMarker072" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.111.1">the list </span><span><span class="kobospan" id="kobo.112.1">inside </span></span><span><strong class="source-inline"><span class="kobospan" id="kobo.113.1">messages</span></strong></span><span><span class="kobospan" id="kobo.114.1">:</span></span></p>
<pre class="source-code"><span class="kobospan1" id="kobo.115.1">
{
  "model": "gpt-3.5-turbo",
  "messages": [
    {
      "role": "system",
      "content": "You are an assistant that creates short one-line responses to comments that users have left on your ice cream shop's Google reviews page"
    },
    {
      "role": "user",
      "content": "Comments: Great experience - I love the vanilla flavor!"
</span><span class="kobospan1" id="kobo.115.2">    },
</span><strong class="bold1"><span class="kobospan1" id="kobo.116.1">{</span></strong>
<strong class="bold1"><span class="kobospan1" id="kobo.117.1">      "role": "assistant",</span></strong>
<strong class="bold1"><span class="kobospan1" id="kobo.118.1">      "content": "Hello Ice Cream Fan, thank you so much. </span><span class="kobospan1" id="kobo.118.2">Vanilla is our favorite too. </span><span class="kobospan1" id="kobo.118.3">SCREAM FOR ICE CREAM!"</span></strong>
<strong class="bold1"><span class="kobospan1" id="kobo.119.1">    },</span></strong>
<strong class="bold1"><span class="kobospan1" id="kobo.120.1">    {</span></strong>
<strong class="bold1"><span class="kobospan1" id="kobo.121.1">      "role": "user",</span></strong>
<strong class="bold1"><span class="kobospan1" id="kobo.122.1">      "content": "Comments: I liked the many different flavors they have, and there's no line!"</span></strong>
<strong class="bold1"><span class="kobospan1" id="kobo.123.1">    },</span></strong>
<strong class="bold1"><span class="kobospan1" id="kobo.124.1">    {</span></strong>
<strong class="bold1"><span class="kobospan1" id="kobo.125.1">      "role": "assistant",</span></strong>
<strong class="bold1"><span class="kobospan1" id="kobo.126.1">      "content": "Hello Ice Cream Fan, thanks for that - we have over 50 different flavors. </span><span class="kobospan1" id="kobo.126.2">SCREAM FOR ICE CREAM!"</span></strong>
<strong class="bold1"><span class="kobospan1" id="kobo.127.1">    },</span></strong>
<strong class="bold1"><span class="kobospan1" id="kobo.128.1">    {</span></strong>
<strong class="bold1"><span class="kobospan1" id="kobo.129.1">      "role": "user",</span></strong>
<strong class="bold1"><span class="kobospan1" id="kobo.130.1">      "content": "Comments: The customer service was great - they were all so helpful!"</span></strong>
<strong class="bold1"><span class="kobospan1" id="kobo.131.1">    },</span></strong>
<strong class="bold1"><span class="kobospan1" id="kobo.132.1">    {</span></strong>
<strong class="bold1"><span class="kobospan1" id="kobo.133.1">      "role": "assistant",</span></strong>
<strong class="bold1"><span class="kobospan1" id="kobo.134.1">      "content": "Hello Ice Cream Fan, much appreciated. </span><span class="kobospan1" id="kobo.134.2">So glad we were helpful. </span><span class="kobospan1" id="kobo.134.3">SCREAM FOR ICE CREAM!"</span></strong>
<strong class="bold1"><span class="kobospan1" id="kobo.135.1">    },</span></strong>
<strong class="bold1"><span class="kobospan1" id="kobo.136.1">    {</span></strong>
<strong class="bold1"><span class="kobospan1" id="kobo.137.1">      "role": "user",</span></strong>
<strong class="bold1"><span class="kobospan1" id="kobo.138.1">      "content": "Comments: great location and great staff"</span></strong>
<strong class="bold1"><span class="kobospan1" id="kobo.139.1">    }</span></strong><span class="kobospan1" id="kobo.140.1">
  ]
}</span></pre> <p class="calibre3"><span class="kobospan" id="kobo.141.1">7.	</span><span class="kobospan" id="kobo.141.2">Click </span><strong class="bold"><span class="kobospan" id="kobo.142.1">Send</span></strong><span class="kobospan" id="kobo.143.1"> to execute the HTTP request. </span><span class="kobospan" id="kobo.143.2">You should see a response similar to the following </span><a id="_idIndexMarker073" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.144.1">from</span><a id="_idIndexMarker074" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.145.1"> the </span><span><span class="kobospan" id="kobo.146.1">OpenAI API:</span></span></p>
<pre class="source-code"><span class="kobospan1" id="kobo.147.1">
{
    "id": "chatcmpl-7l0vHiJlRrMrrWhjeJhBMEnT1HyHD",
    "object": "chat.completion",
    "created": 1691439319,
    "model": "gpt-3.5-turbo-0613",
    "choices": [
        {
            "index": 0,
            "message": {
                "role": "assistant",
                "content": "</span><strong class="bold1"><span class="kobospan1" id="kobo.148.1">Hello Ice Cream Fan, thank you for the kind words. </span><span class="kobospan1" id="kobo.148.2">We love our location and our staff too. </span><span class="kobospan1" id="kobo.148.3">SCREAM FOR ICE CREAM!</span></strong><span class="kobospan1" id="kobo.149.1">"
            },
            "finish_reason": "stop"
        }
    ],
    "usage": {
        "prompt_tokens": 177,
        "completion_tokens": 28,
        "total_tokens": 205
    }
}</span></pre> <h2 id="_idParaDest-50" class="calibre7"><a id="_idTextAnchor051" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.150.1">How it works…</span></h2>
<p class="calibre3"><span class="kobospan" id="kobo.151.1">The</span><a id="_idIndexMarker075" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.152.1"> OpenAI API works very</span><a id="_idIndexMarker076" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.153.1"> similar to the </span><strong class="bold"><span class="kobospan" id="kobo.154.1">Playground</span></strong><span class="kobospan" id="kobo.155.1">, where developers can add messages to the </span><em class="italic"><span class="kobospan" id="kobo.156.1">Chat Log</span></em><span class="kobospan" id="kobo.157.1">. </span><span class="kobospan" id="kobo.157.2">This, in turn, fine-tunes the responses that the API generates – it learns from the assistant responses that we </span><span><span class="kobospan" id="kobo.158.1">have created.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.159.1">We did this by first executing a simple chat completion request, and only specified a </span><strong class="source-inline"><span class="kobospan" id="kobo.160.1">System message</span></strong><span class="kobospan" id="kobo.161.1"> and a </span><strong class="source-inline"><span class="kobospan" id="kobo.162.1">User message</span></strong><span class="kobospan" id="kobo.163.1"> (i.e., the prompt), as shown in </span><span><em class="italic"><span class="kobospan" id="kobo.164.1">Figure 2</span></em></span><span><em class="italic"><span class="kobospan" id="kobo.165.1">.1</span></em></span><span><span class="kobospan" id="kobo.166.1">.</span></span></p>
<div class="calibre2">
<div class="img---figure" id="_idContainer018">
<span class="kobospan" id="kobo.167.1"><img alt="Figure 2.1 – Excerpt of messages object within the request body" src="image/B21007_02_1.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.168.1">Figure 2.1 – Excerpt of messages object within the request body</span></p>
<p class="calibre3"><span class="kobospan" id="kobo.169.1">This was done by adding message objects within the messages object in </span><strong class="bold"><span class="kobospan" id="kobo.170.1">Body</span></strong><span class="kobospan" id="kobo.171.1">. </span><span class="kobospan" id="kobo.171.2">Each message object must contain a </span><em class="italic"><span class="kobospan" id="kobo.172.1">role</span></em><span class="kobospan" id="kobo.173.1"> and some </span><em class="italic"><span class="kobospan" id="kobo.174.1">content</span></em><span class="kobospan" id="kobo.175.1">, as we learned in </span><a href="B21007_01.xhtml#_idTextAnchor021" class="pcalibre1 calibre6 pcalibre"><span><em class="italic"><span class="kobospan" id="kobo.176.1">Chapter 1</span></em></span></a><span><span class="kobospan" id="kobo.177.1">.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.178.1">We can then </span><a id="_idIndexMarker077" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.179.1">add additional </span><strong class="source-inline"><span class="kobospan" id="kobo.180.1">Assistant</span></strong><span class="kobospan" id="kobo.181.1"> and </span><strong class="source-inline"><span class="kobospan" id="kobo.182.1">User</span></strong><span class="kobospan" id="kobo.183.1"> messages to teach the model how it should formulate its responses. </span><span class="kobospan" id="kobo.183.2">Importantly, the model will attempt to match any pattern it sees within the messages tagged as </span><strong class="source-inline"><span class="kobospan" id="kobo.184.1">Assistant</span></strong><span class="kobospan" id="kobo.185.1">. </span><span class="kobospan" id="kobo.185.2">It is almost as if we are </span><em class="italic"><span class="kobospan" id="kobo.186.1">teaching</span></em><span class="kobospan" id="kobo.187.1"> the model how it should generate its responses. </span><span class="kobospan" id="kobo.187.2">In this case, all of the </span><strong class="source-inline"><span class="kobospan" id="kobo.188.1">Assistant</span></strong><span class="kobospan" id="kobo.189.1"> responses contained the words </span><strong class="bold"><span class="kobospan" id="kobo.190.1">Hello Ice Cream Fan</span></strong><span class="kobospan" id="kobo.191.1"> and </span><strong class="bold"><span class="kobospan" id="kobo.192.1">SCREAM FOR </span></strong><span><strong class="bold"><span class="kobospan" id="kobo.193.1">ICE CREAM!</span></strong></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.194.1">As a result </span><a id="_idIndexMarker078" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.195.1">of us adding messages to the </span><em class="italic"><span class="kobospan" id="kobo.196.1">Chat Log</span></em><span class="kobospan" id="kobo.197.1">, when we provided the API with an additional prompt, it returned a response that matched the pattern described in the </span><span><span class="kobospan" id="kobo.198.1">preceding paragraph:</span></span></p>
<p class="calibre3"><strong class="bold"><span class="kobospan" id="kobo.199.1">Hello Ice Cream Fan, thank you for the kind words. </span><span class="kobospan" id="kobo.199.2">We love our location and our staff too. </span><span class="kobospan" id="kobo.199.3">SCREAM FOR </span></strong><span><strong class="bold"><span class="kobospan" id="kobo.200.1">ICE CREAM!</span></strong></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.201.1">In this recipe, we learned how to use the Chat Completions endpoint in the OpenAI API to generate text, and how to use the System Message, User prompts, and Chat Log to modify the generated text. </span><span class="kobospan" id="kobo.201.2">This is important because the Chat Completions endpoint is the most common OpenAI API endpoint to use when integrating with other systems to create intelligent applications. </span><span class="kobospan" id="kobo.201.3">Furthermore, as we begin to load the API for practical purposes, it’s important to know how to adjust the generated text to fit our desired use case using levers such as the </span><span><span class="kobospan" id="kobo.202.1">Chat Log.</span></span></p>
<h2 id="_idParaDest-51" class="calibre7"><a id="_idTextAnchor052" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.203.1">There’s more…</span></h2>
<p class="calibre3"><span class="kobospan" id="kobo.204.1">Adding messages</span><a id="_idIndexMarker079" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.205.1"> to the </span><em class="italic"><span class="kobospan" id="kobo.206.1">Chat Log</span></em><span class="kobospan" id="kobo.207.1"> has many more purposes than just fine-tuning the assistant responses. </span><span class="kobospan" id="kobo.207.2">Another important use case is creating a chat bot, where the conversation (the preceding </span><strong class="source-inline"><span class="kobospan" id="kobo.208.1">User</span></strong><span class="kobospan" id="kobo.209.1"> and </span><strong class="source-inline"><span class="kobospan" id="kobo.210.1">Assistant</span></strong><span class="kobospan" id="kobo.211.1"> messages) must be taken into context before a response can be generated. </span><span class="kobospan" id="kobo.211.2">For instance, consider the </span><span><span class="kobospan" id="kobo.212.1">following example:</span></span></p>
<pre class="source-code"><span class="kobospan1" id="kobo.213.1">
System: You are an AI assistant that answers questions about the solar system
User: What's the largest planet in our solar system?
</span><span class="kobospan1" id="kobo.213.2">Assistant: The largest planet in the solar system is Jupiter
User: How big is it?</span></pre> <p class="calibre3"><span class="kobospan" id="kobo.214.1">Note that the</span><a id="_idIndexMarker080" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.215.1"> preceding block is pseudocode for the purposes of illustration and because it’s easier to read than the proper JSON structure that would be required for the OpenAI API. </span><span class="kobospan" id="kobo.215.2">In order to use this example in the OpenAI API, the request </span><strong class="bold"><span class="kobospan" id="kobo.216.1">Body</span></strong><span class="kobospan" id="kobo.217.1"> would need to be what is displayed in the following </span><span><span class="kobospan" id="kobo.218.1">code block:</span></span></p>
<pre class="source-code"><span class="kobospan1" id="kobo.219.1">
{
  "model": "gpt-3.5-turbo",
  "messages": [
    {
      "role": "system",
      "content": " You are an AI assistant that answers questions about the solar system"
    },
    {
      "role": "user",
      "content": "What's the largest planet in our solar system?"
</span><span class="kobospan1" id="kobo.219.2">    },
    {
      "role": "assistant",
      "content": "The largest planet in the solar system is Jupiter"
    },
    {
      "role": "user",
      "content": "How big is it?"
</span><span class="kobospan1" id="kobo.219.3">    }
  ]
}</span></pre> <p class="calibre3"><span class="kobospan" id="kobo.220.1">Here, the user</span><a id="_idIndexMarker081" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.221.1"> prompt is </span><strong class="source-inline"><span class="kobospan" id="kobo.222.1">How big is it?</span></strong><span class="kobospan" id="kobo.223.1">. </span><span class="kobospan" id="kobo.223.2">However, if we were to call the API using just this prompt, it would not generate the correct answer – in fact, it wouldn’t know at all what we were talking about because the previous </span><strong class="source-inline"><span class="kobospan" id="kobo.224.1">User</span></strong><span class="kobospan" id="kobo.225.1"> and </span><strong class="source-inline"><span class="kobospan" id="kobo.226.1">Assistant</span></strong><span class="kobospan" id="kobo.227.1"> messages are not in the </span><span><span class="kobospan" id="kobo.228.1">request </span></span><span><strong class="bold"><span class="kobospan" id="kobo.229.1">Body</span></strong></span><span><span class="kobospan" id="kobo.230.1">.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.231.1">As a result, we would need to construct the request body with all of the messages listed in the preceding code block for the model to provide an </span><span><span class="kobospan" id="kobo.232.1">accurate response.</span></span></p>
<h1 id="_idParaDest-52" class="calibre5"><a id="_idTextAnchor053" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.233.1">Creating pictures using the Images endpoint</span></h1>
<p class="calibre3"><span class="kobospan" id="kobo.234.1">The </span><a id="_idIndexMarker082" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.235.1">OpenAI API can do more than generate text (although that is its main purpose); it can also create images. </span><span class="kobospan" id="kobo.235.2">It does this with a similar methodology to text generation, but instead of predicting characters, it predicts pixels. </span><span class="kobospan" id="kobo.235.3">The inner workings of the model are complex (it involves the use of encoders, decoders, and embeddings), but that doesn’t stop us from actually using </span><span><span class="kobospan" id="kobo.236.1">the model.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.237.1">This</span><a id="_idIndexMarker083" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.238.1"> significantly opens up the types of applications you can create with the OpenAI API. </span><span class="kobospan" id="kobo.238.2">For example, you can create an application that produces stock images based on a user prompt. </span><span class="kobospan" id="kobo.238.3">In this recipe, we will use the OpenAI API to generate several types </span><span><span class="kobospan" id="kobo.239.1">of images.</span></span></p>
<h2 id="_idParaDest-53" class="calibre7"><a id="_idTextAnchor054" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.240.1">How to do it…</span></h2>
<ol class="calibre14">
<li class="calibre15"><span class="kobospan" id="kobo.241.1">In Postman, create a new request by selecting the </span><strong class="bold"><span class="kobospan" id="kobo.242.1">New</span></strong><span class="kobospan" id="kobo.243.1"> button on the top-left menu bar, and then </span><span><span class="kobospan" id="kobo.244.1">select </span></span><span><strong class="bold"><span class="kobospan" id="kobo.245.1">HTTP</span></strong></span><span><span class="kobospan" id="kobo.246.1">.</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.247.1">Change the HTTP request type from </span><strong class="bold"><span class="kobospan" id="kobo.248.1">GET</span></strong><span class="kobospan" id="kobo.249.1"> to </span><strong class="bold"><span class="kobospan" id="kobo.250.1">POST</span></strong><span class="kobospan" id="kobo.251.1"> in the </span><strong class="bold"><span class="kobospan" id="kobo.252.1">Method</span></strong><span class="kobospan" id="kobo.253.1"> drop-down menu (by default, it will be set </span><span><span class="kobospan" id="kobo.254.1">to </span></span><span><strong class="bold"><span class="kobospan" id="kobo.255.1">GET</span></strong></span><span><span class="kobospan" id="kobo.256.1">).</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.257.1">Enter the following URL as the endpoint for </span><span><span class="kobospan" id="kobo.258.1">images: </span></span><a href="https://api.openai.com/v1/images/generations" class="pcalibre1 calibre6 pcalibre"><span><span class="kobospan" id="kobo.259.1">https://api.openai.com/v1/images/generations</span></span></a></li>
<li class="calibre15"><span class="kobospan" id="kobo.260.1">Select </span><strong class="bold"><span class="kobospan" id="kobo.261.1">Headers</span></strong><span class="kobospan" id="kobo.262.1"> in the sub-menu, and add the following key-value pairs into the table </span><span><span class="kobospan" id="kobo.263.1">below it:</span></span></li>
</ol>
<table class="no-table-style" id="table002">
<colgroup class="calibre10">
<col class="calibre11"/>
<col class="calibre11"/>
</colgroup>
<tbody class="calibre13">
<tr class="no-table-style1">
<td class="no-table-style2">
<p class="calibre3"><span><em class="italic"><span class="kobospan" id="kobo.264.1">Key</span></em></span></p>
</td>
<td class="no-table-style2">
<p class="calibre3"><span><em class="italic"><span class="kobospan" id="kobo.265.1">Value</span></em></span></p>
</td>
</tr>
<tr class="no-table-style1">
<td class="no-table-style2">
<p class="calibre3"><span><strong class="source-inline"><span class="kobospan" id="kobo.266.1">Content-Type</span></strong></span></p>
</td>
<td class="no-table-style2">
<p class="calibre3"><span><strong class="source-inline"><span class="kobospan" id="kobo.267.1">application/json</span></strong></span></p>
</td>
</tr>
<tr class="no-table-style1">
<td class="no-table-style2">
<p class="calibre3"><span><strong class="source-inline"><span class="kobospan" id="kobo.268.1">Authorization</span></strong></span></p>
</td>
<td class="no-table-style2">
<p class="calibre3"><strong class="source-inline"><span class="kobospan" id="kobo.269.1">Bearer &lt;your API </span></strong><span><strong class="source-inline"><span class="kobospan" id="kobo.270.1">key here&gt;</span></strong></span></p>
</td>
</tr>
</tbody>
</table>
<p class="calibre3"><span class="kobospan" id="kobo.271.1">Select </span><strong class="bold"><span class="kobospan" id="kobo.272.1">Body</span></strong><span class="kobospan" id="kobo.273.1"> in the sub-menu and then select </span><strong class="bold"><span class="kobospan" id="kobo.274.1">raw</span></strong><span class="kobospan" id="kobo.275.1"> for the request type. </span><span class="kobospan" id="kobo.275.2">Enter the following </span><a id="_idIndexMarker084" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.276.1">and after that, </span><span><span class="kobospan" id="kobo.277.1">select </span></span><span><strong class="bold"><span class="kobospan" id="kobo.278.1">Send</span></strong></span><span><span class="kobospan" id="kobo.279.1">:</span></span></p>
<pre class="source-code"><span class="kobospan1" id="kobo.280.1">
{
    "prompt": "A dog",
    "n": 1,
    "size": "1024x1024"
}</span></pre> <p class="calibre3"><span class="kobospan" id="kobo.281.1">5.	</span><span class="kobospan" id="kobo.281.2">After</span><a id="_idIndexMarker085" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.282.1"> sending the HTTP request, you should see the following response from the OpenAI API. </span><span class="kobospan" id="kobo.282.2">Note that your response will be different – it will produce a completely different URL. </span><span class="kobospan" id="kobo.282.3">The following URL has been </span><span><span class="kobospan" id="kobo.283.1">artificially condensed:</span></span></p>
<pre class="source-code"><span class="kobospan1" id="kobo.284.1">
{
    "created": 1691525818,
    "data": [
        {
            "url": </span><strong class="bold1"><span class="kobospan1" id="kobo.285.1">"https://oaidalleapiprodscus.blob.core.windows.net/private/org-SdhfpAqxiHTuyKDLiHYAve6V/user-6A9i4gNyfxN9e9i2e0IUqomI/img-[...]%3D"</span></strong><span class="kobospan1" id="kobo.286.1">
        }
    ]
}</span></pre> <p class="calibre3"><span class="kobospan" id="kobo.287.1">6.	</span><span class="kobospan" id="kobo.287.2">The image</span><a id="_idIndexMarker086" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.288.1"> is contained within the URL that is generated in the response. </span><span class="kobospan" id="kobo.288.2">Copy the URL from the </span><strong class="source-inline"><span class="kobospan" id="kobo.289.1">url</span></strong><span class="kobospan" id="kobo.290.1"> object and paste it into your internet browser. </span><span class="kobospan" id="kobo.290.2">You should see an image of a dog. </span><span class="kobospan" id="kobo.290.3">Similar to text generation, the image that you see will be different than the </span><span><span class="kobospan" id="kobo.291.1">following one.</span></span></p>
<div class="calibre2">
<div class="img---figure" id="_idContainer019">
<span class="kobospan" id="kobo.292.1"><img alt="Figure 2.2 – Output of DALLE-2 OpenAI image generation of a dog" src="image/B21007_02_2.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.293.1">Figure 2.2 – Output of DALLE-2 OpenAI image generation of a dog</span></p>
<p class="calibre3"><span class="kobospan" id="kobo.294.1">7.	</span><span class="kobospan" id="kobo.294.2">Return </span><a id="_idIndexMarker087" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.295.1">to Postman and modify the request </span><strong class="bold"><span class="kobospan" id="kobo.296.1">Body</span></strong><span class="kobospan" id="kobo.297.1">. </span><span class="kobospan" id="kobo.297.2">Change the prompt object to the following phrase and then select </span><strong class="bold"><span class="kobospan" id="kobo.298.1">Send</span></strong><span class="kobospan" id="kobo.299.1">: </span><strong class="source-inline"><span class="kobospan" id="kobo.300.1">A brown furry medium-sized corgi dog on a green grass field, </span></strong><span><strong class="source-inline"><span class="kobospan" id="kobo.301.1">profile view</span></strong></span><span><span class="kobospan" id="kobo.302.1">.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.303.1">8.	</span><span class="kobospan" id="kobo.303.2">Copy and paste the URL from the </span><strong class="bold"><span class="kobospan" id="kobo.304.1">Response</span></strong><span class="kobospan" id="kobo.305.1"> field into your browser, and should see a clear photo of a </span><span><span class="kobospan" id="kobo.306.1">Corgi dog.</span></span></p>
<div class="calibre2">
<div class="img---figure" id="_idContainer020">
<span class="kobospan" id="kobo.307.1"><img alt="Figure 2.3 – Output of DALL-E 2 OpenAI image generation with a more detailed prompt" src="image/B21007_02_3.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.308.1">Figure 2.3 – Output of DALL-E 2 OpenAI image generation with a more detailed prompt</span></p>
<h2 id="_idParaDest-54" class="calibre7"><a id="_idTextAnchor055" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.309.1">How it works…</span></h2>
<p class="calibre3"><span class="kobospan" id="kobo.310.1">The Images endpoint</span><a id="_idIndexMarker088" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.311.1"> works using an AI model called </span><strong class="bold"><span class="kobospan" id="kobo.312.1">DALL-E</span></strong><span class="kobospan" id="kobo.313.1">, which</span><a id="_idIndexMarker089" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.314.1"> is a variation of the GPT model, but used to produce visualizations instead of text output. </span><span class="kobospan" id="kobo.314.2">The model was trained on several billion image-text prompts to associate certain textual characteristics with visual representations. </span><span class="kobospan" id="kobo.314.3">The power of this model is available within OpenAI, but a particular endpoint needs to be used, as we described in </span><span><span class="kobospan" id="kobo.315.1">the recipe.</span></span></p>
<p class="callout-heading"><span class="kobospan" id="kobo.316.1">Note</span></p>
<p class="callout"><span class="kobospan" id="kobo.317.1">DALL-E was introduced by OpenAI in early 2021 as its first text-to-image generation model. </span><span class="kobospan" id="kobo.317.2">DALL-E 2, its next iteration, was released one year </span><span><span class="kobospan" id="kobo.318.1">later (</span></span><a href="https://openai.com/dall-e-2" class="pcalibre1 calibre6 pcalibre"><span><span class="kobospan" id="kobo.319.1">https://openai.com/dall-e-2</span></span></a><span><span class="kobospan" id="kobo.320.1">).</span></span></p>
<p class="callout"><span class="kobospan" id="kobo.321.1">Both DALL-E and DALL-E 2 serve the same purpose (generating images from text) and are even called using the same API. </span><span class="kobospan" id="kobo.321.2">The key difference is that DALL-E 2 employs a more advanced and more popular technique </span><a id="_idIndexMarker090" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.322.1">called </span><strong class="bold"><span class="kobospan" id="kobo.323.1">diffusion</span></strong><span class="kobospan" id="kobo.324.1">, a particular image generation method that leads to more realistic and </span><span><span class="kobospan" id="kobo.325.1">high-resolution images.</span></span></p>
<p class="callout"><span class="kobospan" id="kobo.326.1">In this book, DALL-E and DALL-E 2 will be used interchangeably to refer to the OpenAI’s text-to-image </span><span><span class="kobospan" id="kobo.327.1">generation model.</span></span></p>
<h3 class="calibre8"><span class="kobospan" id="kobo.328.1">Request body and response</span></h3>
<p class="calibre3"><span class="kobospan" id="kobo.329.1">The request </span><strong class="bold"><span class="kobospan" id="kobo.330.1">Body</span></strong><span class="kobospan" id="kobo.331.1"> for</span><a id="_idIndexMarker091" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.332.1"> the Images endpoint is actually far simpler than the Chat Completions endpoint. </span><span class="kobospan" id="kobo.332.2">Here are all </span><span><span class="kobospan" id="kobo.333.1">its components:</span></span></p>
<ul class="calibre16">
<li class="calibre15"><strong class="source-inline1"><span class="kobospan" id="kobo.334.1">prompt</span></strong><span class="kobospan" id="kobo.335.1">: This is the textual instruction provided to the model for image generation. </span><span class="kobospan" id="kobo.335.2">Usually, the more detailed this statement is, the more accurate your desired image </span><span><span class="kobospan" id="kobo.336.1">will be.</span></span></li>
<li class="calibre15"><strong class="source-inline1"><span class="kobospan" id="kobo.337.1">n</span></strong><span class="kobospan" id="kobo.338.1">: This expresses to the API the number of images that the model should generate. </span><span class="kobospan" id="kobo.338.2">Each image will have slightly different variations, as the model attempts to provide different interpretations or angles based on </span><span><span class="kobospan" id="kobo.339.1">the prompt.</span></span></li>
<li class="calibre15"><strong class="source-inline1"><span class="kobospan" id="kobo.340.1">size</span></strong><span class="kobospan" id="kobo.341.1">: This specifies the dimensions of the generated image. </span><span class="kobospan" id="kobo.341.2">Note that, at this point, only the following image sizes can be created: 256x256, 512x512, </span><span><span class="kobospan" id="kobo.342.1">and 1024x1024.</span></span></li>
</ul>
<p class="calibre3"><span class="kobospan" id="kobo.343.1">The </span><strong class="bold"><span class="kobospan" id="kobo.344.1">Response</span></strong><span class="kobospan" id="kobo.345.1"> that </span><a id="_idIndexMarker092" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.346.1">we receive from the Images endpoint is also very easy </span><span><span class="kobospan" id="kobo.347.1">to understand:</span></span></p>
<ul class="calibre16">
<li class="calibre15"><strong class="source-inline1"><span class="kobospan" id="kobo.348.1">created</span></strong><span class="kobospan" id="kobo.349.1">: This represents the Unix timestamp of when the image </span><span><span class="kobospan" id="kobo.350.1">was generated</span></span></li>
<li class="calibre15"><strong class="source-inline1"><span class="kobospan" id="kobo.351.1">data</span></strong><span class="kobospan" id="kobo.352.1">: The value of this object is actually an array of objects, each containing the </span><span><strong class="source-inline1"><span class="kobospan" id="kobo.353.1">url</span></strong></span><span><span class="kobospan" id="kobo.354.1"> parameter:</span></span><ul class="calibre17"><li class="calibre15"><strong class="source-inline1"><span class="kobospan" id="kobo.355.1">url</span></strong><span class="kobospan" id="kobo.356.1">: This contains the direct link to the </span><span><span class="kobospan" id="kobo.357.1">generated image</span></span></li></ul></li>
</ul>
<h3 class="calibre8"><span class="kobospan" id="kobo.358.1">Importance of being detailed</span></h3>
<p class="calibre3"><span class="kobospan" id="kobo.359.1">Unlike text generation, where you can afford to be a bit general and any ambiguity is usually addressed by the context of the Chat Log and System Message, image generation requires detailed, descriptive, and specific language to produced the desired output. </span><span class="kobospan" id="kobo.359.2">We clearly saw this in this recipe. </span><span class="kobospan" id="kobo.359.3">The simle prompt, </span><strong class="source-inline"><span class="kobospan" id="kobo.360.1">A dog</span></strong><span class="kobospan" id="kobo.361.1">, resulted in a standard image of a dog, but observe in </span><span><em class="italic"><span class="kobospan" id="kobo.362.1">Figure 2</span></em></span><em class="italic"><span class="kobospan" id="kobo.363.1">.4</span></em><span class="kobospan" id="kobo.364.1"> the variation of images that are produced when we run image generation again with the </span><span><span class="kobospan" id="kobo.365.1">same prompt.</span></span></p>
<div class="calibre2">
<div class="img---figure" id="_idContainer021">
<span class="kobospan" id="kobo.366.1"><img alt="Figure 2.4 – Outputs generated for the same image prompt" src="image/B21007_02_4.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.367.1">Figure 2.4 – Outputs generated for the same image prompt</span></p>
<p class="calibre3"><span class="kobospan" id="kobo.368.1">The images contain different types of dogs, different environments, different angles, and different lighting. </span><span class="kobospan" id="kobo.368.2">Compare this to the more detailed prompt we used – the following figure shows the additional images that were produced by the more detailed prompt about a Corgi in </span><span><span class="kobospan" id="kobo.369.1">this recipe.</span></span></p>
<div class="calibre2">
<div class="img---figure" id="_idContainer022">
<span class="kobospan" id="kobo.370.1"><img alt="Figure 2.5 – Different outputs generated from a specific prompt" src="image/B21007_02_5.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.371.1">Figure 2.5 – Different outputs generated from a specific prompt</span></p>
<p class="calibre3"><span class="kobospan" id="kobo.372.1">A more descriptive prompt significantly narrows down the possibilities, guiding the model towards producing an image that matches the user’s wants and intentions. </span><span class="kobospan" id="kobo.372.2">It’s important to specify colors, positioning, objects, emotions, lighting, and other details so that the user can ensure that the generated image is not only relevant but also intricately tailored to </span><span><span class="kobospan" id="kobo.373.1">their requirements.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.374.1">The Images endpoint in the OpenAI API unlocks a variety of different use cases. </span><span class="kobospan" id="kobo.374.2">For example, the endpoint can be used to build personalized pictures in stories, visualize different food recipe ideas, and even create funny pictures for greeting cards. </span><span class="kobospan" id="kobo.374.3">The possibilities are </span><span><span class="kobospan" id="kobo.375.1">truly endless!</span></span></p>
<h1 id="_idParaDest-55" class="calibre5"><a id="_idTextAnchor056" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.376.1">Generating transcripts using the Audio endpoint</span></h1>
<p class="calibre3"><span class="kobospan" id="kobo.377.1">In this recipe, we will </span><a id="_idIndexMarker093" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.378.1">learn how to use the OpenAI API’s Audio endpoint, which converts audio into text. </span><span class="kobospan" id="kobo.378.2">This enables developers to </span><a id="_idIndexMarker094" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.379.1">create voice applications, such as voice agents and speech </span><span><span class="kobospan" id="kobo.380.1">conversational bots.</span></span></p>
<h2 id="_idParaDest-56" class="calibre7"><a id="_idTextAnchor057" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.381.1">Getting ready</span></h2>
<p class="calibre3"><span class="kobospan" id="kobo.382.1">This recipe will also use Postman, but the typical set of Headers that we use will need to be modified so that the HTTP client uses form data instead of typical JSON. </span><span class="kobospan" id="kobo.382.2">In addition, we must have a sample audio file that we can use as an example to convert speech to text. </span><strong class="bold"><span class="kobospan" id="kobo.383.1">Form data</span></strong><span class="kobospan" id="kobo.384.1"> is a </span><a id="_idIndexMarker095" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.385.1">way to encode and send data as key-value pairs in HTTP requests instead of JSON-formatted strings. </span><span class="kobospan" id="kobo.385.2">Form data is often used for </span><span><span class="kobospan" id="kobo.386.1">uploading files.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.387.1">After opening a new request in Postman, navigate to the </span><strong class="bold"><span class="kobospan" id="kobo.388.1">Headers</span></strong><span class="kobospan" id="kobo.389.1"> menu and delete the </span><strong class="source-inline"><span class="kobospan" id="kobo.390.1">Content-Type application/json</span></strong><span class="kobospan" id="kobo.391.1"> entry. </span><span class="kobospan" id="kobo.391.2">This will force Postman to default to the </span><strong class="source-inline"><span class="kobospan" id="kobo.392.1">Content-Type</span></strong><span class="kobospan" id="kobo.393.1"> of the request based on what is passed in the </span><span><span class="kobospan" id="kobo.394.1">request </span></span><span><strong class="bold"><span class="kobospan" id="kobo.395.1">Body</span></strong></span><span><span class="kobospan" id="kobo.396.1">.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.397.1">Next, we need an audio file. </span><span class="kobospan" id="kobo.397.2">Any short (i.e., less than a minute) file will do, but it must contain words that can be transcribed and must be in one of the following formats: </span><strong class="source-inline"><span class="kobospan" id="kobo.398.1">.mp3</span></strong><span class="kobospan" id="kobo.399.1">, </span><strong class="source-inline"><span class="kobospan" id="kobo.400.1">.mp4</span></strong><span class="kobospan" id="kobo.401.1">, </span><strong class="source-inline"><span class="kobospan" id="kobo.402.1">.mpeg</span></strong><span class="kobospan" id="kobo.403.1">, </span><strong class="source-inline"><span class="kobospan" id="kobo.404.1">.mpga</span></strong><span class="kobospan" id="kobo.405.1">, </span><strong class="source-inline"><span class="kobospan" id="kobo.406.1">.m4a</span></strong><span class="kobospan" id="kobo.407.1">, </span><strong class="source-inline"><span class="kobospan" id="kobo.408.1">.wav</span></strong><span class="kobospan" id="kobo.409.1">, or </span><strong class="source-inline"><span class="kobospan" id="kobo.410.1">.webm</span></strong><span class="kobospan" id="kobo.411.1">. </span><span class="kobospan" id="kobo.411.2">You can also download a 10-second audio snip that I cr</span><a href="https://github.com/hasygithub/ChatGPT-API-Book/raw/main/audiosample.mp3" class="pcalibre1 calibre6 pcalibre"><span class="kobospan" id="kobo.412.1">eated </span><span><span class="kobospan" id="kobo.413.1">here: </span></span><span><span class="kobospan" id="kobo.414.1">https://github.com/hasygithub/ChatGPT-API-Book/raw/main/aud</span></span></a><span><span class="kobospan" id="kobo.415.1">iosample.mp3</span></span><span><span class="kobospan" id="kobo.416.1">.</span></span></p>
<h2 id="_idParaDest-57" class="calibre7"><a id="_idTextAnchor058" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.417.1">How to do it…</span></h2>
<p class="calibre3"><span class="kobospan" id="kobo.418.1">We can add examples of prompts and responses to the Chat Log to modify the model’s behavior. </span><span class="kobospan" id="kobo.418.2">Let’s observe this with the </span><span><span class="kobospan" id="kobo.419.1">following steps:</span></span></p>
<ol class="calibre14">
<li class="calibre15"><span class="kobospan" id="kobo.420.1">In Postman, change the </span><strong class="bold"><span class="kobospan" id="kobo.421.1">Endpoint</span></strong><span class="kobospan" id="kobo.422.1"> value to the following URL and change the request type </span><span><span class="kobospan" id="kobo.423.1">to </span></span><span><strong class="bold"><span class="kobospan" id="kobo.424.1">Post</span></strong></span><span><span class="kobospan" id="kobo.425.1">:</span></span><pre class="source-code"><span class="kobospan1" id="kobo.426.1">
https://api.openai.com/v1/audio/transcriptions</span></pre></li> <li class="calibre15"><span class="kobospan" id="kobo.427.1">Select </span><strong class="bold"><span class="kobospan" id="kobo.428.1">Body</span></strong><span class="kobospan" id="kobo.429.1">, and then select the </span><strong class="bold"><span class="kobospan" id="kobo.430.1">form-data</span></strong><span class="kobospan" id="kobo.431.1"> radio button. </span><span class="kobospan" id="kobo.431.2">This will open the form </span><a id="_idIndexMarker096" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.432.1">data fields. </span><span class="kobospan" id="kobo.432.2">Each field contains a </span><strong class="bold"><span class="kobospan" id="kobo.433.1">Key</span></strong><span class="kobospan" id="kobo.434.1"> and </span><span><span class="kobospan" id="kobo.435.1">a </span></span><span><strong class="bold"><span class="kobospan" id="kobo.436.1">Value</span></strong></span><span><span class="kobospan" id="kobo.437.1">.</span></span></li>
</ol>
<p class="callout-heading"><span class="kobospan" id="kobo.438.1">Note</span></p>
<p class="callout"><span class="kobospan" id="kobo.439.1">We have the option to set each field as </span><strong class="bold"><span class="kobospan" id="kobo.440.1">Text</span></strong><span class="kobospan" id="kobo.441.1"> or </span><strong class="bold"><span class="kobospan" id="kobo.442.1">File</span></strong><span class="kobospan" id="kobo.443.1">. </span><span class="kobospan" id="kobo.443.2">We can do this by hovering over </span><strong class="bold"><span class="kobospan" id="kobo.444.1">Key</span></strong><span class="kobospan" id="kobo.445.1"> and selecting our chosen option from the drop-down menu, as demonstrated in </span><span><em class="italic"><span class="kobospan" id="kobo.446.1">Figure 2</span></em></span><span><em class="italic"><span class="kobospan" id="kobo.447.1">.6</span></em></span><span><span class="kobospan" id="kobo.448.1">.</span></span></p>
<ol class="calibre14">
<li value="3" class="calibre15"><span class="kobospan" id="kobo.449.1">Enter </span><a id="_idIndexMarker097" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.450.1">the following fields in the </span><span><span class="kobospan" id="kobo.451.1">form data:</span></span></li>
</ol>
<table class="no-table-style" id="table003">
<colgroup class="calibre10">
<col class="calibre11"/>
<col class="calibre11"/>
</colgroup>
<tbody class="calibre13">
<tr class="no-table-style1">
<td class="no-table-style2">
<p class="calibre3"><span><em class="italic"><span class="kobospan" id="kobo.452.1">Key</span></em></span></p>
</td>
<td class="no-table-style2">
<p class="calibre3"><span><em class="italic"><span class="kobospan" id="kobo.453.1">Instruction/Value</span></em></span></p>
</td>
</tr>
<tr class="no-table-style1">
<td class="no-table-style2">
<p class="calibre3"><span><strong class="source-inline"><span class="kobospan" id="kobo.454.1">file</span></strong></span></p>
</td>
<td class="no-table-style2">
<p class="calibre3"><span class="kobospan" id="kobo.455.1">Click </span><strong class="bold"><span class="kobospan" id="kobo.456.1">Select Files</span></strong><span class="kobospan" id="kobo.457.1"> and upload the audio file you created or </span><span><span class="kobospan" id="kobo.458.1">downloaded earlier</span></span></p>
</td>
</tr>
<tr class="no-table-style1">
<td class="no-table-style2">
<p class="calibre3"><span><strong class="source-inline"><span class="kobospan" id="kobo.459.1">model</span></strong></span></p>
</td>
<td class="no-table-style2">
<p class="calibre3"><span><strong class="source-inline"><span class="kobospan" id="kobo.460.1">whisper-1</span></strong></span></p>
</td>
</tr>
</tbody>
</table>
<div class="calibre2">
<div class="img---figure" id="_idContainer023">
<span class="kobospan" id="kobo.461.1"><img alt="Figure 2.6 – Selecting field types in Postman" src="image/B21007_02_6.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.462.1">Figure 2.6 – Selecting field types in Postman</span></p>
<p class="calibre3"><span class="kobospan" id="kobo.463.1">4.	</span><span class="kobospan" id="kobo.463.2">Select the </span><strong class="bold"><span class="kobospan" id="kobo.464.1">Send</span></strong><span class="kobospan" id="kobo.465.1"> button to submit the </span><span><span class="kobospan" id="kobo.466.1">HTTP request.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.467.1">5.	</span><span class="kobospan" id="kobo.467.2">You should </span><a id="_idIndexMarker098" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.468.1">see the following response</span><a id="_idIndexMarker099" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.469.1"> from OpenAI, specifying the text that </span><span><span class="kobospan" id="kobo.470.1">was transcribed:</span></span></p>
<pre class="source-code"><span class="kobospan1" id="kobo.471.1">
{
"text": "This is a test of the Whisper model."
</span><span class="kobospan1" id="kobo.471.2">}</span></pre> <h2 id="_idParaDest-58" class="calibre7"><a id="_idTextAnchor059" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.472.1">How it works…</span></h2>
<p class="calibre3"><span class="kobospan" id="kobo.473.1">This recipe</span><a id="_idIndexMarker100" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.474.1"> uses the </span><em class="italic"><span class="kobospan" id="kobo.475.1">Audio</span></em><span class="kobospan" id="kobo.476.1"> endpoint, but note that the way we interacted with this endpoint’s API was completely different than the other endpoints. </span><span class="kobospan" id="kobo.476.2">In particular, this endpoint expects the </span><strong class="source-inline"><span class="kobospan" id="kobo.477.1">Content-Type</span></strong><span class="kobospan" id="kobo.478.1"> of the request to be </span><strong class="source-inline"><span class="kobospan" id="kobo.479.1">form-data</span></strong><span class="kobospan" id="kobo.480.1">, instead of the typical JSON structure that we saw previously. </span><span class="kobospan" id="kobo.480.2">The reason for this is because </span><strong class="source-inline"><span class="kobospan" id="kobo.481.1">form-data</span></strong><span class="kobospan" id="kobo.482.1"> is capable of handling file streaming, which we needed here as we are uploading audio to OpenAI. </span><span class="kobospan" id="kobo.482.2">In the other endpoints, raw JSON is sufficient because only text is being sent to OpenAI, </span><span><span class="kobospan" id="kobo.483.1">not files.</span></span></p>
<p class="calibre3"><strong class="bold"><span class="kobospan" id="kobo.484.1">HTTP requests</span></strong><span class="kobospan" id="kobo.485.1"> are the bedrock of data communication on the web and are frequently used to interact with APIs. </span><span class="kobospan" id="kobo.485.2">Two options for sending data within HTTP requests are </span><strong class="bold"><span class="kobospan" id="kobo.486.1">JSON</span></strong><span class="kobospan" id="kobo.487.1"> and </span><strong class="bold"><span class="kobospan" id="kobo.488.1">forms</span></strong><span class="kobospan" id="kobo.489.1">. </span><span class="kobospan" id="kobo.489.2">JSON has now become the ubiquitous data interchange format due to its flexibility in structure – it can be used to communicate key-value pairs, lists, and hierarchy concepts. </span><span class="kobospan" id="kobo.489.3">However, the reason we used forms is that they enable developers to encode binary data. </span><span class="kobospan" id="kobo.489.4">In short, forms enable you to transfer files (such as a 10-second MP3 file, in </span><span><span class="kobospan" id="kobo.490.1">this case).</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.491.1">In the form, there were two fields: </span><strong class="bold"><span class="kobospan" id="kobo.492.1">file</span></strong><span class="kobospan" id="kobo.493.1"> and </span><strong class="bold"><span class="kobospan" id="kobo.494.1">model</span></strong><span class="kobospan" id="kobo.495.1">. </span><span class="kobospan" id="kobo.495.2">The </span><strong class="bold"><span class="kobospan" id="kobo.496.1">file</span></strong><span class="kobospan" id="kobo.497.1"> field represents the audio file object that we want to transcribe, and the </span><strong class="bold"><span class="kobospan" id="kobo.498.1">model</span></strong><span class="kobospan" id="kobo.499.1"> field represents the particular transcription model we want to use – which, in this case, was actually limited to only one </span><span><span class="kobospan" id="kobo.500.1">option: </span></span><span><strong class="bold"><span class="kobospan" id="kobo.501.1">whisper-1</span></strong></span><span><span class="kobospan" id="kobo.502.1">.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.503.1">The </span><strong class="bold"><span class="kobospan" id="kobo.504.1">Response</span></strong><span class="kobospan" id="kobo.505.1"> is simple – a JSON with one object (</span><em class="italic"><span class="kobospan" id="kobo.506.1">text</span></em><span class="kobospan" id="kobo.507.1">), representing the </span><span><span class="kobospan" id="kobo.508.1">transcribed text.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.509.1">Now that we know how to use this endpoint, we can integrate it to create powerful and smart business applications. </span><span class="kobospan" id="kobo.509.2">For example, typical workflows such as transcribing recorded meetings and lectures can be done with a single API request. </span><span class="kobospan" id="kobo.509.3">Several endpoints can be chained together for even more advanced use cases. </span><span class="kobospan" id="kobo.509.4">For example, we can create voice assistants similar to Siri that take a recorded voice, convert it to text, and then call the Chat Completions API to get </span><span><span class="kobospan" id="kobo.510.1">a response.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.511.1">It’s important to </span><a id="_idIndexMarker101" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.512.1">know that the OpenAI API is more than just text generation; it can perform image generation, voice-to-text, and even create embeddings for semantic search. </span><span class="kobospan" id="kobo.512.2">The OpenAI API is a collection of several different endpoints that, when combined, offer developers an invaluable set of tools to build </span><span><span class="kobospan" id="kobo.513.1">intelligent applications.</span></span></p>
</div>
</body></html>