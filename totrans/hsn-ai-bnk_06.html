<html><head></head><body>
        <section>

                            <header class="header-title chapter-title">
                    Mechanizing Capital Market Decisions
                </header>
            
            <article>
                
<p class="mce-root">In the previous chapter, we learned about reinforcement learning. We learned how to automate bank decision-making using reinforcement learning. We also learned about AI modeling techniques such as Monte Carlo simulation, the logistic regression model, decision trees, neural networks, and deep learning. We then learned how to build a bankruptcy risk prediction model and used decision-making to fund a loan using reinforcement learning.</p>
<p>In this chapter, we will understand the basic financial and capital market concepts. We will look at how AI can help us in optimizing the best capital structure by running the risk models to generate sales forecasts using macro-economic data. It is useful to plan the internal financial areas of an organization and the external investors' communication. Along with commercial banking activities, which include funding the day-to-day transaction activities of a company, investment banking seeks to pull investors' money behind companies that may want more flexibility in terms of their capital deployment for medium- to long-term activities from these capital-raising markets. We will look at two examples that will help you with financially planning for capital demand.</p>
<p class="mce-root">We will cover the following topics in this chapter:</p>
<ul>
<li>Understanding the vision of investment banking</li>
<li>Basic concepts of the finance domain</li>
<li>AI modeling techniques</li>
<li>Finding the optimal capital structure</li>
<li>Providing a financial performance forecast using macroeconomic scenarios</li>
</ul>
<p>Let's get started!</p>
<h1 id="uuid-63df826b-a05a-4b67-a2a7-d9bc12e30363">Understanding the vision of investment banking</h1>
<p>Before we look at the basic concepts of the financial domain, we have to understand the vision of investment banking. The future of investment banking depends on how accurately the future financial performance and behaviors of companies are estimated, as well as how the key factors for the businesses are captured in the model as features. Distributing securities to investors will be automated, as will the syndication desk. The next two chapters will go through the changes that will be made on the client side in regards to their capital decisions, as well as the change on the investment bankers side regarding how to use the model to source investors so that they support the clients' capital needs (clients who raise capital via debt or equity issues are called <strong>issuers</strong>), as well as predicting the M&amp;A needs of clients based on the financial aspects.</p>
<h2 id="uuid-ad534e6f-969d-417d-a4bf-455188206793">Performance of investment banking-based businesses</h2>
<p>Once all these predictions are made by machines, automated filing will be implemented via an API that connects firms to the regulators and exchanges. The following diagram shows how issuers, investment bankers, investors/owners, and regulators/exchanges work and coordinate:</p>
<p class="CDPAlignCenter CDPAlign"><img class="aligncenter size-full wp-image-1143 image-border" src="assets/4b75e0ca-7d78-4a86-bc0c-9f9aabadd419.png" style="width:31.25em;height:21.25em;"/></p>
<p>In the preceding diagram, <strong>Issuers</strong> are legal entities associated with registering and selling security. Issuers sell this security in order to finance the operations of the entity. The tasks that issuers have to perform include preparing financial reports and assessing financial needs. <span>The investment bankers facilitate the listing and approval process by performing various operations for issuers.</span></p>
<h1 id="uuid-658492e5-8654-4595-9b72-fd73ee129995" class="">Basic concepts of the finance domain</h1>
<p>In this section, we will look at basic concepts of the finance domain. We will start off by looking at how financial statements are formed. We will also understand the theoretical part of how to optimize capital structure.</p>
<h2 id="uuid-29759069-ad7d-4e2a-b5f6-523dcd5cedea">Financial statements</h2>
<p>Financial statements are used for the health report of a company. A financial report is part of an annual report for the listed company and is the basis of reading the financial health of a company.</p>
<p>Bankers recommend financial products from the results provided in this report, while investors make decisions by referencing this report for investment decisions. With regard to financial statements, there are two major types:</p>
<ul>
<li><strong><span>B</span>alance sheet</strong>: This is <span>about the overall net worth</span>. It details the total investment (assets), what we owe to the other as debt (for example, credit card and mortgage, liability, and so on), and the net of the investment-less liability, that is, the net worth (equity).</li>
<li><strong>Profit and loss<span> </span>account</strong><span> </span>(<strong>P&amp;L</strong> or income statement): This type shows the dynamics of the financial year. It is <span>like the monthly expenses and income report.</span></li>
</ul>
<p>Besides the major types, we also have the following types of financial statements:</p>
<ul>
<li>Equity change</li>
<li>Statement of comprehensive income</li>
<li>Cash flow statement</li>
</ul>
<p>These describe the changes in the owner's stakes, the income that wasn't captured in the income statement issue, and cash movement. However, we will not look at these three statements in order to simplify the scope of our examples.</p>
<h3 id="uuid-bbd189cc-dcc1-45aa-88b6-0a3b4fabfd09"><strong>Real-time financial reporting</strong></h3>
<p><span>Every transaction is given as input to the accounting system, while every transaction is classified into an account, which will be classified into one or two of these statements. At the end of the day, each account will be categorized as an account entry. </span></p>
<p>By analyzing the time series data (in <a href="9ee6480e-c259-4e5d-bc11-31057de1a173.xhtml">Chapter 2</a>, <em>Time Series Analysis</em>), we can clearly see the limitations of the long-range forecast. Therefore, to produce an accurate forecast, our approach shifts to performing frequently updated short-term forecasts. Since we are part of a corporation, it is entirely possible to generate a daily financial statement based on transactional data flowing through the system on a daily basis. For those who have no idea about accounting systems and financial reports, our Excel sheet provides an example of how transaction data gets aggregated as a financial report. <span>The following table shows how the account is classified into the balance sheet and the profit and loss statement:</span></p>
<table style="border-collapse: collapse;width: 100%" border="1">
<tbody>
<tr>
<td class="CDPAlignCenter CDPAlign">
<p><strong>Item</strong></p>
</td>
<td class="CDPAlignCenter CDPAlign">
<p><strong>Asset</strong></p>
</td>
<td class="CDPAlignCenter CDPAlign">
<p><strong>Equity</strong></p>
</td>
<td class="CDPAlignCenter CDPAlign">
<p><strong>Liability</strong></p>
</td>
<td class="CDPAlignCenter CDPAlign">
<p><strong>P&amp;L</strong></p>
</td>
</tr>
<tr>
<td class="CDPAlignCenter CDPAlign">
<p>Share capital</p>
</td>
<td class="CDPAlignCenter CDPAlign">
<p>Y</p>
</td>
<td class="CDPAlignCenter CDPAlign">
<p>Y</p>
</td>
<td class="CDPAlignCenter CDPAlign"/>
<td class="CDPAlignCenter CDPAlign"/>
</tr>
<tr>
<td class="CDPAlignCenter CDPAlign">
<p>Working capital</p>
</td>
<td class="CDPAlignCenter CDPAlign">
<p>Y</p>
</td>
<td class="CDPAlignCenter CDPAlign">
<p>Y</p>
</td>
<td class="CDPAlignCenter CDPAlign"/>
<td class="CDPAlignCenter CDPAlign">
<p>Y</p>
</td>
</tr>
<tr>
<td class="CDPAlignCenter CDPAlign">
<p>Capex</p>
</td>
<td class="CDPAlignCenter CDPAlign">
<p>Y</p>
</td>
<td class="CDPAlignCenter CDPAlign">
<p>Y</p>
</td>
<td class="CDPAlignCenter CDPAlign"/>
<td class="CDPAlignCenter CDPAlign">
<p>Y</p>
</td>
</tr>
<tr>
<td class="CDPAlignCenter CDPAlign">
<p>Debt capital</p>
</td>
<td class="CDPAlignCenter CDPAlign">
<p>Y</p>
</td>
<td class="CDPAlignCenter CDPAlign"/>
<td class="CDPAlignCenter CDPAlign">
<p>Y</p>
</td>
<td class="CDPAlignCenter CDPAlign"/>
</tr>
<tr>
<td class="CDPAlignCenter CDPAlign">
<p>Bank loan</p>
</td>
<td class="CDPAlignCenter CDPAlign">
<p>Y</p>
</td>
<td class="CDPAlignCenter CDPAlign"/>
<td class="CDPAlignCenter CDPAlign">
<p>Y</p>
</td>
<td class="CDPAlignCenter CDPAlign"/>
</tr>
</tbody>
</table>
<p class="mce-root"/>
<p><strong>Share capital</strong><span> </span>is the amount of money (capital means money that is productive) we have contributed to the birth of a company. It's like the resources we receive from parents at birth. It goes to the equity of a company and, naturally, is part of the assets owned by the company. Shareholders are the people who contribute to the capital of the company; thus, they are the owners of the company. A company is expected to pay out dividends (this can be cash or in the form of company shares) to reward investors, mostly on an annual basis. With regard to the money they own in the company, they own everything after repaying what they owe others (as liabilities).</p>
<p><strong>Working capital and capex (capital expenditure)</strong><span> </span>are like our regular recurrent expenses that are required to run our households, such as groceries, bills, and fuel. Think of capex is a major home repair that makes your owned house look better and leads to higher market value, or a new car that you buy to work as an Uber driver (for AI researchers, a GPU computer could be a capex). In this way, anything that impacts P&amp;L will impact equity and assets, which means what we earn as net income will be part of our net worth and our assets. For corporations, capex is spent to acquire properties and equipment.</p>
<p><strong>Liabilities:</strong><span> </span>Debt capital and bank loans are borrowed money and assets. When we borrow these liabilities, they normally come in as cash, but we will immediately pay out this cash for capital expenditure. Bondholders and lenders are people that contribute the debt capital and bank loans to the company. The company is expected to pay the interest (cash) to reward the lenders/bondholders, mostly on a biannual basis. The bond interest is also known as a <strong>coupon</strong>. The amount we borrow is called the <strong>principal</strong>. So, in every borrowing relationship, we have a principal as well as interest.</p>
<p><strong>The objective of the CFO:</strong><span> </span>With different kinds of capital or money, you might be wondering why there is a firm/company in the first place. What is it supposed to do? According to<span> </span>Max Weber (<a href="http://sk.sagepub.com/books/writers-on-organizations">http://sk.sagepub.com/books/writers-on-organizations</a>), a firm is supposed to deliver economic value efficiently by organizing the resources within the firm. So, being a CFO means that we are organizing the financial resources to support the delivery of the firm's major economic activities, which could be generating energy for Duke Energy or organizing goods  so that they reach our end customers in supermarkets.</p>
<h2 id="uuid-6770baf3-7701-4e3d-a594-20179425a488">Theories for optimizing the best structure of the firm</h2>
<p>The best capital structure is to channel financing to fund the development of the firm while maximizing the investors' investment values with the right risk appetite that best fits the company's business. For example, when the company is in the development stage and the future is unsure, it's better to fund it using the capital that's sticky, that is, equity. When the company becomes stable, it is very common to match it with stable funding, that is, bonds.</p>
<h3 id="uuid-4e29b406-369f-4a32-a9a0-1aee537e7e57">What decisions need to be made?</h3>
<p>The decision we want to make as a long-term strategic CFO is the right mix of equity and the debt we need to fund the company. On the equity side, we need to consider how many shares we issue to bring in these owners, as well as how many dividends (regular contributions to the investors). On the bond side, we need to consider how many liabilities, what type, what currency, the interest rate, and how long we need for repayment.</p>
<h3 id="uuid-17858b6d-f1e7-4214-847c-55fa5f36fae5">Financial theories on capital structure</h3>
<p>One great resource for this is<span> </span><em>Applied Corporate Finance</em> by Aswath Damodaran (<a href="https://www.wiley.com/en-us/Applied+Corporate+Finance%2C+4th+Edition-p-9781118808931">https://www.wiley.com/en-us/Applied+Corporate+Finance%2C+4th+Edition-p-9781118808931</a>).<span> </span>On one hand, a company identifies a project to invest its money into (investment decision), while on the other hand, it arranges financial resources behind it (financing decision). We are not going to identify what project to invest in but how to finance it to make it happen.</p>
<p>According to<span> </span>Bradley, Jarrel, and Kim (<a href="https://econpapers.repec.org/article/blajfinan/v_3a39_3ay_3a1984_3ai_3a3_3ap_3a857-78.htm">https://econpapers.repec.org/article/blajfinan/v_3a39_3ay_3a1984_3ai_3a3_3ap_3a857-78.htm</a>), there is an optimal capital mix between equity and liabilities (called <strong>debt</strong>) that will produce the lowest overall financing cost. While there are many reasons for this that have been summarized by Damodaran, let's focus on how to make AI help CFOs in determining an optimal capital structure that is quantifiable and measurable.</p>
<p>As data scientists, we are interested in the cost and benefits of two options, both of which shall help us find the optimal point. Let's take a look:</p>
<table style="border-collapse: collapse;width: 100%" border="1">
<tbody>
<tr>
<td>
<p><strong>Why take equity?</strong></p>
</td>
<td>
<p><strong>Why take debt?</strong></p>
</td>
</tr>
<tr>
<td>
<p> </p>
<p>1) No obligation to pay dividends if there's no profit—more flexibility for investment with unclear cash flow visibility such as technology.</p>
<p>2) Increasing equity alone will not raise the cost of equity<span>—</span>approximated as the dividend we pay. However, increasing the debt will increase the probability of company bankruptcy as there is more obligation to repay the interest or principal.</p>
<p>3) More flexibility on certain specifics of financial ratios; for example, some bond borrowers will restrict the company's certain financial ratios to a specific range.</p>
<p> </p>
</td>
<td>
<p>4) Interest paid to lenders is counted as an expense, so there's no need to pay tax, while if paid as a dividend (for the equity holder), it will not be counted as expenses, and therefore, is subject to profit tax.</p>
<p>5) Existing shareholders can retain control of the company without any dilution of ownership.</p>
</td>
</tr>
</tbody>
</table>
<p> </p>
<ul>
<li>Point 1's project certainty on generating a return above the cost of financing can be approximated by the variance of the return.</li>
<li>Points 2 and 3 can be coded as a formula: for 2, one formula can specify the percentage of debt (called <strong>leverage</strong>) in increasing the risk of bankruptcy (the credit risk model was explained in the previous chapter). For 3, it is just a ratio that can be obtained; that is, the tax rate of the firm.</li>
</ul>
<ul>
<li>Points 4 and 5 can be implemented as a fixed threshold that limits the maximum amount of equity the company can raise. For a family business, a change of equity rarely happens, unless there is a change in the family (for example, the death of the founder).</li>
</ul>
<h2 id="uuid-153eb7c1-233a-45e1-9182-bb80daa7f8cb">Total factor productivity to measure project values</h2>
<p>This is essentially the question we asked in <a href="9ee6480e-c259-4e5d-bc11-31057de1a173.xhtml">Chapter 2</a>, <em>Time Series Analysis</em>, when using time series analysis to automate client procurement and trying to understand how to foresee the demand for each month. For a long-term forecast, we can use the ARIMA model to do the projection. However, there is no clear model when it comes to predicting a project's success within an organization because it requires team members' data, the project's execution, and the type and output of the project, which itself is part of a separate discipline of study in management.</p>
<p>There are three ways we can do this:</p>
<ul>
<li>By drawing from insights into the market, we can assume that a project will normally generate the market return on capital<span>—</span>with a floor closed to the risk-free interest rate<span>—</span>if the project has no risk at all. Of course, the return on a higher-risk project shall be higher.</li>
<li>All in all, if projects are similar to those in the past, the expected value of the project's return shall be the present value of the expected return on the project investment. It has to be equal to the return on the equity of the firm.</li>
<li>If there has to be a model, drawing from the literature of Marco economics, productivity is measured by the total factor productivity formula:</li>
</ul>
<p class="CDPAlignCenter CDPAlign"><img class="fm-editor-equation" src="assets/383b059f-8226-42c9-b56d-270c433262c7.png" style="width:10.92em;height:1.17em;"/></p>
<p style="padding-left: 60px">Here, <em>Y</em> is the output, <em>A</em> is the technology's efficiency, <em>K</em> is the capital spent, and <em>L</em> is the labor. The efficiency of capital consumption in terms of financing, purchasing, and sourcing is represented by <em>alpha</em>. The labor skills are represented by <em>beta</em>. Let's go over these in more detail:</p>
<ul>
<li style="padding-left: 30px"><strong><em>A</em></strong> (<strong>technological efficiency</strong>):<span> </span>Technological efficiency could be the ideal economic values delivered by the machine's full handling capacity per dollar spent.</li>
<li style="padding-left: 30px"><strong><em>L</em></strong> (<strong>labor</strong>):<span> </span><span>Labor means the ideal economic values delivered by the labor's full handling capacity per dollar spent.</span></li>
</ul>
<ul>
<li style="padding-left: 30px"><strong><em>K</em></strong> (<strong>capital</strong>):<span> </span><span>Amount of capital invested in technology and labor.</span></li>
<li style="padding-left: 30px"><strong><em>alpha</em></strong> (<strong>efficiency of capital consumption</strong>):<span> </span><span>This can be the actual economic value spent on purchaseless profits that are taken by an intermediary and during the process.</span></li>
<li style="padding-left: 30px"><strong><em>beta</em></strong> (<strong>labor skills</strong>):<span> As stated in the book <em>Human resources and organizational behaviors</em>, successful project delivery is directly related to the capability of individual members and the roles they play in the team. This can be seen in the growing body of sports results predictions, which can predict the probability of success for each match.</span></li>
</ul>
<p>A macroeconomic model is indeed an aggregate behavior of many micro-level behaviors. With regard to the next frontier of macroeconomics, it might make sense for data scientists to draw insights from macroeconomics models that have been applied to individual companies or aggregate micro behaviors to generate macroeconomic behaviors.</p>
<p>If we were to deliver a model that predicts each of the company's project values, we'd often find insights from other disciplines that we could bring in to cross-pollinate the study and quantify it using predictive models. Having the features for this technology, investment amount, and labor might be a good starting point in researching macroeconomics.</p>
<p>Doing this allows us to predict a project's economic values, which in itself can be a machine learning model. We will not cover this here as we wish to focus on high-level financial decisions in this chapter, but the next frontier of finance can generate values.</p>
<h2 id="uuid-a7b164a8-0c19-410e-bb17-fb5682ec2f5d">The cash flow pattern of a project</h2>
<p>Besides the productivity/economic value of a project, we also need to find out the precise cash flow payment or receipts of the project. The answer to this is to track all the events of the project from a centralized trusting repository. But wait: for all parties to share information about the same project rather than having a central repository that becomes the central place for hackers, we need a totally decentralized place; this is the rationale of blockchain. The best cash flow pattern prediction comes from getting the data that triggers the cash flow activities: either the project status triggered by signing off progress, confirmation of a sales agreement according to the payment terms, confirming the receipt of goods at a warehouse, and so on.</p>
<p>Practically, in today's world, most of these steps still require human input, so it is easier to ask the relevant human to provide a forward-looking cash flow forecast. Of course, if all these activities become automated and handled by intelligent machines and codified in structured databases, it seems possible to reliably predict future cash flow.</p>
<p>Even if we pass the ball to humans to input data, in finance, we ask humans to provide three scenarios<span>—</span>optimum, realistic, and pessimistic<span>—</span>each with a different probability of occurrence. The expected forecast will be the predicted result of these three scenarios. However, considering the potential issue of an extreme forecast, it seems better to allow humans to make a realistic forecast with an assigned likelihood of such cash flow events to happen within a short time frame.</p>
<p>Again, we are talking about paying large amounts here. For smaller amounts and numerous payments, we have the following approaches:</p>
<ul>
<li>Regular cash flow</li>
<li>Irregular/event-triggered cash flow</li>
</ul>
<p><strong>Regular cash flow</strong><span> </span>is based on business rules; for example, payroll occurs every Friday. But in order to predict the cash flow of payroll for the next week, we need to get the HR databases, along with the salary for each staff member.</p>
<p>For day-to-day businesses, where regular cash flow is based on expenses paid for procurement and sales made, we can rely on the model we developed in the previous chapter. Once we've projected the demand (sales), we can reliably estimate the procurement required and the corresponding payment being delayed in terms of actual timing<span>—</span>knowing that corporate buyers will delay paying the supplier to earn liquidity. To clarify this, here are a couple of explanations:</p>
<ul>
<li>In finance, the ratios of working capital required for sales growth can be calculated by the formula from Churchill N.C. and Mullins, J.W. 2001, <em>How Fast Can your Company Afford to Grow?</em> (<a href="https://hbr.org/2001/05/how-fast-can-your-company-afford-to-grow">https://hbr.org/2001/05/how-fast-can-your-company-afford-to-grow</a>).</li>
<li>Delaying payment may not be optimal for the supply chain since we know that this delayed payment will cause the upstream to further increase their need for short-term financing to fund the production of goods. If the upstream suppliers are smaller in scale, this will actually create a higher overall production cost for the supply chain if the higher-risk/smaller-sized suppliers get financing at a higher rate.</li>
</ul>
<p><strong>Irregular/event-triggered cash flow:</strong><span> </span>This is usually triggered by other parties or external events. The best way to handle this is to improve data exchange with the customers or suppliers.</p>
<h2 id="uuid-c889be35-50f0-4624-9832-86e12eaaf1a8">Forecasting financial statement items</h2>
<p>In this section, we will discuss how we can forecast financial items. Let's take a look:</p>
<ul>
<li><strong>Sales:</strong><span> </span>If you are a professional trained in finance, the biggest driver<span>—</span>being revenues<span>—</span>has to be forecast based on demand for the goods/services that the company is delivering. In the case of Duke Energy, forecasting the electricity market is basically looking at the market growth of various segments: industrial, commercial, and households. This is the best way to work with marketing.</li>
</ul>
<p style="padding-left: 60px">In industrial and commercial (B2B) markets, the most reliable forecast is one that looks at the customers; ultimately, the business entity will have to create some goods and services to be consumed by the end customers. For industrial and commercial markets, we can start by looking at the major industrial activities in California and their potential electricity consumption. Then, we move one step forward to observe what they are producing.</p>
<p style="padding-left: 60px">Households depend on the household income, populations, private electric cars, and, most importantly, the weather of the coming years<span>—</span>whether it is El Niño or any other weather forecast, these are important aspects. Even though we can use macroeconomic data (and its forecast, such as the weather forecast) to forecast our sales, it may not always be possible to find predictors for each of the financial items in the financial statements. Here, we can use the known/predictable item to predict the rest, which should make economic and statistical sense.</p>
<p style="padding-left: 60px">In short, the best way to predict sales is to predict the personal sector's sales activities.</p>
<ul>
<li><strong>Cost of goods sold:</strong><span> </span>This is related to the sales volume. Even though we know that it is not a 1:1 relationship, such as a CFO, we can obtain monthly internal costs and sales figures and build a model to forecast these costs based on sales. Alternatively, we can use demand quantity to forecast procurement quantity. As for Duke Energy, the unit cost also comes largely from commodities markets; given that we have set the target procurement strategy regarding when to buy and the global markets on unit cost are driven by capital markets, we could obtain forward-looking pricing from the markets (that is,<span> </span>CME Henry Hub's 12-month pricing (<a href="https://www.cmegroup.com/trading/energy/natural-gas/natural-gas.html">https://www.cmegroup.com/trading/energy/natural-gas/natural-gas.html</a>)).</li>
</ul>
<p class="mce-root"/>
<p style="padding-left: 60px">For companies in the physical goods industry, the cost of goods sold is close to 1:1 to sales if any fixed cost (such as equipment, machinery, and so on) is not allocated to an item. A typical example could be the fashion industry, where the cost of goods sold should align with sales. These sales are proportional to the cost of the goods we purchased.</p>
<p style="padding-left: 60px">To illustrate this point, let's run a small analysis on the cost of goods sold versus sales across industries:</p>
<p class="CDPAlignCenter CDPAlign"><img class="aligncenter size-full wp-image-1145 image-border" src="assets/98d7ccb0-43b7-459d-83b0-ba1a73814d16.png" style="width:29.50em;height:7.42em;"/></p>
<ul>
<li class="CDPAlignLeft CDPAlign"><strong>Operating expenses, including selling, general, and administrative expenses</strong> (<strong>SG&amp;A</strong>): Depending on the accounting standards and company practice, some companies do not list depreciation and amortization separately, which is not linear to sales activities. Looking at the preceding table, the trend we are seeing is that the higher the fixed asset-intensive industry (called the <strong>capex</strong>), the lower the predictive power of sales to the cost of goods sold. On the other hand, the more human-intensive but less fixed the asset is, the higher the likelihood that the cost of goods sold is moving along due to the higher percentage of variable cost.</li>
</ul>
<h1 id="uuid-f7379a75-add0-421e-b9d9-46d1df96420b">AI modeling techniques</h1>
<p>In this section, we will look at two important modeling techniques, known as <strong>linear optimization</strong> and the <strong>linear regression</strong> <strong>model</strong>. In the previous chapter, we learned about deep learning, neural networks, decision trees, and reinforcement learning.</p>
<h2 id="uuid-83e7098b-10c9-48f6-8d70-dea1eac70b84">Linear optimization</h2>
<p>Used frequently in supply chain businesses, the linear optimization model seeks to achieve the optimization objective (that is, to maximize profit or minimize cost) by changing some variables while considering some constraints. In the case of linear optimization, we also implement the structure similar to that of the capital structure optimization process.</p>
<p>This is not a machine learning model as we do not need to train the machine to learn any patterns.</p>
<h2 id="uuid-a6b406df-c2e9-4147-b444-de6aee8af065">The linear regression model</h2>
<p>This is typically known as the regression model. What it does is find out the causation of some factors of the outcome. The outcome has to be numeric values. In statistics, <em>some factors</em> refers to the independent variables as we assume all these factors are independent of other factors, while the outcome is the <strong>dependent variable</strong>. The outcome is dependent on the independent variables.</p>
<h1 id="uuid-50f01114-1a2e-4531-9686-4ab8c7e21b05">Finding the optimal capital structure</h1>
<p>Now, we can start analyzing how much equity and debt capital we should raise in the capital market to support demand (new projects and businesses or by replacing existing machinery that is worn out or obsolete) and supply (generated from profit). Our projection of optimal capital structure is time-bound; that is, it concerns the optimal mix for a given period, such as the next year. We can certainly expand it to cover the next 5 years. The formula used to forecast business performance is as follows:</p>
<p class="CDPAlignCenter CDPAlign"><em>Revenue growth * Fixed Capital Required / Sales</em></p>
<p>The optimal capital structure is the capital structure that delivers the lowest possible cost of funding but delivers the required capital to generate values within the firm.</p>
<h2 id="uuid-026cd0a2-da04-4389-9d46-f3f3d454ca34">Implementation steps</h2>
<p>In this section, we will learn how to implement a machine learning model that can find the optimal capital structure that delivers the lowest possible cost of funding.</p>
<h3 id="uuid-7faa548c-e375-48b2-9037-3f6b4ac1a8b8">Downloading the data and loading it into the model</h3>
<p>In our example, we are downloading our data from Quandl, an external financial data provider. This data is quarterly data. Imagine that we are the CFO of a corporation; we can get a real-time daily forecast to update our funding strategy regularly<span>—</span>weekly, monthly, and quarterly. The steps are as follows:</p>
<ol>
<li>Here, we will use <em>Ticker</em> to represent the unique identifier of a company. Use the following code to import the required library dependencies:</li>
</ol>
<pre style="padding-left: 60px">import quandl<br/>import pickle<br/>import numpy as np<br/>import math<br/>import pandas as pd<br/>from sklearn import linear_model<br/>import matplotlib.pyplot as plt <br/>import seaborn as sns</pre>
<ol start="2">
<li>Define the API key and a ticker for the company:</li>
</ol>
<pre style="padding-left: 60px">tkr = 'DUK'<br/>quandl.ApiConfig.api_key = '[API key from Quandl]'</pre>
<ol start="3">
<li>Download the New York Stock Exchange index values and stock code, and then calculate the return of NYSE versus the stock to come up with beta and risk-free rates for the CAPM pricing model:</li>
</ol>
<pre style="padding-left: 60px">'''*************************************<br/>## Retrieve data for 2A.<br/>'''<br/>econ = quandl.get("FRED/TEDRATE", authtoken="[API Key from Quandl]", start_date='2018-05-31', end_date='2018-07-31')<br/>NYSE_index = quandl.get('WFE/INDEXES_NYSECOMPOSITE', start_date='2013-05-31', end_date='2018-07-31')</pre>
<ol start="4">
<li>Download the financial data of the company to project and retrieve 2 years' worth of financial data for the target company. This will be fed into the credit model:</li>
</ol>
<pre style="padding-left: 60px">'''*************************************<br/>## Retrieve Data for the target ticker<br/>'''<br/>record_db = quandl.get_table('SHARADAR/SF1', calendardate='2017-12-31', ticker=tkr,dimension='MRY')<br/>record_db_t_1 = quandl.get_table('SHARADAR/SF1', calendardate='2016-12-31', ticker=tkr,dimension='MRY')</pre>
<ol start="5">
<li>Download the historical financial data of the company in order to estimate the parameters between the driver:</li>
</ol>
<pre style="padding-left: 60px">'''*************************************<br/>## Download &amp; Load Data for 2C.<br/>'''<br/>tkr = 'DUK'<br/>quandl.ApiConfig.api_key = 'nzBtupqX5H65EG3sFusF'<br/>record_db_t_2017Q1=quandl.get_table('SHARADAR/SF1', calendardate='2017-3-31', ticker=tkr,dimension='MRQ')<br/>...<br/>df_all = pd.concat(list_all)<br/><br/>#fix the dataframes<br/><br/>#convert to float<br/><br/>#create new fields<br/><br/>#remove any record with na and 0 values to avoid division errors<br/><br/>#we take a proxy here, should use last period's numbers as denominator not current period</pre>
<h3 id="uuid-e4869c43-9599-4a7d-8131-802759a32ec3">Preparing the parameters and models</h3>
<p>In this section, the following parameters will be calculated:</p>
<ul>
<li>Levered beta on CAPM in order to calculate the cost of equity.</li>
<li>Cost of debt by reusing the credit model (the logistic regression model). We're using this because it is simple and requires the least amount of financial ratios.</li>
<li>Cost of goods sold. The capex is estimated by relating it to sales growth and the cost of goods sold.</li>
</ul>
<p>With these parameters, it is possible to estimate the major moving parts of the financial model, as follows:</p>
<ul>
<li><strong>Calculate the cost of the equity formula</strong>: Based on the data from 1A, find out the risk-free rate and beta as the intercept and coefficient of the regression formula from the CAPM model: <em>the Return of Stock = Risk-Free Rate + Beta * Return of Market.</em></li>
<li><strong>Calculate the cost of the debt formula</strong>: Calculate the cost of debt by calculating the financial ratios. The model we used is based on the 5-year default rate we calculated in the previous chapter. In real life, the bond rating is formulated by the rating agency (such as Moody's or Standard &amp; Poor's), while the bank loan's rating is done internally by the credit risk model of each bank, such as the one we are using.</li>
<li>Calculate drivers to see how sales can drive other items in the P&amp;L/working capital, directly or indirectly via the cost of goods sold. </li>
<li>We assume that the cost of goods sold (or the cost of sales) is driven by sales activities, while the operating expense is driven by the cost of sales. We assume that the relationship is linear and can be calculated by the regression model.</li>
</ul>
<ul>
<li>Selling expenses and general and administrative expenses are zero in our example; therefore, we do not have any calculations for them.</li>
<li>I have also attempted to figure out the relationship between the working capital and receivables, inventory, and payables, but we will not be using it because we will take another approach—the total amount of cash required per sale—to find out the amount of cash/working capital required in the day-to-day operations to support sales.</li>
</ul>
<h3 id="uuid-9ebb0a30-2020-4504-92f2-ae95a0d83ef0">Projections</h3>
<p>Projection involves estimating the revenue growth, followed by looking at the equity and debt capital required that impacts the income statements. Most of the forecasting logics are embedded in <kbd>cal_F_WACC</kbd>. The optimization result is getting the minimal WACC by trying the range of debt (%) in the capital structure of the company. Unfortunately, we tried this and didn't find it simple to execute through code without implementing a linear optimization algorithm, which will add complexity to the program, even though this is computationally more efficient.</p>
<p>All the stages mentioned in the <em>Preparing the parameters and models</em> section are combined. Formulas are built based on the dependency seen in Excel. However, the sequence largely starts with sales, then finding out the capital structure, and then going back to the income statement.</p>
<p>The weighted average costs of the capital are calculated; then, they are compared against the preset conditions, such as the credit risk changed, which cannot be above a certain threshold.</p>
<p>The following are the accounting formulas in forecasting:<strong><br/></strong></p>
<ul>
<li class="TableContents"><strong>Sales are projected</strong>: <em><span>Sales = Existing Sales * (1 + Sales Growth)</span></em></li>
<li class="TableContents"><strong>Net income follows the calculation of sales:</strong> <em><span>Net Income = Sales - Cost of Good sold - Selling, General Administrative Expenses - Operating Expenses - Net Interest Expense - Taxation Expenses</span></em></li>
<li style="padding-left: 30px"><em>Cost of Goods Sold = Sales * Cost to Sales Ratio</em></li>
<li style="padding-left: 30px"><em>Selling, General Administrative Expenses = Sales * Selling</em></li>
<li style="padding-left: 30px"><em>General Administrative Expense to Sales Ratio</em></li>
<li style="padding-left: 30px"><em>Operating Expenses = Sales * Operating Expenses to Sales Ratio</em></li>
<li style="padding-left: 30px"><em>Net Interest Expense = Debt * Interest Expense%</em></li>
</ul>
<ul>
<li class="TableContents"><strong>The equity and debt in total we need equates to the capital required</strong>: <em><span>Equity + Debt &gt;= Existing PPE + New PPE Needed + Working Capital Required + Inventory + Goodwill</span></em></li>
<li style="padding-left: 30px"><em>Equity = Existing Equity + New Equity Capital Generated</em></li>
<li style="padding-left: 30px"><em>Debt = Existing Debt + New Net Debt Capital Generated</em></li>
<li style="padding-left: 30px"><em>New Capital Required = New Equity Capital Required + New Debt Capital Required</em></li>
<li style="padding-left: 30px"><em>New Net Equity Capital Generated = New Equity Capital Raised - Divided Payment + New Equity from Earnings</em></li>
<li style="padding-left: 30px"><em>New Equity Capital Generated from Earnings = Net Income</em></li>
<li style="padding-left: 30px"><em><span>New Net Debt Capital Generated = New Debt Capital Raised - Debt Repayment</span></em></li>
<li style="padding-left: 30px"><em><span>Debt Repayment = Previous Debt Repayment</span></em></li>
<li style="padding-left: 30px"><em><span>Total Property Plant and Equipment (PPE) Needed = Existing PPE (net of depreciation) - Depreciation for the Next Period + New PPE Needed</span></em></li>
<li style="padding-left: 30px"><em><span>Sales / Total PPE Needed = Sales to PPE Ratio</span></em></li>
<li style="padding-left: 30px"><em><span>Working Capital Required = Working Capital Required per Sales * Sales</span></em></li>
<li style="padding-left: 30px"><em><span>Working Capital Required per Sales = Cost of Sales/Sales * Total Cash Cycle in Days/ Operating Cash Cycle in Days + Operation Expenses / Sales * 1/2</span></em></li>
</ul>
<p>The code for this is as follows:</p>
<pre>'''*************************************<br/>3. Projection<br/>'''<br/>print('optimization...')<br/>#simulations<br/>record_db_f = record_db<br/><br/>#Projection<br/>...<br/><br/>def cal_F_WACC(record_db_f, logreg, logreg_sc, new_debt_pct,price_offering,levered_beta,sales_growth,coefs,r_free):<br/>...<br/>for new_debt_pct in debt_pct_range:<br/> for price_offering in price_offering_range:<br/> ...<br/> F_WACC, F_default_risk,conditions = cal_F_WACC(record_db_f,logreg,logreg_sc, new_debt_pct, price_offering,levered_beta,sales_growth,coefs,r_free)<br/> '''****************************************<br/> 4. Calculate WACC<br/> '''<br/> #update WACC<br/> obj = F_WACC &lt; optimal_WACC and F_default_risk/default_risk_existing-1&lt;=0.75<br/> ...</pre>
<h3 id="uuid-5c6db3db-affa-478c-b509-9426a75ca0b7">Calculating the weighted average cost of capital</h3>
<p style="font-weight: 400">The objective of this step is to ensure the following happens:</p>
<ul>
<li>The ideal capital structure is rewarded by the lowest cost of capital with a mix of debt and equity.</li>
<li>The cost of equity is defined by the capital asset pricing model.</li>
<li>The cost of debt is defined by the cost of credit risk, plus the cost of the risk-free rate. The cost of credit risk is calculated by the credit model we built in the previous chapter.</li>
<li>Minimize the following:</li>
<li style="padding-left: 30px"><strong>Weighted Average Cost of Capital</strong> (<strong>WACC</strong>)</li>
<li style="padding-left: 30px">Cost of debt</li>
<li style="padding-left: 30px">Cost of credit risk</li>
<li style="padding-left: 30px">Cost of equity</li>
<li style="padding-left: 30px">Unlevered beta</li>
<li style="padding-left: 30px">Levered beta</li>
</ul>
<h3 id="uuid-e6153a97-e8ce-427f-9a74-4153e3dfc9c6">Constraints used in optimization</h3>
<p style="font-weight: 400">Let's take a look at the demand and supply of capital, which has to be tied up:</p>
<ul>
<li><strong>Restrictions on capital mix</strong>: The existing bondholder does not want the rating to be altered; therefore, they are limited to changing the default risk by less than 75%.</li>
<li style="font-weight: 400"><strong>Constraints calculated but not checked for optimization</strong>:</li>
<li style="padding-left: 30px">These restrictions are not implemented because there will be circular references to profit and loss items that shall be fixed.</li>
<li style="padding-left: 30px">Normally, these are the constraints imposed by the existing shareholders.</li>
<li style="padding-left: 30px">The existing shareholders don't want the earnings per share to be dropped as there are more shares.</li>
<li style="padding-left: 30px">The existing shareholders don't want to chip in the extra equity to the same company by drastically increasing the equity amount.</li>
</ul>
<p>The following code snippet demonstrates how equity offering constraints are calculated:</p>
<pre>#equity offering constraints --- not bounding<br/>price_offering = record_db_f['price'][0]<br/>unit_offering = int(F_new_equity / price_offering)<br/>F_eps = F_earnings / (unit_offering+record_db_f['shareswa'][0])<br/>equity_growth = F_equity / record_db_f['equity'][0]-1<br/>eps_growth = abs(F_eps/ (record_db_f['netinc'][0]/record_db_f['shareswa'][0])-1)<br/>c_eq_1 = equity_growth &lt;= 0.1<br/>c_eq_2 = eps_growth &lt;= 0.3</pre>
<p style="font-weight: 400">Congratulations! We have found the optimal capital structure for the company using optimization.</p>
<h1 id="uuid-f5a6325c-6110-4de8-bd1a-62c4656eb4a7">Providing a financial performance forecast using macroeconomic scenarios</h1>
<p style="font-weight: 400">One of the key jobs of a CFO is to provide a forecast for financial performance. So, how is AI going to change this job? We will build on what we know about finance in terms of helping with financial projections for accounting rules between items and add the predictive capability of our age to improve it.</p>
<p style="font-weight: 400">As the CFO of the listed firm, one of our key aspects is to provide management and analyst guidance for forward-looking financials. Hypothetical data is handcrafted by the author. This seeks to emulate what the accounting system looks like.</p>
<p style="font-weight: 400">In this section, we will look at how to forecast the financial performance of the firm.</p>
<h2 id="uuid-5b14e945-a1a3-44de-92fa-f75441cca744">Implementation steps</h2>
<p>In this section, we will learn how to derive financial performance forecasts using macroeconomic scenarios. The steps are as follows:</p>
<ol>
<li>Initialize the tickers in each industry by loading them from CSV files and importing the required library dependencies:</li>
</ol>
<pre style="padding-left: 60px">from pyquery import PyQuery<br/>import pandas as pd<br/>import quandl<br/>import matplotlib.pyplot as plt<br/>from sklearn import linear_model<br/>from sklearn.metrics import r2_score<br/><br/>...</pre>
<ol start="2">
<li>Download the historical financial data from Quandl:</li>
</ol>
<pre style="padding-left: 60px">cal_LIND = quandl.get("FRED/CASLIND", authtoken="nzBtupqX5H65EG3sFusF")<br/>cal_ele = quandl.get(["EIA/ELEC_SALES_CA_RES_M","EIA/ELEC_SALES_CA_IND_M"], authtoken="nzBtupqX5H65EG3sFusF")</pre>
<ol start="3">
<li>Calculate the various parameters required to derive the performance:</li>
</ol>
<pre style="padding-left: 60px">#update the index date to begin of month (in fact all index should be referring to end of month)<br/>cal_ele['mth_begin'] = cal_ele.index<br/>#change the column to begin of month<br/>...<br/><br/>reg_retail = linear_model.LinearRegression()<br/>reg_retail.fit(df_marco[[' MeanAvgTemperature']], \<br/>               df_marco['EIA/ELEC_SALES_CA_RES_M - Value'])<br/>reg_retail.coef_<br/>reg_retail_pred = \<br/>            reg_retail.predict(df_marco[['MeanAvgTemperature']])<br/>error_retail = r2_score(df_marco['EIA/ELEC_SALES_CA_RES_M - \<br/>                                  Value'], reg_retail_pred)<br/><br/>reg_ind = linear_model.LinearRegression()<br/>reg_ind.fit(df_marco[[' MeanAvgTemperature']], \<br/>            df_marco['EIA/ELEC_SALES_CA_IND_M - Value'])<br/>reg_ind.coef_<br/>reg_ind_pred = reg_ind.predict(df_marco[['MeanAvgTemperature']])<br/>error_ind = r2_score(df_marco['EIA/ELEC_SALES_CA_IND_M - \<br/>                               Value'], reg_ind_pred)<br/>...</pre>
<p style="font-weight: 400">Congratulations! You have generated the sales forecast using macro factors that have been reliably forecast by meteorological experts.</p>
<h1 id="uuid-aeef1143-c6b0-4bca-8290-323f1917d766"><strong>Summary</strong></h1>
<p>In this chapter, we looked at financial banking and a few basic concepts of the finance domain. We learned about two important machine learning modeling techniques known as optimization and the linear regression model. We also looked at two examples that help automate capital market decisions<span>—</span><em>Finding optimal capital structure</em> and <em>Providing a financial performance forecast using macroeconomic scenarios</em>. We also looked at the future and the implications of investment banking and financial reporting.</p>
<p style="font-weight: 400">Then, we explored the internals of financial projection and financial modeling, which we were able to do due to financial positions being rapidly updated with real-time financial IT systems. By leveraging the richness of financial positions on a daily basis, we have lots of data points to perform a reliable projection of the complete financial positions of a firm. Being the strategic thinkers of the firm, we also looked at how to rely on external data (such as weather data from popular forecasting services from the government) to augment the lack of internal financial data as a CFO. We leveraged an external data provider called Quandl to blend all the financial data from peers in the same industry. In reality, this technique should be replaced by an internal position snapshot, but essentially, the key point is to blend AI with financial modeling.</p>
<p style="font-weight: 400"><span>As you can see, the future of financial reporting may have to dive deeper than just reporting financial statements. CFOs may be required to disclose the project's status and plan for greater transparency, as well as the benefits of the investors, without jeopardizing commercial secrecy. This form of disclosure is also present in annual reports but isn't in a quantitative format yet. The CFOs of the future will have to buckle up for this new wave of reporting philosophy as what happens inside the organization is what is driving the return of capital.</span></p>
<p>In the next chapter, we will continue learning about new machine learning techniques that will help us solve complex financial problems. We will also understand a core business concept known as <strong>Merger and Acquisition</strong> (<strong>M&amp;A</strong>). We will understand the basic concepts of data technologies such as SQL and look at a machine learning modeling technique known as <strong>clustering models</strong>. </p>


            </article>

            
        </section>
    </body></html>