<html><head></head><body>
        <section>

                            <header class="header-title chapter-title">
                    Automated Portfolio Management Using Treynor-Black Model and ResNet
                </header>
            
            <article>
                
<p class="mce-root"><span>In the previous chapter, we covered the basic concepts of investment banking. We also learned about the concepts of <strong>Mergers and Acquisitions</strong> (<strong>M&amp;A</strong>) and <strong>Initial Public Offering</strong> (<strong>IPO</strong>). We examined the clustering model, which is a modeling technique of AI. We looked at detailed steps and examples to solve the problem with auto syndication. We implemented an example that identified acquirers and targets. So, the previous two chapters were intended for the issuers on the securities side of investment banking.</span></p>
<p>In this chapter, we will look at the dynamics of investors. Investors drive investment behavior strategically. The issuance of equity or debt can be done in either of two ways—via the primary market or the secondary market. The role of the primary market is to issue new securities on behalf of companies, the government, or other groups in order to receive financing by debt or equity-oriented securities. The role of the secondary market is to facilitate interested parties with the buying or selling of previously issued securities. The role of portfolio managers is to make smarter decisions based on the price movement of the securities to increase the amount of profit for their customers. The portfolio manager tries to understand the needs of investors and places money behind those investments that generate the maximum return.</p>
<p>In this chapter, we will cover the following topics:</p>
<ul>
<li>Financial concepts</li>
<li>The Markowitz mean-variance model</li>
<li>The Treynor-Black model</li>
<li>Portfolio construction using the Treynor-Black model</li>
<li>Trend prediction</li>
</ul>
<h1 id="uuid-3a5e2b8f-a76d-4230-a236-f39c710d4c28">Financial concepts</h1>
<p>In this section, we will explore various financial concepts. For an in-depth survey of the domain knowledge, you are encouraged to refer to the syllabus of the <strong>Chartered Finance Analyst</strong> (<strong>CFA</strong>).</p>
<h2 id="uuid-742fc7ee-6185-46e2-aa67-50f2b822a0d0">Alpha and beta returns in the capital asset pricing model</h2>
<p class="sdfootnote-western">According to the <strong>capital asset pricing model</strong> (<strong>CAPM</strong>), investment return equals the <em>risk-free rate + alpha + beta * market return + noise</em> (with a mean of zero). Alpha is the return earned by the superior performance of the firm or investors, while beta is the riskiness of the asset in comparison to the overall market return. Beta is high when the risk of the investment is riskier than the average market. Noise is the random movement or luck that has a long-term return of zero.</p>
<p>The asset management industry, especially professional investment managers, is commonly charging clients based on alpha. That explains why people pay so much attention to alpha.</p>
<h2 id="uuid-0fc4c209-bbde-4d72-9171-332724a86b25">Realized and unrealized investment returns</h2>
<p>Investment returns (gain) can be realized or unrealized. Realized return is the return that is actualized and pocketed. Unrealized return is the return we would have pocketed today if we had sold the assets for money.</p>
<h2 id="uuid-723faf5f-20d9-4b09-af74-4041a9e3507c">Investment policy statements</h2>
<p class="mce-root">The investment industry works on investing on behalf of the asset owner. As an asset manager, it is our fiduciary duty to advise and invest on behalf of the client. So far in this book, we have tried to understand the investment needs of investors by looking at behavioral/trading data. However, the key data is, in fact, the <strong>investment policy statement</strong> (<strong>IPS</strong>) that the investors will establish.</p>
<p class="mce-root">An IPS contains the return objective, risk appetite, and constraints laid down by the investor. The return objective and risk appetite are both variables that we can define quantitatively. Return can be defined as the net annual return of the inflation rate. If the target return is 1% and the inflation rate is 1%, then this means the value of capital is preserved as the price level of goods increases by the inflation rate. In the long run, the purchasing power we put into the portfolio remains the same because the value grows in line with the price level.</p>
<p class="mce-root">Each of these variables can be mathematically expressed as follows:</p>
<ul>
<li><strong>Return objective</strong>: This return objective is called capital preservation. The 1% return rate is called the nominal rate of return. After deducting the inflation rate from the nominal rate, it is called the real rate of return:</li>
</ul>
<p class="CDPAlignCenter CDPAlign"><img class="fm-editor-equation" src="assets/75860ee7-6d7c-4e2b-a8a5-be1f5c9b1e43.png" style="width:32.50em;height:1.25em;"/></p>
<ul>
<li><strong>Risk appetite</strong>: Risk appetite can be defined as the volatility of a return. We normally define it like this:</li>
</ul>
<p class="CDPAlignCenter CDPAlign"><img class="fm-editor-equation" src="assets/330d2db1-5f66-4485-9787-9df67d36c1cf.png" style="width:31.83em;height:1.17em;"/></p>
<p>The choice of risk appetite is subjective—some people like the ups and downs that accompany this excitement. While some prefer to read this book while sitting on the sofa (pretty boring, isn't it?), some prefer to read it seated on a chair <span>at the table</span>. Some people prefer to work in a boring 9 to 5 with steady pay, while others prefer the excitement of a start-up, with the hope of getting rich quickly and risking the possibility of failure.</p>
<p>That said, boring does not mean there is a lower risk of being laid off, and an exciting job does not imply a high risk of losing out on the job. There are obvious cases where we have an exciting job, high potential, and stability. That's exactly the target result of asset allocation from this portfolio management process.</p>
<div class="mce-root packt_infobox">Given that this book concerns practical aspects of work, for more details, I recommend<span> </span><em>Managing Investment Portfolio, A Dynamic Process</em><span> </span>by the CFA Institute (<a href="https://www.wiley.com/en-us/Managing+Investment+Portfolios%3A+A+Dynamic+Process%2C+3rd+Edition-p-9780470080146">https://www.wiley.com/en-us/Managing+Investment+Portfolios%3A+A+Dynamic+Process%2C+3rd+Edition-p-9780470080146</a>). Our objective here is to define the necessary parameters to execute the machine learning program in Python.</div>
<p class="mce-root">The challenge, in the age of AI, is how to bring this policy to life in the form of code that a machine would understand. Indeed, the investment community has the task of digitizing investment policy.</p>
<p class="mce-root">Recent advancements in blockchain promise smart contracts, which is based on the assumption that certain statements could be digitized as logic. If a contract could be coded as a smart contract on the blockchain for execution, then why not an IPS? Let's assume that the investment policy is codified for the rest of this chapter.</p>
<h2 id="uuid-69267e8e-281d-4f20-a3df-94f88c4513b6">Asset class</h2>
<p class="mce-root"><strong>Portfolio management</strong> is the process of allocating capital to various investment assets based on the characteristics of the asset class or risk factors. We'll begin by focusing on asset class allocation. An <strong>asset class</strong> is defined as a group of assets that bear similar characteristics. It actually sounds quite similar to the outcome of a clustering model.</p>
<p class="mce-root">To blend in our the knowledge of finance, asset classes normally refer to equity, bonds, the money market, and alternative investments. <strong>Alternative investments</strong> can be subdivided into real estate, private equity, hedge funds, and commodities. <strong>Equity</strong> refers to the equity shares issued in the publicly traded market, while <strong>bonds</strong> refer to the debt issued by companies. The <strong>money market</strong> refers to short-term debt that has a duration of between one day and one year. They are different from bonds as the <span>money </span>market is highly liquid (heavily traded with a fairly priced market), whereas, in bond issues, the market can either be very illiquid or dominated by certain investors. Bonds typically refer to debt that has a longer duration, such as 10 years of maturity or beyond. Of course, it can include anything above 1 year, typically called <strong>notes</strong>.</p>
<h2 id="uuid-0656fcba-a0a9-4dbe-81c6-af322e0facd0">Players in the investment industry</h2>
<p class="mce-root">Investors play a central role in the finance industry. It is, however, equally important to know the other major players—investment managers (who manage the investor's money), brokers who are referred to as the sell side (typically, an investment bank or securities firm), and consultants and advisers who provide specialized advice to investors on how to choose investment managers. Custodians refer to the party that looks after the settlement and the administrative aspects of any investment transactions and filings with the exchange markets.</p>
<p>If the investment managers are from institutions, they are referred to as <strong>institutional investors</strong>, whereas someone who is acting on their own is called an <strong>individual investor</strong>. Institutional investors have fiduciary duties to the beneficiary owners of the investment money. Those beneficiaries are the real customers of the investment managers. For instance, in the case of Duke Energy, <span>the ultimate beneficiaries </span>could be the employees of Duke Energy. In between, it could either be the treasurer who manages the fund as the investment manager, or it could be the outsourced investment fund managers who are the chosen investment managers.</p>
<p>On the sales side of the industry, the fund could be for institutional investors, individual investors, or retail distribution via banks or insurance companies. In the case of retail distribution, the responsibility of fitting the investment to the needs of the owners lies with the distributors. While it is the institutional investors or individual investors that deal directly with the investment managers, it's the investment managers or consultants who are responsible for the matching.</p>
<h2 id="uuid-0440c80d-96ee-47f5-abb5-6b3a26b67a91">Benchmark – the baseline of comparison</h2>
<p>A benchmark is used by the investment portfolio to define what average market return they should be measured against. It could refer to the market return or the beta<span> </span>in the CAPM. Anything above the average is called <strong>alpha</strong>. In this chapter's example, we assume that the global equity <span><strong>Exchange-Traded Fund</strong> (</span><strong>ETF</strong>) is the market benchmark.</p>
<p>If we were to construct the world's market benchmark for an investor in the world's assets, we could analytically create such an index that weighted the various indices or baskets of returns.</p>
<h2 id="uuid-c9785a92-b316-4863-9cc7-6a7affc3be61">Investors are return-seeking</h2>
<p>A study by the Bank of International Settlement shows that investors are exhibiting return-chasing behavior. This means that one of the key principles of investment is to follow the market (return). It also surely means that we will always be slower than the market if we solely let returns drive our allocation decisions. So, in the world of AI, there could be two ways to improve:</p>
<ul>
<li>Being very quick to follow the return trend with a super-fast machine</li>
<li>Predicting the market better than the crowd</li>
</ul>
<p>An ETF promises to do the former, provided that we do the allocation to the ETF quickly enough—which, in turn, defeats the purpose of following the markets as there are so many different kinds of ETFs. It is only possible when we invest in a true market representative—for example, a major market index ETF; otherwise, we are still going back to the same challenge of trying to allocate to the right securities/investments to generate alpha (beating the market).</p>
<p>In most trading books, the author will hide what their winning strategies are—which makes our understanding of what a strategy <span>actually is</span> <span>difficult. To remain really practical, we are going to work on a losing strategy, which you can improve on. This, at least, shows you end-to-end strategy development and gives you a full view of how trading works.</span></p>
<h2 id="uuid-c5e3ca28-1fe9-40f8-a5a0-154bdd05b665">Trend following fund</h2>
<p>After allocating assets to the fund manager, let's dig deeper into the fund being invested. If we were the ETF, one of our key needs would be to track the underlying securities. For example, if the fund's mandate is to track the performance of a basket of securities given a set of rules, we can just simply buy and hold the underlying assets until redemption (that is, the investors withdraw their money).</p>
<p class="mce-root">However, if we try to predict the pricing movement in advance and act accordingly, there is a chance that we win more than just the benchmark—this is what we refer to as <strong>alpha</strong>.</p>
<h3 id="uuid-dccb5990-b3a7-45df-9848-55587dd16819"><span>Using technical analysis as a means to generate alpha</span></h3>
<p>A school of thought in trading believes in the trends exhibited in the pricing of securities. This is called <strong>technical analysis</strong>. It assumes that past pricing movements can predict future movement. The following graph shows the trend in the price of securities over a certain period of time:</p>
<p class="CDPAlignCenter CDPAlign"><img class="aligncenter size-full wp-image-1107 image-border" src="assets/4a5ef4dd-7dd0-45aa-8572-15ed32159c79.png" style="width:144.75em;height:63.42em;"/></p>
<p>At a very high level, we see that the securities price moves in trend, but the length of the trend is not always the same. There has been a wealth of studies on how to read the patterns seen on the pricing movement across time. But isn't this a computer vision challenge? As opposed to us hand-picking countless numbers of features, should we leave it to a computer to read the graphs and learn how to chart trend lines?</p>
<div class="packt_infobox">In terms of types of patterns, a good place to start is <em>Technical Analysis of the Financial Markets: A Comprehensive Guide to Trading Methods and Applications</em> (New York Institute of Finance). For information on exact data processing to detect patterns, please refer to <em>Advances in Machine Learning</em>. Here, Dr. Prado really takes it to another level by giving you an insight into the working before the data is fed to the machine.</div>
<h2 id="uuid-1943e2a2-a5e2-43a1-a5b6-e7c28415f44f">Trading decisions – strategy</h2>
<p>A trading strategy refers to the considerations and actions to be taken on trading activities. So, in this chapter, as opposed to barring the strategies, I will show you an actual strategy that failed at its design. <span>For a real trader</span>, disclosing the winning trading strategy will kill the strategy because people can trade against it—for example, an opposing trader can also sell when you are expected to buy and vice versa.</p>
<p>The brief strategy we present here does not generate positive alpha compared to a simple buy-and-hold strategy with the same asset. However, I will indicate ways to improve it.</p>
<div class="packt_infobox">To learn more about the comparative behaviors of traders and bankers, please refer to <em>Compensating Financial</em> Experts by <em>The Journal of Finance</em> (<a href="https://onlinelibrary.wiley.com/doi/abs/10.1111/jofi.12372">https://onlinelibrary.wiley.com/doi/abs/10.1111/jofi.12372</a>).</div>
<h1 id="uuid-6ebbfe5e-23aa-4ad3-b7f4-b38a4d1c144b">Understanding the Markowitz mean-variance model</h1>
<p><span>The objective of portfolio management is to minimize risk in order to ascertain the target return, g</span><span>iven that, for the specific investor, we have the target return and risk tolerance captured from the IPS and historical returns. </span><span>Typical portfolio optimization models used in the industry include the Markowitz mean-variance model and the Treynor-Black model.</span></p>
<p>An economist, named Harry Markowitz, introduced mean-variance analysis, which is also known as <strong>Modern Portfolio Theory</strong> (<strong>MPT</strong>), in 1952. He was awarded a Nobel Prize in Economics for his theory.</p>
<p>The mean-variance model is a framework for assembling asset portfolios so that a return can be maximized for a given risk level. It is an extension of investment diversification. <strong>Investment diversification</strong> is an idea that suggests investors should invest in different kinds of financial assets. Investment diversification is less risky in comparison to investing in only one type of asset.</p>
<p>The investors choose the asset allocation that maximizes return, also known as the <strong>variance of return</strong>. While investing in assets, the risk to reward ratio becomes a critical decision-making factor. The risk to reward ratio is calculated as the ratio of expected returns to possible losses. The difference between the expected return and the actual return is known as <strong>risk</strong>. The key challenge is the calculation of the variance of return on the target portfolio. For example, it could be 40% equity and 60% bonds or an even more complex asset class allocation, such as real estate, commodities, and more. To come up with a variance of return with 40% equity and 60% bonds, we need to first calculate the variance of return for equities and bonds separately. At the same time, we also have to consider the covariance between the equity and bond, that is, how the return of equities and bonds goes hand in hand in the same direction or a completely different direction.</p>
<div class="packt_infobox">For detailed insights into how the asset and wealth management industry is shaping up, please refer to <em>PwC, 2017, Asset Management</em> <em>2020: Taking stock, Asset &amp; Wealth Management Insights</em>.</div>
<p>Imagine a team of people (where each person represents one asset class) working together on a task to deliver a return. The work of a portfolio manager is to determine who has more say and who has less say within the group (asset allocation work). This depends on the productivity (return) and fluctuation of the person's performance: some people exhibit extreme levels of performance, while some are pretty stable in terms of their productivity (variance). We also need to know the interaction between individual team members—this interaction also has to consider how each of them complements or amplifies each other's productivity (correlation). Some team members show strong chemistry between two of them to deliver extremely good results (positive correlation), some work at different times of the day—one is a night owl and the other a morning person—each with different productive hours (negative correlation), and some don't really have any consistent pattern of similarity or dissimilarity (zero correlation).</p>
<p>The following diagram shows the correlation matrix between two assets (<span class="packt_screen">i</span> and <span class="packt_screen">j</span>). The diagonal line in gray shows the securities' return variance and the remaining cells show inter-security return covariance. The cells in black are not needed, as they mirror the values opposite to the diagonal line. For a mere 20 securities, we will have 190 values to be estimated:</p>
<p class="CDPAlignCenter CDPAlign"><img class="aligncenter size-full wp-image-1108 image-border" src="assets/c857c8a0-12fa-430a-9b2d-bdd9f373c0ed.png" style="width:38.08em;height:26.17em;"/></p>
<p class="CDPAlignLeft CDPAlign"><span>To illustrate this problem further, let's assume that security <strong>20</strong> is not liquid, and we cannot reliably estimate its covariance with another security. We could have impacted the data quality of covariance with the other 19 securities. </span><span>The problem with this model in a real-life application is as follows:</span></p>
<ul>
<li>Some assets do not have enough data points for us to calculate their correlation with others (for example, new team members to the team).</li>
<li>In financial markets, the correlation between assets changes dynamically, and it is hard to forecast a forward-looking correlation.</li>
<li>The correlation is not linear.</li>
</ul>
<p>This model works on public equity with efficient pricing and lots of data points for modeling. But it does not work on non-liquid assets—such as private equity in start-ups or emerging market securities or bonds, where we don't have full visibility of the pricing and many are often reconstructed analytically.</p>
<div class="packt_infobox">One specific type of correlation in risk could be credit risk—in good times, the correlation of risk across assets is low; whereas, in crisis, the correlation spikes and moves in a similar direction. Please refer to <em>Credit Risk Pricing, Measurement and Management,</em> by Duffie D. and Singleton, K.J., for an example on default correlation.</div>
<p>Some treasurers in established firms are responsible for managing their own pension money. We assume that treasurers need to handle the target asset allocation for the pension fund. We will take the index return data for each of the asset classes. We will use Quandl's subscribed data on the ETF as the data source.</p>
<p>An ETF refers to funds that can be bought and sold on a public exchange such as the <strong>New York Stock Exchange</strong> (<strong>NYSE</strong>). It is a fund because it invests in many more underlying securities such as stocks or bonds. It is becoming more popular as it allows investors to focus on the themes that the funds are investing in, rather than individual stocks. For example, we can have a strong view about the strength of the US economy by buying the fund that invests in the largest 500 stocks of the US.</p>
<h1 id="uuid-6c55fca4-53eb-4956-b863-8b7951c1557d">Exploring the Treynor-Black model</h1>
<p class="mce-root">Due to the instability of the Markowitz mean-variance model in managing problems associated with multi-asset class portfolios, the Treynor-Black model was established. Treynor-Black's model fits the modern portfolio allocation approach where there are certain portfolios that are active and others that are passive. Here, passive refers to an investment that follows the market rate of return—not to beat the market average return but to closely <span>follow </span>the market return.</p>
<p class="mce-root">An active portfolio refers to the portfolio of investment in which we seek to deliver an above-market average return. The lower the market return with a market risk level, the higher the portfolio. Then, we allocate the total capital to an active portfolio. So, why take more risk if the market return is good enough? The Treynor-Black model seeks to allocate more weight to the asset that delivers a higher return/risk level out of the total risk/return level of the active portfolio.</p>
<h2 id="uuid-1502769b-8e4b-4903-a734-350cca5f7b73">Introducing ResNet – the convolutional neural network for pattern recognition</h2>
<p>What is specific about applying the computer vision type of neural network is that we can use the following hidden layers. In our example, we will use ResNet implemented in Keras as an example to illustrate these ideas. We will also showcase an approach to improve performance—however, you are expected to dig deeper into hyperparameter tuning.</p>
<p class="mce-root">The convolutional layer is like taking a subset of the image that is being inputted. In technical analysis, it's like having a sliding window to calculate a statistical value. Each type of sliding window is trained to detect a certain pattern such as upward, downward, and flat lines. In neural network terminology, each type is called a <strong>filter</strong>. For each type of filter, there are numbers of windows to fully run (or slide) through the input image; the number is represented by the number of neurons in the layer.</p>
<p>To explain the terminology, let's take an input image of size <em>3</em> <em>×</em> <em>3</em> and a kernel shape of <em>2</em> <em>×</em> <em>2</em>. Our actual input in the coding example is larger than this size.</p>
<p>The<span> </span><strong>input image</strong><span> </span>is a <span><em>3</em> </span><span><em>×</em> <em>3</em></span> image with a black line (represented by 3 pixels) crossing from the bottom-<span>left corner </span>to the upper-right corner diagonally. It shows a stock price that is moving upward by one pixel every day:</p>
<p class="CDPAlignCenter CDPAlign"><img class="aligncenter size-full wp-image-1109 image-border" src="assets/2c72f0f9-466a-430f-ab1b-336b94bcdc2b.png" style="width:16.58em;height:3.25em;"/></p>
<p>The shape of the sliding windows is called a <strong>kernel</strong>. A kernel is a function that can transform an inputted matrix/vector into another form, as shown in the following diagram:</p>
<p class="CDPAlignCenter CDPAlign"><img class="aligncenter size-full wp-image-1110 image-border" src="assets/fc0a9b54-fc34-43cf-87fc-7344dbc68857.png" style="width:13.00em;height:6.25em;"/></p>
<p><span>For illustration, we assume the kernel size to be <em>2</em> <em>×</em> <em>2</em>, <em>stride = 1</em>, and zero padding unless specified.</span></p>
<p class="mce-root">The numbers in the following diagram show the sequence of the kernel movement. Each movement will be represented by one neuron at the convolution layer:</p>
<p class="CDPAlignCenter CDPAlign"><img class="aligncenter size-full wp-image-1111 image-border" src="assets/9a11941c-d1d7-4697-a8a8-def4297988dc.png" style="width:13.50em;height:5.42em;"/></p>
<p><span>The following diagram shows the <em>2</em> <em>×</em> <em>2</em> kernel, and the kernel moves 4 times (that is, 4 neurons are required):</span></p>
<ul>
<li><strong>Kernel shape</strong>: <span>As the kernel moves (we call it slides), it may or may not cover the same input pixel, which makes the blue darker as we want to show which pixels are covered more than once:</span></li>
</ul>
<p class="CDPAlignCenter CDPAlign"><img class="aligncenter size-full wp-image-1112 image-border" src="assets/6577c452-3da1-44e3-a447-5545a02a2477.png" style="width:14.00em;height:5.58em;"/></p>
<p style="padding-left: 60px">The kernel <em>shape =</em> <em>2</em> <em>×</em> <em>2</em>, and it takes 4 moves to cover the full image:</p>
<p class="CDPAlignCenter CDPAlign"><img class="aligncenter size-full wp-image-1113 image-border" src="assets/e21ba8d6-fd2f-40b3-92bf-8cd69c777a9c.png" style="width:13.00em;height:5.50em;"/></p>
<p style="color: black;padding-left: 60px" class="CDPAlignLeft CDPAlign">The kernel <em>shape =</em> <em>1</em> <span><em>×</em> </span><em>1</em>, and it takes 9 moves to cover the full image.</p>
<ul>
<li><strong>Stride</strong>: This shows how many pixels need to be moved toward the right and downward as it advances:</li>
</ul>
<p class="CDPAlignCenter CDPAlign"><img class="aligncenter size-full wp-image-1114 image-border" src="assets/4b5eba3c-0ac0-42cf-a446-64a7b7c4ad7c.png" style="width:13.08em;height:5.25em;"/></p>
<p style="padding-left: 60px" class="CDPAlignLeft CDPAlign">Here, <em>stride = 1</em>, and it takes 4 moves to cover the image. Note that every time there will be overlapping pixels covered:</p>
<p class="CDPAlignCenter CDPAlign"><img class="aligncenter size-full wp-image-1115 image-border" src="assets/3db4863d-b4ef-4757-ab22-d47615256553.png" style="width:15.08em;height:6.08em;"/></p>
<p style="padding-left: 60px" class="CDPAlignLeft CDPAlign">Here, <em>stride = 2</em>, and it takes 4 moves to cover the image. Note that every time there will not be any overlapping pixels covered by the filter.</p>
<ul>
<li><strong>Padding</strong>: This shows how many white pixels are surrounding the inputted image:</li>
</ul>
<p class="CDPAlignCenter CDPAlign"><img class="aligncenter size-full wp-image-1116 image-border" src="assets/48563ec3-ee0d-4af3-9a2b-1862222c2ef5.png" style="width:13.17em;height:5.25em;"/></p>
<p style="padding-left: 60px" class="CDPAlignLeft CDPAlign">The following diagram shows zero padding:</p>
<p class="CDPAlignCenter CDPAlign"><img class="aligncenter size-full wp-image-1159 image-border" src="assets/bc4dceab-1e6b-4168-82f9-98854d7f5c97.png" style="width:39.25em;height:5.42em;"/></p>
<p class="CDPAlignLeft CDPAlign">Here, <em>padding = 1</em>, which allows the edge cell on the side to be covered by a different neuron.</p>
<h3 id="uuid-6aa1f772-c642-4793-b4ab-57f966315dea" class="mce-root">Pooling layer</h3>
<p class="mce-root">The pooling layer is quite self-explanatory—it is meant for pooling the results from the input. Imagine that after the convolutional layer, for each type of filter, there will be a number of outputs—for example, four. Can we reduce this to one variable instead of four output variables? Pooling can play the role of compressing this information. For example, taking the maximum of the four outputs (max pooling) or averaging the four outputs (average pooling). Visually, the meaning of the pooling layer is to blur the image or calculate moving average trends.</p>
<h3 id="uuid-8d875d0f-2646-4591-a54f-9326b77fbb16">ReLU activation layer</h3>
<p>For finance professionals, the <strong>Rectifier Linear Unit</strong> (<strong>ReLU</strong>) layer is like a call option payoff—once a certain threshold is exceeded, the output value is changed linearly with the input. Its significance is to reduce the noise in the pricing to ensure that only a strong market trend is considered.</p>
<h3 id="uuid-614527a4-9c01-4633-bc04-a600eab264fd">Softmax</h3>
<p>Softmax is a super-charged version of the logistics regression model that we touched on in the earlier chapters of this book with multiple predicted outcomes—for example, the version one binary outcome in the logistics regression model case. In our case, we wish to identify what the pricing <span>would be </span>on the next day.</p>
<h1 id="uuid-2844f9f1-298f-4c2c-8d8d-4dbc38b6f73e">Portfolio construction using the Treynor-Black model</h1>
<p>Let's say we are given 10 days of pricing data, and the work of technical analysis is to draw the lines on the right to make sense of the trend in order to generate the next day's pricing for the 11<sup>th</sup> day. It is quite obvious to find that it is indeed what a convolutional neural network could tackle.</p>
<p>Knowing that, practically, the time unit we are looking at could be per 100 ms or 10 ms instead of 1 day, but the principle will be the same:</p>
<p class="CDPAlignCenter CDPAlign"><img class="aligncenter size-full wp-image-1118 image-border" src="assets/0dc7414f-8319-4764-8beb-ceab6bd1f543.png" style="width:79.75em;height:70.33em;"/></p>
<p class="mce-root">Let's continue with the Duke Energy <span>example</span>. In this hypothetical case, we assume that we are the treasurer running the pension fund plan of Duke Energy with a total asset size of 15 billion USD with a defined contribution plan. Presumably, we know what our IPS is in digital format:</p>
<ul>
<li>Target return = 5% of real return (that means deducting the inflation of goods)</li>
<li>Risk = return volatility equals 10%</li>
<li>Constraints: No electricity utility companies to avoid investing in other peers/competitors</li>
</ul>
<div class="packt_infobox">Please note that this is a hypothetical example. No inference will be made about the actual company.</div>
<p>Using the IPS, we will first illustrate how to allocate the fund to the various asset classes as the first example. Then, in the second example, we will look at the trend following strategy to enable the investment managers to follow the market, given the recent trend in passive investment.</p>
<h2 id="uuid-cc066296-516c-4baf-a25a-b3f2c92ec1b7">Solution</h2>
<p>We have created two separate Python files because the asset parameters should be independent of how the asset is allocated. There are a total of four steps for this. The two main steps (the files) are as follows:</p>
<p class="CDPAlignCenter CDPAlign"><img class="aligncenter size-full wp-image-1119 image-border" src="assets/b1a921b1-aec5-49f9-a0a0-8b4cd0022eee.png" style="width:22.67em;height:22.67em;"/></p>
<p>We will download and estimate the asset parameters and generate the target asset allocation:</p>
<ol>
<li>To download and estimate the asset parameters, we will import libraries and key variable values. Then, we will define functions to download data for each of the assets, the market return, the risk-free rate, the asset return, and the parameters.</li>
</ol>
<ol start="2">
<li>To generate the target asset allocation, we will import libraries and key variable values, find out the weight of the securities in the active portfolio, and find out the weight of the active portfolio in the total portfolio.</li>
</ol>
<div class="mce-root packt_infobox">As we progress through the chapters, we will try to illustrate the use of traditional databases via this example, rather than creating a data dump without database storage. It follows our point made earlier that a structured database (a SQL database) works perfectly with securities' pricing data where the data is structured. We are using SQLite, which is a lighter version of the database. It is only meant to illustrate to the finance professional how databases come into play in our use case. For actual IT implementation, of course, we can use a lot of enterprise-grade databases that are both secure and fast.</div>
<h3 id="uuid-c5f3af78-3612-4fc4-84e0-6b68d18d105c"><strong>Downloading price data on an asset in scope</strong></h3>
<p>Individual assets and market assets used in this example are all ETFs. Data is downloaded from Quandl using free and paid subscriptions—including the risk-free data represented by the US treasury notes and the market return represented by the global equity ETF. After we download the data, which is the end-of-day data, we also need to define what we refer to as the price. In our example, we take the middle point between the daily high and the daily low as the price for the day.</p>
<p>The steps are as follows:</p>
<ol>
<li>Import the necessary libraries; <kbd>sqlite3</kbd> is newly introduced in this chapter. This shows how the SQL database could be used for trading data use cases. We will use a lightweight SQL database, called <strong>SQLite</strong>, which itself is shown as a file:</li>
</ol>
<p style="padding-left: 60px"><kbd>6A_1_cal_assetpara.py</kbd></p>
<pre style="padding-left: 60px">'''*************************************<br/>#1. Import libraries and key variable values<br/>'''<br/>import quandl<br/>import pandas as pd<br/>import numpy as np<br/>from sklearn import linear_model<br/>from sklearn.metrics import r2_score<br/>import sqlite3<br/>import math<br/>import os<br/>#not needed when using database<br/>import pickle<br/><br/>#API Key<br/><br/>#dates variables for all the download<br/><br/>#db file</pre>
<ol start="2">
<li>Define the function to download data for each of the assets:</li>
</ol>
<pre style="padding-left: 60px">'''*************************************<br/>#2. Define function to download data for each of the asset<br/>'''<br/><br/></pre>
<div class="packt_infobox"><span>Without Python, you can also directly assess the file via a tool, such as a plugin to the Chrome browser, SQLite viewer and more.</span></div>
<p>The function will download the price data of any given ticker in the <kbd>SHARADAR</kbd> database from Quandl. In addition to this, it will calculate the return of the ticket on a daily basis.</p>
<p>What it does is download the data and then calculate the return series.</p>
<h3 id="uuid-94e2cabc-adb3-47c1-87c1-0d9b107fcca6"><strong>Calculating the risk-free rate and defining the market</strong></h3>
<p>In our example, we take the US 3-month treasury notes as the proxy for a risk-free rate of return. In the investment world, the US is considered risk-free and the government will never default. Any return we earn above the risk-free rate is the return we get by taking more risk.</p>
<p>The market, as a whole, can be represented by the return from all of the investment assets around the world—this is easy in theory, but in reality, it is really hard to define. The most challenging part is generating this market return on a regular basis so that it could be used in the next step. We will take a shortcut and use an ETF to represent the market return:</p>
<pre>'''*************************************<br/>#3. Market Return<br/>'''</pre>
<p>Given a ticker as the market proxy, run the preceding function:</p>
<pre>'''*************************************<br/>#4. Risk Free Rate<br/>'''<br/>#day count<br/><br/>#risk free rate<br/><br/># override return of market</pre>
<p>The risk-free rate is rather complex. By convention, the industry uses a 3-month treasury note. To obtain the risk-free rate for the whole period, we take around 10 years of data to calculate the risk-free rate for the period.</p>
<p class="mce-root">However, we also need to annualize the interest rate. By definition of a 3-month treasury note, the number of days counted is 360 days. The interest rate is where every day is counted.</p>
<h3 id="uuid-4e6c71d7-d641-4b59-ad93-9a4836d819a5"><strong>Calculating the alpha, beta, and variance of error of each asset type</strong></h3>
<p>After understanding what the risk-free return rate and market return are, our next task is to find out the alpha, beta, and variance of error by regressing the market return against the asset's return:</p>
<p class="CDPAlignCenter CDPAlign"><em>Investment Return = Risk-Free Rate + Alpha + Beta * market return + noise (Variance of error)</em></p>
<p>After performing this calculation, we will keep the data in a SQLite<span> </span>database for retrieval later on.</p>
<p class="mce-root">I believe, in the future of start-ups, our robo-advisor will be focusing on ETF/smart beta—that is, the allocation of sectors to generate a return against the market. Therefore, in this example, I choose the ETF tickers.</p>
<p class="mce-root">We will run a linear regression of the sector ETF against the market benchmark. However, the day in which we can have a price quotation of the ETF and the market could be different; therefore, we will regress only when both the sector ETF and market ETF have a price—using the inner join command on SQL.</p>
<p class="mce-root">Inner join implicitly requires that the index of both the sector ETF and the market benchmark have to be the same before joining. The index of the dataset refers to the date of return:</p>
<pre>'''*************************************<br/>#5. Asset Return and parameters<br/>'''<br/>#list of stocks for selection in the active portfolio<br/><br/>#connect to the databases and reset it everytime with drop indicator<br/><br/>#write out the risk free and market parameters<br/><br/>#loop through the tickers<br/>for tkr in list_tkr:<br/> #calculate the CAPM:<br/> #download data for the ticker<br/><br/>#make sure the ticket we select has market data<br/> <br/> #linear regression<br/><br/>#obtain the result and write out the parameters</pre>
<h3 id="uuid-cb5ce0a9-4035-4e7d-8534-b75d8cf81493">Calculating the optimal portfolio allocation</h3>
<p>We are at the second major process—that is, working out the portfolio allocation. First, we will calculate the active portfolio size and weight of different asset within the active portfolio. The steps are as follows:</p>
<ol>
<li>Import all of the relevant libraries:</li>
</ol>
<p style="padding-left: 60px"><kbd><span>6A_2_treynor_black.py</span></kbd></p>
<pre style="padding-left: 60px">'''*************************************<br/>#1. Import libraries and key variable values<br/>'''<br/>import sqlite3<br/>import datetime<br/><br/>#create a table to store weight</pre>
<ol start="2">
<li>Calculate the active portfolio's parameters and compare them against the market performance to find out how much weight from the total portfolio we should allocate to the active portfolio:</li>
</ol>
<pre style="padding-left: 60px">'''*************************************<br/>#2. Find out the weight of the securities in the active portfolio<br/>'''<br/>#total alpha/variance of the active securities<br/><br/>#insert into the table the weight of each active securities</pre>
<p style="padding-left: 60px">The weight of the active portfolio is solved by aggregating the parameters for the securities (sector ETF) that belong to the active portfolio.</p>
<ol start="3">
<li class="mce-root">Then, based on the ratio of the market return/risk, as compared to the active portfolio return/risk, the stronger the active portfolio performs, the more weight it gets out of the total portfolio:</li>
</ol>
<pre style="padding-left: 60px">'''*************************************<br/>#3. Find out the weight of the active portfolio in the total portfolio<br/>'''<br/>#calculate the parameters of the active portfolio<br/><br/>#read back the risk free and market para<br/><br/>#calculate the weight of active portfolio<br/><br/>#display the result</pre>
<p>After the optimal portfolio is obtained, the next step is to allocate it to <em>you</em> according to the IPS on return and risk.</p>
<p>The following two constraints need to be satisfied:</p>
<ul>
<li><em>% Optimal portfolio x Return by Optimal portfolio + (1-%Optimal portfolio) x Return by risk-free asset &gt;= Return required by IPS</em></li>
<li><em><span>% Optimal portfolio x Risk by Optimal portfolio &lt;= Risk required by IPS</span></em></li>
</ul>
<p><span>Congratulations! You have learned how to allow capital to different investment assets to yield the optimal return and risk level. In the next section, </span>we will look at an example on how to predict the trend of a security. This will help investors to make wise investment decisions.</p>
<h1 id="uuid-62cf9e4d-a585-4881-9962-64b42426b66e">Predicting the trend of a security</h1>
<p>In the preceding example, we played the role of a trader who followed the portfolio allocation set by the treasurer. Assuming that our job is to follow the securities required by the treasurer, the profit and loss of the trader hinges on how can we profit from buying low and selling high. We took the daily pricing history of securities as the data to build our model. In the following section, we will demonstrate how to predict the trend before making buy decisions for assets.</p>
<h2 id="uuid-55c3b70c-41f4-4238-bb02-17ef254a9920" class="mce-root">Solution</h2>
<p>There are two major processes—one on model development and another on model backtesting. Both processes include a total of eight steps for real-time deployment, which we will not include here. However, it is very similar to model backtesting. The following diagram illustrates the flow of the process:</p>
<p class="CDPAlignCenter CDPAlign"><img class="aligncenter size-full wp-image-1120 image-border" src="assets/8623fb85-d217-407c-a6f5-d3890eebbb86.png" style="width:28.92em;height:22.00em;"/></p>
<h3 id="uuid-b26a25b7-8a28-4415-9579-05004d5e97d7" class="mce-root"><strong>Loading, converting, and storing data</strong></h3>
<p>In this step, we will load the data, convert the data into an image array, and then store it in a HDF5 data file format. First, we will load the data from Quandl as a data frame, and then convert the data into an array—which will plot the data like it was presented earlier. In our example, we simplify the problem by plotting only day end data points for one day. We only take the middle point of the day high and the day low, without considering its transaction volume.</p>
<p class="mce-root">When it comes to plotting the price on an array with fixed dimensions, on the <em>y</em> axis—the price—we will develop a function to fix the maximum and minimum values into the fixed dimension by scaling the data points in between the maximum and minimum accordingly. This is called <strong>normalization</strong>. On the <em>x</em> axis, each day is represented by one point on the <em>x</em> axis, where the far left is the earliest day and the far right is the latest day of a given window size. On a given point, the color of the price point is of the same, <em>color = 255</em> for showing it in pictures, or 1 for feeding it to neural network.</p>
<p class="mce-root">The same treatment is done on the target variable—which is only the next day chart using the same scale for <em>y</em>. If the next day is <span>actually </span>higher than the maximum or lower than the minimum, we can force it to take the current maximum and minimum point.</p>
<p class="mce-root">After the array is prepared, we will then stack up the array for the duration specified—with every single day represented by one chart that shows the past <em>X</em> days, with <em>X</em> being the window size. When we have finished stacking up, we will put the whole array into a HDF5 file—this is a distributed file format in nature, and it allows the file to be stored across multiple physical locations.</p>
<p>Define the libraries and variables. We have a defined a list of tickers to go through for the download step:</p>
<p><kbd>6B_1_trendFollowing.py</kbd></p>
<pre>'''*************************************<br/>#1. Import libraries and key variable values<br/><br/>'''<br/>import quandl<br/>import plotly<br/>import plotly.graph_objs as go<br/>import numpy as np<br/><br/>from datetime import datetime<br/>try:<br/>    import Image<br/>except ImportError:<br/>    from PIL import Image<br/>import os<br/>import h5py<br/><br/>#dates parameters<br/>...<br/>#quandl setting<br/>...<br/>#parameters for the image generation<br/>...<br/>#create path for the output dataset<br/>...<br/>#ticker lists<br/>...<br/>#generate png file for each of the input or now<br/>...<br/>#generate interactive plot to the ticket stock price or not<br/>...</pre>
<p>Define the function to put the stock price of variable range into a fixed-sized image of fixed height and width. It will return a column of values that has been rescaled along with the scaling factor:</p>
<ul>
<li><em>Pixel value = (price value – minimum value of the column) x number of pixels per value</em></li>
<li><em>Number of pixels = (maximum value of the column - minimum value of the column) / total number of pixels</em></li>
</ul>
<p>The code is as follows:</p>
<pre>'''*************************************<br/>#2. Define the function to rescale the stock price according to the min and max values<br/><br/>'''<br/>#input_X is a series of price<br/>#output_X is a series of price expressed in pixel<br/>def rescale(input_X, pixel, min_x,max_x):<br/>...</pre>
<p>Ticker by ticker, we will download and convert the data into an input image and target result for machine learning as the next step. The most technical aspect of these codes relates to HDF5 file saving. Within the file, it is further divided into a dataset, and, within the dataset, we can store the files inside. One specific feature of dataset is that its size is fixed once it is defined at creation. Additionally, it is not meant to be dynamically updated—though, this is technically possible.</p>
<p style="color: black" class="western">Colored images are stored in three channels—red, green, and blue—each channel is a matrix where each pixel ranges from the value of 0 to 255. However, in our example, we will only <span>use </span>one channel for black and white pictures. Before we store the image to HDF5, all the numbers are divided by 255 so that the input variables are in a range between 0 and 1 for neural network training later.</p>
<p>To give you a real feeling of the data, we also have another interactive chart feature (using <kbd>ploty</kbd>) provided. This was also turned off to improve speed. However, for a first-time user of the code, it is recommended that you try it out to see the data being downloaded.</p>
<p class="sdfootnote-western">Please refer to image processing texts for an in-depth discussion—my favorite is <em>Feature Extraction &amp; Image Processing for Computer Vision</em> by Nixon M.S. and Aguado, A.S., as it focuses a lot on extracting features that we need as opposed to just laying out the theoretical background.</p>
<p class="sdfootnote-western">However, the downside is that this book's code is not in Python—which is an acceptable challenge given that learning the principle is more important than code that evolves:</p>
<pre>'''*************************************<br/>#3. Go through the tickers<br/>'''<br/>for tkr in tkr_list:<br/>    ...<br/>    #if the ticker has been downloaded, skip the ticket and go for the next <br/>     one<br/>    ...<br/>    #download and create dataset<br/>    ...<br/>    #sort the date from ascending to descending...<br/>    ...    <br/>    #charting interactive chart for viewing the data<br/>    ...<br/>    #calculate mid price of the day<br/>    ...    <br/>    #remove the file if there is one<br/>    ...<br/>    #remove the file if there is one<br/>    ...<br/>    #create dataset within the HDF5 file<br/>    #now we create the dataset with a fixed size to fit all the data, it <br/>     could also be create to fit fixed batches    <br/>    ...<br/>    <br/>    #loop through the dates<br/>    for i in range(num_img):<br/>        ...<br/>        #create min and max values for the mid price plot within a given <br/>         timeframe<br/>        ...<br/>        #in case of low liquidity ETF which has the same price, no graph be <br/>         drawn<br/>        ...<br/>        #draw the dot on the x, y axis of the input image array<br/>        ...<br/>        #output the image for visualization<br/>        ...        <br/>        #draw the dot on the target image for training<br/>        ...        <br/>        #stack up for a numpy for Image Recognition<br/>        ...</pre>
<h3 id="uuid-c127f324-9fd2-4272-8225-4964739a9aa3">Setting up the neural network</h3>
<p>Following the code from the Keras examples in regard to ResNet, we do not perform any alternation of the network design. We take both version 1 and version 2 while disabling the batch normalization,<span> </span>given that the data point has the same color, and the <em>y</em> axis is normalized for a given window size, so there is not much significance in further normalizing it.</p>
<div class="packt_infobox">Batch normalization has to do with harmonizing the values seen in the network in the current batch of records—it works well if the color we plot on an image contains different colors. However, since we have already normalized the pricing at each data point on its <em>y</em> axis, the codes are unchanged for now as we need this when we feed in data with different scales and distributions.</div>
<h3 id="uuid-543e7e17-9a44-4df3-bf2f-c11319494f9f" class="mce-root">Loading the data to the neural network for training</h3>
<p class="mce-root">We retrieved the data from the HDF5 file earlier and put it in the network that was just set up in the previous step. There will be a splitting of the training, testing and validation sets. However, in our case, we just take all of the data as the training and testing sets at the same time. The validation set can be another stock—given that we are training only the general intelligence to observe the technical movement of stock.</p>
<p class="mce-root">We feed the network with batch normalization and a certain epoch number. This step takes the most time.</p>
<p class="mce-root">During training, we keep a log of the performance for visualization later:</p>
<p><kbd>6B_2_TrainCNN.py</kbd></p>
<pre>'''*************************************<br/>#1. Import libraries and key variable values<br/>'''<br/>'''*************************************<br/>#2. Define functions<br/>'''<br/>def lr_schedule(epoch):<br/>def resnet_layer(inputs,<br/>                 num_filters=16,<br/>                 kernel_size=3,<br/>                 strides=1,<br/>                 activation='relu',<br/>                 batch_normalization=True,<br/>                 conv_first=True):<br/>def resnet_v1(input_shape, depth, num_classes=10):<br/>def resnet_v2(input_shape, depth, num_classes=10):<br/><br/></pre>
<div class="packt_infobox">Please refer to <a href="https://arxiv.org/abs/1512.03385">https://arxiv.org/abs/1512.03385</a> for an explanation on the design, and refer to the Keras documentation for further implementation details: <a href="https://keras.io/applications/#resnet50">https://keras.io/applications/#resnet50</a>.</div>
<p class="mce-root">What the code essentially does is to create two different neural network designs of different structures—given that we have a sizable data input with the data source, readers will experience a better performance with version 2 as long as the data is sizable:</p>
<pre>#3. Execute the model training<br/>'''<br/># Computed depth from supplied model parameter n<br/><br/># Model name, depth and version<br/><br/># create list of batches to shuffle the data<br/><br/>#check if the prev step is completed before starting<br/><br/>#decide if we should load a model or not<br/><br/>#loop through the tickers<br/><br/>#load dataset saved in the previous preparation step<br/><br/>#start if both file exists:<br/><br/>#calculate number of batches<br/> #do it at the first one<br/><br/># Input image dimensions.<br/>        # Prepare model model saving directory.<br/><br/>        # Prepare callbacks for model saving and for learning rate <br/>          adjustment<br/><br/>        # loop over batches<br/><br/>            # Run training, without data augmentation.<br/><br/>        #when model training finished for the ticket, create a file to <br/>         indicate its completion<br/><br/># Score trained model.<br/><br/></pre>
<h3 id="uuid-1b2e2644-78fc-4e6c-b92a-884c02c794f0" class="mce-root"><strong>Saving and fine-tuning the neural network</strong></h3>
<p class="mce-root">The network is saved at the end. We did not fine-tune our model at all in this example—but it has to do with hyperparameters tuning—which means that we should tune every single parameter in the network so far. I would recommend that you look at<span> </span><em>Machine Learning Yearning</em><span> </span>by Andrew Ng (<a href="https://www.deeplearning.ai/machine-learning-yearning/">https://www.deeplearning.ai/machine-learning-yearning/</a>). This step is not implemented in this example. But we have illustrated it in more detail in <a href="61949743-f7c3-4295-aaee-dab1d169d25c.xhtml">Chapter 3</a>, <em>Using Features and Reinforcement Learning to Automate Bank Financing</em>.</p>
<h3 id="uuid-54d1cca8-9dbd-473e-907e-a1b508be7b84" class="mce-root">Loading the runtime data and running through the neural network</h3>
<p class="mce-root">The network can be loaded again and run on a new dataset as a validation set. However, in our example, we take another stock to test whether this generic technical analysis machine works or not. The output of the network is the prediction of the next day's pricing.</p>
<p>In this program, the most special data will be the strategy parameters. It all starts with one monetary value. And we are testing three strategies—one buy and hold, which is the benchmark, and two takes on different pricing outputs to trade.</p>
<p>The steps involved are as follows:</p>
<ol>
<li>Import all the necessary libraries and variables:</li>
</ol>
<p style="padding-left: 90px"><kbd>6B_3_RunCNN.py</kbd></p>
<pre style="padding-left: 60px">'''*************************************<br/>#1. Import libraries and key variable values<br/>'''<br/>#folder path<br/><br/>#date range for full dataset<br/><br/>#Create list of dates<br/><br/>#API key for quandl<br/><br/>#Parameters for the image generation<br/><br/>#model path<br/><br/>#number of channel for the image<br/><br/>#strategies parameter</pre>
<div class="packt_infobox">With ResNet v2, we have close to 1 million parameters, while we are feeding roughly 3 millions of records ~14.5 years x 200 trading days x 125 tickers (but some tickers are not liquid to trade)<span>.</span></div>
<ol start="2">
<li>Then, define the functions to fit the price points into the image with a fixed height:</li>
</ol>
<pre style="padding-left: 60px">'''*************************************<br/>#2. Define functions<br/>'''</pre>
<ol start="3">
<li>Get new data and run the functions to predict the price. Load data from a ticket and prepare the data; then, run the model built from the training process:</li>
</ol>
<pre style="padding-left: 60px">'''*************************************<br/>#3. Running the test<br/>'''<br/>#Get the data<br/><br/>#write header for the log of the strategy back-testing<br/><br/>#loop through the dates<br/> #make sure both start and end dates are valid<br/><br/>#prepare the input data<br/><br/>#if no trend, then drop this data point<br/><br/>#stack up for a numpy for Image Recognition<br/> #print the historical data<br/><br/>#make prediction<br/>#Obtain predicted price</pre>
<h3 id="uuid-a5a40512-6a1c-4faa-bf69-d8f0d261eb23" class="mce-root">Generating a trading strategy from the result and performing performance analysis</h3>
<p class="mce-root">For a given price prediction, we can devise different actions to do with the price prediction.</p>
<p>The objective of this loop is to measure the profit and loss of the trading strategies by relying on the prediction made by the model in the previous section.</p>
<p class="mce-root">At any given date, there will be only one price prediction, in the form of a 1D array with the probability at each price point given the scale. The various strategies (1 and 2) handle what to do with the prediction:</p>
<pre class="mce-root">#calculate expected values<br/><br/>#Strategy Back-Testing<br/> #Benchmark - Strategy 0 - buy and hold<br/><br/>#Testing of strategy1<br/><br/>#Testing of strategy2<br/><br/>#print the final result of the strategies<br/><br/></pre>
<p>Congratulations! You have walked through the process of price prediction using computer vision models.</p>
<p class="mce-root">In the real world, there could be more predictions made by different models, which will add complexity to the number of strategies tested. We require a benchmark to know whether these strategies outperform the normal market situation, which are buy and hold strategies. If our strategies are successful, then they should be able to outperform the market by showing higher profit and loss figures.</p>
<p class="mce-root">In strategy backtesting, we normally deploy it to an out-of-time, unseen sample.</p>
<h1 id="uuid-e13c5563-5c95-430c-92ce-047eb8111382">Summary</h1>
<p class="mce-root">In this chapter, we learned a number of portfolio management techniques. We combined them with AI to automate the decision-making process when buying assets. We learned about the Markowitz mean-variance model and the Treynor-Black model for portfolio construction. We also looked at an example of portfolio construction using the Treynor-Black model. We also learned how to predict trends in the trading of a security. </p>
<p>In the next chapter, we will look at the sell side of asset management. We will learn about sentiment analysis, algorithmic marketing for investment products, network analysis, and how to extract network relationships. We will also explore techniques such as Network X and tools such as Neo4j and PDF Miner.</p>


            </article>

            
        </section>
    </body></html>