<html><head></head><body>
<div id="_idContainer076" class="calibre2">
<h1 class="chapter-number" id="_idParaDest-100"><a id="_idTextAnchor106" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.1.1">6</span></h1>
<h1 id="_idParaDest-101" class="calibre5"><a id="_idTextAnchor107" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.2.1">Building Intelligent Applications with the OpenAI API</span></h1>
<p class="calibre3"><a id="_idTextAnchor108" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.3.1">This chapter will bring together all the key concepts that we have learned about in the previous chapters. </span><span class="kobospan" id="kobo.3.2">It’s all about creating real intelligent applications using the OpenAI API. </span><span class="kobospan" id="kobo.3.3">It’s important to note that an application is not simply just the OpenAI API, but several layers around it, such as the frontend and </span><span><span class="kobospan" id="kobo.4.1">backend layers.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.5.1">In this chapter, we will make use of the application architecture that we learned in the previous chapter. </span><span class="kobospan" id="kobo.5.2">In particular, we will use </span><em class="italic"><span class="kobospan" id="kobo.6.1">Google Cloud Functions</span></em><span class="kobospan" id="kobo.7.1"> as the backend layer and </span><em class="italic"><span class="kobospan" id="kobo.8.1">Bubble</span></em><span class="kobospan" id="kobo.9.1"> as the frontend layer. </span><span class="kobospan" id="kobo.9.2">In case you don’t recall the architecture, </span><span><em class="italic"><span class="kobospan" id="kobo.10.1">Figure 6</span></em></span><em class="italic"><span class="kobospan" id="kobo.11.1">.1</span></em><span class="kobospan" id="kobo.12.1"> demonstrates the layers within </span><span><span class="kobospan" id="kobo.13.1">any application:</span></span></p>
<div class="calibre2">
<div class="img---figure" id="_idContainer050">
<span class="kobospan" id="kobo.14.1"><img alt="Figure 6.1 - Demonstration of a typical application architecture using the OpenAI API" src="image/B21007_06_1.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.15.1">Figure 6.1 - Demonstration of a typical application architecture using the OpenAI API</span></p>
<p class="calibre3"><span class="kobospan" id="kobo.16.1">In this chapter, we will cover the </span><span><span class="kobospan" id="kobo.17.1">following recipes:</span></span></p>
<ul class="calibre16">
<li class="calibre15"><span class="kobospan" id="kobo.18.1">Creating a wrapper application that generates replies to </span><span><span class="kobospan" id="kobo.19.1">your emails</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.20.1">Creating a multi-modal application that generates </span><span><span class="kobospan" id="kobo.21.1">travel itineraries</span></span></li>
</ul>
<h1 id="_idParaDest-102" class="calibre5"><a id="_idTextAnchor109" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.22.1">Technical requirements</span></h1>
<p class="calibre3"><span class="kobospan" id="kobo.23.1">All the recipes in this chapter require you to have access to the OpenAI API (via a generated API key) and have an API client installed. </span><span class="kobospan" id="kobo.23.2">Please refer to the </span><em class="italic"><span class="kobospan" id="kobo.24.1">Making OpenAI API requests with Postman</span></em><span class="kobospan" id="kobo.25.1"> recipe in </span><a href="B21007_01.xhtml#_idTextAnchor021" class="pcalibre1 calibre6 pcalibre"><span><em class="italic"><span class="kobospan" id="kobo.26.1">Chapter 1</span></em></span></a><span class="kobospan" id="kobo.27.1"> for more information on how to obtain your API key. </span><span class="kobospan" id="kobo.27.2">You will also require knowledge of Python and the Python OpenAI library, which we covered in the first recipe within </span><a href="B21007_04.xhtml#_idTextAnchor074" class="pcalibre1 calibre6 pcalibre"><span><em class="italic"><span class="kobospan" id="kobo.28.1">Chapter 4</span></em></span></a><span><span class="kobospan" id="kobo.29.1">.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.30.1">We will also use GCP to host our public endpoint. </span><span class="kobospan" id="kobo.30.2">GCP is a suite of cloud computing services offered by Google. </span><span class="kobospan" id="kobo.30.3">It offers a range of hosting and computing services for databases, data storage, data analytics, machine learning, and more, all hosted on Google’s infrastructure. </span><span class="kobospan" id="kobo.30.4">You can refer to the </span><em class="italic"><span class="kobospan" id="kobo.31.1">Creating a public endpoint server that calls the OpenAI API</span></em><span class="kobospan" id="kobo.32.1"> recipe in </span><a href="B21007_05.xhtml#_idTextAnchor090" class="pcalibre1 calibre6 pcalibre"><span><em class="italic"><span class="kobospan" id="kobo.33.1">Chapter 5</span></em></span></a><span class="kobospan" id="kobo.34.1"> for </span><span><span class="kobospan" id="kobo.35.1">more information.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.36.1">Finally, you need to be familiar with Bubble, which is a visual programming platform that allows users to create web applications without needing to write code. </span><span class="kobospan" id="kobo.36.2">You can refer to the </span><em class="italic"><span class="kobospan" id="kobo.37.1">Calling the user-created endpoint from no-code applications</span></em><span class="kobospan" id="kobo.38.1"> recipe in </span><a href="B21007_05.xhtml#_idTextAnchor090" class="pcalibre1 calibre6 pcalibre"><span><em class="italic"><span class="kobospan" id="kobo.39.1">Chapter 5</span></em></span></a><span class="kobospan" id="kobo.40.1"> for more information on how to set </span><span><span class="kobospan" id="kobo.41.1">up Bubble.</span></span></p>
<h1 id="_idParaDest-103" class="calibre5"><a id="_idTextAnchor110" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.42.1">Creating a wrapper application that generates replies to your emails</span></h1>
<p class="calibre3"><span class="kobospan" id="kobo.43.1">In this recipe, we</span><a id="_idIndexMarker260" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.44.1"> will build an intelligent application that helps you reply to emails from your manager, who has asked you to perform a specific task. </span><span class="kobospan" id="kobo.44.2">I always have a hard time politely saying no to my manager when I’m overburdened with tasks, so this could be a great application for me (and I use a variant of this </span><span><span class="kobospan" id="kobo.45.1">every day).</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.46.1">Technically, everything that you do with this application you could do with the ChatGPT service directly. </span><span class="kobospan" id="kobo.46.2">So, why take the time and build it with the API, backend, frontend approach? </span><span class="kobospan" id="kobo.46.3">When learning any new skill, it is useful to learn concepts in manageable steps. </span><span class="kobospan" id="kobo.46.4">Here, the first step when building an intelligent application is to start with a simple wrapper application. </span><span class="kobospan" id="kobo.46.5">This will enable you to master the underlying workflow of building an intelligent application. </span><span class="kobospan" id="kobo.46.6">Afterward, we will add new concepts to this workflow that will enable you to build an application, which cannot be done with the </span><span><span class="kobospan" id="kobo.47.1">ChatGPT service.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.48.1">A </span><strong class="bold"><span class="kobospan" id="kobo.49.1">wrapper application</span></strong><span class="kobospan" id="kobo.50.1"> for</span><a id="_idIndexMarker261" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.51.1"> the OpenAI API is essentially a software layer that facilitates easier and more efficient interaction with the OpenAI API. </span><span class="kobospan" id="kobo.51.2">The term </span><strong class="bold"><span class="kobospan" id="kobo.52.1">wrapper</span></strong><span class="kobospan" id="kobo.53.1"> in programming generally refers to a type of software that acts as an intermediary or interface to another software component or API, making it more accessible or simpler to use. </span><span class="kobospan" id="kobo.53.2">Wrappers are very useful as they simplify API interactions, and they are also easier to make compared to more complex </span><span><span class="kobospan" id="kobo.54.1">multi-modal applications.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.55.1">In this recipe, we will build the application in three phases: </span><em class="italic"><span class="kobospan" id="kobo.56.1">OpenAI Playground</span></em><span class="kobospan" id="kobo.57.1">, </span><em class="italic"><span class="kobospan" id="kobo.58.1">Google Cloud Function</span></em><span class="kobospan" id="kobo.59.1">, </span><span><span class="kobospan" id="kobo.60.1">and </span></span><span><em class="italic"><span class="kobospan" id="kobo.61.1">Bubble</span></em></span><span><span class="kobospan" id="kobo.62.1">.</span></span></p>
<p class="calibre3"><span><span class="kobospan" id="kobo.63.1">Getting ready</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.64.1">Ensure you </span><a id="_idIndexMarker262" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.65.1">have an OpenAI platform account with available usage credits. </span><span class="kobospan" id="kobo.65.2">If you don’t, please follow the </span><em class="italic"><span class="kobospan" id="kobo.66.1">Setting up your OpenAI Playground environment</span></em><span class="kobospan" id="kobo.67.1"> recipe in </span><a href="B21007_01.xhtml#_idTextAnchor021" class="pcalibre1 calibre6 pcalibre"><span><em class="italic"><span class="kobospan" id="kobo.68.1">Chapter 1</span></em></span></a><span><span class="kobospan" id="kobo.69.1">.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.70.1">Furthermore, ensure you have created a GCP account. </span><span class="kobospan" id="kobo.70.2">You may need to provide a billing profile as well to create any GCP resources. </span><span class="kobospan" id="kobo.70.3">Note that GCP does have a free tier, and in this recipe, we will </span><em class="italic"><span class="kobospan" id="kobo.71.1">not</span></em><span class="kobospan" id="kobo.72.1"> go above the free tier so, essentially, you should not be billed </span><span><span class="kobospan" id="kobo.73.1">for anything.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.74.1">Finally, ensure that you have created a Bubble account, which you can do for free at </span><a href="http://bubble.io" class="pcalibre1 calibre6 pcalibre"><span><span class="kobospan" id="kobo.75.1">http://bubble.io</span></span></a><span><span class="kobospan" id="kobo.76.1">.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.77.1">All the recipes in this chapter will have this </span><span><span class="kobospan" id="kobo.78.1">same requirement.</span></span></p>
<h2 id="_idParaDest-104" class="calibre7"><a id="_idTextAnchor111" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.79.1">How to do it…</span></h2>
<h3 class="calibre8"><span class="kobospan" id="kobo.80.1">OpenAI Playground</span></h3>
<ol class="calibre14">
<li class="calibre15"><span class="kobospan" id="kobo.81.1">Navigate to </span><a href="https://openai.com" class="pcalibre1 calibre6 pcalibre"><span class="kobospan" id="kobo.82.1">https://openai.com</span></a><span class="kobospan" id="kobo.83.1">. </span><span class="kobospan" id="kobo.83.2">Select </span><strong class="bold"><span class="kobospan" id="kobo.84.1">Playground</span></strong><span class="kobospan" id="kobo.85.1"> from the left-hand side menu. </span><span class="kobospan" id="kobo.85.2">From</span><a id="_idIndexMarker263" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.86.1"> the top menu, switch Playground mode from </span><strong class="bold"><span class="kobospan" id="kobo.87.1">Assistant</span></strong> <span><span class="kobospan" id="kobo.88.1">to </span></span><span><strong class="bold"><span class="kobospan" id="kobo.89.1">Chat</span></strong></span><span><span class="kobospan" id="kobo.90.1">.</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.91.1">In the </span><strong class="bold"><span class="kobospan" id="kobo.92.1">System</span></strong><span class="kobospan" id="kobo.93.1"> message, type </span><strong class="source-inline1"><span class="kobospan" id="kobo.94.1">You are a helpful assistant that creates replies to emails that politely say no to the task you have been asked to perform. </span><span class="kobospan" id="kobo.94.2">Only return the reply to the email, </span></strong><span><strong class="source-inline1"><span class="kobospan" id="kobo.95.1">nothing else.</span></strong></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.96.1">On the </span><strong class="bold"><span class="kobospan" id="kobo.97.1">User</span></strong><span class="kobospan" id="kobo.98.1"> tab, select </span><strong class="bold"><span class="kobospan" id="kobo.99.1">Enter a user message here</span></strong><span class="kobospan" id="kobo.100.1"> and type in a sample email, such as </span><span><span class="kobospan" id="kobo.101.1">the following:</span></span><p class="calibre3"><span><strong class="source-inline"><span class="kobospan" id="kobo.102.1">Hi Henry,</span></strong></span></p><p class="calibre3"><strong class="source-inline"><span class="kobospan" id="kobo.103.1">Since Dave is out, could you please pick up the Henderson proposal and have it on my desk by </span></strong><span><strong class="source-inline"><span class="kobospan" id="kobo.104.1">tomorrow morning?</span></strong></span></p><p class="calibre3"><span><strong class="source-inline"><span class="kobospan" id="kobo.105.1">Best,</span></strong></span></p><p class="calibre3"><span><strong class="source-inline"><span class="kobospan" id="kobo.106.1">Rick</span></strong></span></p></li>
<li class="calibre15"><span class="kobospan" id="kobo.107.1">Over </span><a id="_idIndexMarker264" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.108.1">on the right-hand side, make the following changes to the </span><span><span class="kobospan" id="kobo.109.1">Playground properties:</span></span><ul class="calibre17"><li class="calibre15"><span class="kobospan" id="kobo.110.1">Switch </span><strong class="bold"><span class="kobospan" id="kobo.111.1">Model</span></strong><span class="kobospan" id="kobo.112.1"> from </span><strong class="bold"><span class="kobospan" id="kobo.113.1">gpt-3.5</span></strong> <span><span class="kobospan" id="kobo.114.1">to </span></span><span><strong class="bold"><span class="kobospan" id="kobo.115.1">gpt-4</span></strong></span></li><li class="calibre15"><span class="kobospan" id="kobo.116.1">Increase </span><strong class="bold"><span class="kobospan" id="kobo.117.1">Temperature</span></strong> <span><span class="kobospan" id="kobo.118.1">to </span></span><span><strong class="source-inline1"><span class="kobospan" id="kobo.119.1">1.4</span></strong></span></li><li class="calibre15"><span class="kobospan" id="kobo.120.1">Set </span><strong class="bold"><span class="kobospan" id="kobo.121.1">Maximum length</span></strong><span class="kobospan" id="kobo.122.1"> to </span><span><span class="kobospan" id="kobo.123.1">around </span></span><span><strong class="source-inline1"><span class="kobospan" id="kobo.124.1">1000</span></strong></span><span><span class="kobospan" id="kobo.125.1">:</span></span></li></ul></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer051">
<span class="kobospan" id="kobo.126.1"><img alt="Figure 6.2 – ChatGPT Playground configuration" src="image/B21007_06_2.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.127.1">Figure 6.2 – ChatGPT Playground configuration</span></p>
<ol class="calibre14">
<li value="5" class="calibre15"><span class="kobospan" id="kobo.128.1">Next, select </span><strong class="bold"><span class="kobospan" id="kobo.129.1">Submit</span></strong><span class="kobospan" id="kobo.130.1">. </span><span class="kobospan" id="kobo.130.2">OpenAI will create a response for you. </span><span class="kobospan" id="kobo.130.3">In this case, it will create a reply to the sample email you sent, with the condition that it </span><em class="italic"><span class="kobospan" id="kobo.131.1">politely</span></em><span class="kobospan" id="kobo.132.1"> says no to the task you have been asked </span><span><span class="kobospan" id="kobo.133.1">to perform.</span></span></li>
</ol>
<h3 class="calibre8"><span class="kobospan" id="kobo.134.1">Google Cloud Function</span></h3>
<ol class="calibre14">
<li value="6" class="calibre15"><span class="kobospan" id="kobo.135.1">In a new </span><a id="_idIndexMarker265" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.136.1">tab, navigate to </span><a href="https://cloud.google.com" class="pcalibre1 calibre6 pcalibre"><span class="kobospan" id="kobo.137.1">https://cloud.google.com</span></a><span class="kobospan" id="kobo.138.1"> and log in with your </span><span><span class="kobospan" id="kobo.139.1">Google account.</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.140.1">Select </span><strong class="bold"><span class="kobospan" id="kobo.141.1">Console</span></strong><span class="kobospan" id="kobo.142.1"> at the </span><span><span class="kobospan" id="kobo.143.1">top right.</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.144.1">Create a new</span><a id="_idIndexMarker266" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.145.1"> Google cloud function. </span><span class="kobospan" id="kobo.145.2">To do so, in the search bar, type </span><strong class="source-inline1"><span class="kobospan" id="kobo.146.1">function</span></strong><span class="kobospan" id="kobo.147.1">, select </span><strong class="bold"><span class="kobospan" id="kobo.148.1">Cloud Functions</span></strong><span class="kobospan" id="kobo.149.1">, and then select </span><span><strong class="bold"><span class="kobospan" id="kobo.150.1">Create Function</span></strong></span><span><span class="kobospan" id="kobo.151.1">.</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.152.1">Give the function a descriptive name. </span><span class="kobospan" id="kobo.152.2">Since this function will return a polite email for us, we are going to aptly name </span><span><span class="kobospan" id="kobo.153.1">it </span></span><span><strong class="source-inline1"><span class="kobospan" id="kobo.154.1">generatepoliteemail</span></strong></span><span><span class="kobospan" id="kobo.155.1">.</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.156.1">In the </span><strong class="bold"><span class="kobospan" id="kobo.157.1">Authentication</span></strong><span class="kobospan" id="kobo.158.1"> menu, ensure that you select </span><strong class="bold"><span class="kobospan" id="kobo.159.1">Allow unauthenticated invocations</span></strong><span class="kobospan" id="kobo.160.1"> as the authentication method. </span><span class="kobospan" id="kobo.160.2">This will enable the frontend application to make calls to the </span><span><span class="kobospan" id="kobo.161.1">backend layer.</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.162.1">Select </span><strong class="bold"><span class="kobospan" id="kobo.163.1">Next</span></strong><span class="kobospan" id="kobo.164.1"> to move on to function development. </span><span class="kobospan" id="kobo.164.2">In the </span><strong class="bold"><span class="kobospan" id="kobo.165.1">Runtime</span></strong><span class="kobospan" id="kobo.166.1"> drop-down menu, select </span><strong class="bold"><span class="kobospan" id="kobo.167.1">Python 3.12</span></strong><span class="kobospan" id="kobo.168.1">. </span><span class="kobospan" id="kobo.168.2">For the </span><strong class="bold"><span class="kobospan" id="kobo.169.1">entry point</span></strong><span class="kobospan" id="kobo.170.1"> value, select or </span><span><span class="kobospan" id="kobo.171.1">type </span></span><span><strong class="source-inline1"><span class="kobospan" id="kobo.172.1">get_message</span></strong></span><span><span class="kobospan" id="kobo.173.1">.</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.174.1">For the actual </span><em class="italic"><span class="kobospan" id="kobo.175.1">code block</span></em><span class="kobospan" id="kobo.176.1">, type </span><span><span class="kobospan" id="kobo.177.1">the following:</span></span><pre class="source-code"><span class="kobospan1" id="kobo.178.1">
import functions_framework
from openai import OpenAI
@functions_framework.http
def get_message(request):
    request_json = request.get_json(silent=True)
    email = request_json['email']
    client = OpenAI(api_key = '&lt;your-openai-api-key-here&gt;')
    ### Playground Code Here ###
    result = {
        'choice_1': response.choices[0].message.content,
        'choice_2': response.choices[1].message.content,
        'choice_3': response.choices[2].message.content,
    }
    return result</span></pre></li> <li class="calibre15"><span class="kobospan" id="kobo.179.1">Go to </span><strong class="bold"><span class="kobospan" id="kobo.180.1">Requirements.txt</span></strong><span class="kobospan" id="kobo.181.1"> in the left-hand side menu, type in a new line, and type </span><strong class="source-inline1"><span class="kobospan" id="kobo.182.1">openai</span></strong><span class="kobospan" id="kobo.183.1">. </span><span class="kobospan" id="kobo.183.2">This is to ensure that the OpenAI library will be downloaded as part of </span><span><span class="kobospan" id="kobo.184.1">this function.</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.185.1">Go</span><a id="_idIndexMarker267" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.186.1"> back to </span><strong class="bold"><span class="kobospan" id="kobo.187.1">Open AI Playground</span></strong><span class="kobospan" id="kobo.188.1">. </span><span class="kobospan" id="kobo.188.2">Remove the </span><strong class="bold"><span class="kobospan" id="kobo.189.1">Assistant</span></strong><span class="kobospan" id="kobo.190.1"> message that was produced as part of </span><em class="italic"><span class="kobospan" id="kobo.191.1">step 4</span></em><span class="kobospan" id="kobo.192.1">. </span><span class="kobospan" id="kobo.192.2">Ensure that the only messages that are populated are </span><strong class="bold"><span class="kobospan" id="kobo.193.1">System</span></strong> <span><span class="kobospan" id="kobo.194.1">and </span></span><span><strong class="bold"><span class="kobospan" id="kobo.195.1">User</span></strong></span><span><span class="kobospan" id="kobo.196.1">.</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.197.1">Select </span><strong class="bold"><span class="kobospan" id="kobo.198.1">View code</span></strong><span class="kobospan" id="kobo.199.1">, copy the response (</span><span><em class="italic"><span class="kobospan" id="kobo.200.1">Figure 6</span></em></span><em class="italic"><span class="kobospan" id="kobo.201.1">.3</span></em><span class="kobospan" id="kobo.202.1">), and then paste it into the Google Cloud console code block under where it says </span><strong class="source-inline1"><span class="kobospan" id="kobo.203.1">### Playground Code Here ###</span></strong><span class="kobospan" id="kobo.204.1"> (</span><span><em class="italic"><span class="kobospan" id="kobo.205.1">Figure 6</span></em></span><span><em class="italic"><span class="kobospan" id="kobo.206.1">.4</span></em></span><span><span class="kobospan" id="kobo.207.1">):</span></span></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer052">
<span class="kobospan" id="kobo.208.1"><img alt="Figure 6.3 – Code from Playground to be ingested into Google Cloud Functions" src="image/B21007_06_3.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.209.1">Figure 6.3 – Code from Playground to be ingested into Google Cloud Functions</span></p>
<div class="calibre2">
<div class="img---figure" id="_idContainer053">
<span class="kobospan" id="kobo.210.1"><img alt="Figure 6.4 – Pasting the code into the Google Cloud ﻿console" src="image/B21007_06_4.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.211.1">Figure 6.4 – Pasting the code into the Google Cloud console</span></p>
<p class="calibre3"><span class="kobospan" id="kobo.212.1">The key part to change about the code is that the </span><strong class="bold"><span class="kobospan" id="kobo.213.1">User</span></strong><span class="kobospan" id="kobo.214.1"> message is currently static (that is, it will always be </span><strong class="source-inline"><span class="kobospan" id="kobo.215.1">Hi Henry, since Dave is out…</span></strong><span class="kobospan" id="kobo.216.1">). </span><span class="kobospan" id="kobo.216.2">We want to replace this with the </span><strong class="source-inline"><span class="kobospan" id="kobo.217.1">email</span></strong><span class="kobospan" id="kobo.218.1"> variable that is part of </span><span><span class="kobospan" id="kobo.219.1">the function.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.220.1">Additionally, since</span><a id="_idIndexMarker268" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.221.1"> we want three email replies (and therefore three answers from the OpenAI API), we need to put in another argument in the OpenAI request that says </span><em class="italic"><span class="kobospan" id="kobo.222.1">n=3</span></em><span class="kobospan" id="kobo.223.1">. </span><span class="kobospan" id="kobo.223.2">This will ensure that we get </span><em class="italic"><span class="kobospan" id="kobo.224.1">n</span></em><span class="kobospan" id="kobo.225.1"> or </span><em class="italic"><span class="kobospan" id="kobo.226.1">three</span></em><span class="kobospan" id="kobo.227.1"> emails from the </span><span><span class="kobospan" id="kobo.228.1">actual API.</span></span></p>
<ol class="calibre14">
<li value="16" class="calibre15"><span class="kobospan" id="kobo.229.1">After making these changes, the code block in </span><strong class="bold"><span class="kobospan" id="kobo.230.1">Google Cloud Functions</span></strong><span class="kobospan" id="kobo.231.1"> should look </span><span><span class="kobospan" id="kobo.232.1">like this:</span></span><pre class="source-code"><span class="kobospan1" id="kobo.233.1">
import functions_framework
from openai import OpenAI
@functions_framework.http
def get_message(request):
    request_json = request.get_json(silent=True)
    email = request_json['email']
    client = OpenAI(api_key = '&lt;your-openai-api-key-here&gt;')
    response = client.chat.completions.create(
      model="gpt-4",
      messages=[
        {
          "role": "system",
          "content": "You are a helpful assistant that creates replies to emails that politely says no to the task you have been asked to perform. </span><span class="kobospan1" id="kobo.233.2">Only return the reply to the email, nothing else."
</span><span class="kobospan1" id="kobo.233.3">        },
        {
          "role": "user",
          "content": email
        }
      ],
      temperature=1.41,
      max_tokens=1066,
      top_p=1,
      frequency_penalty=0,
      presence_penalty=0,
      n=3
    )
    result = {
        'choice_1': response.choices[0].message.content,
        'choice_2': response.choices[1].message.content,
        'choice_3': response.choices[2].message.content,
    }
    return result</span></pre></li> <li class="calibre15"><span class="kobospan" id="kobo.234.1">Select </span><strong class="bold"><span class="kobospan" id="kobo.235.1">Deploy</span></strong><span class="kobospan" id="kobo.236.1">. </span><span class="kobospan" id="kobo.236.2">You </span><a id="_idIndexMarker269" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.237.1">might need to wait 5 minutes for the deployment to fully complete. </span><span class="kobospan" id="kobo.237.2">When you see the </span><em class="italic"><span class="kobospan" id="kobo.238.1">green checkmark</span></em><span class="kobospan" id="kobo.239.1"> on the </span><strong class="bold"><span class="kobospan" id="kobo.240.1">Cloud Functions</span></strong><span class="kobospan" id="kobo.241.1"> screen, your function has been </span><span><span class="kobospan" id="kobo.242.1">successfully deployed:</span></span></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer054">
<span class="kobospan" id="kobo.243.1"><img alt="Figure 6.5 – Cloudless function deployment snapshot" src="image/B21007_06_5.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.244.1">Figure 6.5 – Cloudless function deployment snapshot</span></p>
<ol class="calibre14">
<li value="18" class="calibre15"><span class="kobospan" id="kobo.245.1">We will now </span><a id="_idIndexMarker270" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.246.1">use Postman to test the cloud function that we have just deployed. </span><span class="kobospan" id="kobo.246.2">To do so, open Postman, select </span><strong class="bold"><span class="kobospan" id="kobo.247.1">New</span></strong><span class="kobospan" id="kobo.248.1"> at the top left, and then </span><span><span class="kobospan" id="kobo.249.1">select </span></span><span><strong class="bold"><span class="kobospan" id="kobo.250.1">HTTP</span></strong></span><span><span class="kobospan" id="kobo.251.1">.</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.252.1">On the Postman request, select </span><strong class="bold"><span class="kobospan" id="kobo.253.1">Headers</span></strong><span class="kobospan" id="kobo.254.1"> and type in a new header, with </span><strong class="bold"><span class="kobospan" id="kobo.255.1">Key</span></strong><span class="kobospan" id="kobo.256.1"> equal to </span><strong class="source-inline1"><span class="kobospan" id="kobo.257.1">Content-Type</span></strong><span class="kobospan" id="kobo.258.1"> and </span><strong class="bold"><span class="kobospan" id="kobo.259.1">Value</span></strong><span class="kobospan" id="kobo.260.1"> equal </span><span><span class="kobospan" id="kobo.261.1">to </span></span><span><strong class="source-inline1"><span class="kobospan" id="kobo.262.1">application/json</span></strong></span><span><span class="kobospan" id="kobo.263.1">:</span></span></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer055">
<span class="kobospan" id="kobo.264.1"><img alt="Figure 6.6 – Cloud Functions test configuration" src="image/B21007_06_6.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.265.1">Figure 6.6 – Cloud Functions test configuration</span></p>
<ol class="calibre14">
<li value="20" class="calibre15"><span class="kobospan" id="kobo.266.1">Change the request from </span><strong class="bold"><span class="kobospan" id="kobo.267.1">Get</span></strong><span class="kobospan" id="kobo.268.1"> to </span><strong class="bold"><span class="kobospan" id="kobo.269.1">Post</span></strong><span class="kobospan" id="kobo.270.1"> from the left-hand side drop-down menu. </span><span class="kobospan" id="kobo.270.2">Copy </span><a id="_idIndexMarker271" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.271.1">the endpoint URL from the </span><strong class="bold"><span class="kobospan" id="kobo.272.1">Cloud Functions</span></strong><span class="kobospan" id="kobo.273.1"> page and paste it </span><span><span class="kobospan" id="kobo.274.1">into Postman.</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.275.1">Select </span><strong class="bold"><span class="kobospan" id="kobo.276.1">Body</span></strong><span class="kobospan" id="kobo.277.1">, then select </span><strong class="bold"><span class="kobospan" id="kobo.278.1">Raw</span></strong><span class="kobospan" id="kobo.279.1">, and copy and paste the following </span><span><span class="kobospan" id="kobo.280.1">JSON request:</span></span><pre class="source-code"><span class="kobospan1" id="kobo.281.1">
{
"email": "Hi Henry,\n\nSince Dave is out, could you please pick up the Henderson proposal and have it on my desk by tomorrow morning?\n\nBest,\nRick"
}</span></pre></li> <li class="calibre15"><span class="kobospan" id="kobo.282.1">Select </span><strong class="bold"><span class="kobospan" id="kobo.283.1">Send</span></strong><span class="kobospan" id="kobo.284.1"> to make the call to your cloud function. </span><span class="kobospan" id="kobo.284.2">If all goes well, you should see a response similar to what’s shown in </span><span><em class="italic"><span class="kobospan" id="kobo.285.1">Figure 6</span></em></span><span><em class="italic"><span class="kobospan" id="kobo.286.1">.7</span></em></span><span><span class="kobospan" id="kobo.287.1">:</span></span></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer056">
<span class="kobospan" id="kobo.288.1"><img alt="Figure 6.7 – ﻿A successful cloud function test" src="image/B21007_06_7.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.289.1">Figure 6.7 – A successful cloud function test</span></p>
<h3 class="calibre8"><span class="kobospan" id="kobo.290.1">Bubble</span></h3>
<ol class="calibre14">
<li value="23" class="calibre15"><span class="kobospan" id="kobo.291.1">Navigate</span><a id="_idIndexMarker272" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.292.1"> to </span><a href="http://bubble.io" class="pcalibre1 calibre6 pcalibre"><span class="kobospan" id="kobo.293.1">http://bubble.io</span></a><span class="kobospan" id="kobo.294.1"> and log in. </span><span class="kobospan" id="kobo.294.2">Select </span><strong class="bold"><span class="kobospan" id="kobo.295.1">Create an app</span></strong><span class="kobospan" id="kobo.296.1"> and give your app a relevant name. </span><span class="kobospan" id="kobo.296.2">Select </span><strong class="bold"><span class="kobospan" id="kobo.297.1">Get started</span></strong><span class="kobospan" id="kobo.298.1"> and then select </span><strong class="bold"><span class="kobospan" id="kobo.299.1">Start with basic features</span></strong><span class="kobospan" id="kobo.300.1">. </span><span class="kobospan" id="kobo.300.2">You can also click on the </span><strong class="bold"><span class="kobospan" id="kobo.301.1">Skip application assistant</span></strong><span class="kobospan" id="kobo.302.1"> prompt if you </span><span><span class="kobospan" id="kobo.303.1">encounter it.</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.304.1">On the </span><strong class="bold"><span class="kobospan" id="kobo.305.1">Canvas</span></strong><span class="kobospan" id="kobo.306.1"> page, we are going to add a few elements that are required for our application. </span><span class="kobospan" id="kobo.306.2">Select </span><strong class="bold"><span class="kobospan" id="kobo.307.1">Multiline Input</span></strong><span class="kobospan" id="kobo.308.1"> from the left-hand side menu and then draw a rectangle at the top of the page. </span><span class="kobospan" id="kobo.308.2">Double-click the element from the property menu and replace </span><strong class="bold"><span class="kobospan" id="kobo.309.1">Placeholder</span></strong><span class="kobospan" id="kobo.310.1"> with </span><strong class="source-inline1"><span class="kobospan" id="kobo.311.1">Type </span></strong><span><strong class="source-inline1"><span class="kobospan" id="kobo.312.1">email here</span></strong></span><span><span class="kobospan" id="kobo.313.1">:</span></span></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer057">
<span class="kobospan" id="kobo.314.1"><img alt="Figure 6.8 – Bubble.io UI configuration" src="image/B21007_06_8.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.315.1">Figure 6.8 – Bubble.io UI configuration</span></p>
<ol class="calibre14">
<li value="25" class="calibre15"><span class="kobospan" id="kobo.316.1">Create a </span><strong class="bold"><span class="kobospan" id="kobo.317.1">Button</span></strong><span class="kobospan" id="kobo.318.1"> element by selecting </span><strong class="bold"><span class="kobospan" id="kobo.319.1">Button</span></strong><span class="kobospan" id="kobo.320.1"> and then drawing a box to the right of the first element </span><span><span class="kobospan" id="kobo.321.1">you created.</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.322.1">The</span><a id="_idIndexMarker273" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.323.1"> final set of elements to create is three </span><strong class="bold"><span class="kobospan" id="kobo.324.1">Text</span></strong><span class="kobospan" id="kobo.325.1"> elements. </span><span class="kobospan" id="kobo.325.2">Select </span><strong class="bold"><span class="kobospan" id="kobo.326.1">Text</span></strong><span class="kobospan" id="kobo.327.1"> from the left-hand side menu and draw a box to the bottom of </span><strong class="bold"><span class="kobospan" id="kobo.328.1">Multiline Input</span></strong><span class="kobospan" id="kobo.329.1">, about 1/3 the width of the page. </span><span class="kobospan" id="kobo.329.2">Repeat this for the other two text boxes and put them adjacent to the other </span><strong class="bold"><span class="kobospan" id="kobo.330.1">Text</span></strong><span class="kobospan" id="kobo.331.1"> elements. </span><span class="kobospan" id="kobo.331.2">Name these elements </span><strong class="source-inline1"><span class="kobospan" id="kobo.332.1">Text A</span></strong><span class="kobospan" id="kobo.333.1">, </span><strong class="source-inline1"><span class="kobospan" id="kobo.334.1">Text B</span></strong><span class="kobospan" id="kobo.335.1">, and </span><strong class="source-inline1"><span class="kobospan" id="kobo.336.1">Text C</span></strong><span class="kobospan" id="kobo.337.1"> by double-clicking each element and replacing the </span><strong class="bold"><span class="kobospan" id="kobo.338.1">Placeholder</span></strong><span class="kobospan" id="kobo.339.1"> element with </span><strong class="source-inline1"><span class="kobospan" id="kobo.340.1">Text A</span></strong><span class="kobospan" id="kobo.341.1">, </span><strong class="source-inline1"><span class="kobospan" id="kobo.342.1">Text B</span></strong><span class="kobospan" id="kobo.343.1">, and </span><strong class="source-inline1"><span class="kobospan" id="kobo.344.1">Text </span></strong><span><strong class="source-inline1"><span class="kobospan" id="kobo.345.1">C</span></strong></span><span><span class="kobospan" id="kobo.346.1">, respectively:</span></span></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer058">
<span class="kobospan" id="kobo.347.1"><img alt="Figure 6.9 – Bubble.io UI configuration" src="image/B21007_06_9.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.348.1">Figure 6.9 – Bubble.io UI configuration</span></p>
<ol class="calibre14">
<li value="27" class="calibre15"><span class="kobospan" id="kobo.349.1">For each text box, double-click the </span><strong class="bold"><span class="kobospan" id="kobo.350.1">Text</span></strong><span class="kobospan" id="kobo.351.1"> element to show the property. </span><span class="kobospan" id="kobo.351.2">Then, click </span><strong class="bold"><span class="kobospan" id="kobo.352.1">Insert dynamic data</span></strong><span class="kobospan" id="kobo.353.1"> on the actual text field, select </span><strong class="source-inline1"><span class="kobospan" id="kobo.354.1">Text A</span></strong><span class="kobospan" id="kobo.355.1">, and then </span><strong class="bold"><span class="kobospan" id="kobo.356.1">Create a new custom state</span></strong><span class="kobospan" id="kobo.357.1">. </span><span class="kobospan" id="kobo.357.2">You will be prompted for a name and type. </span><span class="kobospan" id="kobo.357.3">For the name, type </span><strong class="source-inline1"><span class="kobospan" id="kobo.358.1">email_ reply</span></strong><span class="kobospan" id="kobo.359.1">. </span><span class="kobospan" id="kobo.359.2">For </span><strong class="bold"><span class="kobospan" id="kobo.360.1">Type</span></strong><span class="kobospan" id="kobo.361.1">, ensure </span><strong class="bold"><span class="kobospan" id="kobo.362.1">Text</span></strong><span class="kobospan" id="kobo.363.1"> is selected. </span><span class="kobospan" id="kobo.363.2">This will create a unique custom state for the text box, which is required to show the values in </span><span><span class="kobospan" id="kobo.364.1">the application.</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.365.1">The next thing we need to do is load the cloud function that we created into Bubble. </span><span class="kobospan" id="kobo.365.2">Select </span><strong class="bold"><span class="kobospan" id="kobo.366.1">Plugins</span></strong><span class="kobospan" id="kobo.367.1"> from the left-hand side menu, and then select </span><strong class="bold"><span class="kobospan" id="kobo.368.1">Add Plugins</span></strong><span class="kobospan" id="kobo.369.1">. </span><span class="kobospan" id="kobo.369.2">Select </span><strong class="bold"><span class="kobospan" id="kobo.370.1">API Connector</span></strong><span class="kobospan" id="kobo.371.1">, then select </span><strong class="bold"><span class="kobospan" id="kobo.372.1">Install</span></strong><span class="kobospan" id="kobo.373.1">, and </span><span><span class="kobospan" id="kobo.374.1">then </span></span><span><strong class="bold"><span class="kobospan" id="kobo.375.1">Done</span></strong></span><span><span class="kobospan" id="kobo.376.1">:</span></span></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer059">
<span class="kobospan" id="kobo.377.1"><img alt="Figure 6.10 – Bubble.io UI configuration" src="image/B21007_06_10.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.378.1">Figure 6.10 – Bubble.io UI configuration</span></p>
<ol class="calibre14">
<li value="29" class="calibre15"><span class="kobospan" id="kobo.379.1">Select </span><strong class="bold"><span class="kobospan" id="kobo.380.1">API Connector</span></strong><span class="kobospan" id="kobo.381.1"> from the list of plugins. </span><span class="kobospan" id="kobo.381.2">Then, select </span><strong class="bold"><span class="kobospan" id="kobo.382.1">Add Another API</span></strong><span class="kobospan" id="kobo.383.1">. </span><span class="kobospan" id="kobo.383.2">For </span><strong class="bold"><span class="kobospan" id="kobo.384.1">API name</span></strong><span class="kobospan" id="kobo.385.1">, type </span><strong class="source-inline1"><span class="kobospan" id="kobo.386.1">get_replies</span></strong><span class="kobospan" id="kobo.387.1">. </span><span class="kobospan" id="kobo.387.2">Scroll down until you get to the </span><strong class="bold"><span class="kobospan" id="kobo.388.1">Name</span></strong><span class="kobospan" id="kobo.389.1"> field</span><a id="_idIndexMarker274" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.390.1"> and click </span><strong class="bold"><span class="kobospan" id="kobo.391.1">Expand</span></strong><span class="kobospan" id="kobo.392.1">. </span><span class="kobospan" id="kobo.392.2">Change the name of this API to </span><strong class="source-inline1"><span class="kobospan" id="kobo.393.1">get_replies</span></strong><span class="kobospan" id="kobo.394.1">. </span><span class="kobospan" id="kobo.394.2">For the API, configure its settings </span><span><span class="kobospan" id="kobo.395.1">like so:</span></span><ul class="calibre17"><li class="calibre15"><span class="kobospan" id="kobo.396.1">From the </span><strong class="bold"><span class="kobospan" id="kobo.397.1">Use as</span></strong><span class="kobospan" id="kobo.398.1"> drop-down menu, </span><span><span class="kobospan" id="kobo.399.1">select </span></span><span><strong class="bold"><span class="kobospan" id="kobo.400.1">Action</span></strong></span><span><span class="kobospan" id="kobo.401.1">.</span></span></li><li class="calibre15"><span class="kobospan" id="kobo.402.1">Change the request from </span><strong class="bold"><span class="kobospan" id="kobo.403.1">GET</span></strong> <span><span class="kobospan" id="kobo.404.1">to </span></span><span><strong class="bold"><span class="kobospan" id="kobo.405.1">POST</span></strong></span><span><span class="kobospan" id="kobo.406.1">.</span></span></li><li class="calibre15"><span class="kobospan" id="kobo.407.1">Directly adjacent to the </span><strong class="bold"><span class="kobospan" id="kobo.408.1">POST</span></strong><span class="kobospan" id="kobo.409.1"> request is a place to enter your </span><strong class="bold"><span class="kobospan" id="kobo.410.1">Endpoint URL</span></strong><span class="kobospan" id="kobo.411.1">. </span><span class="kobospan" id="kobo.411.2">Enter the URL you copied from the Google </span><span><span class="kobospan" id="kobo.412.1">cloud function.</span></span></li><li class="calibre15"><span class="kobospan" id="kobo.413.1">Create a new header by clicking </span><strong class="bold"><span class="kobospan" id="kobo.414.1">New Header</span></strong><span class="kobospan" id="kobo.415.1">. </span><span class="kobospan" id="kobo.415.2">Select </span><strong class="bold"><span class="kobospan" id="kobo.416.1">Add Header.</span></strong><span class="kobospan" id="kobo.417.1"> For </span><strong class="bold"><span class="kobospan" id="kobo.418.1">key</span></strong><span class="kobospan" id="kobo.419.1"> type in </span><strong class="source-inline1"><span class="kobospan" id="kobo.420.1">Content-Type</span></strong><span class="kobospan" id="kobo.421.1">, for </span><strong class="bold"><span class="kobospan" id="kobo.422.1">value</span></strong><span class="kobospan" id="kobo.423.1"> type </span><span><span class="kobospan" id="kobo.424.1">in </span></span><span><strong class="source-inline1"><span class="kobospan" id="kobo.425.1">application/json</span></strong></span><span><span class="kobospan" id="kobo.426.1">.</span></span></li><li class="calibre15"><span class="kobospan" id="kobo.427.1">Click </span><strong class="bold"><span class="kobospan" id="kobo.428.1">Parameter</span></strong><span class="kobospan" id="kobo.429.1"> to add a new parameter. </span><span class="kobospan" id="kobo.429.2">For </span><strong class="bold"><span class="kobospan" id="kobo.430.1">key</span></strong><span class="kobospan" id="kobo.431.1">, type in </span><strong class="source-inline1"><span class="kobospan" id="kobo.432.1">email</span></strong><span class="kobospan" id="kobo.433.1">. </span><span class="kobospan" id="kobo.433.2">For </span><strong class="bold"><span class="kobospan" id="kobo.434.1">value</span></strong><span class="kobospan" id="kobo.435.1">, copy the same JSON text that was used in the Postman call in </span><em class="italic"><span class="kobospan" id="kobo.436.1">step 17</span></em><span class="kobospan" id="kobo.437.1">, which is also written as follows. </span><span class="kobospan" id="kobo.437.2">Do </span><em class="italic"><span class="kobospan" id="kobo.438.1">not</span></em><span class="kobospan" id="kobo.439.1"> include the quotes. </span><span class="kobospan" id="kobo.439.2">Ensure that the </span><strong class="bold"><span class="kobospan" id="kobo.440.1">private</span></strong><span class="kobospan" id="kobo.441.1"> box is </span><em class="italic"><span class="kobospan" id="kobo.442.1">unchecked</span></em><span class="kobospan" id="kobo.443.1">. </span><span class="kobospan" id="kobo.443.2">This is important because we need to make sure that we have this argument available </span><span><span class="kobospan" id="kobo.444.1">within Bubble:</span></span><pre class="source-code"><span class="kobospan1" id="kobo.445.1">
Hi Henry,\n\nSince Dave is out, could you please pick up the Henderson proposal and have it on my desk by tomorrow morning?\n\nBest,\nRick</span></pre></li></ul></li> <li class="calibre15"><span class="kobospan" id="kobo.446.1">Select </span><strong class="bold"><span class="kobospan" id="kobo.447.1">Initialize Call</span></strong><span class="kobospan" id="kobo.448.1"> to test the API call. </span><span class="kobospan" id="kobo.448.2">If you see the screen shown in </span><span><em class="italic"><span class="kobospan" id="kobo.449.1">Figure 6</span></em></span><em class="italic"><span class="kobospan" id="kobo.450.1">.11</span></em><span class="kobospan" id="kobo.451.1">, then </span><a id="_idIndexMarker275" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.452.1">the call has been successful. </span><span class="kobospan" id="kobo.452.2">Ensure that for each </span><strong class="bold"><span class="kobospan" id="kobo.453.1">choice</span></strong><span class="kobospan" id="kobo.454.1"> field, the </span><strong class="bold"><span class="kobospan" id="kobo.455.1">text</span></strong><span class="kobospan" id="kobo.456.1"> type has been selected, and </span><span><span class="kobospan" id="kobo.457.1">click </span></span><span><strong class="bold"><span class="kobospan" id="kobo.458.1">Save</span></strong></span><span><span class="kobospan" id="kobo.459.1">.</span></span></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer060">
<span class="kobospan" id="kobo.460.1"><img alt="Figure 6.11 ﻿– A successful UI ﻿configuration" src="image/B21007_06_11.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.461.1">Figure 6.11 – A successful UI configuration</span></p>
<ol class="calibre14">
<li value="31" class="calibre15"><span class="kobospan" id="kobo.462.1">Select </span><strong class="bold"><span class="kobospan" id="kobo.463.1">Design</span></strong><span class="kobospan" id="kobo.464.1"> from the left-hand side menu. </span><span class="kobospan" id="kobo.464.2">Double-click the </span><strong class="bold"><span class="kobospan" id="kobo.465.1">Button</span></strong><span class="kobospan" id="kobo.466.1"> element that you had created. </span><span class="kobospan" id="kobo.466.2">In the property menu that appears, select </span><span><strong class="bold"><span class="kobospan" id="kobo.467.1">Add Workflow</span></strong></span><span><span class="kobospan" id="kobo.468.1">.</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.469.1">Select </span><strong class="bold"><span class="kobospan" id="kobo.470.1">Click here to add an action</span></strong><span class="kobospan" id="kobo.471.1">. </span><span class="kobospan" id="kobo.471.2">Go to </span><strong class="bold"><span class="kobospan" id="kobo.472.1">Plugins</span></strong><span class="kobospan" id="kobo.473.1"> and find the API you had just created (</span><strong class="source-inline1"><span class="kobospan" id="kobo.474.1">get_replies – get_replies</span></strong><span class="kobospan" id="kobo.475.1">) and select it. </span><span class="kobospan" id="kobo.475.2">On the property menu that appears, delete the content of </span><strong class="bold"><span class="kobospan" id="kobo.476.1">(param.) email</span></strong><span class="kobospan" id="kobo.477.1"> and then select </span><strong class="bold"><span class="kobospan" id="kobo.478.1">Insert dynamic data</span></strong><span class="kobospan" id="kobo.479.1">. </span><span class="kobospan" id="kobo.479.2">Scroll down and select </span><strong class="bold"><span class="kobospan" id="kobo.480.1">Multiline Input Type email here</span></strong><span class="kobospan" id="kobo.481.1">, and then </span><span><span class="kobospan" id="kobo.482.1">select </span></span><span><strong class="bold"><span class="kobospan" id="kobo.483.1">value</span></strong></span><span><span class="kobospan" id="kobo.484.1">.</span></span></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer061">
<span class="kobospan" id="kobo.485.1"><img alt="Figure 6.12 ﻿– Bubble workflow" src="image/B21007_06_12.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.486.1">Figure 6.12 – Bubble workflow</span></p>
<ol class="calibre14">
<li value="33" class="calibre15"><span class="kobospan" id="kobo.487.1">Next, select </span><strong class="bold"><span class="kobospan" id="kobo.488.1">Click here to add an action</span></strong><span class="kobospan" id="kobo.489.1"> again, scroll down to </span><strong class="bold"><span class="kobospan" id="kobo.490.1">Element Actions</span></strong><span class="kobospan" id="kobo.491.1">, and then select </span><strong class="bold"><span class="kobospan" id="kobo.492.1">Set State</span></strong><span class="kobospan" id="kobo.493.1">. </span><span class="kobospan" id="kobo.493.2">For the </span><strong class="bold"><span class="kobospan" id="kobo.494.1">Element</span></strong><span class="kobospan" id="kobo.495.1"> drop-down menu, select </span><strong class="source-inline1"><span class="kobospan" id="kobo.496.1">Text A</span></strong><span class="kobospan" id="kobo.497.1">. </span><span class="kobospan" id="kobo.497.2">For the </span><strong class="bold"><span class="kobospan" id="kobo.498.1">Custom state</span></strong><span class="kobospan" id="kobo.499.1"> drop-down menu, select </span><strong class="source-inline1"><span class="kobospan" id="kobo.500.1">email_reply</span></strong><span class="kobospan" id="kobo.501.1">. </span><span class="kobospan" id="kobo.501.2">For </span><strong class="bold"><span class="kobospan" id="kobo.502.1">Value</span></strong><span class="kobospan" id="kobo.503.1">, select </span><strong class="bold"><span class="kobospan" id="kobo.504.1">Results of step 1</span></strong><span class="kobospan" id="kobo.505.1"> and then select </span><strong class="bold"><span class="kobospan" id="kobo.506.1">Choice 1</span></strong><span class="kobospan" id="kobo.507.1">. </span><span class="kobospan" id="kobo.507.2">This will make the value of </span><strong class="source-inline1"><span class="kobospan" id="kobo.508.1">Text A</span></strong><span class="kobospan" id="kobo.509.1"> equal to the first choice is the result of the API call to the cloud function that you </span><span><span class="kobospan" id="kobo.510.1">had created.</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.511.1">Repeat </span><em class="italic"><span class="kobospan" id="kobo.512.1">step 33</span></em><span class="kobospan" id="kobo.513.1"> two more times for the </span><strong class="source-inline1"><span class="kobospan" id="kobo.514.1">Text B</span></strong><span class="kobospan" id="kobo.515.1"> and </span><strong class="source-inline1"><span class="kobospan" id="kobo.516.1">Text C</span></strong><span class="kobospan" id="kobo.517.1"> elements, choosing </span><strong class="bold"><span class="kobospan" id="kobo.518.1">Choice 2</span></strong><span class="kobospan" id="kobo.519.1"> and </span><strong class="bold"><span class="kobospan" id="kobo.520.1">Choice </span></strong><span><strong class="bold"><span class="kobospan" id="kobo.521.1">3</span></strong></span><span><span class="kobospan" id="kobo.522.1">, respectively.</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.523.1">We have</span><a id="_idIndexMarker276" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.524.1"> completed everything we need for our Bubble intelligent application. </span><span class="kobospan" id="kobo.524.2">To test whether the application works, select </span><strong class="bold"><span class="kobospan" id="kobo.525.1">Preview</span></strong><span class="kobospan" id="kobo.526.1"> on the right; a new page will appear containing your application. </span><span class="kobospan" id="kobo.526.2">In the </span><strong class="bold"><span class="kobospan" id="kobo.527.1">Email</span></strong><span class="kobospan" id="kobo.528.1"> text box, try using the same email we posted on the OpenAI Playground in </span><span><em class="italic"><span class="kobospan" id="kobo.529.1">step 3</span></em></span><span><span class="kobospan" id="kobo.530.1">:</span></span><p class="calibre3"><span><strong class="source-inline"><span class="kobospan" id="kobo.531.1">Hi Henry,</span></strong></span></p><p class="calibre3"><strong class="source-inline"><span class="kobospan" id="kobo.532.1">Since Dave is out, could you please pick up the Henderson proposal and have it on my desk by </span></strong><span><strong class="source-inline"><span class="kobospan" id="kobo.533.1">tomorrow morning?</span></strong></span></p><p class="calibre3"><span><strong class="source-inline"><span class="kobospan" id="kobo.534.1">Best,</span></strong></span></p><p class="calibre3"><span><strong class="source-inline"><span class="kobospan" id="kobo.535.1">Rick</span></strong></span></p></li>
<li class="calibre15"><span class="kobospan" id="kobo.536.1">Select </span><strong class="bold"><span class="kobospan" id="kobo.537.1">Generate Replies</span></strong><span class="kobospan" id="kobo.538.1">. </span><span class="kobospan" id="kobo.538.2">If all goes well, you should get a screen like the one shown in </span><span><em class="italic"><span class="kobospan" id="kobo.539.1">Figure 6</span></em></span><em class="italic"><span class="kobospan" id="kobo.540.1">.13</span></em><span class="kobospan" id="kobo.541.1">, which shows the user three possible ways to reply to their </span><a id="_idIndexMarker277" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.542.1">manager and politely say no to an </span><span><span class="kobospan" id="kobo.543.1">upcoming task:</span></span></li>
</ol>
<p class="calibre3"> </p>
<div class="calibre2">
<div class="img---figure" id="_idContainer062">
<span class="kobospan" id="kobo.544.1"><img alt="Figure 6.13 – A successful application configuration" src="image/B21007_06_13.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.545.1">Figure 6.13 – A successful application configuration</span></p>
<h2 id="_idParaDest-105" class="calibre7"><a id="_idTextAnchor112" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.546.1">How it works…</span></h2>
<p class="calibre3"><span class="kobospan" id="kobo.547.1">In this recipe, we </span><a id="_idIndexMarker278" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.548.1">created a simple wrapper web application that produces sample responses to emails. </span><span class="kobospan" id="kobo.548.2">By using the OpenAI API, our web application leveraged the power of LLMs to solve a particular problem. </span><span class="kobospan" id="kobo.548.3">In this case, it was finding ways to politely say no to common tasks </span><span><span class="kobospan" id="kobo.549.1">on email.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.550.1">The steps that we followed in this recipe are like what we have </span><span><span class="kobospan" id="kobo.551.1">covered previously:</span></span></p>
<ol class="calibre14">
<li class="calibre15"><span class="kobospan" id="kobo.552.1">First, we tested our prompts in the </span><em class="italic"><span class="kobospan" id="kobo.553.1">Playground</span></em><span class="kobospan" id="kobo.554.1">, an environment where users can test different configurations and observe the impact on </span><span><span class="kobospan" id="kobo.555.1">generated responses.</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.556.1">Then, we created the Google cloud function, which is the backend layer. </span><span class="kobospan" id="kobo.556.2">In this layer, we added the code from the Playground that calls the OpenAI </span><span><span class="kobospan" id="kobo.557.1">Chat API.</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.558.1">Then, we tested our backend layer using Postman to ensure that the calls were working properly, and then we received a suitable response from our </span><span><span class="kobospan" id="kobo.559.1">backend API.</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.560.1">Next, we created a simple frontend </span><span><span class="kobospan" id="kobo.561.1">using Bubble.</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.562.1">Finally, we connected the frontend and backend layers using Bubble workflows and the API </span><span><span class="kobospan" id="kobo.563.1">connector plugin.</span></span></li>
</ol>
<p class="calibre3"><span class="kobospan" id="kobo.564.1">By performing</span><a id="_idIndexMarker279" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.565.1"> these steps, we can create any intelligent application in less than an hour. </span><span class="kobospan" id="kobo.565.2">It is worth zooming in on </span><em class="italic"><span class="kobospan" id="kobo.566.1">step 1</span></em><span class="kobospan" id="kobo.567.1"> as it is a critical step in creating any </span><span><span class="kobospan" id="kobo.568.1">new application.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.569.1">We started this recipe with the OpenAI Playground, where we tested the </span><strong class="bold"><span class="kobospan" id="kobo.570.1">System</span></strong><span class="kobospan" id="kobo.571.1"> prompt in an environment where we could quickly iterate to ensure that we received the right response. </span><span class="kobospan" id="kobo.571.2">The Playground provided a user-friendly interface, allowing us to experiment with different prompts and parameters. </span><span class="kobospan" id="kobo.571.3">This experimentation was crucial for understanding how the AI model responds to various inputs, which, in turn, helped us fine-tune the prompts for </span><span><span class="kobospan" id="kobo.572.1">our application.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.573.1">In the Playground and in the Python script where we made the OpenAI API request, we purposely set the </span><span><span class="kobospan" id="kobo.574.1">following settings:</span></span></p>
<ul class="calibre16">
<li class="calibre15"><strong class="bold"><span class="kobospan" id="kobo.575.1">Model</span></strong><span class="kobospan" id="kobo.576.1"> to </span><strong class="bold"><span class="kobospan" id="kobo.577.1">gpt-4</span></strong><span class="kobospan" id="kobo.578.1">: For an email response application, GPT-4’s advanced understanding of context and nuance is crucial. </span><span class="kobospan" id="kobo.578.2">Emails can cover a wide range of topics and styles, from formal business communications to casual conversations. </span><span class="kobospan" id="kobo.578.3">GPT-4’s robust language model can adapt to these varying styles and provide responses that are more accurate and </span><span><span class="kobospan" id="kobo.579.1">contextually relevant.</span></span></li>
<li class="calibre15"><strong class="bold"><span class="kobospan" id="kobo.580.1">Temperature</span></strong><span class="kobospan" id="kobo.581.1"> to </span><strong class="source-inline1"><span class="kobospan" id="kobo.582.1">1.4</span></strong><span class="kobospan" id="kobo.583.1">: Since the purpose of this app is to create several varied responses, the temperature has been set higher than the standard value (1.0) to ensure there’s some randomness in the responses. </span><span class="kobospan" id="kobo.583.2">A higher temperature helps in generating responses that are not too generic and can adapt to the unique content and tone of </span><span><span class="kobospan" id="kobo.584.1">each email.</span></span></li>
<li class="calibre15"><strong class="bold"><span class="kobospan" id="kobo.585.1">Maximum length</span></strong><span class="kobospan" id="kobo.586.1"> to </span><strong class="source-inline1"><span class="kobospan" id="kobo.587.1">1000</span></strong><span class="kobospan" id="kobo.588.1">: The maximum token length setting determines how long the generated responses can be. </span><span class="kobospan" id="kobo.588.2">Setting this to 1,000 allows for sufficiently </span><span><span class="kobospan" id="kobo.589.1">lengthy responses.</span></span></li>
<li class="calibre15"><strong class="bold"><span class="kobospan" id="kobo.590.1">N</span></strong><span class="kobospan" id="kobo.591.1"> to </span><strong class="source-inline1"><span class="kobospan" id="kobo.592.1">3</span></strong><span class="kobospan" id="kobo.593.1">: The </span><strong class="bold"><span class="kobospan" id="kobo.594.1">N</span></strong><span class="kobospan" id="kobo.595.1"> parameter dictates the number of different responses the model will generate for each prompt. </span><span class="kobospan" id="kobo.595.2">Setting </span><strong class="bold"><span class="kobospan" id="kobo.596.1">N</span></strong><span class="kobospan" id="kobo.597.1"> to </span><strong class="source-inline1"><span class="kobospan" id="kobo.598.1">3</span></strong><span class="kobospan" id="kobo.599.1"> means the app will generate three different responses for each email, which is what we want for the </span><span><span class="kobospan" id="kobo.600.1">web application.</span></span></li>
</ul>
<p class="calibre3"><span class="kobospan" id="kobo.601.1">The other</span><a id="_idIndexMarker280" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.602.1"> benefit of the Playground is that it produces Python-ready code for you; this is what we did in </span><em class="italic"><span class="kobospan" id="kobo.603.1">step 15</span></em><span class="kobospan" id="kobo.604.1"> of this recipe. </span><span class="kobospan" id="kobo.604.2">After configuring all the settings and after we were happy with the responses from the Playground, all we needed to do was click </span><strong class="bold"><span class="kobospan" id="kobo.605.1">View Code</span></strong><span class="kobospan" id="kobo.606.1"> to then produce the exact code that </span><span><span class="kobospan" id="kobo.607.1">we needed.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.608.1">In this recipe, we created a simple application. </span><span class="kobospan" id="kobo.608.2">However, because it was a wrapper application, it technically could have been done within ChatGPT itself, without the need to set up a complex backend layer or frontend layer. </span><span class="kobospan" id="kobo.608.3">For example, I can go to ChatGPT (</span><a href="https://chat.openai.com/" class="pcalibre1 calibre6 pcalibre"><span class="kobospan" id="kobo.609.1">https://chat.openai.com/</span></a><span class="kobospan" id="kobo.610.1">) and type in the following prompt, at which point it will give me </span><span><span class="kobospan" id="kobo.611.1">similar answers:</span></span></p>
<div class="calibre2">
<div class="img---figure" id="_idContainer063">
<span class="kobospan" id="kobo.612.1"><img alt="Figure 6.14 – Using ChatGPT to create email responses" src="image/B21007_06_14.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.613.1">Figure 6.14 – Using ChatGPT to create email responses</span></p>
<p class="calibre3"><span class="kobospan" id="kobo.614.1">So, you may</span><a id="_idIndexMarker281" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.615.1"> be wondering, what’s the point of creating the application through the OpenAI API? </span><span class="kobospan" id="kobo.615.2">Well, there are some examples of applications that are not wrappers and can only be created through the API. </span><span class="kobospan" id="kobo.615.3">This is what we will cover in the </span><span><span class="kobospan" id="kobo.616.1">next recipe.</span></span></p>
<h1 id="_idParaDest-106" class="calibre5"><a id="_idTextAnchor113" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.617.1">Creating a multi-modal application that generates travel itineraries</span></h1>
<p class="calibre3"><span class="kobospan" id="kobo.618.1">In the previous recipe, we</span><a id="_idIndexMarker282" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.619.1"> successfully created an intelligent application that produced replies to emails. </span><span class="kobospan" id="kobo.619.2">We also discussed how this is technically a wrapper application, something that could be easily done through ChatGPT or the </span><span><span class="kobospan" id="kobo.620.1">Playground itself.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.621.1">In this recipe, we will take the next step and create a multi-modal application. </span><span class="kobospan" id="kobo.621.2">A </span><strong class="bold"><span class="kobospan" id="kobo.622.1">multi-modal application</span></strong><span class="kobospan" id="kobo.623.1"> is </span><a id="_idIndexMarker283" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.624.1">an advanced type of software that integrates various forms of media and interaction methods into a single </span><em class="italic"><span class="kobospan" id="kobo.625.1">cohesive</span></em><span class="kobospan" id="kobo.626.1"> experience. </span><span class="kobospan" id="kobo.626.2">This integration allows for a richer and more engaging user interface, one that can cater to a wider range of user preferences </span><span><span class="kobospan" id="kobo.627.1">and needs.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.628.1">The core idea behind a multi-modal application is to combine text, voice, images, and possibly even video, to create a more dynamic and interactive environment. </span><span class="kobospan" id="kobo.628.2">For instance, consider an application that not only responds to text queries but also understands voice commands, can analyze images, and perhaps even respond with video content. </span><span class="kobospan" id="kobo.628.3">Such an application would be tremendously useful in fields such as education, where different learning styles could be accommodated, or in customer service, where it could provide a more personalized and </span><span><span class="kobospan" id="kobo.629.1">efficient experience.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.630.1">In our case, we will </span><a id="_idIndexMarker284" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.631.1">combine the </span><strong class="bold"><span class="kobospan" id="kobo.632.1">Chat API</span></strong><span class="kobospan" id="kobo.633.1"> and </span><strong class="bold"><span class="kobospan" id="kobo.634.1">Images API</span></strong><span class="kobospan" id="kobo.635.1"> to create travel itineraries. </span><span class="kobospan" id="kobo.635.2">A </span><a id="_idIndexMarker285" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.636.1">user can go to the application, type in the city to which they will be traveling, and receive a full-day itinerary with images of the items mentioned specifically in the </span><span><span class="kobospan" id="kobo.637.1">created itinerary.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.638.1">This is an example of an application that could </span><em class="italic"><span class="kobospan" id="kobo.639.1">not</span></em><span class="kobospan" id="kobo.640.1"> easily be created through ChatGPT or the Playground, and as such provides </span><span><span class="kobospan" id="kobo.641.1">real value.</span></span></p>
<h2 id="_idParaDest-107" class="calibre7"><a id="_idTextAnchor114" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.642.1">How to do it…</span></h2>
<ol class="calibre14">
<li class="calibre15"><span class="kobospan" id="kobo.643.1">In a new tab, navigate to </span><a href="https://cloud.google.com" class="pcalibre1 calibre6 pcalibre"><span class="kobospan" id="kobo.644.1">https://cloud.google.com</span></a><span class="kobospan" id="kobo.645.1"> and log in with your </span><span><span class="kobospan" id="kobo.646.1">Google account.</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.647.1">Select </span><strong class="bold"><span class="kobospan" id="kobo.648.1">Console</span></strong><span class="kobospan" id="kobo.649.1"> at the </span><span><span class="kobospan" id="kobo.650.1">top right.</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.651.1">Create a new Google cloud function. </span><span class="kobospan" id="kobo.651.2">In the search bar, type </span><strong class="source-inline1"><span class="kobospan" id="kobo.652.1">function</span></strong><span class="kobospan" id="kobo.653.1">, select </span><strong class="bold"><span class="kobospan" id="kobo.654.1">Cloud Functions</span></strong><span class="kobospan" id="kobo.655.1">, and then select </span><span><strong class="bold"><span class="kobospan" id="kobo.656.1">Create Function</span></strong></span><span><span class="kobospan" id="kobo.657.1">.</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.658.1">Give the function a descriptive name. </span><span class="kobospan" id="kobo.658.2">Since this function will return an itinerary and images for us, we are going to aptly name </span><span><span class="kobospan" id="kobo.659.1">it </span></span><span><strong class="source-inline1"><span class="kobospan" id="kobo.660.1">get_itinerary_and_images</span></strong></span><span><span class="kobospan" id="kobo.661.1">.</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.662.1">In the </span><strong class="bold"><span class="kobospan" id="kobo.663.1">Authentication</span></strong><span class="kobospan" id="kobo.664.1"> menu, ensure that you select </span><strong class="bold"><span class="kobospan" id="kobo.665.1">Allow unauthenticated invocations</span></strong><span class="kobospan" id="kobo.666.1"> as the authentication method. </span><span class="kobospan" id="kobo.666.2">This will enable the frontend application to make calls to the </span><span><span class="kobospan" id="kobo.667.1">backend layer.</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.668.1">Select </span><a id="_idIndexMarker286" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.669.1">the </span><strong class="bold"><span class="kobospan" id="kobo.670.1">Runtime, build, connections and security settings</span></strong><span class="kobospan" id="kobo.671.1"> drop-down menu to expand the options. </span><span class="kobospan" id="kobo.671.2">Change </span><strong class="bold"><span class="kobospan" id="kobo.672.1">Timeout</span></strong><span class="kobospan" id="kobo.673.1"> from </span><strong class="bold"><span class="kobospan" id="kobo.674.1">60 seconds</span></strong><span class="kobospan" id="kobo.675.1"> to </span><strong class="bold"><span class="kobospan" id="kobo.676.1">300 seconds</span></strong><span class="kobospan" id="kobo.677.1">. </span><span class="kobospan" id="kobo.677.2">This will ensure that the timeout for the Google cloud function is not 1 minute but 5 minutes instead. </span><span class="kobospan" id="kobo.677.3">This is important in multi-modal applications as several API requests will </span><span><span class="kobospan" id="kobo.678.1">be made:</span></span></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer064">
<span class="kobospan" id="kobo.679.1"><img alt="Figure 6.15 – Google Cloud Functions configuration settings" src="image/B21007_06_15.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.680.1">Figure 6.15 – Google Cloud Functions configuration settings</span></p>
<ol class="calibre14">
<li value="7" class="calibre15"><span class="kobospan" id="kobo.681.1">Select </span><strong class="bold"><span class="kobospan" id="kobo.682.1">Next</span></strong><span class="kobospan" id="kobo.683.1"> to move on to function development. </span><span class="kobospan" id="kobo.683.2">In the </span><strong class="bold"><span class="kobospan" id="kobo.684.1">Runtime</span></strong><span class="kobospan" id="kobo.685.1"> drop-down menu, select </span><strong class="bold"><span class="kobospan" id="kobo.686.1">Python 3.12</span></strong><span class="kobospan" id="kobo.687.1">. </span><span class="kobospan" id="kobo.687.2">For </span><strong class="bold"><span class="kobospan" id="kobo.688.1">Entry point</span></strong><span class="kobospan" id="kobo.689.1">, select or type </span><span><span class="kobospan" id="kobo.690.1">in </span></span><span><strong class="source-inline1"><span class="kobospan" id="kobo.691.1">get_travel_details</span></strong></span><span><span class="kobospan" id="kobo.692.1">.</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.693.1">Go to </span><strong class="bold"><span class="kobospan" id="kobo.694.1">Requirements.txt</span></strong><span class="kobospan" id="kobo.695.1"> in the left-hand side menu, type in a new line, and type in </span><strong class="source-inline1"><span class="kobospan" id="kobo.696.1">openai</span></strong><span class="kobospan" id="kobo.697.1">. </span><span class="kobospan" id="kobo.697.2">This is to ensure that the OpenAI library will be downloaded as part of </span><span><span class="kobospan" id="kobo.698.1">this function.</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.699.1">For the</span><a id="_idIndexMarker287" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.700.1"> actual </span><em class="italic"><span class="kobospan" id="kobo.701.1">code block</span></em><span class="kobospan" id="kobo.702.1">, type in the following. </span><span class="kobospan" id="kobo.702.2">This function takes in a city as an input and returns the itinerary in a morning-afternoon-evening format and three relevant images, one each for morning, afternoon, and </span><span><span class="kobospan" id="kobo.703.1">evening, respectively:</span></span><pre class="source-code"><span class="kobospan1" id="kobo.704.1">
import functions_framework
from openai import OpenAI
@functions_framework.http
def get_travel_details(request):
    request_json = request.get_json(silent=True)
    city = request_json['city']
    client = OpenAI(api_key = '&lt;openai-api-key here&gt;')
    response = client.chat.completions.create(
      model="gpt-4",
      messages=[
    {
      "role": "system",
      "content": "You are a helpful assistant that creates detailed one day itineraries based on the city that the user chooses. </span><span class="kobospan1" id="kobo.704.2">Create only 3 activities (morning, afternoon, evening). </span><span class="kobospan1" id="kobo.704.3">Only mention the itinerary, nothing else."
</span><span class="kobospan1" id="kobo.704.4">    },
    {
      "role": "user",
      "content": "Rome, Italy"
    },
    {
      "role": "assistant",
      "content": "Morning: \n\nStart the day at the Colosseum, one of the most iconic sights of Rome. </span><span class="kobospan1" id="kobo.704.5">Take a guided tour to fully appreciate its history and significance. </span><span class="kobospan1" id="kobo.704.6">\n\nAfternoon: \n\nHead over to the Vatican City. </span><span class="kobospan1" id="kobo.704.7">Visit the Vatican Museums, home to a vast collection of art and historical artifacts. </span><span class="kobospan1" id="kobo.704.8">Don't miss the Sistine Chapel, famous for Michelangelo's ceiling.\n\nEvening: \n\nEnjoy a leisurely stroll to the Trevi Fountain. </span><span class="kobospan1" id="kobo.704.9">Make sure to throw a coin over your shoulder into the fountain for good luck. </span><span class="kobospan1" id="kobo.704.10">Then, end the day with a delicious Italian dinner at one of the local restaurants nearby."
</span><span class="kobospan1" id="kobo.704.11">    },
    {
      "role": "user",
      "content": "Lisbon, Portugal"
    },
    {
      "role": "assistant",
      "content": "Morning: \n\nBegin your day with a visit to the iconic Belém Tower, a UNESCO World Heritage site offering panoramic views of Lisbon. </span><span class="kobospan1" id="kobo.704.12">\n\nAfternoon: \n\nExplore the historical neighborhood of Alfama. </span><span class="kobospan1" id="kobo.704.13">Wander its narrow, winding streets, visit the Se Cathedral and enjoy a traditional Portuguese lunch at a local tavern.\n\nEvening: \n\nHead to Bairro Alto, the city's bohemian district, for dinner. </span><span class="kobospan1" id="kobo.704.14">Afterwards, enjoy a Fado show - a traditional Portuguese music genre - at one of the local bars."
</span><span class="kobospan1" id="kobo.704.15">    },
    {
      "role": "user",
      "content": city
    },
  ],
      temperature=0.64,
      max_tokens=1024,
      top_p=1,
      frequency_penalty=0,
      presence_penalty=0
    )
    itinerary = response.choices[0].message.content
    response = client.chat.completions.create(
      model="gpt-3.5-turbo-1106",
      messages=[
        {
          "role": "system",
          "content": "You are a helpful assistant that creates DALL-E prompts based itineraries. </span><span class="kobospan1" id="kobo.704.16">The prompts should be short. </span><span class="kobospan1" id="kobo.704.17">Create one prompt for Morning, one for Afternoon, and one for Evening. </span><span class="kobospan1" id="kobo.704.18">The DALL-E prompt should be separated by \"|\"."
</span><span class="kobospan1" id="kobo.704.19">        },
        {
          "role": "user",
          "content": itinerary
        }
      ],
      temperature=0.64,
      max_tokens=1024,
      top_p=1,
      frequency_penalty=0,
      presence_penalty=0
    )
    dalle_prompts = response.choices[0].message.content
    dalle_prompts_list = response.choices[0].message.content.split('|')
    image_urls = []
    for prompt in dalle_prompts_list:
      response = client.images.generate(
            model="dall-e-3",
            prompt=prompt,
            size="1024x1024",
            quality="standard",
            n=1
        )
      image_urls.append(response.data[0].url)
    result = {
        'itinerary': itinerary,
        'morning_image': image_urls[0],
        'afternoon_image': image_urls[1],
        'evening_image': image_urls[2]
    }
    return result</span></pre></li> <li class="calibre15"><span class="kobospan" id="kobo.705.1">Select </span><strong class="bold"><span class="kobospan" id="kobo.706.1">Deploy</span></strong><span class="kobospan" id="kobo.707.1">. </span><span class="kobospan" id="kobo.707.2">You might need to wait 5 minutes for the deployment to fully complete. </span><span class="kobospan" id="kobo.707.3">When you see the green checkmark on the </span><strong class="bold"><span class="kobospan" id="kobo.708.1">Cloud Functions</span></strong><span class="kobospan" id="kobo.709.1"> screen, your function has been </span><span><span class="kobospan" id="kobo.710.1">successfully deployed.</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.711.1">Similar to</span><a id="_idIndexMarker288" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.712.1"> the previous recipe, we will now use Postman to test the cloud function that we have just deployed. </span><span class="kobospan" id="kobo.712.2">To do so, open Postman, select </span><strong class="bold"><span class="kobospan" id="kobo.713.1">New</span></strong><span class="kobospan" id="kobo.714.1"> at the top left, and then </span><span><span class="kobospan" id="kobo.715.1">select </span></span><span><strong class="bold"><span class="kobospan" id="kobo.716.1">HTTP</span></strong></span><span><span class="kobospan" id="kobo.717.1">.</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.718.1">On the Postman request, select </span><strong class="bold"><span class="kobospan" id="kobo.719.1">Headers</span></strong><span class="kobospan" id="kobo.720.1"> and type in a new header, with </span><strong class="bold"><span class="kobospan" id="kobo.721.1">Key</span></strong><span class="kobospan" id="kobo.722.1"> equal to </span><strong class="source-inline1"><span class="kobospan" id="kobo.723.1">Content-Type</span></strong><span class="kobospan" id="kobo.724.1"> and </span><strong class="bold"><span class="kobospan" id="kobo.725.1">Value</span></strong><span class="kobospan" id="kobo.726.1"> equal </span><span><span class="kobospan" id="kobo.727.1">to </span></span><span><strong class="source-inline1"><span class="kobospan" id="kobo.728.1">application/json</span></strong></span><span><span class="kobospan" id="kobo.729.1">.</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.730.1">Change the request from </span><strong class="bold"><span class="kobospan" id="kobo.731.1">Get</span></strong><span class="kobospan" id="kobo.732.1"> to </span><strong class="bold"><span class="kobospan" id="kobo.733.1">Post</span></strong><span class="kobospan" id="kobo.734.1"> from the left-hand side drop-down menu. </span><span class="kobospan" id="kobo.734.2">Copy the endpoint URL from the </span><strong class="bold"><span class="kobospan" id="kobo.735.1">Cloud Functions</span></strong><span class="kobospan" id="kobo.736.1"> page and paste it </span><span><span class="kobospan" id="kobo.737.1">into Postman.</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.738.1">Select </span><strong class="bold"><span class="kobospan" id="kobo.739.1">Body</span></strong><span class="kobospan" id="kobo.740.1">, then </span><strong class="bold"><span class="kobospan" id="kobo.741.1">Raw</span></strong><span class="kobospan" id="kobo.742.1">, and copy and paste the following </span><span><span class="kobospan" id="kobo.743.1">JSON request:</span></span><pre class="source-code"><span class="kobospan1" id="kobo.744.1">
{
    "city": "Toronto, Canada"
}</span></pre></li> </ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer065">
<span class="kobospan" id="kobo.745.1"><img alt="Figure 6.16 – Postman body" src="image/B21007_06_16.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.746.1">Figure 6.16 – Postman body</span></p>
<p class="calibre3"><span class="kobospan" id="kobo.747.1">Note</span><a id="_idIndexMarker289" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.748.1"> that because this is a long cloud function that makes several calls to OpenAI (for both text and images), this may take several minutes </span><span><span class="kobospan" id="kobo.749.1">to complete.</span></span></p>
<ol class="calibre14">
<li value="15" class="calibre15"><span class="kobospan" id="kobo.750.1">Select </span><strong class="bold"><span class="kobospan" id="kobo.751.1">Send</span></strong><span class="kobospan" id="kobo.752.1"> to make the call to your cloud function. </span><span class="kobospan" id="kobo.752.2">If all goes well, you should see a similar response to the one shown in </span><span><em class="italic"><span class="kobospan" id="kobo.753.1">Figure 6</span></em></span><em class="italic"><span class="kobospan" id="kobo.754.1">.17</span></em><span class="kobospan" id="kobo.755.1">, which contains several objects embedded in the </span><span><span class="kobospan" id="kobo.756.1">JSON response:</span></span></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer066">
<span class="kobospan" id="kobo.757.1"><img alt="Figure 6.17 – Postman output" src="image/B21007_06_17.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.758.1">Figure 6.17 – Postman output</span></p>
<ol class="calibre14">
<li value="16" class="calibre15"><span class="kobospan" id="kobo.759.1">Navigate to </span><a href="http://bubble.io" class="pcalibre1 calibre6 pcalibre"><span class="kobospan" id="kobo.760.1">http://bubble.io</span></a><span class="kobospan" id="kobo.761.1"> and log in. </span><span class="kobospan" id="kobo.761.2">Select </span><strong class="bold"><span class="kobospan" id="kobo.762.1">Create an App</span></strong><span class="kobospan" id="kobo.763.1"> and give your app a relevant name. </span><span class="kobospan" id="kobo.763.2">Select </span><strong class="bold"><span class="kobospan" id="kobo.764.1">Get Started</span></strong><span class="kobospan" id="kobo.765.1"> and then select </span><strong class="bold"><span class="kobospan" id="kobo.766.1">Start with Basic Features</span></strong><span class="kobospan" id="kobo.767.1">. </span><span class="kobospan" id="kobo.767.2">You can also click </span><strong class="bold"><span class="kobospan" id="kobo.768.1">Skip the application assistant</span></strong><span class="kobospan" id="kobo.769.1"> if you encounter </span><span><span class="kobospan" id="kobo.770.1">the prompt.</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.771.1">On the </span><strong class="bold"><span class="kobospan" id="kobo.772.1">Canvas</span></strong><span class="kobospan" id="kobo.773.1"> page, we are going to add a few elements that are required for our application. </span><span class="kobospan" id="kobo.773.2">Add in an input by selecting </span><strong class="bold"><span class="kobospan" id="kobo.774.1">Input</span></strong><span class="kobospan" id="kobo.775.1"> from the left-hand side menu and then drawing a rectangle at the top left of the page. </span><span class="kobospan" id="kobo.775.2">Then, add a button adjacent</span><a id="_idIndexMarker290" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.776.1"> to it by selecting </span><strong class="bold"><span class="kobospan" id="kobo.777.1">Button</span></strong><span class="kobospan" id="kobo.778.1"> from the left-hand side menu and drawing it next </span><span><span class="kobospan" id="kobo.779.1">to </span></span><span><strong class="bold"><span class="kobospan" id="kobo.780.1">Input</span></strong></span><span><span class="kobospan" id="kobo.781.1">:</span></span></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer067">
<span class="kobospan" id="kobo.782.1"><img alt="Figure 6.18 – Adding a button in Bubble" src="image/B21007_06_18.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.783.1">Figure 6.18 – Adding a button in Bubble</span></p>
<ol class="calibre14">
<li value="18" class="calibre15"><span class="kobospan" id="kobo.784.1">Double-click the </span><strong class="bold"><span class="kobospan" id="kobo.785.1">Input</span></strong><span class="kobospan" id="kobo.786.1"> element and in the property menu, replace </span><strong class="bold"><span class="kobospan" id="kobo.787.1">Placeholder</span></strong> <span><span class="kobospan" id="kobo.788.1">with </span></span><span><strong class="source-inline1"><span class="kobospan" id="kobo.789.1">City</span></strong></span><span><span class="kobospan" id="kobo.790.1">.</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.791.1">Double-click the </span><strong class="bold"><span class="kobospan" id="kobo.792.1">Button</span></strong><span class="kobospan" id="kobo.793.1"> element and in the property menu, replace </span><strong class="bold"><span class="kobospan" id="kobo.794.1">Text</span></strong><span class="kobospan" id="kobo.795.1"> with </span><span><strong class="source-inline1"><span class="kobospan" id="kobo.796.1">Plan Itinerary</span></strong></span><span><span class="kobospan" id="kobo.797.1">.</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.798.1">Create a </span><strong class="bold"><span class="kobospan" id="kobo.799.1">Text</span></strong><span class="kobospan" id="kobo.800.1"> element and place it on the left-hand side of </span><span><span class="kobospan" id="kobo.801.1">the page.</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.802.1">Next, we need to create three images. </span><span class="kobospan" id="kobo.802.2">Select </span><strong class="bold"><span class="kobospan" id="kobo.803.1">Image</span></strong><span class="kobospan" id="kobo.804.1"> and put it on the right-hand side. </span><span class="kobospan" id="kobo.804.2">Do this </span><em class="italic"><span class="kobospan" id="kobo.805.1">three</span></em><span class="kobospan" id="kobo.806.1"> times, creating </span><em class="italic"><span class="kobospan" id="kobo.807.1">Image A</span></em><span class="kobospan" id="kobo.808.1">, </span><em class="italic"><span class="kobospan" id="kobo.809.1">Image B</span></em><span class="kobospan" id="kobo.810.1">, and </span><em class="italic"><span class="kobospan" id="kobo.811.1">Image C</span></em><span class="kobospan" id="kobo.812.1">. </span><span class="kobospan" id="kobo.812.2">Verify that they are around the same size. </span><span class="kobospan" id="kobo.812.3">You may need to drag and move the images around to </span><span><span class="kobospan" id="kobo.813.1">verify this:</span></span></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer068">
<span class="kobospan" id="kobo.814.1"><img alt="Figure 6.19 – Adding images in Bubble" src="image/B21007_06_19.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.815.1">Figure 6.19 – Adding images in Bubble</span></p>
<ol class="calibre14">
<li value="22" class="calibre15"><span class="kobospan" id="kobo.816.1">Next, create </span><strong class="bold"><span class="kobospan" id="kobo.817.1">Custom states</span></strong><span class="kobospan" id="kobo.818.1"> for the </span><strong class="bold"><span class="kobospan" id="kobo.819.1">Text</span></strong><span class="kobospan" id="kobo.820.1"> and </span><span><strong class="bold"><span class="kobospan" id="kobo.821.1">Image</span></strong></span><span><span class="kobospan" id="kobo.822.1"> elements.</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.823.1">For</span><a id="_idIndexMarker291" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.824.1"> each </span><strong class="bold"><span class="kobospan" id="kobo.825.1">Text</span></strong><span class="kobospan" id="kobo.826.1"> element, double-click the element to show the property menu. </span><span class="kobospan" id="kobo.826.2">Then, click </span><strong class="bold"><span class="kobospan" id="kobo.827.1">Insert dynamic data</span></strong><span class="kobospan" id="kobo.828.1"> on the actual text field, select </span><strong class="bold"><span class="kobospan" id="kobo.829.1">Text</span></strong><span class="kobospan" id="kobo.830.1">, and then </span><strong class="bold"><span class="kobospan" id="kobo.831.1">Create a new custom state</span></strong><span class="kobospan" id="kobo.832.1">. </span><span class="kobospan" id="kobo.832.2">You will be prompted for a name and type. </span><span class="kobospan" id="kobo.832.3">For the name, type </span><strong class="source-inline1"><span class="kobospan" id="kobo.833.1">itinerary_details</span></strong><span class="kobospan" id="kobo.834.1">. </span><span class="kobospan" id="kobo.834.2">For </span><strong class="bold"><span class="kobospan" id="kobo.835.1">Type</span></strong><span class="kobospan" id="kobo.836.1">, ensure </span><strong class="bold"><span class="kobospan" id="kobo.837.1">Text</span></strong><span class="kobospan" id="kobo.838.1"> is selected. </span><span class="kobospan" id="kobo.838.2">This will create a unique custom state for the text box, which is required to show the values in the application. </span><span class="kobospan" id="kobo.838.3">The box will contain the itinerary details from </span><span><span class="kobospan" id="kobo.839.1">the application.</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.840.1">For each of the </span><strong class="bold"><span class="kobospan" id="kobo.841.1">Image</span></strong><span class="kobospan" id="kobo.842.1"> elements, double-click the element to show the property menu. </span><span class="kobospan" id="kobo.842.2">Then, click </span><strong class="bold"><span class="kobospan" id="kobo.843.1">Insert dynamic data</span></strong><span class="kobospan" id="kobo.844.1"> where it says </span><strong class="bold"><span class="kobospan" id="kobo.845.1">Dynamic image</span></strong><span class="kobospan" id="kobo.846.1">. </span><span class="kobospan" id="kobo.846.2">Select </span><strong class="bold"><span class="kobospan" id="kobo.847.1">Image X</span></strong><span class="kobospan" id="kobo.848.1">, then </span><strong class="bold"><span class="kobospan" id="kobo.849.1">Create a new custom state</span></strong><span class="kobospan" id="kobo.850.1">. </span><span class="kobospan" id="kobo.850.2">You will be prompted for a name and type. </span><span class="kobospan" id="kobo.850.3">For the name, type in </span><strong class="source-inline1"><span class="kobospan" id="kobo.851.1">img_url</span></strong><span class="kobospan" id="kobo.852.1">. </span><span class="kobospan" id="kobo.852.2">For </span><strong class="bold"><span class="kobospan" id="kobo.853.1">Type</span></strong><span class="kobospan" id="kobo.854.1">, ensure </span><strong class="bold"><span class="kobospan" id="kobo.855.1">Text</span></strong> <span><span class="kobospan" id="kobo.856.1">is selected.</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.857.1">The next thing we need to do is load the cloud function that we created into Bubble. </span><span class="kobospan" id="kobo.857.2">Select </span><strong class="bold"><span class="kobospan" id="kobo.858.1">Plugins</span></strong><span class="kobospan" id="kobo.859.1"> from the left-hand side menu, and then select </span><strong class="bold"><span class="kobospan" id="kobo.860.1">Add Plugins</span></strong><span class="kobospan" id="kobo.861.1">. </span><span class="kobospan" id="kobo.861.2">Select </span><strong class="bold"><span class="kobospan" id="kobo.862.1">API Connector</span></strong><span class="kobospan" id="kobo.863.1">, then </span><strong class="bold"><span class="kobospan" id="kobo.864.1">Install</span></strong><span class="kobospan" id="kobo.865.1">, and </span><span><span class="kobospan" id="kobo.866.1">then </span></span><span><strong class="bold"><span class="kobospan" id="kobo.867.1">Done</span></strong></span><span><span class="kobospan" id="kobo.868.1">:</span></span></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer069">
<span class="kobospan" id="kobo.869.1"><img alt="Figure 6.20 - Bubble.io UI configuration" src="image/B21007_06_20.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.870.1">Figure 6.20 - Bubble.io UI configuration</span></p>
<ol class="calibre14">
<li value="26" class="calibre15"><span class="kobospan" id="kobo.871.1">Select </span><strong class="bold"><span class="kobospan" id="kobo.872.1">API Connector</span></strong><span class="kobospan" id="kobo.873.1"> from the list of plugins. </span><span class="kobospan" id="kobo.873.2">Select </span><strong class="source-inline1"><span class="kobospan" id="kobo.874.1">Add Another API</span></strong><span class="kobospan" id="kobo.875.1">. </span><span class="kobospan" id="kobo.875.2">For </span><strong class="bold"><span class="kobospan" id="kobo.876.1">API name</span></strong><span class="kobospan" id="kobo.877.1">, type in </span><strong class="source-inline1"><span class="kobospan" id="kobo.878.1">travel</span></strong><span class="kobospan" id="kobo.879.1">. </span><span class="kobospan" id="kobo.879.2">Scroll down until you get to the </span><strong class="bold"><span class="kobospan" id="kobo.880.1">Name</span></strong><span class="kobospan" id="kobo.881.1"> field and click </span><strong class="bold"><span class="kobospan" id="kobo.882.1">Expand</span></strong><span class="kobospan" id="kobo.883.1">. </span><span class="kobospan" id="kobo.883.2">Change the name of this API to </span><strong class="source-inline1"><span class="kobospan" id="kobo.884.1">travel</span></strong><span class="kobospan" id="kobo.885.1">. </span><span class="kobospan" id="kobo.885.2">For the API, configure</span><a id="_idIndexMarker292" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.886.1"> its settings </span><span><span class="kobospan" id="kobo.887.1">like so:</span></span><ul class="calibre17"><li class="calibre15"><span class="kobospan" id="kobo.888.1">From the </span><strong class="bold"><span class="kobospan" id="kobo.889.1">Use as</span></strong><span class="kobospan" id="kobo.890.1"> drop-down menu, </span><span><span class="kobospan" id="kobo.891.1">select </span></span><span><strong class="bold"><span class="kobospan" id="kobo.892.1">Action</span></strong></span><span><span class="kobospan" id="kobo.893.1">.</span></span></li><li class="calibre15"><span class="kobospan" id="kobo.894.1">Change the request from </span><strong class="bold"><span class="kobospan" id="kobo.895.1">GET</span></strong> <span><span class="kobospan" id="kobo.896.1">to </span></span><span><strong class="bold"><span class="kobospan" id="kobo.897.1">POST</span></strong></span><span><span class="kobospan" id="kobo.898.1">.</span></span></li><li class="calibre15"><span class="kobospan" id="kobo.899.1">Directly adjacent to the </span><strong class="bold"><span class="kobospan" id="kobo.900.1">POST</span></strong><span class="kobospan" id="kobo.901.1"> request is a place to enter your </span><strong class="bold"><span class="kobospan" id="kobo.902.1">Endpoint URL</span></strong><span class="kobospan" id="kobo.903.1">. </span><span class="kobospan" id="kobo.903.2">Enter the URL you copied from the Google </span><span><span class="kobospan" id="kobo.904.1">cloud function.</span></span></li><li class="calibre15"><span class="kobospan" id="kobo.905.1">Create a </span><strong class="bold"><span class="kobospan" id="kobo.906.1">New Header</span></strong><span class="kobospan" id="kobo.907.1"> value. </span><span class="kobospan" id="kobo.907.2">Select </span><strong class="bold"><span class="kobospan" id="kobo.908.1">Add Header</span></strong><span class="kobospan" id="kobo.909.1">. </span><span class="kobospan" id="kobo.909.2">Then, for </span><strong class="bold"><span class="kobospan" id="kobo.910.1">Key</span></strong><span class="kobospan" id="kobo.911.1">, type </span><strong class="source-inline1"><span class="kobospan" id="kobo.912.1">Content-Type</span></strong><span class="kobospan" id="kobo.913.1">, and for </span><strong class="bold"><span class="kobospan" id="kobo.914.1">Value</span></strong><span class="kobospan" id="kobo.915.1">, </span><span><span class="kobospan" id="kobo.916.1">type </span></span><span><strong class="source-inline1"><span class="kobospan" id="kobo.917.1">application/json</span></strong></span><span><span class="kobospan" id="kobo.918.1">.</span></span></li><li class="calibre15"><span class="kobospan" id="kobo.919.1">Add a parameter by clicking </span><strong class="bold"><span class="kobospan" id="kobo.920.1">Parameter</span></strong><span class="kobospan" id="kobo.921.1">. </span><span class="kobospan" id="kobo.921.2">For </span><strong class="bold"><span class="kobospan" id="kobo.922.1">Key</span></strong><span class="kobospan" id="kobo.923.1">, type </span><strong class="source-inline1"><span class="kobospan" id="kobo.924.1">city</span></strong><span class="kobospan" id="kobo.925.1">. </span><span class="kobospan" id="kobo.925.2">For </span><strong class="bold"><span class="kobospan" id="kobo.926.1">Value</span></strong><span class="kobospan" id="kobo.927.1">, copy the same JSON text that was used in the Postman call, which was </span><strong class="source-inline1"><span class="kobospan" id="kobo.928.1">Toronto, Canada</span></strong><span class="kobospan" id="kobo.929.1">. </span><span class="kobospan" id="kobo.929.2">Ensure that the </span><strong class="bold"><span class="kobospan" id="kobo.930.1">Private</span></strong><span class="kobospan" id="kobo.931.1"> box </span><span><span class="kobospan" id="kobo.932.1">is </span></span><span><em class="italic"><span class="kobospan" id="kobo.933.1">unchecked</span></em></span><span><span class="kobospan" id="kobo.934.1">:</span></span></li></ul></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer070">
<span class="kobospan" id="kobo.935.1"><img alt="Figure 6.21 – Bubble API configurations" src="image/B21007_06_21.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.936.1">Figure 6.21 – Bubble API configurations</span></p>
<ol class="calibre14">
<li value="27" class="calibre15"><span class="kobospan" id="kobo.937.1">Select </span><strong class="bold"><span class="kobospan" id="kobo.938.1">Initialize Call</span></strong><span class="kobospan" id="kobo.939.1"> to test</span><a id="_idIndexMarker293" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.940.1"> the API call. </span><span class="kobospan" id="kobo.940.2">If you see the screen depicted in </span><span><em class="italic"><span class="kobospan" id="kobo.941.1">Figure 6</span></em></span><em class="italic"><span class="kobospan" id="kobo.942.1">.22</span></em><span class="kobospan" id="kobo.943.1">, then the call has been successful. </span><span class="kobospan" id="kobo.943.2">Ensure that for each return object, the </span><strong class="bold"><span class="kobospan" id="kobo.944.1">Text</span></strong><span class="kobospan" id="kobo.945.1"> type has been selected. </span><span class="kobospan" id="kobo.945.2">Then, </span><span><span class="kobospan" id="kobo.946.1">click </span></span><span><strong class="bold"><span class="kobospan" id="kobo.947.1">Save</span></strong></span><span><span class="kobospan" id="kobo.948.1">:</span></span></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer071">
<span class="kobospan" id="kobo.949.1"><img alt="Figure 6.22 –  A successful UI configuration" src="image/B21007_06_22.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.950.1">Figure 6.22 –  A successful UI configuration</span></p>
<ol class="calibre14">
<li value="28" class="calibre15"><span class="kobospan" id="kobo.951.1">Select </span><strong class="bold"><span class="kobospan" id="kobo.952.1">Design</span></strong><span class="kobospan" id="kobo.953.1"> from the left-hand side menu. </span><span class="kobospan" id="kobo.953.2">Double-click the </span><strong class="bold"><span class="kobospan" id="kobo.954.1">Button</span></strong><span class="kobospan" id="kobo.955.1"> element that you created. </span><span class="kobospan" id="kobo.955.2">In the property menu that appears, select </span><span><strong class="bold"><span class="kobospan" id="kobo.956.1">Add Workflow</span></strong></span><span><span class="kobospan" id="kobo.957.1">.</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.958.1">Select </span><strong class="bold"><span class="kobospan" id="kobo.959.1">Click here to add an action</span></strong><span class="kobospan" id="kobo.960.1">. </span><span class="kobospan" id="kobo.960.2">Then, go to </span><strong class="bold"><span class="kobospan" id="kobo.961.1">Plugins</span></strong><span class="kobospan" id="kobo.962.1">, find the API you just created (</span><strong class="source-inline1"><span class="kobospan" id="kobo.963.1">travel-travel</span></strong><span class="kobospan" id="kobo.964.1">), and select it. </span><span class="kobospan" id="kobo.964.2">From the property menu that appears, delete </span><a id="_idIndexMarker294" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.965.1">the content of </span><strong class="bold"><span class="kobospan" id="kobo.966.1">(param.) city</span></strong><span class="kobospan" id="kobo.967.1"> and then select </span><strong class="bold"><span class="kobospan" id="kobo.968.1">Insert dynamic data</span></strong><span class="kobospan" id="kobo.969.1">. </span><span class="kobospan" id="kobo.969.2">Scroll down, select </span><strong class="bold"><span class="kobospan" id="kobo.970.1">Input City here</span></strong><span class="kobospan" id="kobo.971.1">, and then </span><span><span class="kobospan" id="kobo.972.1">select </span></span><span><strong class="bold"><span class="kobospan" id="kobo.973.1">Value</span></strong></span><span><span class="kobospan" id="kobo.974.1">:</span></span></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer072">
<span class="kobospan" id="kobo.975.1"><img alt="Figure 6.23 – Adding dynamic data to an API call (1)" src="image/B21007_06_23.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.976.1">Figure 6.23 – Adding dynamic data to an API call (1)</span></p>
<div class="calibre2">
<div class="img---figure" id="_idContainer073">
<span class="kobospan" id="kobo.977.1"><img alt="Figure 6.24 – Adding dynamic data to an API call (2)" src="image/B21007_06_24.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.978.1">Figure 6.24 – Adding dynamic data to an API call (2)</span></p>
<ol class="calibre14">
<li value="30" class="calibre15"><span class="kobospan" id="kobo.979.1">Next, select </span><strong class="bold"><span class="kobospan" id="kobo.980.1">Click here to add an action</span></strong><span class="kobospan" id="kobo.981.1"> again, scroll down to </span><strong class="bold"><span class="kobospan" id="kobo.982.1">Element Actions</span></strong><span class="kobospan" id="kobo.983.1">, and then select </span><strong class="bold"><span class="kobospan" id="kobo.984.1">Set State</span></strong><span class="kobospan" id="kobo.985.1">. </span><span class="kobospan" id="kobo.985.2">From the </span><strong class="bold"><span class="kobospan" id="kobo.986.1">Element</span></strong><span class="kobospan" id="kobo.987.1"> drop-down menu, select </span><strong class="source-inline1"><span class="kobospan" id="kobo.988.1">Text A</span></strong><span class="kobospan" id="kobo.989.1">. </span><span class="kobospan" id="kobo.989.2">From the </span><strong class="bold"><span class="kobospan" id="kobo.990.1">Custom state</span></strong><span class="kobospan" id="kobo.991.1"> drop-down menu, select </span><strong class="bold"><span class="kobospan" id="kobo.992.1">itinerary_details</span></strong><span class="kobospan" id="kobo.993.1">. </span><span class="kobospan" id="kobo.993.2">For </span><strong class="bold"><span class="kobospan" id="kobo.994.1">Value</span></strong><span class="kobospan" id="kobo.995.1">, select </span><strong class="bold"><span class="kobospan" id="kobo.996.1">Results of step 1</span></strong><span class="kobospan" id="kobo.997.1"> and then select </span><strong class="bold"><span class="kobospan" id="kobo.998.1">itinerary</span></strong><span class="kobospan" id="kobo.999.1">. </span><span class="kobospan" id="kobo.999.2">This will make the value of </span><strong class="source-inline1"><span class="kobospan" id="kobo.1000.1">Text A</span></strong><span class="kobospan" id="kobo.1001.1"> equal to the itinerary value in the JSON object result of the API call to the cloud function that </span><span><span class="kobospan" id="kobo.1002.1">you created.</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.1003.1">Next, select </span><strong class="bold"><span class="kobospan" id="kobo.1004.1">Click here to add an action</span></strong><span class="kobospan" id="kobo.1005.1"> again. </span><span class="kobospan" id="kobo.1005.2">Then scroll down to </span><strong class="bold"><span class="kobospan" id="kobo.1006.1">Element Actions</span></strong><span class="kobospan" id="kobo.1007.1">, and </span><a id="_idIndexMarker295" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.1008.1">then select </span><strong class="bold"><span class="kobospan" id="kobo.1009.1">Set State</span></strong><span class="kobospan" id="kobo.1010.1">. </span><span class="kobospan" id="kobo.1010.2">From the </span><strong class="bold"><span class="kobospan" id="kobo.1011.1">Element</span></strong><span class="kobospan" id="kobo.1012.1"> drop-down menu, select </span><strong class="bold"><span class="kobospan" id="kobo.1013.1">Image A</span></strong><span class="kobospan" id="kobo.1014.1">. </span><span class="kobospan" id="kobo.1014.2">From the </span><strong class="bold"><span class="kobospan" id="kobo.1015.1">Custom state</span></strong><span class="kobospan" id="kobo.1016.1"> drop-down menu, select </span><strong class="source-inline1"><span class="kobospan" id="kobo.1017.1">img_url</span></strong><span class="kobospan" id="kobo.1018.1">. </span><span class="kobospan" id="kobo.1018.2">For </span><strong class="bold"><span class="kobospan" id="kobo.1019.1">Value</span></strong><span class="kobospan" id="kobo.1020.1">, select </span><strong class="bold"><span class="kobospan" id="kobo.1021.1">Results of step 1</span></strong><span class="kobospan" id="kobo.1022.1"> and then select </span><strong class="bold"><span class="kobospan" id="kobo.1023.1">morning_image</span></strong><span class="kobospan" id="kobo.1024.1">. </span><span class="kobospan" id="kobo.1024.2">This will make </span><strong class="bold"><span class="kobospan" id="kobo.1025.1">Image A</span></strong><span class="kobospan" id="kobo.1026.1"> equal to the picture of </span><strong class="bold"><span class="kobospan" id="kobo.1027.1">Morning Image</span></strong><span class="kobospan" id="kobo.1028.1">, which was returned in the cloud function, which was, in turn, returned from the OpenAI </span><span><span class="kobospan" id="kobo.1029.1">Images API:</span></span></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer074">
<span class="kobospan" id="kobo.1030.1"><img alt="Figure 6.25 – Assigning a custom state in Bubble" src="image/B21007_06_25.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.1031.1">Figure 6.25 – Assigning a custom state in Bubble</span></p>
<ol class="calibre14">
<li value="32" class="calibre15"><span class="kobospan" id="kobo.1032.1">Repeat </span><em class="italic"><span class="kobospan" id="kobo.1033.1">step 31</span></em><span class="kobospan" id="kobo.1034.1"> two more times for the </span><strong class="bold"><span class="kobospan" id="kobo.1035.1">Image B</span></strong><span class="kobospan" id="kobo.1036.1"> and </span><strong class="bold"><span class="kobospan" id="kobo.1037.1">Image C</span></strong><span class="kobospan" id="kobo.1038.1"> elements, choosing </span><strong class="bold"><span class="kobospan" id="kobo.1039.1">afternoon_image</span></strong><span class="kobospan" id="kobo.1040.1"> and </span><span><strong class="bold"><span class="kobospan" id="kobo.1041.1">evening_image</span></strong></span><span><span class="kobospan" id="kobo.1042.1">, respectively.</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.1043.1">We have </span><a id="_idIndexMarker296" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.1044.1">completed everything we need for our Bubble intelligent application. </span><span class="kobospan" id="kobo.1044.2">To test if the application works, select </span><strong class="bold"><span class="kobospan" id="kobo.1045.1">Preview</span></strong><span class="kobospan" id="kobo.1046.1"> on the right; a new page will appear that contains </span><span><span class="kobospan" id="kobo.1047.1">your application.</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.1048.1">In the </span><strong class="bold"><span class="kobospan" id="kobo.1049.1">City</span></strong><span class="kobospan" id="kobo.1050.1"> text box, type in any city you want (I have typed in Toronto, Canada). </span><span class="kobospan" id="kobo.1050.2">Then, select the </span><strong class="bold"><span class="kobospan" id="kobo.1051.1">Plan Itinerary</span></strong><span class="kobospan" id="kobo.1052.1"> button; this will start the Bubble workflow and call the </span><span><span class="kobospan" id="kobo.1053.1">cloud function.</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.1054.1">If all goes well, you should get a screen like what’s shown in </span><span><em class="italic"><span class="kobospan" id="kobo.1055.1">Figure 6</span></em></span><em class="italic"><span class="kobospan" id="kobo.1056.1">.26</span></em><span class="kobospan" id="kobo.1057.1">, which shows the travel itinerary, along with three images that correspond directly to what is stated in </span><span><span class="kobospan" id="kobo.1058.1">the itinerary:</span></span></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer075">
<span class="kobospan" id="kobo.1059.1"><img alt="Figure 6.26 – Output of the completed Bubble application" src="image/B21007_06_26.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.1060.1">Figure 6.26 – Output of the completed Bubble application</span></p>
<h2 id="_idParaDest-108" class="calibre7"><a id="_idTextAnchor115" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.1061.1">How it works…</span></h2>
<p class="calibre3"><span class="kobospan" id="kobo.1062.1">In this recipe, we created a travel itinerary app where a user can type in any location and the application will create a 1-day itinerary specific to that location, along with AI-generated photos that correspond to that itinerary. </span><span class="kobospan" id="kobo.1062.2">As mentioned previously, this is a </span><em class="italic"><span class="kobospan" id="kobo.1063.1">multi-modal</span></em><span class="kobospan" id="kobo.1064.1"> application as both the OpenAI Chat API and Images API were used to construct </span><span><span class="kobospan" id="kobo.1065.1">this application.</span></span></p>
<h3 class="calibre8"><span class="kobospan" id="kobo.1066.1">Configuring settings for a multi-modal application</span></h3>
<p class="calibre3"><span class="kobospan" id="kobo.1067.1">Since this was </span><a id="_idIndexMarker297" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.1068.1">a multi-modal application, there was one key difference when creating the backend Google cloud function. </span><span class="kobospan" id="kobo.1068.2">In particular, we set </span><strong class="bold"><span class="kobospan" id="kobo.1069.1">Function Timeout</span></strong><span class="kobospan" id="kobo.1070.1"> to 300 seconds (which is the max possible – by default, at the time of writing, it is 60 seconds). </span><span class="kobospan" id="kobo.1070.2">This timeout is crucial for ensuring the application can process and handle more complex or time-consuming tasks without prematurely terminating. </span><span class="kobospan" id="kobo.1070.3">Given the intricate nature of the multi-modal data being processed – combining text, images, and possibly even video content – the extended timeout allows for sufficient data parsing, analysis, and response generation. </span><span class="kobospan" id="kobo.1070.4">This adjustment </span><a id="_idIndexMarker298" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.1071.1">also means that the backend can comfortably accommodate the occasional spikes in data volume or complexity, which is typical in a multi-modal setup, without compromising on performance </span><span><span class="kobospan" id="kobo.1072.1">or reliability.</span></span></p>
<h3 class="calibre8"><span class="kobospan" id="kobo.1073.1">Code walk-through for the three OpenAI API calls</span></h3>
<p class="calibre3"><span class="kobospan" id="kobo.1074.1">The </span><a id="_idIndexMarker299" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.1075.1">backend layer contains three interweaving OpenAI API calls, and it is worth going through each so that we can discuss exactly what is occurring in </span><span><span class="kobospan" id="kobo.1076.1">each step.</span></span></p>
<h4 class="calibre19"><span class="kobospan" id="kobo.1077.1">Call 1</span></h4>
<pre class="source-code"><span class="kobospan1" id="kobo.1078.1">
response = client.chat.completions.create(
      model="gpt-4",
      messages=[
    {
      "role": "system",
      "content": "You are a helpful assistant that creates detailed one day itineraries based on the city that the user chooses. </span><span class="kobospan1" id="kobo.1078.2">Create only 3 activities (morning, afternoon, evening). </span><span class="kobospan1" id="kobo.1078.3">Only mention the itinerary, nothing else."
</span><span class="kobospan1" id="kobo.1078.4">    },
    {
      "role": "user",
      "content": "Rome, Italy"
    },
    {
      "role": "assistant",
      "content": "Morning: \n\nStart the day at the Colosseum, one of the most iconic sights of Rome. </span><span class="kobospan1" id="kobo.1078.5">Take a guided tour to fully appreciate its history and significance. </span><span class="kobospan1" id="kobo.1078.6">\n\nAfternoon: \n\nHead over to the Vatican City. </span><span class="kobospan1" id="kobo.1078.7">Visit the Vatican Museums, home to a vast collection of art and historical artifacts. </span><span class="kobospan1" id="kobo.1078.8">Don't miss the Sistine Chapel, famous for Michelangelo's ceiling.\n\nEvening: \n\nEnjoy a leisurely stroll to the Trevi Fountain. </span><span class="kobospan1" id="kobo.1078.9">Make sure to throw a coin over your shoulder into the fountain for good luck. </span><span class="kobospan1" id="kobo.1078.10">Then, end the day with a delicious Italian dinner at one of the local restaurants nearby."
</span><span class="kobospan1" id="kobo.1078.11">    },
    {
      "role": "user",
      "content": "Lisbon, Portugal"
    },
    {
      "role": "assistant",
      "content": "Morning: \n\nBegin your day with a visit to the iconic Belém Tower, a UNESCO World Heritage site offering panoramic views of Lisbon. </span><span class="kobospan1" id="kobo.1078.12">\n\nAfternoon: \n\nExplore the historical neighborhood of Alfama. </span><span class="kobospan1" id="kobo.1078.13">Wander its narrow, winding streets, visit the Se Cathedral and enjoy a traditional Portuguese lunch at a local tavern.\n\nEvening: \n\nHead to Bairro Alto, the city's bohemian district, for dinner. </span><span class="kobospan1" id="kobo.1078.14">Afterwards, enjoy a Fado show - a traditional Portuguese music genre - at one of the local bars."
</span><span class="kobospan1" id="kobo.1078.15">    },
    {
      "role": "user",
      "content": city
    },
  ],
      temperature=0.64,
      max_tokens=1024,
      top_p=1,
      frequency_penalty=0,
      presence_penalty=0
    )
    itinerary = response.choices[0].message.content</span></pre> <p class="calibre3"><span class="kobospan" id="kobo.1079.1">This is the</span><a id="_idIndexMarker300" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.1080.1"> standard GPT-4 chat call that we have made in previous recipes, but note that we have included a long </span><em class="italic"><span class="kobospan" id="kobo.1081.1">Chat Log</span></em><span class="kobospan" id="kobo.1082.1"> as part of the call. </span><span class="kobospan" id="kobo.1082.2">In particular, we gave OpenAI two examples of the input and output to effectively </span><em class="italic"><span class="kobospan" id="kobo.1083.1">fine-tune</span></em> <span><span class="kobospan" id="kobo.1084.1">the model:</span></span></p>
<table class="no-table-style" id="table001-6">
<colgroup class="calibre10">
<col class="calibre11"/>
<col class="calibre11"/>
</colgroup>
<thead class="calibre12">
<tr class="no-table-style1">
<td class="no-table-style2">
<p class="calibre3"><span><strong class="bold"><span class="kobospan" id="kobo.1085.1">Input</span></strong></span></p>
</td>
<td class="no-table-style2">
<p class="calibre3"><span><strong class="bold"><span class="kobospan" id="kobo.1086.1">Output</span></strong></span></p>
</td>
</tr>
</thead>
<tbody class="calibre13">
<tr class="no-table-style1">
<td class="no-table-style2">
<p class="calibre3"><span><strong class="source-inline"><span class="kobospan" id="kobo.1087.1">Rome, Italy</span></strong></span></p>
</td>
<td class="no-table-style2">
<pre class="console"><span class="kobospan1" id="kobo.1088.1">
Morning:</span></pre> <pre class="console"><span class="kobospan1" id="kobo.1089.1">
Start the day at the Colosseum, one of the most iconic sights of Rome. </span><span class="kobospan1" id="kobo.1089.2">Take a guided tour to fully appreciate its history and significance.</span></pre> <pre class="console"><span class="kobospan1" id="kobo.1090.1">
Afternoon: Head over to the Vatican City. </span><span class="kobospan1" id="kobo.1090.2">Visit the Vatican Museums, home to a vast collection of art and historical artifacts. </span><span class="kobospan1" id="kobo.1090.3">Don't miss the Sistine Chapel, famous for Michelangelo's ceiling.</span></pre> <pre class="console"><span class="kobospan1" id="kobo.1091.1">
Evening: Enjoy a leisurely stroll to the Trevi Fountain. </span><span class="kobospan1" id="kobo.1091.2">Make sure to throw a coin over your shoulder into the fountain for good luck. </span><span class="kobospan1" id="kobo.1091.3">Then, end the day with a delicious Italian dinner at one of the local restaurants nearby.</span></pre> </td>
</tr>
<tr class="no-table-style1">
<td class="no-table-style2">
<p class="calibre3"><span><strong class="source-inline"><span class="kobospan" id="kobo.1092.1">Lisbon, Portugal</span></strong></span></p>
</td>
<td class="no-table-style2">
<pre class="console"><span class="kobospan1" id="kobo.1093.1">
Morning:</span></pre> <pre class="console"><span class="kobospan1" id="kobo.1094.1">
Begin your day with a visit to the iconic Belém Tower, a UNESCO World Heritage site offering panoramic views of Lisbon. </span><span class="kobospan1" id="kobo.1094.2">Afternoon:</span></pre> <pre class="console"><span class="kobospan1" id="kobo.1095.1">
Explore the historical neighborhood of Alfama. </span><span class="kobospan1" id="kobo.1095.2">Wander its narrow, winding streets, visit the Se Cathedral and enjoy a traditional Portuguese lunch at a local tavern.</span></pre> <pre class="console"><span class="kobospan1" id="kobo.1096.1">
Evening: Head to Bairro Alto, the city's bohemian district, for dinner. </span><span class="kobospan1" id="kobo.1096.2">Afterwards, enjoy a Fado show - a traditional Portuguese music genre - at one of the local bars.</span></pre> </td>
</tr>
</tbody>
</table>
<p class="calibre3"><span class="kobospan" id="kobo.1097.1">In </span><a href="B21007_01.xhtml#_idTextAnchor021" class="pcalibre1 calibre6 pcalibre"><span><em class="italic"><span class="kobospan" id="kobo.1098.1">Chapter 1</span></em></span></a><span class="kobospan" id="kobo.1099.1">, </span><a href="B21007_02.xhtml#_idTextAnchor044" class="pcalibre1 calibre6 pcalibre"><span><em class="italic"><span class="kobospan" id="kobo.1100.1">Chapter 2</span></em></span></a><span class="kobospan" id="kobo.1101.1">, and </span><a href="B21007_04.xhtml#_idTextAnchor074" class="pcalibre1 calibre6 pcalibre"><span><em class="italic"><span class="kobospan" id="kobo.1102.1">Chapter 4</span></em></span></a><span class="kobospan" id="kobo.1103.1">, we learned how </span><strong class="bold"><span class="kobospan" id="kobo.1104.1">Chat Log</span></strong><span class="kobospan" id="kobo.1105.1"> can be used to fine-tune the generated responses, and that is exactly what we are doing here. </span><span class="kobospan" id="kobo.1105.2">After we get the generated</span><a id="_idIndexMarker301" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.1106.1"> response, we can save it to the </span><span><strong class="source-inline"><span class="kobospan" id="kobo.1107.1">itinerary</span></strong></span><span><span class="kobospan" id="kobo.1108.1"> variable.</span></span></p>
<h4 class="calibre19"><span class="kobospan" id="kobo.1109.1">Call 2</span></h4>
<p class="calibre3"><span class="kobospan" id="kobo.1110.1">In the second call, we request the OpenAI API to create image-generating (DALL-E) prompts based on the itinerary that was produced by the previous call. </span><span class="kobospan" id="kobo.1110.2">Specifically, three DALL-E prompts are produced (one for morning, one for afternoon, and one for evening) that are separated by a </span><span><span class="kobospan" id="kobo.1111.1">pipe (</span></span><span><strong class="source-inline"><span class="kobospan" id="kobo.1112.1">|</span></strong></span><span><span class="kobospan" id="kobo.1113.1">):</span></span></p>
<pre class="source-code"><span class="kobospan1" id="kobo.1114.1">
response = client.chat.completions.create(
      model="gpt-3.5-turbo-1106",
      messages=[
        {
          "role": "system",
          "content": "You are a helpful assistant that creates DALL-E prompts based itineraries. </span><span class="kobospan1" id="kobo.1114.2">The prompts should be short. </span><span class="kobospan1" id="kobo.1114.3">Create one prompt for Morning, one for Afternoon, and one for Evening. </span><span class="kobospan1" id="kobo.1114.4">The DALL-E prompt should be separated by \"|\"."
</span><span class="kobospan1" id="kobo.1114.5">        },
        {
          "role": "user",
          "content": itinerary
        }
      ],
      temperature=0.64,
      max_tokens=1024,
      top_p=1,
      frequency_penalty=0,
      presence_penalty=0
    )
    dalle_prompts = response.choices[0].message.content</span></pre> <p class="calibre3"><span class="kobospan" id="kobo.1115.1">Note that, in this case, we have changed the model from </span><strong class="source-inline"><span class="kobospan" id="kobo.1116.1">gpt-4</span></strong><span class="kobospan" id="kobo.1117.1"> to </span><strong class="source-inline"><span class="kobospan" id="kobo.1118.1">gpt-3.5-turbo-1106</span></strong><span class="kobospan" id="kobo.1119.1">. </span><span class="kobospan" id="kobo.1119.2">We discussed when to use what model in </span><a href="B21007_03.xhtml#_idTextAnchor060" class="pcalibre1 calibre6 pcalibre"><span><em class="italic"><span class="kobospan" id="kobo.1120.1">Chapter 3</span></em></span></a><span class="kobospan" id="kobo.1121.1">, and in this case, GPT-3.5 is perfect as the</span><a id="_idIndexMarker302" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.1122.1"> instruction itself is simple and not-nuanced and it’s far cheaper. </span><span class="kobospan" id="kobo.1122.2">Additionally, even if it does hallucinate, the user never sees the output of this call – they just see the resulting image generation </span><span><span class="kobospan" id="kobo.1123.1">for DALL-E.</span></span></p>
<h4 class="calibre19"><span class="kobospan" id="kobo.1124.1">Call 3</span></h4>
<pre class="source-code"><span class="kobospan1" id="kobo.1125.1">
…
dalle_prompts_list = response.choices[0].message.content.split('|')
image_urls = []
for prompt in dalle_prompts_list:
    response = client.images.generate(
            model="dall-e-3",
            prompt=prompt,
            size="1024x1024",
            quality="standard",
            n=1
        )
image_urls.append(response.data[0].url)</span></pre> <p class="calibre3"><span class="kobospan" id="kobo.1126.1">In the last call, we cycle through each of the three DALL-E prompts that were generated in the previous call and pass them to the OpenAI Images API. </span><span class="kobospan" id="kobo.1126.2">We do this through a </span><strong class="bold"><span class="kobospan" id="kobo.1127.1">for loop</span></strong><span class="kobospan" id="kobo.1128.1">. </span><span class="kobospan" id="kobo.1128.2">In Python, a for loop is a programming structure that allows us to execute a block of code multiple times, usually with some variation in each iteration. </span><span class="kobospan" id="kobo.1128.3">In this context, we systematically process each DALL-E prompt. </span><span class="kobospan" id="kobo.1128.4">With each iteration, the loop takes a prompt from the list, sends it to the OpenAI Images API, and then moves to the next prompt until all prompts have </span><span><span class="kobospan" id="kobo.1129.1">been processed.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.1130.1">Note that</span><a id="_idIndexMarker303" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.1131.1"> instead of using the </span><strong class="source-inline"><span class="kobospan" id="kobo.1132.1">client.chat</span></strong><span class="kobospan" id="kobo.1133.1"> library, we are using the </span><strong class="source-inline"><span class="kobospan" id="kobo.1134.1">client.images</span></strong><span class="kobospan" id="kobo.1135.1"> library as we need to use DALL-E to generate images. </span><span class="kobospan" id="kobo.1135.2">We store each output in a list variable called </span><strong class="source-inline"><span class="kobospan" id="kobo.1136.1">image_urls</span></strong><span class="kobospan" id="kobo.1137.1">. </span><span class="kobospan" id="kobo.1137.2">This is then returned by our Google cloud function, with the following </span><span><span class="kobospan" id="kobo.1138.1">JSON structure:</span></span></p>
<pre class="source-code"><span class="kobospan1" id="kobo.1139.1">
result = {
        'itinerary': itinerary,
        'morning_image': image_urls[0],
        'afternoon_image': image_urls[1],
        'evening_image': image_urls[2]
    }
return result</span></pre> <p class="calibre3"><span class="kobospan" id="kobo.1140.1">In this recipe, we created an intelligent application that combines multiple models, multiple API calls, and fine-tuning concepts. </span><span class="kobospan" id="kobo.1140.2">Overall, in this chapter, we built two impactful applications in less than a </span><span><span class="kobospan" id="kobo.1141.1">few hours.</span></span></p>
</div>
</body></html>