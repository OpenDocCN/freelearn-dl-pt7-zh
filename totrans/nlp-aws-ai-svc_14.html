<html><head></head><body><div id="sbo-rt-content"><div id="_idContainer246">
			<h1 id="_idParaDest-137"><em class="italic"><a id="_idTextAnchor141"/>Chapter 12</em>: AI and NLP in Healthcare </h1>
			<p>In the previous chapter, we covered how AWS AI services can be used to set up a chatbot with your document workflows using <strong class="bold">Amazon Lex</strong> and <strong class="bold">Amazon Kendra</strong>. In this chapter, we will talk about how <strong class="bold">Amazon Textract</strong> and <strong class="bold">Amazon Comprehend Medical</strong> can help digitize medical claims in healthcare. We will talk about the healthcare industry's claims processing system and why it's important to automate medical claims. Then, we will walk you through how you can use Amazon Textract to digitize these claims in paper form and use postprocessing to validate them. Then, we will show you how you can extract NLP insights from these claims, such as whether the person was diabetic or not, using Amazon Comprehend Medical APIs. </p>
			<p>For invalid claims, we will show you how to easily set up notifications to notify the person submitting the claims to resubmit it with the right data, such as ZIP code or claim ID. Lastly, we will show you some architecture patterns that help automate everything using AWS Lambda functions. By doing so, you will spin up an end-to-end serverless solution that will reduce time to market for the claims processing workflow. This happens because you do not have to set up and manage servers or scale to process millions of such claims. </p>
			<p>We will cover the following topics in this chapter: </p>
			<ul>
				<li>Introducing the automated claims processing use case</li>
				<li>Understanding how to extract and validate data from medical intake forms</li>
				<li>Understanding clinical data with Amazon Comprehend Medical</li>
				<li>Understanding invalid medical form processing with notifications</li>
				<li>Understanding how to create a serverless pipeline for medical claims</li>
			</ul>
			<h1 id="_idParaDest-138"><a id="_idTextAnchor142"/>Technical requirements</h1>
			<p>For this chapter, you will need access to an AWS account:</p>
			<ul>
				<li>Please make sure that you follow the instructions specified in the <em class="italic">Technical requirements</em> section of <a href="B17528_02_Final_SB_ePub.xhtml#_idTextAnchor027"><em class="italic">Chapter 2</em></a>, <em class="italic">Introducing Amazon Textract</em>, to create your AWS account.</li>
				<li>Log into the AWS Management Console before trying the steps in the <em class="italic">Improving the accuracy of document processing workflows</em> section.</li>
			</ul>
			<p>The Python code and sample datasets for our solution can be found at <a href="https://github.com/PacktPublishing/Natural-Language-Processing-with-AWS-AI-Services/tree/main/Chapter%2012">https://github.com/PacktPublishing/Natural-Language-Processing-with-AWS-AI-Services/tree/main/Chapter%2012</a>. Please use the instructions in the following sections, along with the code in the preceding repository, to build the solution.</p>
			<p>Check out the following video to see the Code in Action at <a href="https://bit.ly/3GrClSK">https://bit.ly/3GrClSK</a>.</p>
			<h1 id="_idParaDest-139"><a id="_idTextAnchor143"/>Introducing the automated claims processing use case</h1>
			<p>In the healthcare industry, there were approximately 6.1 billion medical claims submitted in 2018 according to the <em class="italic">2018 CAHQ index report</em> (<a href="https://www.caqh.org/sites/default/files/explorations/index/report/2018-index-report.pdf">https://www.caqh.org/sites/default/files/explorations/index/report/2018-index-report.pdf</a>), and this number is expected to continue rising in the upcoming years. </p>
			<p>Healthcare <a id="_idIndexMarker691"/>payer companies are constantly looking for efficient and cost-effective ways to process such volumes of claims in a scalable manner. With the current manual process of claim processing, it takes too much time to process these claims. So, healthcare companies are looking at AI and ML approaches to automating and digitizing these claims. Once they can digitize these, it becomes really easy to drive insights such as improving the population's overall health. Moreover, analyzing these claim documents might help you identify behaviors that can help prevent a medical condition from being developed. Also, healthcare payers are looking for a solution that is also compliant, such as <em class="italic">HIPAA-compliant</em>. For those of you outside the US, HIPAA is a healthcare-specific compliance law for the healthcare industry in the US.</p>
			<p>So, we now understand why automating claims is so important. Now, we will talk about how we can help you automate this pipeline using AWS AI services such as Amazon Textract to digitize the claim process. You can do this by extracting text from these scanned claim documents and verifying them using NLP, along with Amazon Comprehend Medical, to get some patient health insights from these claims.</p>
			<p>In this use case, our fictitious company, <em class="italic">LiveRight Holdings Private Limited</em>, is working with a healthcare insurance provider known as <em class="italic">AwakenLife</em> to process the claims that have been submitted by their insurance holders. These claims are mostly scanned images and most of their time and effort is spent on processing these claims since some of them are invalid. This leads to a loss to the organization. Since LiveRight has already been using <a id="_idIndexMarker692"/>Amazon Textract to automate, digitize, and further innovate their document processing workflows in the preceding chapters, they have recommended using <em class="italic">AwakenLife</em> so that they can use some of these AWS AI services to improve and automate their overall claims process. In this chapter, we will set up a simple AI-based workflow to validate the claims for AwakenLife, which can further reduce their overall processing time.</p>
			<p>This solution is highly cost-effective and scalable as these services are serverless and scale to process documents based on your need. In this chapter, we will walk you through the following architecture:</p>
			<div>
				<div id="_idContainer231" class="IMG---Figure">
					<img src="Images/B17528_12_01.jpg" alt="Figure 12.1 – Medical claim processing architecture for the notebook&#13;&#10;" width="1066" height="560"/>
				</div>
			</div>
			<p class="figure-caption">Figure 12.1 – Medical claim processing architecture for the notebook</p>
			<p>In the preceding diagram, we can see the following:</p>
			<ul>
				<li>You have your medical intake forms, which can be in image or PDF format, that are sent to Amazon Textract for digitization or text extraction.</li>
				<li>Amazon Textract extracts text from these highly unstructured medical intake documents.</li>
				<li>You must <em class="italic">postprocess </em>Amazon Textract's response to validate the claims. For this blog, we are using a ZIP code and claim ID to make sure the claims are valid. You can customize these validation rules based on your business case.</li>
				<li>Once the ZIP code and claim ID have been validated, valid data is sent to Amazon Comprehend Medical to gain insights and entities such as patient procedure.</li>
				<li>If the ZIP code and claim ID are not valid, an email is sent to the stakeholder, notifying them that it's an invalid claim.</li>
			</ul>
			<p>We will walk <a id="_idIndexMarker693"/>through the previous architecture using a Jupyter notebook. Once we've done this, we will cover an architecture on how to make this implementation automated using event-based lambda functions.</p>
			<p>In the next section, we will talk about how you can use Amazon Textract to extract data from medical intake forms.</p>
			<h1 id="_idParaDest-140"><a id="_idTextAnchor144"/>Understanding how to extract and validate data from medical intake forms</h1>
			<p>In this section, we will show you how to use Amazon Textract to extract key-value pairs or form <a id="_idIndexMarker694"/>data from a medical intake form. Then, using <a id="_idIndexMarker695"/>simple logic, you will verify <a id="_idIndexMarker696"/>whether the extracted values are valid or invalid.</p>
			<p>If you <a id="_idIndexMarker697"/>have not done so in the previous chapters, you <a id="_idIndexMarker698"/>will have to create an Amazon SageMaker Jupyter notebook and set up <strong class="bold">Identity and Access Management</strong> (<strong class="bold">IAM</strong>) permissions for that notebook role. By doing so, you will be able to access the AWS services we will use in this notebook. After that, you will need to clone this book's GitHub repository (<a href="https://github.com/PacktPublishing/Natural-Language-Processing-with-AWS-AI-Services">https://github.com/PacktPublishing/Natural-Language-Processing-with-AWS-AI-Services</a>), go to the <strong class="source-inline">Chapter 12</strong> folder, and open the <strong class="source-inline">ch 12 automating claims processing.ipynb</strong> notebook.</p>
			<p class="callout-heading">Note:</p>
			<p class="callout">Make <a id="_idIndexMarker699"/>sure that <a id="_idIndexMarker700"/>the IAM <a id="_idIndexMarker701"/>role in the notebook has <strong class="bold">AmazonSNSFullAccess</strong>,<strong class="bold"> AmazonComprehendMedicalFullAccess</strong>, and <strong class="bold">AmazonTextractFullAccess</strong>.</p>
			<p>Now, using <a id="_idIndexMarker702"/>this notebook, we will learn <a id="_idIndexMarker703"/>how to extract data using Textract <a id="_idIndexMarker704"/>APIs and validate them using some <a id="_idIndexMarker705"/>postprocessing logic via a sample medical intake form:</p>
			<ol>
				<li>We will use the following sample medical intake form to get started. Run the following code block to load the sample medical form, which is a valid medical form for claims:<p class="source-code">documentName = "validmedicalform.png"</p><p class="source-code">display(Image(filename=documentName))</p><p>You will see that the following medical intake form has been loaded:</p><div id="_idContainer232" class="IMG---Figure"><img src="Images/B17528_12_02.jpg" alt="Figure 12.2 – Sample valid medical intake form&#13;&#10;" width="740" height="758"/></div><p class="figure-caption">Figure 12.2 – Sample valid medical intake form</p><p>Now, we <a id="_idIndexMarker706"/>will <a id="_idIndexMarker707"/>extract <a id="_idIndexMarker708"/>the medical <a id="_idIndexMarker709"/>intake form's data by calling the Amazon Textract Analyze Document API with the Form feature enabled. This is a sync API and we covered it in detail in <a href="B17528_02_Final_SB_ePub.xhtml#_idTextAnchor027"><em class="italic">Chapter 2</em></a>, <em class="italic">Introducing Amazon Textract</em>. We have created a function that takes any document image as input and returns a Textract response. We will talk about how this function can be automated using a lambda function in the last section of this chapter, <em class="italic">Understanding how to create a serverless pipeline for medical claims</em>. Run the following notebook cell to execute this function:</p><p class="source-code">def calltextract(documentName): </p><p class="source-code">    client = boto3.client(service_name='textract',</p><p class="source-code">         region_name= 'us-east-1',</p><p class="source-code">         endpoint_url='https://textract.us-east-1.amazonaws.com')</p><p class="source-code">    with open(documentName, 'rb') as file:</p><p class="source-code">            img_test = file.read()</p><p class="source-code">            bytes_test = bytearray(img_test)</p><p class="source-code">            print('Image loaded', documentName)</p><p class="source-code">    response = client.analyze_document(Document={'Bytes': bytes_test}, FeatureTypes=['FORMS'])</p><p class="source-code">               return response</p></li>
				<li>With that, we've defined a Textract function. Now, we will call this function by passing the scanned medical intake form. We will get a Textract response back. Run the following cell:<p class="source-code">response= calltextract(documentName)</p><p class="source-code">print(response)</p><p>If the response from Textract is a success, you will get the following message, along with a JSON response with extracted data:</p><div id="_idContainer233" class="IMG---Figure"><img src="Images/B17528_12_03.jpg" alt="Figure 12.3 – Textract JSON response for the medical form&#13;&#10;" width="1327" height="436"/></div><p class="figure-caption">Figure 12.3 – Textract JSON response for the medical form</p><p>The preceding response contains a lot of information, such as geometry, pages, and text in document metadata.</p></li>
				<li>Now, we <a id="_idIndexMarker710"/>will create a function to parse <a id="_idIndexMarker711"/>form data or key-value text responses <a id="_idIndexMarker712"/>from this JSON response. We <a id="_idIndexMarker713"/>are using a Textract parser to parse this JSON response. Here, we have created a method that accepts a JSON response and uses a Textract parser to parse the form key values and return a key-value pair:<p class="source-code">from trp import Document</p><p class="source-code">def getformkeyvalue(response):</p><p class="source-code">    doc = Document(response)</p><p class="source-code">    key_map = {}</p><p class="source-code">    for page in doc.pages:</p><p class="source-code">        # Print fields</p><p class="source-code">        for field in page.form.fields:</p><p class="source-code">            if field is None or field.key is None or field.value is None:</p><p class="source-code">                continue</p><p class="source-code">            key_map[field.key.text] = field.value.text</p><p class="source-code">    return key_map</p></li>
				<li>Now, we <a id="_idIndexMarker714"/>will pass the Textract <a id="_idIndexMarker715"/>JSON response to the <strong class="source-inline">def getformkeyvalue(response)</strong> method to get the key-value pairs or <a id="_idIndexMarker716"/>form data from the Textract <a id="_idIndexMarker717"/>JSON response:<p class="source-code">get_form_keys = getformkeyvalue(response)</p><p class="source-code">print(get_form_keys)</p><p>You will get the following output:</p><div id="_idContainer234" class="IMG---Figure"><img src="Images/B17528_12_04.jpg" alt="Figure 12.4 – Parsed Textract form data from the JSON response&#13;&#10;" width="1349" height="122"/></div><p class="figure-caption">Figure 12.4 – Parsed Textract form data from the JSON response</p><p>All the form entries are extracted as key-value pairs.</p></li>
				<li>Now, we will check whether these key-value or form entries are valid using some defined business rules. For this book, we are checking for form validity based on a valid ZIP Code and Claim ID. You can also modify the validation code based on your business needs. We have created a method that accepts key-value pairs and checks whether the ZIP Code or ID Number information that has been extracted from Textract is valid. If it is valid, it will return the required ID, while if it is not valid, it will return a message stating that Claim ID and ZIP Code are not valid:<p class="source-code">def validate(body):</p><p class="source-code">    json_acceptable_string = body.replace("'", "\"")</p><p class="source-code">    json_data = json.loads(json_acceptable_string)</p><p class="source-code">    print(json_data)</p><p class="source-code">    zip = json_data['ZIP CODE']</p><p class="source-code">    id = json_data['ID NUMBER']</p><p class="source-code">    if(not zip.strip().isdigit()):</p><p class="source-code">        return False, id, "Zip code invalid"</p><p class="source-code">    length = len(id.strip())</p><p class="source-code">    if(length != 12):</p><p class="source-code">        return False, id, "Invalid claim Id"</p><p class="source-code">    return True, id, "Ok"</p></li>
				<li>Now, we <a id="_idIndexMarker718"/>will test this validation method <a id="_idIndexMarker719"/>for a valid medical form by sending <a id="_idIndexMarker720"/>the key-value pair we extracted <a id="_idIndexMarker721"/>from the <strong class="source-inline">getformdata(response)</strong> method:<p class="source-code">textract_json= json.dumps(get_form_keys,indent=2)</p><p class="source-code">res, formid, result = validate(textract_json)</p><p class="source-code">print(result)</p><p class="source-code">print(formid)</p></li>
				<li>Since it's a valid claim, both ZIP code and Claim ID are valid, and this method returns a true response (a valid response):</li>
			</ol>
			<div>
				<div id="_idContainer235" class="IMG---Figure">
					<img src="Images/B17528_12_05.jpg" alt="Figure 12.5 – Valid claim response&#13;&#10;" width="1353" height="166"/>
				</div>
			</div>
			<p class="figure-caption">Figure 12.5 – Valid claim response</p>
			<p>As you can see, we get an <strong class="source-inline">Ok</strong> response, along with the valid claim ID.</p>
			<p>Now, going back to the architecture, two things can happen:</p>
			<ul>
				<li>If the form is valid or the response from this method is <strong class="source-inline">Ok</strong>, we will send this data to Comprehend Medical to gain insights, as we will cover in the next section.</li>
				<li>If the <a id="_idIndexMarker722"/>form is invalid, we will notify the customer, using Amazon<strong class="bold"> Simple Notification Service</strong> (<strong class="bold">SNS</strong>), that this service is used to send email or phone notifications. We will cover this in the last section, <em class="italic">Understanding how to create a serverless pipeline for medical claims</em>.</li>
			</ul>
			<p>In this <a id="_idIndexMarker723"/>section, we covered how you can use <a id="_idIndexMarker724"/>the Amazon Textract Analyze Document <a id="_idIndexMarker725"/>API to extract the form values <a id="_idIndexMarker726"/>from a medical intake form. We also covered how you can validate a Textract response. </p>
			<p>Since the response is valid for the medical intake form, in the next section, we will show you how you can use Amazon Comprehend Medical to extract medical insights.</p>
			<h1 id="_idParaDest-141"><a id="_idTextAnchor145"/>Understanding clinical data with Amazon Comprehend Medical</h1>
			<p>In this section, we <a id="_idIndexMarker727"/>will talk about how you can use <strong class="bold">Amazon Comprehend Medical</strong> to gain insights from a valid medical intake form. We covered <a id="_idIndexMarker728"/>Amazon Comprehend's <a id="_idIndexMarker729"/>features in <a href="B17528_03_Final_SB_ePub.xhtml#_idTextAnchor049"><em class="italic">Chapter 3</em></a>, <em class="italic">Introducing Amazon Comprehend</em>. In this chapter, we will learn how to use the Amazon Comprehend Medical Entity API to extract entities such as <em class="italic">patient diagnosis</em> and PHI data types such as <em class="italic">claim ID</em> from the medical intake form. Let's get started: </p>
			<ol>
				<li value="1">Go back to your notebook and run the following cell to use the Comprehend Medical <strong class="source-inline">boto3</strong> API:<p class="source-code">comprehend = boto3.client(service_name='comprehendmedical')</p></li>
				<li>Now, we will use the <strong class="source-inline">comprehend.detect_entities_v2</strong> API (<a href="https://docs.aws.amazon.com/comprehend/latest/dg/API_medical_DetectEntitiesV2.html">https://docs.aws.amazon.com/comprehend/latest/dg/API_medical_DetectEntitiesV2.html</a>) to analyze the clinical text data from medical intake forms and return <a id="_idIndexMarker730"/>entities specific <a id="_idIndexMarker731"/>to the medical text, such as type or diagnosis. Run the following cell to see what entities we are going to get from the valid medical intake form:<p class="source-code">cm_json_data =  comprehend.detect_entities_v2(Text=textract_json)</p><p class="source-code">print("\nMedical Entities\n========")</p><p class="source-code">for entity in cm_json_data["Entities"]:</p><p class="source-code">    print("- {}".format(entity["Text"]))</p><p class="source-code">    print ("   Type: {}".format(entity["Type"]))</p><p class="source-code">    print ("   Category: {}".format(entity["Category"]))</p><p class="source-code">    if(entity["Traits"]):</p><p class="source-code">        print("   Traits:")</p><p class="source-code">        for trait in entity["Traits"]:</p><p class="source-code">            print ("    - {}".format(trait["Name"]))</p><p class="source-code">    print("\n")</p><p>You will get the following medical insights by using this API:</p><div id="_idContainer236" class="IMG---Figure"><img src="Images/B17528_12_06.jpg" alt="Figure 12.6 – Medical entities&#13;&#10;" width="460" height="549"/></div><p class="figure-caption">Figure 12.6 – Medical entities</p><p>It was <a id="_idIndexMarker732"/>able to determine <a id="_idIndexMarker733"/>the phone number and medical ID as PHI. If you have regulatory requirements, you can mask or redact these entity types easily as they have been correctly identified by this API.</p></li>
				<li>Now that we have extracted the entities, we will save this extracted data in Amazon S3 in a CSV file. For large-scale medical intake form processing, you would want to save all these insights in a CSV file, in an S3 bucket, and analyze them by using an analytics service such as <em class="italic">Amazon Athena</em>, which we covered in <a href="B17528_08_Final_SB_ePub.xhtml#_idTextAnchor106"><em class="italic">Chapter 8</em></a>, <em class="italic">Leveraging NLP to Monetize Your Media Content</em>. We have created a function that takes Comprehend Medical's response and validated ID from the medical intake form and saves it in Amazon S3. Run the following code:<p class="source-code">def printtocsv(cm_json_data,formid):       </p><p class="source-code">        entities = cm_json_data['Entities']</p><p class="source-code">        with open(TEMP_FILE, 'w') as csvfile: # 'w' will truncate the file</p><p class="source-code">            filewriter = csv.writer(csvfile, delimiter=',',</p><p class="source-code">                            quotechar='|', quoting=csv.QUOTE_MINIMAL)</p><p class="source-code">            filewriter.writerow([ 'ID','Category', 'Type', 'Text'])</p><p class="source-code">            for entity in entities:</p><p class="source-code">                filewriter.writerow([formid, entity['Category'], entity['Type'], entity['Text']])</p><p class="source-code">filename = "procedureresult/" + formid + ".csv"</p><p class="source-code"> S3Uploader.upload(TEMP_FILE, 's3://{}/{}'.format(bucket, prefix))</p></li>
				<li>Now, we <a id="_idIndexMarker734"/>will call the <strong class="source-inline">printtocsv(cm_json_data,formid)</strong> method by passing the JSON response <a id="_idIndexMarker735"/>from the Comprehend Medical Entity API and <strong class="source-inline">formid</strong> from the validation logic:<p class="source-code">printtocsv(cm_json_data,formid)</p><p>You will get the following response: </p><p class="source-code">"successfully parsed:procedureresult/a-184054-6661.csv"</p></li>
			</ol>
			<p>In this section, we covered how you can extract medical insights or entities using the Amazon Comprehend Medical API for valid claims from Amazon Textract. In the next section, we will <a id="_idIndexMarker736"/>take an invalid claim form and extract data using Amazon Textract and postprocess this data to check for validation. If it's not valid, we will show you how you can set up SNs to notify the stakeholder via email.</p>
			<h1 id="_idParaDest-142"><a id="_idTextAnchor146"/>Understanding invalid medical form processing with notifications</h1>
			<p>In this section, we will walk through the architecture specified in <em class="italic">Figure 12.1</em> when the claim is <a id="_idIndexMarker737"/>identified as invalid by Textract postprocessing. We will send the message to the stakeholder via Amazon SNS. Let's go back to the notebook:</p>
			<ol>
				<li value="1">In the notebook, we will start by loading the scanned medical intake form by running the following code:<p class="source-code">InvalidDocument = "invalidmedicalform.png"</p><p class="source-code">display(Image(filename=InvalidDocument))</p><p>You will get the following sample medical form, which we will check for invalid use cases:</p><div id="_idContainer237" class="IMG---Figure"><img src="Images/B17528_12_07.jpg" alt="Figure 12.7 – Medical intake invalid claim form&#13;&#10;" width="737" height="730"/></div><p class="figure-caption">Figure 12.7 – Medical intake invalid claim form</p><p>In this <a id="_idIndexMarker738"/>form, <strong class="bold">ZIP CODE</strong> and <strong class="bold">ID NUMBER</strong> have been entered incorrectly.</p></li>
				<li>Now, we will call the <strong class="source-inline">calltextract(document)</strong> function that we created in the previous section and pass this document to extract the text or data using the Amazon Textract Sync API. To do so, run the following code:<p class="source-code">response = calltextract(InvalidDocument)</p></li>
				<li>After this, we will call the <strong class="source-inline">getformdata(response)</strong> method that we defined <a id="_idIndexMarker739"/>in the previous sections, which takes Textract's response as input and returns the form's key-value data:<p class="source-code">get_form_keys = getformkeyvalue(response)</p><p class="source-code">print(get_form_keys)</p><p>You will get the following output:</p><div id="_idContainer238" class="IMG---Figure"><img src="Images/B17528_12_08.jpg" alt="Figure 12.8 – Extracted form data using Textract&#13;&#10;" width="1192" height="107"/></div><p class="figure-caption">Figure 12.8 – Extracted form data using Textract</p><p>Here, we get all the key-value pairs or form data.</p></li>
				<li>Now, we will check whether the extracted key-value pairs, such as <strong class="source-inline">ZIP CODE</strong> and <strong class="source-inline">ID NUMBER</strong>, are valid by sending this as input to the <strong class="source-inline">validate(body)</strong> method that we defined in the previous section. This method returns true if the content is valid but will return false if invalid claim data is submitted concerning <strong class="source-inline">ZIP CODE</strong> and <strong class="source-inline">ID NUMBER</strong>:<p class="source-code">textract_json= json.dumps(get_form_keys,indent=2)</p><p class="source-code">res, formid, result = validate(textract_json)</p><p class="source-code">print(result)</p><p class="source-code">print(formid)</p><p class="source-code">print(res)</p><p>You will get the following response:</p><div id="_idContainer239" class="IMG---Figure"><img src="Images/B17528_12_09.jpg" alt="Figure 12.9 – Invalid claim response&#13;&#10;" width="1188" height="171"/></div><p class="figure-caption">Figure 12.9 – Invalid claim response</p><p>The valid method returns an invalid claim and <strong class="source-inline">false</strong>, along with the invalid claim ID.</p></li>
				<li>Now, we <a id="_idIndexMarker740"/>want to notify the users that this claim is invalid. To do this, we will walk you through how you can set up <strong class="bold">Amazon SNS</strong> through the Amazon SNS console. Go to this link to create a topic where you will publish this invalid message: <a href="https://console.aws.amazon.com/sns/v3/home?region=us-east-1#/create-topic">https://console.aws.amazon.com/sns/v3/home?region=us-east-1#/create-topic</a>.</li>
				<li>For <strong class="bold">Name</strong>, enter <strong class="source-inline">invalid-claims-notify</strong>, as shown in the following screenshot:<div id="_idContainer240" class="IMG---Figure"><img src="Images/B17528_12_10.jpg" alt="Figure 12.10 – Creating a topic in the SNS AWS console&#13;&#10;" width="826" height="450"/></div><p class="figure-caption"> </p><p class="figure-caption">Figure 12.10 – Creating a topic in the SNS AWS console</p><p>Make sure you choose the <strong class="bold">Standard</strong> topic type.</p></li>
				<li>Scroll <a id="_idIndexMarker741"/>down and click on the <strong class="bold">Create topic</strong> button.</li>
				<li>After creating a topic, we must add subscribers or people who are going to subscribe to this topic for notifications by going to <a href="https://console.aws.amazon.com/sns/v3/home?region=us-east-1#/create-subscription">https://console.aws.amazon.com/sns/v3/home?region=us-east-1#/create-subscription</a>.</li>
				<li>Select your <strong class="bold">topic ARN</strong> from the drop-down menu, set <strong class="bold">Email</strong> for <strong class="bold">Protocol</strong>, and enter your email ID in the <strong class="bold">Endpoint</strong> box, as shown in the following screenshot:<div id="_idContainer241" class="IMG---Figure"><img src="Images/B17528_12_11.jpg" alt="Figure 12.11 – Subscribing to the topic via email&#13;&#10;" width="635" height="407"/></div><p class="figure-caption">Figure 12.11 – Subscribing to the topic via email</p><p>Scroll down and click on <strong class="bold">Create Subscription</strong>.</p></li>
				<li>An email <a id="_idIndexMarker742"/>will be sent to the address you just used to subscribe. Check your email or spam for an email from SNS with a form email ID of <strong class="bold">AWS Notification - Subscription Confirmation</strong> and click on <strong class="bold">Confirm Subscription</strong>.<p class="callout-heading">Note:</p><p class="callout">It's important to confirm the subscription; otherwise, you will not be notified.</p></li>
				<li>Now, go back to <a href="https://console.aws.amazon.com/sns/v3/home?region=us-east-1#/topics">https://console.aws.amazon.com/sns/v3/home?region=us-east-1#/topics</a> to copy the <strong class="bold">ARN</strong> topic we just created called <strong class="source-inline">invalid-claims-notify</strong>:<div id="_idContainer242" class="IMG---Figure"><img src="Images/B17528_12_12.jpg" alt="Figure 12.12 – Copying the topic's ARN from the AWS console&#13;&#10;" width="1066" height="252"/></div><p class="figure-caption">Figure 12.12 – Copying the topic's ARN from the AWS console</p></li>
				<li>After <a id="_idIndexMarker743"/>copying this ARN, go back to the notebook and paste it into the following notebook cell to load the SNS <strong class="source-inline">boto3</strong> client. Here, enter a topic:<p class="source-code">sns = boto3.client('sns')</p><p class="source-code">topicARN="&lt;Enter your topic arn&gt;"</p></li>
				<li>Now, we will convert the invalid message into a payload that we can publish to this topic:<p class="source-code">snsbody = "Content:" + str(textract_json) + "Reason:" + str(result)</p><p class="source-code">print(snsbody)</p></li>
				<li>Next, we will use the <strong class="source-inline">sns.publish</strong> Python <strong class="source-inline">boto3</strong> API (<a href="https://boto3.amazonaws.com/v1/documentation/api/latest/reference/services/sns.html#SNS.Client.publish">https://boto3.amazonaws.com/v1/documentation/api/latest/reference/services/sns.html#SNS.Client.publish</a>) to send an invalid email message in the body to the registered email:<p class="source-code">try:</p><p class="source-code">    response = sns.publish(</p><p class="source-code">                    TargetArn = topicARN,</p><p class="source-code">                    Message= snsbody</p><p class="source-code">    )</p><p class="source-code">    print(response)</p><p class="source-code">except Exception as e:</p><p class="source-code">        print("Failed while doing validation")</p><p class="source-code">        print(e.message)</p><p>You will get the following response:</p><div id="_idContainer243" class="IMG---Figure"><img src="Images/B17528_12_13.jpg" alt="Figure 12.13 – Pushing the invalid claim message to the topic&#13;&#10;" width="1195" height="70"/></div><p class="figure-caption">Figure 12.13 – Pushing the invalid claim message to the topic</p></li>
				<li>Check the <a id="_idIndexMarker744"/>email address you subscribed with for an email notifying you of invalid medical claims:</li>
			</ol>
			<div>
				<div id="_idContainer244" class="IMG---Figure">
					<img src="Images/B17528_12_14.jpg" alt="Figure 12.14 – Email notification sent&#13;&#10;" width="522" height="337"/>
				</div>
			</div>
			<p class="figure-caption">Figure 12.14 – Email notification sent</p>
			<p>You can always opt out of the topic you have created.</p>
			<p>In this section, we covered how to process a medical claim using Amazon Textract, check for invalid medical claims, and notify the stakeholders about this. Next, we'll learn how to create a serverless pipeline for medical claims.</p>
			<h1 id="_idParaDest-143"><a id="_idTextAnchor147"/>Understanding how to create a serverless pipeline for medical claims</h1>
			<p>In the previous sections, we covered the building blocks of the architecture by using the Amazon Textract Sync API, the Amazon Comprehend Medical Detect Entities Sync API, and Amazon <a id="_idIndexMarker745"/>SNS to send invalid claims. We defined functions for this workflow and called the text extraction and validation <a id="_idIndexMarker746"/>functions to showcase the use case or workflow with both a valid and invalid medical claim form. These functions can be moved into lambda code and, along with <strong class="bold">S3 event notifications</strong>, can be invoked to create a scalable pipeline for medical claims processing. We can do this by using the following architecture:</p>
			<div>
				<div id="_idContainer245" class="IMG---Figure">
					<img src="Images/B17528_12_15.jpg" alt="Figure 12.15 – Automating an architecture for scale with AWS Lambda&#13;&#10;" width="1036" height="680"/>
				</div>
			</div>
			<p class="figure-caption">Figure 12.15 – Automating an architecture for scale with AWS Lambda</p>
			<p>We walked through a Jupyter notebook showing individual code components for processing medical claims using a single intake form. We created Python functions to extract data, validate data, gather insights, and convert those insights into CSV files. To process millions of such documents, we will learn how to make the code functions AWS Lambda functions <a id="_idIndexMarker747"/>to create an end-to-end <a id="_idIndexMarker748"/>automated serverless architecture using the preceding diagram. The medical claims form we'll be using has been dropped into an Amazon S3 bucket by payers of <em class="italic">AwakenLife Ltd</em>:</p>
			<ul>
				<li>Amazon S3 claims that the upload creates an Amazon S3 event notification, which triggers the lambda function. </li>
				<li>In this lambda, you can call the <strong class="source-inline">textract</strong> function we defined in the <em class="italic">Understanding how to extract and validate data from medical intake forms</em> section and call Amazon Textract by passing this image as input.</li>
				<li>You get a text response back. This extracted text can be sent to the <strong class="source-inline">validation</strong> function we defined in the previous section. </li>
				<li>For valid claims, valid claim data is sent to Amazon Comprehend Medical to extract insights. Extracted insights are sent back to AWS Lambda. </li>
				<li>You can move the code for the <strong class="source-inline">printtocsv</strong> (<strong class="source-inline">cm_json_data</strong>, <strong class="source-inline">formid</strong>) function, which we defined in the <em class="italic">Understanding clinical data with Amazon Comprehend Medical</em> section, to this lambda function to convert this extracted insight into a CSV file and save it to Amazon S3.</li>
				<li>For invalid claims, you can use SNS to notify the stakeholders.</li>
			</ul>
			<p>We can use scale and process medical claims documents at a large scale with just a few lines of code. This <a id="_idIndexMarker749"/>architecture can be quickly automated and deployed in the form of a <em class="italic">CloudFormation template</em>, which lets you set up <strong class="bold">Infrastructure as Code</strong> (<strong class="bold">IaC</strong>). We have provided a similar scalable implementation in the form of a blog in the <em class="italic">Further reading</em> section if you're interested. </p>
			<p>In this section, we covered how to use the code we defined in the previous sections and move that to an AWS Lambda section to architect an end-to-end automated workflow using a walkthrough architecture. Now, let's summarize this chapter.</p>
			<h1 id="_idParaDest-144"><a id="_idTextAnchor148"/>Summary</h1>
			<p>In this chapter, we introduced the medical claim processing use case. We then covered how you can use AWS AI services such as Amazon Textract to extract form data from these scanned medical forms. Then, we spoke about how you can perform some postprocessing on the extracted text based on your business rules to validate their form data. Once the form data had been validated, we showed you how to use Amazon Comprehend Medical, as covered in <a href="B17528_03_Final_SB_ePub.xhtml#_idTextAnchor049"><em class="italic">Chapter 3</em></a>, <em class="italic">Introducing Amazon Comprehend</em>, to extract medical insights. Once you have medical insights, this data can be converted into a CSV file and saved in Amazon S3. Once you've done this, you can analyze this data for population health analytics by using <strong class="bold">Amazon Athena</strong> or <strong class="bold">Amazon QuickSight</strong>. We also discussed how to handle invalid claims processing by showing how to quickly configure Amazon SNS through the AWS console and add subscribers. You can notify your subscribers by email regarding the medical claims that have been submitted as invalid.</p>
			<p>Lastly, we showed you how to architect a serverless scalable solution using AWS Lambda to call these Textract Sync and Amazon Comprehend Medical Sync APIs. This ensures that you have an end-to-end working automated architecture with the claim documents you uploaded in Amazon S3.</p>
			<p>In the next chapter, we will cover how to improve the accuracy of your existing document processing workflows using <em class="italic">Amazon Augmented AI</em> with the human-in-the-loop process. We will also deep dive into aspects of why you need a human-in-the-loop process and how it helps improve the accuracy of your existing AI predictions.</p>
			<h1 id="_idParaDest-145"><a id="_idTextAnchor149"/>Further reading</h1>
			<p>To learn more about the topics that were covered in this chapter, take a look at the following resource:</p>
			<ul>
				<li><em class="italic">Automating claims adjudication workflows using Amazon Textract and Amazon Comprehend Medical</em>, by Sonali Sahu and Ujjwal Ratan (<a href="https://aws.amazon.com/blogs/industries/automating-claims-adjudication-workflows-using-amazon-textract-and-amazon-comprehend-medical/">https://aws.amazon.com/blogs/industries/automating-claims-adjudication-workflows-using-amazon-textract-and-amazon-comprehend-medical/</a>) </li>
			</ul>
		</div>
	</div></body></html>