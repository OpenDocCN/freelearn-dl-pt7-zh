<html><head></head><body>
		<div id="_idContainer101">
			<h1 id="_idParaDest-68" class="chapter-number"><a id="_idTextAnchor067"/>5</h1>
			<h1 id="_idParaDest-69"><a id="_idTextAnchor068"/>Building a Contact Center Analytics Solution</h1>
			<p> In our previous chapter, we addressed the challenge of managing scattered information across multiple documents. We explored how Azure OpenAI simplifies the process of finding relevant content by setting up tools in the Azure portal and utilizing Python code to organize documents into a searchable format. With Azure OpenAI’s assistance, we efficiently tackled specific challenges, transforming chaos into order and streamlining <span class="No-Break">content search.</span></p>
			<p>In this chapter, we’re delving into the construction of a contact center analytics solution. We’ll outline the challenges, technical needs, and design essentials for this endeavor. Our aim is to showcase the integration of Azure OpenAI and Azure Communication Services to build an advanced analytics platform. By mastering these concepts, you will learn how to enhance contact center operations and utilize AI and communication <span class="No-Break">tech efficiently.</span></p>
			<p>Specifically, in this chapter, we will cover the <span class="No-Break">following topics:</span></p>
			<ul>
				<li>Problem <span class="No-Break">statement introduction</span></li>
				<li><span class="No-Break">Architecture design</span></li>
				<li>Building a contact center analytics solution using Azure OpenAI and Azure <span class="No-Break">Communication Services</span></li>
			</ul>
			<h1 id="_idParaDest-70"><a id="_idTextAnchor069"/>Problem statement introduction</h1>
			<p>Imagine you’re running a food delivery app in your city, overseeing a dedicated team of 10 members handling customer queries. As more people use the app, the number of customer chats skyrockets. Navigating through millions of these chats has become a major challenge for your team, making it tough to address customer issues during the food delivery process. The sheer volume of data is making it hard to pinpoint problems within the app or the delivery process overall. On top of that, the uncertainty about what steps to take next in app development is making things even more complicated. It’s becoming increasingly crucial to efficiently manage and understand all this chat data, spot app and process issues, and figure out the next steps for development to keep your food delivery <span class="No-Break">platform successful.</span></p>
			<h1 id="_idParaDest-71"><a id="_idTextAnchor070"/>Technical requirements</h1>
			<p>To follow along with the practical exercises in this chapter, access the source code available in this chapter's GitHub repository <span class="No-Break">at </span><a href="https://github.com/PacktPublishing/Azure-OpenAI-Essentials/blob/main/Chapter5.ipynb"><span class="No-Break">https://github.com/PacktPublishing/Azure-OpenAI-Essentials/blob/main/Chapter5.ipynb</span></a></p>
			<p>The following are the requirements that we already configured in <a href="B21019_04.xhtml#_idTextAnchor059"><span class="No-Break"><em class="italic">Chapter 4</em></span></a><span class="No-Break">:</span></p>
			<ul>
				<li>Python 3.9, 3.10, or <span class="No-Break">3.11: </span><a href="https://www.python.org/downloads/"><span class="No-Break">https://www.python.org/downloads/</span></a></li>
				<li>Azure Developer <span class="No-Break">CLI: </span><a href="https://learn.microsoft.com/en-us/azure/developer/azure-developer-cli/install-azd"><span class="No-Break">https://learn.microsoft.com/en-us/azure/developer/azure-developer-cli/install-azd</span></a></li>
				<li>Node.js <span class="No-Break">14+: </span><a href="https://nodejs.org/en/download"><span class="No-Break">https://nodejs.org/en/download</span></a></li>
				<li><span class="No-Break">Git: </span><a href="https://git-scm.com/downloads"><span class="No-Break">https://git-scm.com/downloads</span></a></li>
				<li>Powershell 7+ (<span class="No-Break">pwsh): </span><a href="https://github.com/powershell/powershell"><span class="No-Break">https://github.com/powershell/powershell</span></a></li>
				<li>Azure account: If you’re new to Azure, get an Azure account for free and you’ll get some free Azure credits to <span class="No-Break">get started</span></li>
				<li>Azure subscription with access enabled for Azure OpenAI Service: You can request access <span class="No-Break">at </span><a href="https://aka.ms/oaiapply"><span class="No-Break">https://aka.ms/oaiapply</span></a></li>
				<li>Azure OpenAI connection and <span class="No-Break">model information:</span><ul><li>OpenAI <span class="No-Break">API key</span></li><li>OpenAI embedding model <span class="No-Break">deployment name</span></li><li>OpenAI <span class="No-Break">API version</span></li></ul></li>
			</ul>
			<p>Only the following additional technical requirement is needed beyond those specified in <a href="B21019_04.xhtml#_idTextAnchor059"><span class="No-Break"><em class="italic">Chapter 4</em></span></a><span class="No-Break">:</span></p>
			<ul>
				<li>Azure <span class="No-Break">Communication Services</span></li>
			</ul>
			<p>Just a quick reminder, make sure you’ve got an active Azure account, as we discussed in <a href="B21019_04.xhtml#_idTextAnchor059"><span class="No-Break"><em class="italic">Chapter 4</em></span></a>. If you need guidance on setting up your Azure account and activating a subscription, you can find all the details in <a href="B21019_04.xhtml#_idTextAnchor059"><span class="No-Break"><em class="italic">Chapter 4</em></span></a><span class="No-Break">.</span></p>
			<h1 id="_idParaDest-72"><a id="_idTextAnchor071"/>Architecture design</h1>
			<p>Now<a id="_idIndexMarker313"/> that we’ve got a handle on the key architectural elements needed for crafting our solution, let’s look at putting these pieces together in the Azure portal. We covered the successful deployment of an Azure OpenAI Service model, whether it’s GPT-3, ChatGPT, or GPT-4, in the previous chapters. In this chapter, we’re shifting our focus to creating a brand-new Azure Communication Services. Now, let’s dive into the details and start putting this plan <span class="No-Break">into action.</span></p>
			<p>First, we’re going to manually send a bunch of messages to Azure Communication Services. After that, we’ll grab those messages from the same place and use them to make a prompt. This prompt is then going to be sent over to the OpenAI service, and it will give us the summary we need. It’s a hands-on process to make our communication smoother and get important insights for our food <span class="No-Break">delivery app.</span></p>
			<h1 id="_idParaDest-73"><a id="_idTextAnchor072"/>Building a contact center analytics solution using Azure OpenAI and other Azure services</h1>
			<p>Just a quick reminder, make <a id="_idIndexMarker314"/>sure you’ve got an active Azure account, as we discussed in <a href="B21019_04.xhtml#_idTextAnchor059"><span class="No-Break"><em class="italic">Chapter 4</em></span></a>. If you need guidance on setting up your Azure account and activating a subscription, you can find all the details in <a href="B21019_04.xhtml#_idTextAnchor059"><span class="No-Break"><em class="italic">Chapter 4</em></span></a><span class="No-Break">.</span></p>
			<h2 id="_idParaDest-74"><a id="_idTextAnchor073"/>Azure subscription prerequisites</h2>
			<p>The<a id="_idIndexMarker315"/> following prerequisites were established in <a href="B21019_02.xhtml#_idTextAnchor023"><span class="No-Break"><em class="italic">Chapter 2</em></span></a> and can <span class="No-Break">be reused:</span></p>
			<ul>
				<li>An <span class="No-Break">Azure subscription</span></li>
				<li>Azure <span class="No-Break">OpenAI resource</span></li>
				<li>Deployed Azure <span class="No-Break">OpenAI models</span></li>
			</ul>
			<p>Create the following tools, excluding those already established in <a href="B21019_02.xhtml#_idTextAnchor023"><span class="No-Break"><em class="italic">Chapter 2</em></span></a><span class="No-Break">.</span></p>
			<p>In this section, your focus will shift to the creation of a new Azure <span class="No-Break">Communication Services.</span></p>
			<p>To set up your Azure Communication Services service, head to the search bar at the top navigation on the Azure home page and type in <span class="No-Break"><strong class="source-inline">Communication Service</strong></span><span class="No-Break">.</span></p>
			<p>If you don’t see it, click on <strong class="bold">Create a resource</strong>, then in the <strong class="bold">Marketplace</strong>, search for <strong class="source-inline">Communication Service</strong> and click <span class="No-Break">on </span><span class="No-Break"><strong class="bold">Create</strong></span><span class="No-Break">:</span></p>
			<div>
				<div id="_idContainer094" class="IMG---Figure">
					<img src="image/B21019_05_1.jpg" alt="Figure 5.1: Create a resource"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 5.1: Create a resource</p>
			<p>Once you <a id="_idIndexMarker316"/>click on <strong class="bold">Create</strong>, you get the option to select from the list of services. Select <strong class="bold">Communication Services</strong> from the dropdown, as <span class="No-Break">shown here:</span></p>
			<div>
				<div id="_idContainer095" class="IMG---Figure">
					<img src="image/B21019_05_2.jpg" alt="Figure 5.2: Selecting Communication Services"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 5.2: Selecting Communication Services</p>
			<p>Once you land on the <strong class="bold">Communication Services</strong> page, you need to click on the <strong class="bold">Create</strong> button, as <span class="No-Break">shown here:</span></p>
			<div>
				<div id="_idContainer096" class="IMG---Figure">
					<img src="image/B21019_05_3.jpg" alt="Figure 5.3: Create under Communication Services"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 5.3: Create under Communication Services</p>
			<p>Once you’ve <a id="_idIndexMarker317"/>successfully created the Communication Service from the Marketplace, move on to the next step. On the <strong class="bold">Create resource</strong> form, choose the subscription and resource group (<strong class="source-inline">azure-openai-rg</strong>) that you set up back in <a href="B21019_04.xhtml#_idTextAnchor059"><span class="No-Break"><em class="italic">Chapter 4</em></span></a>. It’s about connecting the dots to make sure everything <span class="No-Break">aligns smoothly.</span></p>
			<div>
				<div id="_idContainer097" class="IMG---Figure">
					<img src="image/B21019_05_4.jpg" alt="Figure 5.4: Entering Communication Services data"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 5.4: Entering Communication Services data</p>
			<p>Now, enter your desired resource name (for example, <strong class="source-inline">azure-openai-communication-service</strong>) and data location for Communication Services, and click on the <strong class="bold">Next</strong> button to go to the <strong class="bold">Tags</strong> tab. You can ignore the <strong class="bold">Tags</strong> section for now. Tags are name/value pairs that allow you to categorize resources and facilitate consolidated <a id="_idIndexMarker318"/>billing by applying the same tag to multiple search and resource groups. Proceed by clicking <strong class="bold">Next</strong> and then go to the <strong class="bold">Review + Create</strong> tab. Here, it will display the details you chose in the previous steps. Review all the information and click on the <span class="No-Break"><strong class="bold">Create</strong></span><span class="No-Break"> button:</span></p>
			<div>
				<div id="_idContainer098" class="IMG---Figure">
					<img src="image/B21019_05_5.jpg" alt="Figure 5.5: Reviewing and creating data"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 5.5: Reviewing and creating data</p>
			<p>Now, we’ll move on to building a solution using the services that <span class="No-Break">we configured.</span></p>
			<h2 id="_idParaDest-75"><a id="_idTextAnchor074"/>Building a solution using Azure Communication Services and OpenAI Service</h2>
			<p>Now that we<a id="_idIndexMarker319"/> have set up all the essential services in our Azure portal, we can begin constructing our solution. To develop the code, I will be working within the Python Jupyter notebook, and the remaining installations are the same as those defined in <a href="B21019_04.xhtml#_idTextAnchor059"><span class="No-Break"><em class="italic">Chapter 4</em></span></a>’s Solution Using Azure <span class="No-Break">OpenAI section.</span></p>
			<p>You will need to install one extra Python library for this code other than those installed in <a href="B21019_04.xhtml#_idTextAnchor059"><span class="No-Break"><em class="italic">Chapter 4</em></span></a><span class="No-Break">.</span></p>
			<p>Create a new Juypter notebook and install the <span class="No-Break">following package:</span></p>
			<pre class="console">
pip install openai azure.communication.chat azure.communication.identity</pre>			<p>Our code <a id="_idIndexMarker320"/>includes the following sections in which we are going to develop <span class="No-Break">our solution:</span></p>
			<ol>
				<li><span class="No-Break">Importing packages</span></li>
				<li>Establishing chat <span class="No-Break">user identities</span></li>
				<li>Configuring the <span class="No-Break">chat client</span></li>
				<li>Generating a <span class="No-Break">conversation transcript</span></li>
				<li>Summarizing the <span class="No-Break">chat thread</span></li>
			</ol>
			<h3>Importing packages</h3>
			<p>We will import all <a id="_idIndexMarker321"/>the packages that are required to build <span class="No-Break">the model:</span></p>
			<pre class="source-code">
from azure.communication.chat import ChatClient, CommunicationTokenCredential, ChatMessageType,ChatParticipant
from azure.communication.identity import CommunicationIdentityClient, CommunicationUserIdentifier
from datetime import datetime
from datetime import datetime, timedelta
import os
import requests
import json
import openai</pre>			<p>You can see a variety of libraries in the preceding code. Let’s delve into each of these libraries in<a id="_idIndexMarker322"/> the <span class="No-Break">table here:</span></p>
			<table id="table001-3" class="No-Table-Style _idGenTablePara-1">
				<colgroup>
					<col/>
					<col/>
				</colgroup>
				<thead>
					<tr class="No-Table-Style">
						<td class="No-Table-Style T---Body">
							<p><span class="No-Break"><strong class="bold">Imported Packages</strong></span></p>
						</td>
						<td class="No-Table-Style T---Body">
							<p><span class="No-Break"><strong class="bold">Description</strong></span></p>
						</td>
					</tr>
				</thead>
				<tbody>
					<tr class="No-Table-Style">
						<td class="No-Table-Style T---Body">
							<p><strong class="source-inline">from azure.communication.chat import ChatClient, CommunicationTokenCredential, </strong><span class="No-Break"><strong class="source-inline">ChatMessageType, ChatParticipant</strong></span></p>
						</td>
						<td class="No-Table-Style T---Body">
							<p>Enables real-time chat with Azure <span class="No-Break">Communication Services</span></p>
						</td>
					</tr>
					<tr class="No-Table-Style">
						<td class="No-Table-Style T---Body">
							<p><strong class="source-inline">from azure.communication.identity import </strong><span class="No-Break"><strong class="source-inline">CommunicationIdentityClient, CommunicationUserIdentifier</strong></span></p>
						</td>
						<td class="No-Table-Style T---Body">
							<p>Manages user identities and <span class="No-Break">authentication tokens</span></p>
						</td>
					</tr>
					<tr class="No-Table-Style">
						<td class="No-Table-Style T---Body">
							<p><strong class="source-inline">from datetime import </strong><span class="No-Break"><strong class="source-inline">datetime, timedelta</strong></span></p>
						</td>
						<td class="No-Table-Style T---Body">
							<p>Handles date and <span class="No-Break">time operations</span></p>
						</td>
					</tr>
					<tr class="No-Table-Style">
						<td class="No-Table-Style T---Body">
							<p><span class="No-Break"><strong class="source-inline">import os</strong></span></p>
						</td>
						<td class="No-Table-Style T---Body">
							<p>Interacts with the operating system and manages <span class="No-Break">environment variables</span></p>
						</td>
					</tr>
					<tr class="No-Table-Style">
						<td class="No-Table-Style T---Body">
							<p><span class="No-Break"><strong class="source-inline">import requests</strong></span></p>
						</td>
						<td class="No-Table-Style T---Body">
							<p>Makes HTTP requests, commonly used for <span class="No-Break">API interaction</span></p>
						</td>
					</tr>
					<tr class="No-Table-Style">
						<td class="No-Table-Style T---Body">
							<p><span class="No-Break"><strong class="source-inline">import json</strong></span></p>
						</td>
						<td class="No-Table-Style T---Body">
							<p>Encodes and decodes <span class="No-Break">JSON data</span></p>
						</td>
					</tr>
					<tr class="No-Table-Style">
						<td class="No-Table-Style T---Body">
							<p><span class="No-Break"><strong class="source-inline">import openai</strong></span></p>
						</td>
						<td class="No-Table-Style T---Body">
							<p>Accesses the OpenAI API for advanced <span class="No-Break">language processing</span></p>
						</td>
					</tr>
					<tr class="No-Table-Style">
						<td class="No-Table-Style T---Body">
							<p><span class="No-Break"><strong class="source-inline">dotenv</strong></span></p>
						</td>
						<td class="No-Table-Style T---Body">
							<p>Loads environment variables from a <strong class="source-inline">.</strong><span class="No-Break"><strong class="source-inline">env</strong></span><span class="No-Break"> file</span></p>
						</td>
					</tr>
				</tbody>
			</table>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Table 5.1: Explanation of imported packages</p>
			<p>Now, let’s initialize all the necessary constants using the keys provided in the <strong class="source-inline">.env</strong> file. Add <strong class="source-inline">COMMUNICATION_CONNECTION_STRING</strong> and <strong class="source-inline">COMMUNICATION_ENDPOINT</strong> to your already existing <strong class="source-inline">.</strong><span class="No-Break"><strong class="source-inline">env</strong></span><span class="No-Break"> file:</span></p>
			<pre class="source-code">
# Azure
load_dotenv()
OPENAI_API_KEY = os.getenv("OPENAI_API_KEY")
OPENAI_DEPLOYMENT_ENDPOINT = os.getenv("OPENAI_DEPLOYMENT_ENDPOINT")
OPENAI_DEPLOYMENT_NAME = os.getenv("OPENAI_DEPLOYMENT_NAME")
OPENAI_MODEL_NAME = os.getenv("OPENAI_MODEL_NAME")
OPENAI_API_VERSION = os.getenv("OPENAI_API_VERSION")
OPENAI_DEPLOYMENT_VERSION = os.getenv("OPENAI_DEPLOYMENT_VERSION")
## Azure Communication Service
COMMUNICATION_CONNECTION_STRING = os.getenv(
     "COMMUNICATION_CONNECTION_STRING")
COMMUNICATION_ENDPOINT = os.getenv("COMMUNICATION_ENDPOINT")
#init Azure OpenAI
openai.api_type = "azure"
openai.api_version = OPENAI_DEPLOYMENT_VERSION
openai.api_base = OPENAI_DEPLOYMENT_ENDPOINT
openai.api_key = OPENAI_API_KEY
load_dotenv()</pre>			<p>Add these <a id="_idIndexMarker323"/>to the <strong class="source-inline">.env</strong> file that was created in <a href="B21019_04.xhtml#_idTextAnchor059"><span class="No-Break"><em class="italic">Chapter 4</em></span></a> with the connection string <span class="No-Break">and endpoints:</span></p>
			<pre class="source-code">
COMMUNICATION_CONNECTION_STRING = "{communication-service-connection-string}"
COMMUNICATION_ENDPOINT = "{communication-serivce-endpoint}"</pre>			<p>Follow these steps to set up the Communication <span class="No-Break">Service endpoint:</span></p>
			<ol>
				<li>Update the <strong class="source-inline">COMMUNICATION_CONNECTION_STRING</strong> value with the connection string value found in your Azure Communication Service under the <span class="No-Break"><strong class="bold">Keys</strong></span><span class="No-Break"> section.</span></li>
				<li>Similarly, modify the values of <strong class="source-inline">COMMUNICATION_ENDPOINT</strong> with the value found in your Azure Communication Service under the <span class="No-Break"><strong class="bold">Keys</strong></span><span class="No-Break"> section.</span></li>
			</ol>
			<p>By completing<a id="_idIndexMarker324"/> these configurations, you’ll have the necessary connection settings for <span class="No-Break">your resources.</span></p>
			<p>We get the <span class="No-Break">following output:</span></p>
			<pre class="source-code">
Out[15]:    True</pre>			<h3>Establishing chat user identities</h3>
			<p>This code <a id="_idIndexMarker325"/>establishes user identities (<strong class="source-inline">identity1</strong> and <strong class="source-inline">identity2</strong>) in Azure Communication Services and retrieves individual access tokens (<strong class="source-inline">token_result1</strong> <span class="No-Break">and </span><span class="No-Break"><strong class="source-inline">token_result2</strong></span><span class="No-Break">):</span></p>
			<pre class="source-code">
client = CommunicationIdentityClient.from_connection_string(
    COMMUNICATION_CONNECTION_STRING)
identity1 = client.create_user()
token_result1 = client.get_token(identity1, ["chat"])
identity2 = client.create_user()
token_result2 = client.get_token(identity2, ["chat"])</pre>			<p>These tokens are designed for authentication purposes when engaging with the chat functionality of Azure Communication Services. Each user identity is linked to a distinct token, granting access specifically to the defined scope, which, in this instance, <span class="No-Break">is </span><span class="No-Break"><strong class="source-inline">chat</strong></span><span class="No-Break">.</span></p>
			<h3>Configuring the chat client</h3>
			<p>In this code, we<a id="_idIndexMarker326"/> establish a chat thread between <strong class="source-inline">Agent</strong> and <strong class="source-inline">Customer</strong> using Azure <span class="No-Break">Communication Services:</span></p>
			<pre class="source-code">
Agent  = ChatParticipant(identifier=identity1, display_name="Agent", share_history_time=datetime.utcnow())
Customer  = ChatParticipant(identifier=identity2, display_name="Customer", share_history_time=datetime.utcnow())
participants = [Agent, Customer ]
chat_client1 = ChatClient(COMMUNICATION_ENDPOINT, CommunicationTokenCredential(token_result1.token))
chat_client2 = ChatClient(COMMUNICATION_ENDPOINT, CommunicationTokenCredential(token_result2.token))
topic="Support conversation"
create_chat_thread_result = chat_client1.create_chat_thread(topic, thread_participants=participants)
chat_thread_client1 = chat_client1.get_chat_thread_client(create_chat_thread_result.chat_thread.id)
chat_thread_client2 = chat_client2.get_chat_thread_client(create_chat_thread_result.chat_thread.id)</pre>			<p>The chat clients are initialized for each user, and a chat thread is created with specified participants and a topic, allowing for subsequent interaction and messaging within the <span class="No-Break">created thread.</span></p>
			<p>We will now <a id="_idIndexMarker327"/>populate the chat thread with a sample conversation between the agent <span class="No-Break">and customer:</span></p>
			<pre class="source-code">
agentText = [
    "Thank you for reaching out to our customer support! How can I assist you with your food delivery today?"
    "I'm sorry to hear that. Could you provide me with your name and order number so I can check your details and assist you better?"
    "Thanks. Can you please share more details about the issue you're facing with your food delivery?"
    "I understand. It can be frustrating. Can you check if the delivery address is correct and accessible? Also, ensure that your contact details are up to date."
    "Alright. Please verify the delivery address and ensure there are no obstacles for our delivery team. Let me know if the issue persists."
    "That might be causing the delay. Can you confirm the delivery address and try placing the order again?"
    "Great to hear that! Is there anything else I can help you with regarding your food delivery?"
    "You're welcome. Feel free to reach out if you have any more questions. Enjoy your meal!"
]
customerText = [
    "Hi, I'm having an issue with my food delivery. It hasn't arrived yet."
    "Yes, my name is John, and my order number is."
    "Well, it seems like my food hasn't been delivered on time. What could be the issue?"
    "I've checked the delivery address, and it's correct. Also, my phone is working fine."
    "Okay, let me check. Yes, it seems like there's a small issue with the delivery address. Let me correct that."
    "Sure, let me try that. Alright, I've updated the delivery address. Can you check the status now?"
    "No, that's all. Thanks for your help. Looking forward to my meal!"
    "Goodbye."
]</pre>			<p>Next, this<a id="_idIndexMarker328"/> code uses a <strong class="source-inline">for</strong> loop to simulate a back-and-forth conversation between an agent and a customer by sending messages to a <span class="No-Break">chat thread:</span></p>
			<pre class="source-code">
for x in range(len(agentText)):
chat_thread_client1.send_message(content= agentText[x], sender_display_name="Agent", chat_message_type=ChatMessageType.TEXT)
chat_thread_client2.send_message(content= customerText[x], sender_display_name="Customer", chat_message_type=ChatMessageType.TEXT)</pre>			<p>The messages address troubleshooting steps for a dishwasher issue, and the conversation flow alternates between the agent and <span class="No-Break">customer perspectives.</span></p>
			<h2 id="_idParaDest-76"><a id="_idTextAnchor075"/>Generating a conversation transcript</h2>
			<p>This<a id="_idIndexMarker329"/> code retrieves text messages from a chat thread that was sent within the last day, filters out non-text messages, and constructs a conversation prompt by concatenating sender names and message content. The prompt is then printed, providing a summary of the recent conversation in reverse <span class="No-Break">chronological order:</span></p>
			<pre class="source-code">
start_time = datetime.utcnow() - timedelta(days=1)
messages = []
chat_messages = chat_thread_client1.list_messages(results_per_page=1, start_time=start_time)
for chat_message_page in chat_messages.by_page():
     for chat_message in chat_message_page:
          if(chat_message.type == ChatMessageType.TEXT):
                 messages.append(chat_message)
# didn't know I had to filter out other messages
prompt = ""
for m in range(len(messages)-1, -1, -1):
     prompt = prompt + messages[m].sender_display_name + ": " + messages[m].content.message + "\n"
print(prompt)</pre>			<p>We get the<a id="_idIndexMarker330"/> <span class="No-Break">following output:</span></p>
			<div>
				<div id="_idContainer099" class="IMG---Figure">
					<img src="image/B21019_05_6.jpg" alt="Figure 5.6: An overview of the conversation output"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 5.6: An overview of the conversation output</p>
			<h3>Summarizing the chat thread</h3>
			<p>This<a id="_idIndexMarker331"/> code utilizes OpenAI’s GPT model to generate an extended response based on a provided prompt, which includes an introductory text and a conversation prompt. The generated summarized text is then processed and printed along with the <span class="No-Break">original prompt:</span></p>
			<pre class="source-code">
# Send a completion call to generate an answer
start_phrase = 'For the following conversation, extract a topic, summary, highlights (1-3 bullet points of key information) and the sentiment of both of the users.\n\n' + prompt
response = openai.Completion.create(engine=OPENAI_DEPLOYMENT_NAME, 
    prompt=start_phrase, max_tokens=500)
text = response['choices'][0]['text'].replace('\n', '').replace(' .', '.').strip()
print(start_phrase + '\n' + text)</pre>			<p>We get the<a id="_idIndexMarker332"/> <span class="No-Break">following output:</span></p>
			<div>
				<div id="_idContainer100" class="IMG---Figure">
					<img src="image/B21019_05_7.jpg" alt="Figure 5.7: An overview of the summary output"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 5.7: An overview of the summary output</p>
			<p>Thus, we have created an analytics solution for contact centers using an integration of OpenAI <span class="No-Break">and Azure.</span></p>
			<h1 id="_idParaDest-77"><a id="_idTextAnchor076"/>Summary</h1>
			<p>In this chapter, we delved into the intricacies of implementing and leveraging Azure Communication Services. Our practical exploration included the creation of a simulated chat dialogue involving an agent and a customer. Employing ChatGPT, we conducted an insightful analysis of the comprehensive <span class="No-Break">conversation summary.</span></p>
			<p>While our example focused on text-based chat interactions, it’s important to note that the versatility of Azure Communication Services extends beyond mere text. It seamlessly accommodates audio, video, or a blend of multiple formats for a more dynamic user experience. This holistic approach enables us to gain valuable insights into customer concerns, allowing the derived statistics to serve as invaluable inputs for shaping the future product roadmap. By exploring various conversation formats, we can uncover potential pain points and identify key areas for improvement, ultimately contributing to the enhancement of our products <span class="No-Break">and services.</span></p>
			<p>In the next chapter, we are going to delve into the world of interacting with SQL databases <span class="No-Break">using prompts.</span></p>
		</div>
	</body></html>