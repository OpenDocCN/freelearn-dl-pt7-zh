<html><head></head><body>
<div id="_idContainer049" class="calibre2">
<h1 class="chapter-number" id="_idParaDest-86"><a id="_idTextAnchor090" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.1.1">5</span></h1>
<h1 id="_idParaDest-87" class="calibre5"><a id="_idTextAnchor091" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.2.1">Staging the OpenAI API for Application Development</span></h1>
<p class="calibre3"><a id="_idTextAnchor092" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.3.1">So far, we have used the OpenAI API by connecting directly to OpenAI’s endpoint and making a request. </span><span class="kobospan" id="kobo.3.2">When building applications and workflows, however, it is not typical to connect directly to OpenAI. </span><span class="kobospan" id="kobo.3.3">Instead, developers tend to stage and call OpenAI’s API from their own backend APIs, which then return information to </span><span><span class="kobospan" id="kobo.4.1">the application.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.5.1">Essentially, there is a layer between the frontend of an application and the OpenAI API, as depicted in </span><span><em class="italic"><span class="kobospan" id="kobo.6.1">Figure 5</span></em></span><em class="italic"><span class="kobospan" id="kobo.7.1">.1</span></em><span class="kobospan" id="kobo.8.1">. </span><span class="kobospan" id="kobo.8.2">This layer normally processes requests from the frontend, calls the OpenAI API (or a series of other endpoints), receives the completion, processes it, and then returns</span><a id="_idIndexMarker213" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.9.1"> the data back to </span><a id="_idIndexMarker214" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.10.1">the frontend. </span><span class="kobospan" id="kobo.10.2">We will refer to this layer as the </span><strong class="bold"><span class="kobospan" id="kobo.11.1">backend layer</span></strong><span class="kobospan" id="kobo.12.1"> or the </span><span><strong class="bold"><span class="kobospan" id="kobo.13.1">server layer</span></strong></span><span><span class="kobospan" id="kobo.14.1">.</span></span></p>
<div class="calibre2">
<div class="img---figure" id="_idContainer036">
<span class="kobospan" id="kobo.15.1"><img alt="Figure 5.1 – Demonstration of typical application architecture using the OpenAI API" src="image/B21007_05_01.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.16.1">Figure 5.1 – Demonstration of typical application architecture using the OpenAI API</span></p>
<p class="calibre3"><span class="kobospan" id="kobo.17.1">Integrating OpenAI’s API into an application usually involves an architecture where the frontend layer (the user interface) communicates with a backend layer (the server), which in turn interacts with OpenAI’s API. </span><span class="kobospan" id="kobo.17.2">This approach has </span><span><span class="kobospan" id="kobo.18.1">several advantages:</span></span></p>
<ul class="calibre16">
<li class="calibre15"><em class="italic"><span class="kobospan" id="kobo.19.1">Security and API key management</span></em><span class="kobospan" id="kobo.20.1">: The OpenAI API key is not exposed to the frontend, reducing the risk of it being compromised. </span><span class="kobospan" id="kobo.20.2">The backend can securely store and manage the </span><span><span class="kobospan" id="kobo.21.1">API key.</span></span></li>
<li class="calibre15"><em class="italic"><span class="kobospan" id="kobo.22.1">Control and customization</span></em><span class="kobospan" id="kobo.23.1">: The backend can control the rate and nature of requests sent to OpenAI’s API. </span><span class="kobospan" id="kobo.23.2">It can also preprocess requests from the frontend or post-process responses from OpenAI, customizing the data according to </span><span><span class="kobospan" id="kobo.24.1">application needs.</span></span></li>
<li class="calibre15"><em class="italic"><span class="kobospan" id="kobo.25.1">Integration with other services</span></em><span class="kobospan" id="kobo.26.1">: Often, applications require data from multiple sources. </span><span class="kobospan" id="kobo.26.2">The backend can integrate OpenAI’s API with other APIs or data sources, creating a centralized point for data processing </span><span><span class="kobospan" id="kobo.27.1">and distribution.</span></span></li>
<li class="calibre15"><em class="italic"><span class="kobospan" id="kobo.28.1">User authentication and authorization</span></em><span class="kobospan" id="kobo.29.1">: The backend can implement security measures such as user authentication and authorization, ensuring that only authorized users can access </span><span><span class="kobospan" id="kobo.30.1">certain functionalities.</span></span></li>
</ul>
<p class="calibre3"><span class="kobospan" id="kobo.31.1">This </span><em class="italic"><span class="kobospan" id="kobo.32.1">backend</span></em><span class="kobospan" id="kobo.33.1"> layer</span><a id="_idIndexMarker215" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.34.1"> is typically staged and hosted on a </span><strong class="bold"><span class="kobospan" id="kobo.35.1">serverless</span></strong><span class="kobospan" id="kobo.36.1"> system such as Azure Functions, Amazon Web Services Lambda, or Google Cloud Functions. </span><span class="kobospan" id="kobo.36.2">Using a serverless architecture offers several benefits, the paramount of which is simplified operations – it’s easy and quick to create a backend layer with </span><span><span class="kobospan" id="kobo.37.1">serverless architecture.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.38.1">In this chapter, we will take the first step into application development with the OpenAI API. </span><span class="kobospan" id="kobo.38.2">We will learn how to create a serverless backend layer that connects and processes data from OpenAI API. </span><span class="kobospan" id="kobo.38.3">We will then learn how to integrate that with the frontend layer, using both no-code and code platforms. </span><span class="kobospan" id="kobo.38.4">By the end of this chapter, you will have everything you need to start creating your own </span><span><span class="kobospan" id="kobo.39.1">intelligent applications.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.40.1">In this chapter, we will cover the </span><span><span class="kobospan" id="kobo.41.1">following recipes:</span></span></p>
<ul class="calibre16">
<li class="calibre15"><span class="kobospan" id="kobo.42.1">Creating a public endpoint server that calls the </span><span><span class="kobospan" id="kobo.43.1">OpenAI API</span></span><a id="_idTextAnchor093" class="pcalibre1 calibre6 pcalibre"/></li>
<li class="calibre15"><span class="kobospan" id="kobo.44.1">Extending the endpoint server to accept parameters and </span><span><span class="kobospan" id="kobo.45.1">return data</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.46.1">Calling the user-created endpoint from </span><span><span class="kobospan" id="kobo.47.1">no-code applications</span></span></li>
</ul>
<h1 id="_idParaDest-88" class="calibre5"><a id="_idTextAnchor094" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.48.1">Technical requirements</span></h1>
<p class="calibre3"><span class="kobospan" id="kobo.49.1">All the recipes in this chapter require you to have access to the OpenAI API (via a generated API key) and have an API client installed. </span><span class="kobospan" id="kobo.49.2">You can refer to the </span><a href="B21007_01.xhtml#_idTextAnchor021" class="pcalibre1 calibre6 pcalibre"><span><em class="italic"><span class="kobospan" id="kobo.50.1">Chapter 1</span></em></span></a><span class="kobospan" id="kobo.51.1"> recipe </span><em class="italic"><span class="kobospan" id="kobo.52.1">Making OpenAI API requests with Postman</span></em><span class="kobospan" id="kobo.53.1"> for more information on how to obtain your API key. </span><span class="kobospan" id="kobo.53.2">This will also require knowledge of Python and the Python OpenAI library, which we covered in the first recipe within </span><a href="B21007_04.xhtml#_idTextAnchor074" class="pcalibre1 calibre6 pcalibre"><span><em class="italic"><span class="kobospan" id="kobo.54.1">Chapter 4</span></em></span></a><span><span class="kobospan" id="kobo.55.1">.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.56.1">We will also use the </span><strong class="bold"><span class="kobospan" id="kobo.57.1">Google Cloud Platform</span></strong><span class="kobospan" id="kobo.58.1"> (</span><strong class="bold"><span class="kobospan" id="kobo.59.1">GCP</span></strong><span class="kobospan" id="kobo.60.1">) to host our public endpoint. </span><span class="kobospan" id="kobo.60.2">GCP is a suite of cloud computing services offered by Google. </span><span class="kobospan" id="kobo.60.3">It provides a range of hosting and computing services for databases, data storage, data analytics, machine learning, and more, all hosted on </span><span><span class="kobospan" id="kobo.61.1">Google’s infrastructure.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.62.1">In order to do this, you need to create a Google Cloud account, which you can do here: </span><a href="https://cloud.google.com/" class="pcalibre1 calibre6 pcalibre"><span><span class="kobospan" id="kobo.63.1">https://cloud.google.com/</span></span></a><span><span class="kobospan" id="kobo.64.1">.</span></span></p>
<h1 id="_idParaDest-89" class="calibre5"><a id="_idTextAnchor095" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.65.1">Creating a public endpoint server that calls the 
OpenAI API</span></h1>
<p class="calibre3"><span class="kobospan" id="kobo.66.1">As discussed previously, there are many important benefits of creating your own public endpoint server that calls the OpenAI API, instead of connecting to the OpenAI API directly – the biggest being control and customization, which we will explore in this recipe and the </span><span><span class="kobospan" id="kobo.67.1">next recipe.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.68.1">In this recipe, we </span><a id="_idIndexMarker216" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.69.1">will use GCP to host our public endpoint. </span><span class="kobospan" id="kobo.69.2">When this endpoint is called, it will make a request to OpenAI for a slogan for an ice cream company and then will return the answer to the user. </span><span class="kobospan" id="kobo.69.3">This sounds simple and almost unnecessary to make a public endpoint, but it is the final step we need to build a truly intelligent application that </span><span><span class="kobospan" id="kobo.70.1">leverages OpenAI.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.71.1">To do this, we will create a GCP resource </span><a id="_idIndexMarker217" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.72.1">called </span><strong class="bold"><span class="kobospan" id="kobo.73.1">Cloud Functions</span></strong><span class="kobospan" id="kobo.74.1">, which we will explore later in the </span><em class="italic"><span class="kobospan" id="kobo.75.1">How it works…</span></em><span class="kobospan" id="kobo.76.1"> section of </span><span><span class="kobospan" id="kobo.77.1">the recipe.</span></span></p>
<h2 id="_idParaDest-90" class="calibre7"><a id="_idTextAnchor096" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.78.1">Getting ready</span></h2>
<p class="calibre3"><span class="kobospan" id="kobo.79.1">Ensure you have an OpenAI platform account with available usage credits. </span><span class="kobospan" id="kobo.79.2">If you don’t, please follow the </span><em class="italic"><span class="kobospan" id="kobo.80.1">Setting up your OpenAI Playground environment</span></em><span class="kobospan" id="kobo.81.1"> recipe in </span><a href="B21007_01.xhtml#_idTextAnchor021" class="pcalibre1 calibre6 pcalibre"><span><em class="italic"><span class="kobospan" id="kobo.82.1">Chapter 1</span></em></span></a><span><span class="kobospan" id="kobo.83.1">.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.84.1">Furthermore, ensure you have created a GCP account. </span><span class="kobospan" id="kobo.84.2">To do this, navigate to </span><a href="https://cloud.google.com/" class="pcalibre1 calibre6 pcalibre"><span class="kobospan" id="kobo.85.1">https://cloud.google.com/</span></a><span class="kobospan" id="kobo.86.1">, then select </span><strong class="bold"><span class="kobospan" id="kobo.87.1">Start Free</span></strong><span class="kobospan" id="kobo.88.1"> from the top right, and follow the instructions that </span><span><span class="kobospan" id="kobo.89.1">you see.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.90.1">You may need </span><a id="_idIndexMarker218" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.91.1">to provide a billing profile as well to create any GCP resources. </span><span class="kobospan" id="kobo.91.2">Note that GCP does have a free tier, and in this recipe, we will not go above the free tier (so, essentially, you should not be billed </span><span><span class="kobospan" id="kobo.92.1">for anything).</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.93.1">You may need to create a project if this is your first time logging in to </span><strong class="bold"><span class="kobospan" id="kobo.94.1">Google Cloud Platform</span></strong><span class="kobospan" id="kobo.95.1">. </span><span class="kobospan" id="kobo.95.2">After you log in, select </span><strong class="bold"><span class="kobospan" id="kobo.96.1">Select a project</span></strong><span class="kobospan" id="kobo.97.1"> from the top left and then select </span><strong class="bold"><span class="kobospan" id="kobo.98.1">New Project</span></strong><span class="kobospan" id="kobo.99.1">. </span><span class="kobospan" id="kobo.99.2">Provide a </span><strong class="bold"><span class="kobospan" id="kobo.100.1">project name</span></strong><span class="kobospan" id="kobo.101.1"> and then </span><span><span class="kobospan" id="kobo.102.1">select </span></span><span><strong class="bold"><span class="kobospan" id="kobo.103.1">Create</span></strong></span><span><span class="kobospan" id="kobo.104.1">.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.105.1">The next recipe in this chapter will also have this </span><span><span class="kobospan" id="kobo.106.1">same requirement.</span></span></p>
<h2 id="_idParaDest-91" class="calibre7"><a id="_idTextAnchor097" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.107.1">How to do it…</span></h2>
<ol class="calibre14">
<li class="calibre15"><span class="kobospan" id="kobo.108.1">Navigate to </span><a href="https://console.cloud.google.com/" class="pcalibre1 calibre6 pcalibre"><span class="kobospan" id="kobo.109.1">https://console.cloud.google.com/</span></a><span class="kobospan" id="kobo.110.1">. </span><span class="kobospan" id="kobo.110.2">In the </span><strong class="bold"><span class="kobospan" id="kobo.111.1">Search</span></strong><span class="kobospan" id="kobo.112.1"> field at the top of the page, type in </span><strong class="source-inline1"><span class="kobospan" id="kobo.113.1">Cloud Functions</span></strong><span class="kobospan" id="kobo.114.1"> and select the top choice from the drop-down menu, </span><span><strong class="bold"><span class="kobospan" id="kobo.115.1">Cloud Functions</span></strong></span><span><span class="kobospan" id="kobo.116.1">.</span></span></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer037">
<span class="kobospan" id="kobo.117.1"><img alt="Figure 5.2 – Cloud Functions in the dropdown" src="image/B21007_05_02.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.118.1">Figure 5.2 – Cloud Functions in the dropdown</span></p>
<ol class="calibre14">
<li value="2" class="calibre15"><span class="kobospan" id="kobo.119.1">Select </span><strong class="bold"><span class="kobospan" id="kobo.120.1">Create Function</span></strong><span class="kobospan" id="kobo.121.1"> from the top of the page. </span><span class="kobospan" id="kobo.121.2">This will begin to create our custom backend endpoint and start the </span><span><span class="kobospan" id="kobo.122.1">configuration steps.</span></span><p class="calibre3"><span class="kobospan" id="kobo.123.1">On the </span><strong class="bold"><span class="kobospan" id="kobo.124.1">Configuration</span></strong><span class="kobospan" id="kobo.125.1"> page, fill in the </span><span><span class="kobospan" id="kobo.126.1">following steps:</span></span></p><ul class="calibre17"><li class="calibre15"><strong class="bold"><span class="kobospan" id="kobo.127.1">Environment</span></strong><span class="kobospan" id="kobo.128.1">: Select </span><strong class="bold"><span class="kobospan" id="kobo.129.1">2nd gen</span></strong><span class="kobospan" id="kobo.130.1"> from the </span><span><span class="kobospan" id="kobo.131.1">drop-down menu.</span></span></li><li class="calibre15"><strong class="bold"><span class="kobospan" id="kobo.132.1">Function name</span></strong><span class="kobospan" id="kobo.133.1">: Since we’re creating a backend endpoint that will produce</span><a id="_idIndexMarker219" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.134.1"> company slogans, the function name will </span><span><span class="kobospan" id="kobo.135.1">be </span></span><span><strong class="source-inline1"><span class="kobospan" id="kobo.136.1">slogan_creator</span></strong></span><span><span class="kobospan" id="kobo.137.1">.</span></span></li><li class="calibre15"><strong class="bold"><span class="kobospan" id="kobo.138.1">Region</span></strong><span class="kobospan" id="kobo.139.1">: Choose the environment location </span><span><span class="kobospan" id="kobo.140.1">nearest you.</span></span></li><li class="calibre15"><span class="kobospan" id="kobo.141.1">In the </span><strong class="bold"><span class="kobospan" id="kobo.142.1">Trigger</span></strong><span class="kobospan" id="kobo.143.1"> menu, choose </span><strong class="bold"><span class="kobospan" id="kobo.144.1">HTTPS</span></strong><span class="kobospan" id="kobo.145.1">. </span><span class="kobospan" id="kobo.145.2">In the </span><strong class="bold"><span class="kobospan" id="kobo.146.1">Authentication</span></strong><span class="kobospan" id="kobo.147.1"> sub-menu, select </span><strong class="bold"><span class="kobospan" id="kobo.148.1">Allow unauthenticated invocation</span></strong><span class="kobospan" id="kobo.149.1">. </span><span class="kobospan" id="kobo.149.2">We need to check this as we are going to create a public endpoint that will be accessible from our </span><span><span class="kobospan" id="kobo.150.1">frontend services.</span></span></li></ul></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer038">
<span class="kobospan" id="kobo.151.1"><img alt="Figure 5.3 – Sample configuration settings of a Google Cloud Function" src="image/B21007_05_03.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.152.1">Figure 5.3 – Sample configuration settings of a Google Cloud Function</span></p>
<ol class="calibre14">
<li value="3" class="calibre15"><span class="kobospan" id="kobo.153.1">Select </span><a id="_idIndexMarker220" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.154.1">the </span><strong class="bold"><span class="kobospan" id="kobo.155.1">Next</span></strong><span class="kobospan" id="kobo.156.1"> button on the bottom of the page to then move on to the </span><span><strong class="bold"><span class="kobospan" id="kobo.157.1">Code</span></strong></span><span><span class="kobospan" id="kobo.158.1"> section.</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.159.1">From the </span><strong class="bold"><span class="kobospan" id="kobo.160.1">Runtime</span></strong><span class="kobospan" id="kobo.161.1"> dropdown, select </span><strong class="bold"><span class="kobospan" id="kobo.162.1">Python 3.12</span></strong><span class="kobospan" id="kobo.163.1">. </span><span class="kobospan" id="kobo.163.2">This ensures that our backend endpoint will be coded using the Python </span><span><span class="kobospan" id="kobo.164.1">programming language.</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.165.1">For that </span><strong class="bold"><span class="kobospan" id="kobo.166.1">Entry point</span></strong><span class="kobospan" id="kobo.167.1"> option, type in </span><strong class="source-inline1"><span class="kobospan" id="kobo.168.1">create_slogan</span></strong><span class="kobospan" id="kobo.169.1">. </span><span class="kobospan" id="kobo.169.2">This refers to the name of the function in Python that is called when the public endpoint is reached </span><span><span class="kobospan" id="kobo.170.1">and triggered.</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.171.1">On the left-hand side menu, you will see two files: </span><strong class="source-inline1"><span class="kobospan" id="kobo.172.1">main.py</span></strong><span class="kobospan" id="kobo.173.1"> and </span><strong class="source-inline1"><span class="kobospan" id="kobo.174.1">requirements.txt</span></strong><span class="kobospan" id="kobo.175.1">. </span><span class="kobospan" id="kobo.175.2">Select the </span><strong class="source-inline1"><span class="kobospan" id="kobo.176.1">requirements.txt</span></strong><span class="kobospan" id="kobo.177.1"> file. </span><span class="kobospan" id="kobo.177.2">This will list all the Python packages that need to be installed for our Cloud Function </span><span><span class="kobospan" id="kobo.178.1">to operate.</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.179.1">In the center of the screen where the contents of </span><strong class="source-inline1"><span class="kobospan" id="kobo.180.1">requirements.txt</span></strong><span class="kobospan" id="kobo.181.1"> are displayed, enter a new line and type in </span><strong class="source-inline1"><span class="kobospan" id="kobo.182.1">openai</span></strong><span class="kobospan" id="kobo.183.1">. </span><span class="kobospan" id="kobo.183.2">This will ensure that the latest </span><strong class="source-inline1"><span class="kobospan" id="kobo.184.1">openai</span></strong><span class="kobospan" id="kobo.185.1"> library package is installed. </span><span class="kobospan" id="kobo.185.2">Your screen should look like what’s displayed in </span><span><em class="italic"><span class="kobospan" id="kobo.186.1">Figure 5</span></em></span><span><em class="italic"><span class="kobospan" id="kobo.187.1">.4</span></em></span><span><span class="kobospan" id="kobo.188.1">.</span></span></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer039">
<span class="kobospan" id="kobo.189.1"><img alt="Figure 5.4 – Snapshot of the requirements.txt file" src="image/B21007_05_04.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.190.1">Figure 5.4 – Snapshot of the requirements.txt file</span></p>
<ol class="calibre14">
<li value="8" class="calibre15"><span class="kobospan" id="kobo.191.1">From the </span><a id="_idIndexMarker221" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.192.1">left-hand side menu, select </span><strong class="source-inline1"><span class="kobospan" id="kobo.193.1">main.py</span></strong><span class="kobospan" id="kobo.194.1">. </span><span class="kobospan" id="kobo.194.2">Copy and paste the following code into the center of the screen (where the content for that file is displayed). </span><span class="kobospan" id="kobo.194.3">These are the instructions that the public endpoint will run when it </span><span><span class="kobospan" id="kobo.195.1">is triggered:</span></span><pre class="source-code"><span class="kobospan1" id="kobo.196.1">
import functions_framework
from openai import OpenAI
@functions_framework.http
def create_slogan(request):
    client = OpenAI(api_key = '</span><strong class="bold1"><span class="kobospan1" id="kobo.197.1">&lt;API Key here&gt;</span></strong><span class="kobospan1" id="kobo.198.1">')
    response = client.chat.completions.create(
        model="gpt-3.5-turbo",
        messages=[
            {
            "role": "system",
            "content": "You are an AI assistant that creates one slogan based on company descriptions"
            },
            {
            "role": "user",
            "content": "A company that sells ice cream"
            }
        ],
        temperature=1,
        max_tokens=256,
        top_p=1,
        frequency_penalty=0,
        presence_penalty=0
    )
    return response.choices[0].message.content</span></pre><p class="calibre3"><span class="kobospan" id="kobo.199.1">As you can see, it simply calls the OpenAI endpoint, requests a chat completion, and then returns the output to the user. </span><span class="kobospan" id="kobo.199.2">You will also need your OpenAI </span><span><span class="kobospan" id="kobo.200.1">API key.</span></span></p></li> <li class="calibre15"><span class="kobospan" id="kobo.201.1">Next, deploy the function by selecting the </span><strong class="bold"><span class="kobospan" id="kobo.202.1">Deploy</span></strong><span class="kobospan" id="kobo.203.1"> button at the bottom of </span><span><span class="kobospan" id="kobo.204.1">your page.</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.205.1">Wait for</span><a id="_idIndexMarker222" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.206.1"> your function to be fully deployed, which typically takes two minutes. </span><span class="kobospan" id="kobo.206.2">You can verify whether the function has been deployed or not by observing the progress in the top left section of the page (shown in </span><span><em class="italic"><span class="kobospan" id="kobo.207.1">Figure 5</span></em></span><em class="italic"><span class="kobospan" id="kobo.208.1">.5</span></em><span class="kobospan" id="kobo.209.1">). </span><span class="kobospan" id="kobo.209.2">Once it is green and checkmarked, the build is successful, and your function has </span><span><span class="kobospan" id="kobo.210.1">been deployed.</span></span></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer040">
<span class="kobospan" id="kobo.211.1"><img alt="Figure 5.5 – The Cloud Function deployment page" src="image/B21007_05_05.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.212.1">Figure 5.5 – The Cloud Function deployment page</span></p>
<ol class="calibre14">
<li value="11" class="calibre15"><span class="kobospan" id="kobo.213.1">Now, let’s verify that our function works. </span><span class="kobospan" id="kobo.213.2">Select the endpoint URL, found on the top of the page near </span><strong class="bold"><span class="kobospan" id="kobo.214.1">URL</span></strong><span class="kobospan" id="kobo.215.1">. </span><span class="kobospan" id="kobo.215.2">It’s typically in the form </span><strong class="source-inline1"><span class="kobospan" id="kobo.216.1">https://[location]-[project-name].cloudfunctions.net/[function-name]</span></strong><span class="kobospan" id="kobo.217.1">. </span><span class="kobospan" id="kobo.217.2">It is also highlighted in </span><span><em class="italic"><span class="kobospan" id="kobo.218.1">Figure 5</span></em></span><span><em class="italic"><span class="kobospan" id="kobo.219.1">.5</span></em></span><span><span class="kobospan" id="kobo.220.1">.</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.221.1">This will open a new web page that will trigger our custom public endpoint, and return a chat completion, which, in this case, is the slogan for an ice cream business. </span><span class="kobospan" id="kobo.221.2">Note that this is a public endpoint – this will work on your computer, phone, or any device connected to </span><span><span class="kobospan" id="kobo.222.1">the internet.</span></span></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer041">
<span class="kobospan" id="kobo.223.1"><img alt="Figure 5.6 – Output of a Google Cloud Function" src="image/B21007_05_06.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.224.1">Figure 5.6 – Output of a Google Cloud Function</span></p>
<h2 id="_idParaDest-92" class="calibre7"><a id="_idTextAnchor098" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.225.1">How it works…</span></h2>
<p class="calibre3"><span class="kobospan" id="kobo.226.1">In this recipe, we</span><a id="_idIndexMarker223" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.227.1"> created a public endpoint. </span><span class="kobospan" id="kobo.227.2">This endpoint can be accessed by anyone (including your application in future recipes). </span><span class="kobospan" id="kobo.227.3">The logic of the endpoint is simple and something we have covered prior: return a slogan for a company that sells ice cream. </span><span class="kobospan" id="kobo.227.4">What’s new, however, is that this is our very own public endpoint that is hosted in Google Cloud, using the Cloud </span><span><span class="kobospan" id="kobo.228.1">Function resource.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.229.1">Note that we</span><a id="_idIndexMarker224" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.230.1"> used the free tier of Google Cloud Functions, which does have limitations such as a cap on the number of function invocations per month, limited execution time, and constrained computational resources. </span><span class="kobospan" id="kobo.230.2">However, for our current purposes, these limitations are not a hindrance, allowing us to deploy and test our functions effectively without incurring costs. </span><span class="kobospan" id="kobo.230.3">This setup is ideal for small-scale applications or for learning and experimentation purposes, providing a practical way to understand cloud functionalities and serverless architecture in a </span><span><span class="kobospan" id="kobo.231.1">cost-effective manner.</span></span></p>
<h3 class="calibre8"><span class="kobospan" id="kobo.232.1">Code in the Cloud Function</span></h3>
<p class="calibre3"><span class="kobospan" id="kobo.233.1">The</span><a id="_idIndexMarker225" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.234.1"> code that we used within the Cloud Function should appear familiar – it’s the exact code we used in the first recipe within </span><a href="B21007_04.xhtml#_idTextAnchor074" class="pcalibre1 calibre6 pcalibre"><span><em class="italic"><span class="kobospan" id="kobo.235.1">Chapter 4</span></em></span></a><span class="kobospan" id="kobo.236.1">, but wrapped into a function called </span><strong class="source-inline"><span class="kobospan" id="kobo.237.1">create_slogan</span></strong><span class="kobospan" id="kobo.238.1">. </span><span class="kobospan" id="kobo.238.2">This code simply makes an OpenAI chat completion with the </span><strong class="source-inline"><span class="kobospan" id="kobo.239.1">system</span></strong><span class="kobospan" id="kobo.240.1"> and </span><strong class="source-inline"><span class="kobospan" id="kobo.241.1">user</span></strong><span class="kobospan" id="kobo.242.1"> messages being </span><strong class="source-inline"><span class="kobospan" id="kobo.243.1">You are an AI assistant that creates one slogan based on company descriptions</span></strong><span class="kobospan" id="kobo.244.1"> and </span><strong class="source-inline"><span class="kobospan" id="kobo.245.1">A company that sells ice cream</span></strong><span class="kobospan" id="kobo.246.1"> respectively. </span><span class="kobospan" id="kobo.246.2">What are GCP </span><span><span class="kobospan" id="kobo.247.1">Cloud Functions?</span></span></p>
<p class="calibre3"><strong class="bold"><span class="kobospan" id="kobo.248.1">Cloud Functions</span></strong><span class="kobospan" id="kobo.249.1">, commonly referred to as </span><strong class="bold"><span class="kobospan" id="kobo.250.1">serverless functions</span></strong><span class="kobospan" id="kobo.251.1"> or </span><strong class="bold"><span class="kobospan" id="kobo.252.1">Function as a Service (FaaS)</span></strong><span class="kobospan" id="kobo.253.1">, are a key component of serverless computing. </span><span class="kobospan" id="kobo.253.2">In this model, developers write and deploy individual functions – small, single-purpose pieces of code – that are executed in the cloud. </span><span class="kobospan" id="kobo.253.3">These functions are typically event-driven, meaning they are designed to respond to specific triggers </span><span><span class="kobospan" id="kobo.254.1">or events.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.255.1">There are two main</span><a id="_idIndexMarker226" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.256.1"> benefits of Cloud Functions that make them perfect for creating our backend layer and a </span><span><span class="kobospan" id="kobo.257.1">public endpoint:</span></span></p>
<ul class="calibre16">
<li class="calibre15"><em class="italic"><span class="kobospan" id="kobo.258.1">No server management</span></em><span class="kobospan" id="kobo.259.1">: Developers don’t need to provision or manage any servers. </span><span class="kobospan" id="kobo.259.2">The cloud provider dynamically allocates and manages the infrastructure. </span><span class="kobospan" id="kobo.259.3">There is no need for setup or maintenance. </span><span class="kobospan" id="kobo.259.4">We created it in less than </span><span><span class="kobospan" id="kobo.260.1">10 minutes.</span></span></li>
<li class="calibre15"><em class="italic"><span class="kobospan" id="kobo.261.1">Automatic scaling</span></em><span class="kobospan" id="kobo.262.1">: Cloud Functions automatically scale up or down based on the number of incoming event triggers. </span><span class="kobospan" id="kobo.262.2">This means they can handle a single request per day or thousands per second. </span><span class="kobospan" id="kobo.262.3">This is especially important when building applications – you want them to work whether there’s one user on your apps, </span><span><span class="kobospan" id="kobo.263.1">or millions.</span></span></li>
</ul>
<p class="calibre3"><span class="kobospan" id="kobo.264.1">Nevertheless, it’s essential to keep in mind that just like any other tool, Cloud Functions come with their own set of pros and cons. </span><span class="kobospan" id="kobo.264.2">They’re selected in this scenario primarily because they offer economical and simple setup benefits during the initial stages. </span><span class="kobospan" id="kobo.264.3">As with every choice, it’s always worth weighing up the potential challenges alongside </span><span><span class="kobospan" id="kobo.265.1">the advantages.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.266.1">GCP offers free-tier Cloud Functions, which means you can set them up for free (assuming they receive less than 2 million requests and some other thresholds (see </span><a href="https://cloud.google.com/functions/pricing" class="pcalibre1 calibre6 pcalibre"><span class="kobospan" id="kobo.267.1">https://cloud.google.com/functions/pricing</span></a><span class="kobospan" id="kobo.268.1">), which we will certainly not pass in </span><span><span class="kobospan" id="kobo.269.1">these recipes).</span></span></p>
<h3 class="calibre8"><span class="kobospan" id="kobo.270.1">Setting up a Cloud Function</span></h3>
<p class="calibre3"><span class="kobospan" id="kobo.271.1">When</span><a id="_idIndexMarker227" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.272.1"> setting up a Cloud Function, there were several configurations options that we purposely chose. </span><span class="kobospan" id="kobo.272.2">Here is an explanation of the </span><span><span class="kobospan" id="kobo.273.1">important configurations:</span></span></p>
<ul class="calibre16">
<li class="calibre15"><strong class="bold"><span class="kobospan" id="kobo.274.1">Trigger</span></strong><span class="kobospan" id="kobo.275.1">: This setting defines how your Cloud Function is invoked. </span><span class="kobospan" id="kobo.275.2">In simple terms, it specifies the event or condition that will cause your function (or the code in the function) to run. </span><span class="kobospan" id="kobo.275.3">There are generally </span><span><span class="kobospan" id="kobo.276.1">two options:</span></span><ul class="calibre17"><li class="calibre15"><strong class="bold"><span class="kobospan" id="kobo.277.1">HTTP Trigger</span></strong><span class="kobospan" id="kobo.278.1">: The function is invoked through an HTTP request, which is the same protocol we have used in previous recipes to call the OpenAI API within Postman. </span><span class="kobospan" id="kobo.278.2">This is useful if you are creating public endpoints that will be called manually by other applications, which is why we have chosen </span><span><span class="kobospan" id="kobo.279.1">this option.</span></span></li><li class="calibre15"><strong class="bold"><span class="kobospan" id="kobo.280.1">Event Trigger</span></strong><span class="kobospan" id="kobo.281.1">: This option allows your function to respond to events from your cloud environment (e.g., changes in a Cloud </span><span><span class="kobospan" id="kobo.282.1">Storage bucket).</span></span></li></ul></li>
<li class="calibre15"><strong class="bold"><span class="kobospan" id="kobo.283.1">Authentication</span></strong><span class="kobospan" id="kobo.284.1">: This</span><a id="_idIndexMarker228" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.285.1"> setting controls who can invoke your Cloud Function. </span><span class="kobospan" id="kobo.285.2">It’s a crucial part of securing your function against unauthorized access. </span><span class="kobospan" id="kobo.285.3">For now, we have chosen </span><strong class="bold"><span class="kobospan" id="kobo.286.1">Allow Unauthenticated Invocations</span></strong><span class="kobospan" id="kobo.287.1">, meaning that anyone can invoke your public endpoint. </span><span class="kobospan" id="kobo.287.2">Even though this isn’t the most secure option, it is the most convenient option as you do not need to create authentication logic within Postman or any other frontend layer that needs to call the Google Cloud Function. </span><span class="kobospan" id="kobo.287.3">It’s important to note that this is not the most secure choice and we highly discourage its use in real-world applications. </span><span class="kobospan" id="kobo.287.4">This option has been utilized in this instance for convenience – to avoid creating authentication logic within Postman or any other frontend layer that interacts with the Google </span><span><span class="kobospan" id="kobo.288.1">Cloud Function.</span></span></li>
<li class="calibre15"><strong class="bold"><span class="kobospan" id="kobo.289.1">Entry Point</span></strong><span class="kobospan" id="kobo.290.1">: This refers to the name of the function in Python that is called when the public endpoint is reached and triggered. </span><span class="kobospan" id="kobo.290.2">Essentially, this is the function or portion of the code that is run when the public endpoint </span><span><span class="kobospan" id="kobo.291.1">is invoked.</span></span></li>
</ul>
<p class="calibre3"><span class="kobospan" id="kobo.292.1">Essentially, now that we have created a public endpoint that calls the OpenAI API, we no longer need to worry about hosting it on our own computers or servers. </span><span class="kobospan" id="kobo.292.2">It can now be reached by anyone globally, even an intelligent application (which I am foreshadowing). </span><span class="kobospan" id="kobo.292.3">This is important because wrapping it in a public endpoint is the first step in building an </span><span><span class="kobospan" id="kobo.293.1">intelligent application.</span></span></p>
<h1 id="_idParaDest-93" class="calibre5"><a id="_idTextAnchor099" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.294.1">Extending the endpoint server to accept parameters and return data</span></h1>
<p class="calibre3"><span class="kobospan" id="kobo.295.1">In the</span><a id="_idIndexMarker229" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.296.1"> previous recipe, we successfully created a Cloud Function that, when invoked, returned a slogan for an ice cream company. </span><span class="kobospan" id="kobo.296.2">While this is useful as it sits on the cloud, we want to amend this function so that it can do </span><span><span class="kobospan" id="kobo.297.1">two things:</span></span></p>
<ul class="calibre16">
<li class="calibre15"><em class="italic"><span class="kobospan" id="kobo.298.1">Accept parameters</span></em><span class="kobospan" id="kobo.299.1">: We need to modify the function to accept input parameters as part of the HTTP request. </span><span class="kobospan" id="kobo.299.2">This means we will be able to create a Cloud Function that not only returns the slogan for an ice cream business but any type of business for which we provide </span><span><span class="kobospan" id="kobo.300.1">a description.</span></span></li>
<li class="calibre15"><em class="italic"><span class="kobospan" id="kobo.301.1">Structure the output</span></em><span class="kobospan" id="kobo.302.1">: We don’t want to simply output the chat completion (which, in this case, is the slogan). </span><span class="kobospan" id="kobo.302.2">Instead, we want to process the data and output a JSON object, as it is widely used and easy to work with in </span><span><span class="kobospan" id="kobo.303.1">web applications.</span></span></li>
</ul>
<p class="calibre3"><span class="kobospan" id="kobo.304.1">In this recipe, we will create a public endpoint server that will accept a parameter called </span><strong class="source-inline"><span class="kobospan" id="kobo.305.1">business_description</span></strong><span class="kobospan" id="kobo.306.1"> and will return the generated slogan in a structured </span><span><span class="kobospan" id="kobo.307.1">output form.</span></span></p>
<h2 id="_idParaDest-94" class="calibre7"><a id="_idTextAnchor100" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.308.1">How to do it…</span></h2>
<ol class="calibre14">
<li class="calibre15"><span class="kobospan" id="kobo.309.1">Navigate to </span><a href="https://console.cloud.google.com/" class="pcalibre1 calibre6 pcalibre"><span class="kobospan" id="kobo.310.1">https://console.cloud.google.com/</span></a><span class="kobospan" id="kobo.311.1">. </span><span class="kobospan" id="kobo.311.2">On the </span><strong class="bold"><span class="kobospan" id="kobo.312.1">Search</span></strong><span class="kobospan" id="kobo.313.1"> field at the top of the page, type in </span><strong class="source-inline1"><span class="kobospan" id="kobo.314.1">Cloud Functions</span></strong><span class="kobospan" id="kobo.315.1"> and select the top choice from the drop-down menu called </span><span><strong class="bold"><span class="kobospan" id="kobo.316.1">Cloud Functions</span></strong></span><span><span class="kobospan" id="kobo.317.1">.</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.318.1">Select </span><strong class="bold"><span class="kobospan" id="kobo.319.1">Create Function</span></strong><span class="kobospan" id="kobo.320.1"> from the top of the page. </span><span class="kobospan" id="kobo.320.2">This will begin to create our custom backend endpoint and start the </span><span><span class="kobospan" id="kobo.321.1">configuration steps.</span></span><p class="calibre3"><span class="kobospan" id="kobo.322.1">On the </span><strong class="bold"><span class="kobospan" id="kobo.323.1">Configuration</span></strong><span class="kobospan" id="kobo.324.1"> page, fill in the </span><span><span class="kobospan" id="kobo.325.1">following steps:</span></span></p><ul class="calibre17"><li class="calibre15"><strong class="bold"><span class="kobospan" id="kobo.326.1">Environment</span></strong><span class="kobospan" id="kobo.327.1">: Select </span><strong class="bold"><span class="kobospan" id="kobo.328.1">2nd gen</span></strong><span class="kobospan" id="kobo.329.1"> from the </span><span><span class="kobospan" id="kobo.330.1">drop-down menu.</span></span></li><li class="calibre15"><strong class="bold"><span class="kobospan" id="kobo.331.1">Function </span></strong><span><strong class="bold"><span class="kobospan" id="kobo.332.1">name</span></strong></span><span><span class="kobospan" id="kobo.333.1">: </span></span><span><strong class="source-inline1"><span class="kobospan" id="kobo.334.1">slogan_creator_with_parameters</span></strong></span><span><span class="kobospan" id="kobo.335.1">.</span></span></li><li class="calibre15"><strong class="bold"><span class="kobospan" id="kobo.336.1">Region</span></strong><span class="kobospan" id="kobo.337.1">: Choose the environment location nearest you, as the closer the server is to you, the faster </span><span><span class="kobospan" id="kobo.338.1">the response.</span></span></li><li class="calibre15"><span class="kobospan" id="kobo.339.1">From the </span><strong class="bold"><span class="kobospan" id="kobo.340.1">Trigger</span></strong><span class="kobospan" id="kobo.341.1"> menu, choose </span><strong class="bold"><span class="kobospan" id="kobo.342.1">HTTPS</span></strong><span class="kobospan" id="kobo.343.1">. </span><span class="kobospan" id="kobo.343.2">From the </span><strong class="bold"><span class="kobospan" id="kobo.344.1">Authentication</span></strong><span class="kobospan" id="kobo.345.1"> sub-menu, select </span><strong class="bold"><span class="kobospan" id="kobo.346.1">Allow </span></strong><span><strong class="bold"><span class="kobospan" id="kobo.347.1">unauthenticated invocation</span></strong></span><span><span class="kobospan" id="kobo.348.1">.</span></span></li></ul></li>
<li class="calibre15"><span class="kobospan" id="kobo.349.1">Select</span><a id="_idIndexMarker230" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.350.1"> the </span><strong class="bold"><span class="kobospan" id="kobo.351.1">Next</span></strong><span class="kobospan" id="kobo.352.1"> button at the bottom of the page to then move on to the </span><span><strong class="bold"><span class="kobospan" id="kobo.353.1">Code</span></strong></span><span><span class="kobospan" id="kobo.354.1"> section.</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.355.1">From the </span><strong class="bold"><span class="kobospan" id="kobo.356.1">Runtime</span></strong><span class="kobospan" id="kobo.357.1"> dropdown, select </span><strong class="bold"><span class="kobospan" id="kobo.358.1">Python 3.12</span></strong><span class="kobospan" id="kobo.359.1">. </span><span class="kobospan" id="kobo.359.2">This ensures that our backend endpoint will be coded using the Python </span><span><span class="kobospan" id="kobo.360.1">programming language.</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.361.1">For that </span><strong class="bold"><span class="kobospan" id="kobo.362.1">Entry point</span></strong><span class="kobospan" id="kobo.363.1"> option, type in </span><strong class="source-inline1"><span class="kobospan" id="kobo.364.1">create_slogan_with_parameters</span></strong><span class="kobospan" id="kobo.365.1">. </span><span class="kobospan" id="kobo.365.2">This refers to the name of the function in Python that is called when the public endpoint is reached </span><span><span class="kobospan" id="kobo.366.1">and triggered.</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.367.1">In the menu on the left-hand side, you will see two files: </span><strong class="source-inline1"><span class="kobospan" id="kobo.368.1">main.py</span></strong><span class="kobospan" id="kobo.369.1"> and </span><strong class="source-inline1"><span class="kobospan" id="kobo.370.1">requirements.txt</span></strong><span class="kobospan" id="kobo.371.1">. </span><span class="kobospan" id="kobo.371.2">Select the </span><strong class="source-inline1"><span class="kobospan" id="kobo.372.1">requirements.txt</span></strong><span class="kobospan" id="kobo.373.1"> file. </span><span class="kobospan" id="kobo.373.2">This will list all the Python packages that need to be installed for our Cloud Function </span><span><span class="kobospan" id="kobo.374.1">to operate.</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.375.1">At the center of the screen where the contents of </span><strong class="source-inline1"><span class="kobospan" id="kobo.376.1">requirements.txt</span></strong><span class="kobospan" id="kobo.377.1"> are displayed, enter a new line and type in </span><strong class="source-inline1"><span class="kobospan" id="kobo.378.1">openai</span></strong><span class="kobospan" id="kobo.379.1">. </span><span class="kobospan" id="kobo.379.2">This will ensure that the latest </span><strong class="source-inline1"><span class="kobospan" id="kobo.380.1">openai</span></strong><span class="kobospan" id="kobo.381.1"> library package </span><span><span class="kobospan" id="kobo.382.1">is installed.</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.383.1">From the left-hand side menu, select </span><strong class="source-inline1"><span class="kobospan" id="kobo.384.1">main.py</span></strong><span class="kobospan" id="kobo.385.1">. </span><span class="kobospan" id="kobo.385.2">Copy and paste the following code into the center of the screen (where the content for that file is displayed). </span><span class="kobospan" id="kobo.385.3">You will again need your OpenAI API key. </span><span class="kobospan" id="kobo.385.4">As you can see, the code is very similar to the previous recipe, with two key changes that </span><span><span class="kobospan" id="kobo.386.1">are highlighted:</span></span><pre class="source-code"><span class="kobospan1" id="kobo.387.1">
import functions_framework
from openai import OpenAI
@functions_framework.http
def create_slogan_with_parameters (request):
    </span><strong class="bold1"><span class="kobospan1" id="kobo.388.1">request_json = request.get_json(silent=True)</span></strong>
<strong class="bold1"><span class="kobospan1" id="kobo.389.1">    business_description = request_json['name']</span></strong><span class="kobospan1" id="kobo.390.1">
    client = OpenAI(api_key = '&lt;API-key&gt;')
    response = client.chat.completions.create(
        model="gpt-3.5-turbo",
        messages=[
            {
            "role": "system",
            "content": "You are an AI assistant that creates one slogan based on company descriptions"
            },
            {
            "role": "user",
            "content": </span><strong class="bold1"><span class="kobospan1" id="kobo.391.1">business_description</span></strong><span class="kobospan1" id="kobo.392.1">
            }
        ],
        temperature=1,
        max_tokens=256,
        top_p=1,
        frequency_penalty=0,
        presence_penalty=0
    )
    </span><strong class="bold1"><span class="kobospan1" id="kobo.393.1">slogan = response.choices[0].message.content</span></strong>
<strong class="bold1"><span class="kobospan1" id="kobo.394.1">    return {"slogan": slogan, "number_of_characters": len(slogan)}</span></strong></pre></li> <li class="calibre15"><span class="kobospan" id="kobo.395.1">Next, deploy </span><a id="_idIndexMarker231" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.396.1">the function by selecting the </span><strong class="bold"><span class="kobospan" id="kobo.397.1">Deploy</span></strong><span class="kobospan" id="kobo.398.1"> button at the bottom of your page. </span><span class="kobospan" id="kobo.398.2">Wait for your function to be fully deployed, which typically takes two minutes. </span><span class="kobospan" id="kobo.398.3">Make note of the Cloud Function URL. </span><span class="kobospan" id="kobo.398.4">It is typically in the </span><span><span class="kobospan" id="kobo.399.1">form </span></span><span><strong class="source-inline1"><span class="kobospan" id="kobo.400.1">https://[location]-[project-name].cloudfunctions.net/[function-name]</span></strong></span><span><span class="kobospan" id="kobo.401.1">.</span></span><p class="calibre3"><span class="kobospan" id="kobo.402.1">Now, we can test our function. </span><span class="kobospan" id="kobo.402.2">Since we have created a Cloud Function that takes a JSON body as input, we need to use Postman to make the HTTP request to our </span><span><span class="kobospan" id="kobo.403.1">public endpoint.</span></span></p></li>
<li class="calibre15"><span class="kobospan" id="kobo.404.1">In Postman, create a new request by selecting the </span><strong class="bold"><span class="kobospan" id="kobo.405.1">New</span></strong><span class="kobospan" id="kobo.406.1"> button from the top left menu bar and then </span><span><span class="kobospan" id="kobo.407.1">selecting </span></span><span><strong class="bold"><span class="kobospan" id="kobo.408.1">HTTP</span></strong></span><span><span class="kobospan" id="kobo.409.1">.</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.410.1">Change </span><strong class="bold"><span class="kobospan" id="kobo.411.1">HTTP Request type</span></strong><span class="kobospan" id="kobo.412.1"> from </span><strong class="bold"><span class="kobospan" id="kobo.413.1">GET</span></strong><span class="kobospan" id="kobo.414.1"> to </span><strong class="bold"><span class="kobospan" id="kobo.415.1">POST</span></strong><span class="kobospan" id="kobo.416.1"> by selecting the </span><strong class="bold"><span class="kobospan" id="kobo.417.1">Method</span></strong><span class="kobospan" id="kobo.418.1"> drop-down menu (by default, it will be set </span><span><span class="kobospan" id="kobo.419.1">to </span></span><span><strong class="bold"><span class="kobospan" id="kobo.420.1">GET</span></strong></span><span><span class="kobospan" id="kobo.421.1">).</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.422.1">Enter the Cloud Function URL from </span><em class="italic"><span class="kobospan" id="kobo.423.1">step 9</span></em><span class="kobospan" id="kobo.424.1"> as </span><span><span class="kobospan" id="kobo.425.1">the </span></span><span><strong class="bold"><span class="kobospan" id="kobo.426.1">Endpoint</span></strong></span><span><span class="kobospan" id="kobo.427.1">.</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.428.1">Select </span><strong class="bold"><span class="kobospan" id="kobo.429.1">Headers</span></strong><span class="kobospan" id="kobo.430.1"> in the sub-menu and add the following key-value pairs to the table </span><span><span class="kobospan" id="kobo.431.1">below it:</span></span></li>
</ol>
<table class="no-table-style" id="table001-5">
<colgroup class="calibre10">
<col class="calibre11"/>
<col class="calibre11"/>
</colgroup>
<thead class="calibre12">
<tr class="no-table-style1">
<td class="no-table-style2">
<p class="calibre3"><span><em class="italic"><span class="kobospan" id="kobo.432.1">Key</span></em></span></p>
</td>
<td class="no-table-style2">
<p class="calibre3"><span><em class="italic"><span class="kobospan" id="kobo.433.1">Value</span></em></span></p>
</td>
</tr>
</thead>
<tbody class="calibre13">
<tr class="no-table-style1">
<td class="no-table-style2">
<p class="calibre3"><span><strong class="source-inline"><span class="kobospan" id="kobo.434.1">Content-Type</span></strong></span></p>
</td>
<td class="no-table-style2">
<p class="calibre3"><span><strong class="source-inline"><span class="kobospan" id="kobo.435.1">application/json</span></strong></span></p>
</td>
</tr>
</tbody>
</table>
<p class="calibre3"><span class="kobospan" id="kobo.436.1">14.	</span><span class="kobospan" id="kobo.436.2">Select </span><strong class="bold"><span class="kobospan" id="kobo.437.1">Body</span></strong><span class="kobospan" id="kobo.438.1"> in the sub-menu and then select </span><strong class="bold"><span class="kobospan" id="kobo.439.1">raw</span></strong><span class="kobospan" id="kobo.440.1"> for the request type. </span><span class="kobospan" id="kobo.440.2">Enter the following request body. </span><span class="kobospan" id="kobo.440.3">After that, </span><span><span class="kobospan" id="kobo.441.1">select </span></span><span><strong class="bold"><span class="kobospan" id="kobo.442.1">Send</span></strong></span><span><span class="kobospan" id="kobo.443.1">:</span></span></p>
<pre class="source-code"><span class="kobospan1" id="kobo.444.1">
# Request Body
{
    "name": "A company that sells ice cream"
}</span></pre> <p class="calibre3"><span class="kobospan" id="kobo.445.1">15.	</span><span class="kobospan" id="kobo.445.2">After</span><a id="_idIndexMarker232" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.446.1"> sending the HTTP request, you should see the following response from your public endpoint. </span><span class="kobospan" id="kobo.446.2">Note that your message value may be different, but the structure should be </span><span><span class="kobospan" id="kobo.447.1">the same:</span></span></p>
<pre class="source-code"><span class="kobospan1" id="kobo.448.1">
# Response
{
    "number_of_characters": 63,
    "slogan": "\"Scoop up happiness with our irresistible ice cream creations!\""
}</span></pre> <h2 id="_idParaDest-95" class="calibre7"><a id="_idTextAnchor101" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.449.1">How it works…</span></h2>
<p class="calibre3"><span class="kobospan" id="kobo.450.1">In this recipe, we created a Cloud Function that simply was able to take in inputs and produce structured output. </span><span class="kobospan" id="kobo.450.2">This is important as, when we build our intelligent applications, we will need to create endpoints like these that the application </span><span><span class="kobospan" id="kobo.451.1">relies on.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.452.1">To do this, we made two sets of edits to the Python code we used from the </span><span><span class="kobospan" id="kobo.453.1">first recipe.</span></span></p>
<h3 class="calibre8"><span class="kobospan" id="kobo.454.1">Accepting inputs</span></h3>
<p class="calibre3"><span class="kobospan" id="kobo.455.1">Cloud Functions </span><a id="_idIndexMarker233" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.456.1">have an object assigned to collect inputs made from HTTP Post requests. </span><span class="kobospan" id="kobo.456.2">This object can be found as an argument to the input function, which in this case is </span><strong class="source-inline"><span class="kobospan" id="kobo.457.1">create_slogan_with_parameters (request)</span></strong><span class="kobospan" id="kobo.458.1">, and so the object is </span><strong class="source-inline"><span class="kobospan" id="kobo.459.1">request</span></strong><span class="kobospan" id="kobo.460.1">. </span><span class="kobospan" id="kobo.460.2">This object stores the HTTP request (along with its request body and headers) and can be converted to JSON using the code. </span><span class="kobospan" id="kobo.460.3">We can then parse through the JSON object to retrieve the particular input, which in this case is </span><strong class="source-inline"><span class="kobospan" id="kobo.461.1">name</span></strong><span class="kobospan" id="kobo.462.1">, and assign it to the </span><span><strong class="source-inline"><span class="kobospan" id="kobo.463.1">business_description</span></strong></span><span><span class="kobospan" id="kobo.464.1"> variable.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.465.1">In this way, we </span><a id="_idIndexMarker234" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.466.1">have created a Cloud Function that can take in and parse any input from the request body of </span><span><span class="kobospan" id="kobo.467.1">HTTP requests.</span></span></p>
<h3 class="calibre8"><span class="kobospan" id="kobo.468.1">Creating structured outputs</span></h3>
<p class="calibre3"><span class="kobospan" id="kobo.469.1">Next, we </span><a id="_idIndexMarker235" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.470.1">need to return outputs from the Cloud Function in a structured form, such as JSON. </span><span class="kobospan" id="kobo.470.2">Using JSON instead of a string to obtain outputs is important for two </span><span><span class="kobospan" id="kobo.471.1">main reasons:</span></span></p>
<ul class="calibre16">
<li class="calibre15"><em class="italic"><span class="kobospan" id="kobo.472.1">Structured multiple outputs</span></em><span class="kobospan" id="kobo.473.1">: JSON allows us to structure multiple data points in an organized manner. </span><span class="kobospan" id="kobo.473.2">You can easily represent different outputs as separate key-value pairs within a single JSON object. </span><span class="kobospan" id="kobo.473.3">This structure makes it straightforward to handle and access multiple pieces of data returned by the </span><span><span class="kobospan" id="kobo.474.1">Cloud Function.</span></span></li>
<li class="calibre15"><em class="italic"><span class="kobospan" id="kobo.475.1">Nested and complex data</span></em><span class="kobospan" id="kobo.476.1">: JSON can handle nested structures, meaning you can have JSON objects within JSON objects. </span><span class="kobospan" id="kobo.476.2">This feature is particularly useful when your Cloud Function needs to return complex data with multiple layers or </span><span><span class="kobospan" id="kobo.477.1">hierarchical information.</span></span></li>
</ul>
<p class="calibre3"><span class="kobospan" id="kobo.478.1">In the code, we did this in Python by defining a JSON object with two elements: </span><strong class="source-inline"><span class="kobospan" id="kobo.479.1">slogan</span></strong><span class="kobospan" id="kobo.480.1"> and </span><strong class="source-inline"><span class="kobospan" id="kobo.481.1">number of characters</span></strong><span class="kobospan" id="kobo.482.1">. </span><span class="kobospan" id="kobo.482.2">In this way, whoever or whatever uses our endpoint will be able to parse through these outputs </span><span><span class="kobospan" id="kobo.483.1">with ease.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.484.1">In this recipe, we took another leap into creating intelligent applications with the OpenAI API, by creating an endpoint that takes in a user-defined customizable input, processes it, calls the OpenAI API, and then returns a structured JSON output that can </span><span><span class="kobospan" id="kobo.485.1">be parsed.</span></span></p>
<h1 id="_idParaDest-96" class="calibre5"><a id="_idTextAnchor102" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.486.1">Calling the user-created endpoint from no-code applications</span></h1>
<p class="calibre3"><span class="kobospan" id="kobo.487.1">In this recipe, we</span><a id="_idIndexMarker236" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.488.1"> will finalize the development process by creating an application (or a frontend user interface) that will call the public endpoint from the previous recipe. </span><span class="kobospan" id="kobo.488.2">To do this efficiently, we will use a no-code application development platform </span><span><span class="kobospan" id="kobo.489.1">called </span></span><span><em class="italic"><span class="kobospan" id="kobo.490.1">Bubble</span></em></span><span><span class="kobospan" id="kobo.491.1">.</span></span></p>
<p class="calibre3"><strong class="bold"><span class="kobospan" id="kobo.492.1">No-code application development</span></strong><span class="kobospan" id="kobo.493.1"> refers to a method of creating software applications </span><a id="_idIndexMarker237" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.494.1">without the need for traditional programming. </span><span class="kobospan" id="kobo.494.2">It uses graphical interfaces and configuration instead of writing code in a programming language. </span><span class="kobospan" id="kobo.494.3">This approach makes app development accessible to people without a programming background, democratizing the ability to create and </span><span><span class="kobospan" id="kobo.495.1">deploy applications.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.496.1">Platforms such as</span><a id="_idIndexMarker238" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.497.1"> Bubble are prominent examples of no-code development environments. </span><span class="kobospan" id="kobo.497.2">Bubble is a popular no-code development platform that enables individuals and businesses to create web applications without the need for traditional programming. </span><span class="kobospan" id="kobo.497.3">It enables users to create web applications with robust functionality without needing to understand or write any </span><span><span class="kobospan" id="kobo.498.1">programming code.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.499.1">This approach is increasingly popular for small businesses and start-ups, and within enterprise settings for developing internal tools and prototypes. </span><span class="kobospan" id="kobo.499.2">Bubble also enables users to create applications that call public endpoints and APIs, which we will leverage in </span><span><span class="kobospan" id="kobo.500.1">this recipe.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.501.1">In this recipe, we</span><a id="_idIndexMarker239" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.502.1"> will create a simple application in Bubble that calls the public endpoint we’ve created, that returns </span><span><span class="kobospan" id="kobo.503.1">marketing slogans.</span></span></p>
<h2 id="_idParaDest-97" class="calibre7"><a id="_idTextAnchor103" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.504.1">Getting ready</span></h2>
<p class="calibre3"><span class="kobospan" id="kobo.505.1">You must create a</span><a id="_idIndexMarker240" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.506.1"> Bubble account to follow this recipe. </span><span class="kobospan" id="kobo.506.2">You can create a free Bubble account by following the steps at </span><a href="http://bubble.io" class="pcalibre1 calibre6 pcalibre"><span class="kobospan" id="kobo.507.1">http://bubble.io</span></a><span class="kobospan" id="kobo.508.1">. </span><span class="kobospan" id="kobo.508.2">There is no need to pay for a paid tier – all the features we will use in this book can be done through the </span><span><span class="kobospan" id="kobo.509.1">free tier.</span></span></p>
<h2 id="_idParaDest-98" class="calibre7"><a id="_idTextAnchor104" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.510.1">How to do it…</span></h2>
<ol class="calibre14">
<li class="calibre15"><span class="kobospan" id="kobo.511.1">After you have created an account in Bubble and logged in, navigate to </span><a href="https://bubble.io/home/apps" class="pcalibre1 calibre6 pcalibre"><span class="kobospan" id="kobo.512.1">https://bubble.io/home/apps</span></a><span class="kobospan" id="kobo.513.1"> and select </span><strong class="bold"><span class="kobospan" id="kobo.514.1">Create an app</span></strong><span class="kobospan" id="kobo.515.1"> in the top-right corner of </span><span><span class="kobospan" id="kobo.516.1">the screen.</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.517.1">Leave the </span><strong class="bold"><span class="kobospan" id="kobo.518.1">Start from a template</span></strong><span class="kobospan" id="kobo.519.1"> option blank. </span><span class="kobospan" id="kobo.519.2">Name your app something unique, such as </span><strong class="source-inline1"><span class="kobospan" id="kobo.520.1">marketingslogan154</span></strong><span class="kobospan" id="kobo.521.1">. </span><span class="kobospan" id="kobo.521.2">Select the </span><strong class="bold"><span class="kobospan" id="kobo.522.1">Start with basic </span></strong><span><strong class="bold"><span class="kobospan" id="kobo.523.1">features</span></strong></span><span><span class="kobospan" id="kobo.524.1"> button.</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.525.1">If an option </span><a id="_idIndexMarker241" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.526.1">called </span><strong class="bold"><span class="kobospan" id="kobo.527.1">Skip application assistant</span></strong><span class="kobospan" id="kobo.528.1"> appears, select it, as we will be going through all the steps manually ourselves. </span><span class="kobospan" id="kobo.528.2">You should now see the Bubble </span><strong class="bold"><span class="kobospan" id="kobo.529.1">UI Builder</span></strong><span class="kobospan" id="kobo.530.1">, which</span><a id="_idIndexMarker242" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.531.1"> is a blank canvas with a menu bar on the left-hand side, as shown in </span><span><em class="italic"><span class="kobospan" id="kobo.532.1">Figure 5</span></em></span><span><em class="italic"><span class="kobospan" id="kobo.533.1">.7</span></em></span><span><span class="kobospan" id="kobo.534.1">.</span></span></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer042">
<span class="kobospan" id="kobo.535.1"><img alt="Figure 5.7 – Bubble UI Builder screen" src="image/B21007_05_07.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.536.1">Figure 5.7 – Bubble UI Builder screen</span></p>
<ol class="calibre14">
<li value="4" class="calibre15"><span class="kobospan" id="kobo.537.1">The first thing we are going to do is set up the endpoint/API connection. </span><span class="kobospan" id="kobo.537.2">Select </span><strong class="bold"><span class="kobospan" id="kobo.538.1">Plugins</span></strong><span class="kobospan" id="kobo.539.1"> from the left-hand menu, and then select </span><span><strong class="bold"><span class="kobospan" id="kobo.540.1">Add plugins</span></strong></span><span><span class="kobospan" id="kobo.541.1">.</span></span></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer043">
<span class="kobospan" id="kobo.542.1"><img alt="Figure 5.8 – Selecting plugins for our app" src="image/B21007_05_08.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.543.1">Figure 5.8 – Selecting plugins for our app</span></p>
<ol class="calibre14">
<li value="5" class="calibre15"><span class="kobospan" id="kobo.544.1">Install the </span><strong class="bold"><span class="kobospan" id="kobo.545.1">API Connector</span></strong><span class="kobospan" id="kobo.546.1"> by selecting the </span><strong class="bold"><span class="kobospan" id="kobo.547.1">Install</span></strong><span class="kobospan" id="kobo.548.1"> button on the API Connector </span><a id="_idIndexMarker243" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.549.1">element. </span><span class="kobospan" id="kobo.549.2">This will enable your Bubble app to call endpoints and APIs. </span><span class="kobospan" id="kobo.549.3">After it has been installed, </span><span><span class="kobospan" id="kobo.550.1">select </span></span><span><strong class="bold"><span class="kobospan" id="kobo.551.1">Done</span></strong></span><span><span class="kobospan" id="kobo.552.1">.</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.553.1">After that, you</span><a id="_idIndexMarker244" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.554.1"> should see the API connector on your </span><strong class="bold"><span class="kobospan" id="kobo.555.1">Plugins</span></strong><span class="kobospan" id="kobo.556.1"> page. </span><span class="kobospan" id="kobo.556.2">Select the </span><strong class="bold"><span class="kobospan" id="kobo.557.1">Add another API</span></strong><span class="kobospan" id="kobo.558.1"> button. </span><span class="kobospan" id="kobo.558.2">A set of configuration options </span><span><span class="kobospan" id="kobo.559.1">will appear.</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.560.1">Now, we need to initialize our API/endpoint connection. </span><span class="kobospan" id="kobo.560.2">For the configuration options, select or type in the following. </span><span class="kobospan" id="kobo.560.3">Note that you may need to select the </span><em class="italic"><span class="kobospan" id="kobo.561.1">expand</span></em><span class="kobospan" id="kobo.562.1"> button near </span><strong class="bold"><span class="kobospan" id="kobo.563.1">API Call</span></strong><span class="kobospan" id="kobo.564.1"> to view all the options. </span><span class="kobospan" id="kobo.564.2">Also, note that this looks similar to the Postman interface, which is </span><span><span class="kobospan" id="kobo.565.1">by design:</span></span><ul class="calibre17"><li class="calibre15"><strong class="bold"><span class="kobospan" id="kobo.566.1">API </span></strong><span><strong class="bold"><span class="kobospan" id="kobo.567.1">Name</span></strong></span><span><span class="kobospan" id="kobo.568.1">: </span></span><span><strong class="source-inline1"><span class="kobospan" id="kobo.569.1">API</span></strong></span></li><li class="calibre15"><strong class="bold"><span class="kobospan" id="kobo.570.1">Name</span></strong><span class="kobospan" id="kobo.571.1">: </span><span><strong class="source-inline1"><span class="kobospan" id="kobo.572.1">Slogan Generator</span></strong></span></li><li class="calibre15"><strong class="bold"><span class="kobospan" id="kobo.573.1">Use </span></strong><span><strong class="bold"><span class="kobospan" id="kobo.574.1">as</span></strong></span><span><span class="kobospan" id="kobo.575.1">: </span></span><span><strong class="source-inline1"><span class="kobospan" id="kobo.576.1">Data</span></strong></span></li><li class="calibre15"><strong class="bold"><span class="kobospan" id="kobo.577.1">Data </span></strong><span><strong class="bold"><span class="kobospan" id="kobo.578.1">type</span></strong></span><span><span class="kobospan" id="kobo.579.1">: </span></span><span><strong class="source-inline1"><span class="kobospan" id="kobo.580.1">JSON</span></strong></span></li><li class="calibre15"><strong class="bold"><span class="kobospan" id="kobo.581.1">Request type</span></strong><span class="kobospan" id="kobo.582.1">: </span><strong class="source-inline1"><span class="kobospan" id="kobo.583.1">POST</span></strong><span class="kobospan" id="kobo.584.1"> (the default </span><span><span class="kobospan" id="kobo.585.1">is </span></span><span><strong class="bold"><span class="kobospan" id="kobo.586.1">GET</span></strong></span><span><span class="kobospan" id="kobo.587.1">)</span></span></li><li class="calibre15"><strong class="bold"><span class="kobospan" id="kobo.588.1">URL</span></strong><span class="kobospan" id="kobo.589.1">: Type in the URL of the endpoint that you created in the </span><span><span class="kobospan" id="kobo.590.1">previous recipe</span></span></li></ul><p class="calibre3"><span class="kobospan" id="kobo.591.1">Select the </span><strong class="bold"><span class="kobospan" id="kobo.592.1">Add header</span></strong><span class="kobospan" id="kobo.593.1"> button</span><a id="_idIndexMarker245" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.594.1"> and </span><a id="_idIndexMarker246" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.595.1">put in the following for </span><strong class="bold"><span class="kobospan" id="kobo.596.1">Key</span></strong><span class="kobospan" id="kobo.597.1"> and </span><strong class="bold"><span class="kobospan" id="kobo.598.1">Value </span></strong><span class="kobospan" id="kobo.599.1">respectively: </span><strong class="source-inline"><span class="kobospan" id="kobo.600.1">Content-Type</span></strong> <span><span class="kobospan" id="kobo.601.1">and </span></span><span><strong class="source-inline"><span class="kobospan" id="kobo.602.1">application/json</span></strong></span><span><span class="kobospan" id="kobo.603.1">:</span></span></p><ul class="calibre17"><li class="calibre15"><strong class="bold"><span class="kobospan" id="kobo.604.1">Body </span></strong><span><strong class="bold"><span class="kobospan" id="kobo.605.1">type</span></strong></span><span><span class="kobospan" id="kobo.606.1">: </span></span><span><strong class="source-inline1"><span class="kobospan" id="kobo.607.1">JSON</span></strong></span></li><li class="calibre15"><span><strong class="bold"><span class="kobospan" id="kobo.608.1">Body</span></strong></span><span><span class="kobospan" id="kobo.609.1">:</span></span><pre class="source-code"><span class="kobospan1" id="kobo.610.1">
{
    "name": "A company that sells ice cream"
}</span></pre></li></ul><p class="calibre3"><span class="kobospan" id="kobo.611.1">Your screen should look like </span><span><em class="italic"><span class="kobospan" id="kobo.612.1">Figure 5</span></em></span><span><em class="italic"><span class="kobospan" id="kobo.613.1">.9</span></em></span><span><span class="kobospan" id="kobo.614.1">.</span></span></p></li> </ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer044">
<span class="kobospan" id="kobo.615.1"><img alt="Figure 5.9 – API Connector configurations" src="image/B21007_05_09.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.616.1">Figure 5.9 – API Connector configurations</span></p>
<ol class="calibre14">
<li value="8" class="calibre15"><span class="kobospan" id="kobo.617.1">Select</span><a id="_idIndexMarker247" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.618.1"> the </span><strong class="bold"><span class="kobospan" id="kobo.619.1">Initialize</span></strong><span class="kobospan" id="kobo.620.1"> call button near the bottom of the page. </span><span class="kobospan" id="kobo.620.2">If you do receive the </span><em class="italic"><span class="kobospan" id="kobo.621.1">500 error</span></em><span class="kobospan" id="kobo.622.1">, review</span><a id="_idIndexMarker248" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.623.1"> the previous recipe to ensure your endpoint/API is reachable and that it works. </span><span class="kobospan" id="kobo.623.2">Sometimes, you may need to repeat this step multiple times if the GCP servers are busy at the time you are testing </span><span><span class="kobospan" id="kobo.624.1">this call.</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.625.1">You should now see a screen called </span><strong class="bold"><span class="kobospan" id="kobo.626.1">Returned values – API call</span></strong><span class="kobospan" id="kobo.627.1">. </span><span class="kobospan" id="kobo.627.2">Ensure that you see two rows and that for each row, the data type is set up correctly as shown as follows (these should be the default values). </span><span><span class="kobospan" id="kobo.628.1">Select </span></span><span><strong class="bold"><span class="kobospan" id="kobo.629.1">Save</span></strong></span><span><span class="kobospan" id="kobo.630.1">.</span></span></li>
</ol>
<table class="no-table-style" id="table002-3">
<colgroup class="calibre10">
<col class="calibre11"/>
<col class="calibre11"/>
</colgroup>
<thead class="calibre12">
<tr class="no-table-style1">
<td class="no-table-style2">
<p class="calibre3"><strong class="source-inline"><span class="kobospan" id="kobo.631.1">number_of_characters</span></strong></p>
</td>
<td class="no-table-style2">
<p class="calibre3"><strong class="source-inline"><span class="kobospan" id="kobo.632.1">number</span></strong></p>
</td>
</tr>
</thead>
<tbody class="calibre13">
<tr class="no-table-style1">
<td class="no-table-style2">
<p class="calibre3"><strong class="source-inline"><span class="kobospan" id="kobo.633.1">slogan</span></strong></p>
</td>
<td class="no-table-style2">
<p class="calibre3"><strong class="source-inline"><span class="kobospan" id="kobo.634.1">text</span></strong></p>
</td>
</tr>
</tbody>
</table>
<ol class="calibre14">
<li value="10" class="calibre15"><span class="kobospan" id="kobo.635.1">Now that we </span><a id="_idIndexMarker249" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.636.1">have set up Bubble, let’s go ahead and add some elements. </span><span class="kobospan" id="kobo.636.2">Select the </span><strong class="bold"><span class="kobospan" id="kobo.637.1">Design</span></strong><span class="kobospan" id="kobo.638.1"> button from</span><a id="_idIndexMarker250" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.639.1"> the left-hand menu. </span><span class="kobospan" id="kobo.639.2">Then select the </span><strong class="bold"><span class="kobospan" id="kobo.640.1">Text</span></strong><span class="kobospan" id="kobo.641.1"> element and drag it to the middle of the screen. </span><span class="kobospan" id="kobo.641.2">You should now see the element highlighted, with a property menu for that element on the </span><span><span class="kobospan" id="kobo.642.1">right side.</span></span></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer045">
<span class="kobospan" id="kobo.643.1"><img alt="Figure 5.10 – Text element in Bubble UI Builder" src="image/B21007_05_10.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.644.1">Figure 5.10 – Text element in Bubble UI Builder</span></p>
<ol class="calibre14">
<li value="11" class="calibre15"><span class="kobospan" id="kobo.645.1">In the property menu, select the box that says </span><strong class="bold"><span class="kobospan" id="kobo.646.1">...edit me…</span></strong><span class="kobospan" id="kobo.647.1"> and select </span><strong class="bold"><span class="kobospan" id="kobo.648.1">Insert </span></strong><span><strong class="bold"><span class="kobospan" id="kobo.649.1">dynamic data</span></strong></span><span><span class="kobospan" id="kobo.650.1">.</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.651.1">In the drop-down menu, select </span><strong class="bold"><span class="kobospan" id="kobo.652.1">Get data from an external API</span></strong><span class="kobospan" id="kobo.653.1"> and a pop-up menu will appear on </span><span><span class="kobospan" id="kobo.654.1">the left.</span></span></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer046">
<span class="kobospan" id="kobo.655.1"><img alt="Figure 5.11 – Text menu from Bubble" src="image/B21007_05_11.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.656.1">Figure 5.11 – Text menu from Bubble</span></p>
<ol class="calibre14">
<li value="13" class="calibre15"><span class="kobospan" id="kobo.657.1">From the </span><a id="_idIndexMarker251" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.658.1">drop-down menu, select</span><a id="_idIndexMarker252" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.659.1"> the API that was created in </span><em class="italic"><span class="kobospan" id="kobo.660.1">step 7</span></em><span class="kobospan" id="kobo.661.1">. </span><span class="kobospan" id="kobo.661.2">In the </span><strong class="bold"><span class="kobospan" id="kobo.662.1">Body (JSON object)</span></strong><span class="kobospan" id="kobo.663.1"> menu, ensure that it reflects the JSON data from </span><em class="italic"><span class="kobospan" id="kobo.664.1">step 7</span></em><span class="kobospan" id="kobo.665.1">. </span><span class="kobospan" id="kobo.665.2">Then, select the text box and </span><span><span class="kobospan" id="kobo.666.1">select </span></span><span><strong class="bold"><span class="kobospan" id="kobo.667.1">slogan</span></strong></span><span><span class="kobospan" id="kobo.668.1">.</span></span></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer047">
<span class="kobospan" id="kobo.669.1"><img alt="Figure 5.12 – Text menu from Bubble" src="image/B21007_05_12.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.670.1">Figure 5.12 – Text menu from Bubble</span></p>
<p class="calibre3"><span class="kobospan" id="kobo.671.1">Our </span><a id="_idIndexMarker253" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.672.1">no-code Bubble</span><a id="_idIndexMarker254" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.673.1"> application </span><span><span class="kobospan" id="kobo.674.1">is complete!</span></span></p>
<ol class="calibre14">
<li value="14" class="calibre15"><span class="kobospan" id="kobo.675.1">Click the </span><strong class="bold"><span class="kobospan" id="kobo.676.1">Preview</span></strong><span class="kobospan" id="kobo.677.1"> button in the top-right corner of the screen to open the web application we have </span><span><span class="kobospan" id="kobo.678.1">just created.</span></span></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer048">
<span class="kobospan" id="kobo.679.1"><img alt="Figure 5.13 – Output in Bubble" src="image/B21007_05_13.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.680.1">Figure 5.13 – Output in Bubble</span></p>
<p class="calibre3"><span class="kobospan" id="kobo.681.1">As you can see, we</span><a id="_idIndexMarker255" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.682.1"> have now </span><a id="_idIndexMarker256" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.683.1">created a web application that generates slogans for ice cream companies. </span><span class="kobospan" id="kobo.683.2">Continue refreshing the screen and you can see </span><span><span class="kobospan" id="kobo.684.1">additional slogans.</span></span></p>
<p class="callout-heading"><span class="kobospan" id="kobo.685.1">Note</span></p>
<p class="callout"><span class="kobospan" id="kobo.686.1">Every time you refresh the screen, you will use tokens from the OpenAI API, so it is wise not to do it too many times in </span><span><span class="kobospan" id="kobo.687.1">a row.</span></span></p>
<h2 id="_idParaDest-99" class="calibre7"><a id="_idTextAnchor105" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.688.1">How it works…</span></h2>
<p class="calibre3"><span class="kobospan" id="kobo.689.1">In this recipe, we created a frontend application that invoked the public endpoint that we set up in the previous recipe. </span><span class="kobospan" id="kobo.689.2">This was the final building block in creating an intelligent application using the OpenAI API. </span><span class="kobospan" id="kobo.689.3">We also did this completely using </span><span><span class="kobospan" id="kobo.690.1">no-code tools.</span></span></p>
<h3 class="calibre8"><span class="kobospan" id="kobo.691.1">Bubble HTTP requests</span></h3>
<p class="calibre3"><span class="kobospan" id="kobo.692.1">The </span><a id="_idIndexMarker257" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.693.1">main achievement of this recipe was being able to make an HTTP request from a frontend application such as Bubble. </span><span class="kobospan" id="kobo.693.2">Most application platforms can make external API requests and this is certainly the case if you are building an application using traditional coding languages, such </span><span><span class="kobospan" id="kobo.694.1">as JavaScript.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.695.1">In Bubble, we did this through the API connector plugin, which simplifies the process of integrating with external APIs. </span><span class="kobospan" id="kobo.695.2">This plugin acts as a bridge between Bubble and the external service, allowing us to send and receive data seamlessly. </span><span class="kobospan" id="kobo.695.3">By configuring the API connector with the appropriate endpoints, authentication, and parameters, we were able to extend the functionality of our Bubble application to interact with other </span><span><span class="kobospan" id="kobo.696.1">web services.</span></span></p>
<h3 class="calibre8"><span class="kobospan" id="kobo.697.1">Connecting Bubble directly to OpenAI</span></h3>
<p class="calibre3"><span class="kobospan" id="kobo.698.1">It is</span><a id="_idIndexMarker258" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.699.1"> worth noting why we had to create our own backend layer endpoint instead of connecting directly to OpenAI. </span><span class="kobospan" id="kobo.699.2">Why did we have an </span><span><span class="kobospan" id="kobo.700.1">intermediary layer?</span></span></p>
<ul class="calibre16">
<li class="calibre15"><em class="italic"><span class="kobospan" id="kobo.701.1">Security concerns</span></em><span class="kobospan" id="kobo.702.1">: Directly integrating external APIs, especially those handling sensitive data or requiring authentication, can pose security risks. </span><span class="kobospan" id="kobo.702.2">By using a backend layer, sensitive information such as our OpenAI API keys or authentication tokens can be kept secure and not exposed in the client-side code that users may be able </span><span><span class="kobospan" id="kobo.703.1">to see.</span></span></li>
<li class="calibre15"><em class="italic"><span class="kobospan" id="kobo.704.1">Data processing and caching</span></em><span class="kobospan" id="kobo.705.1">: The intermediary layer can process, filter, or cache the data before sending it to the frontend. </span><span class="kobospan" id="kobo.705.2">This can optimize performance, reduce the load on the client side, and manage data flow more effectively. </span><span class="kobospan" id="kobo.705.3">For example, we process the data in the backend to also </span><span><span class="kobospan" id="kobo.706.1">extract </span></span><span><strong class="source-inline1"><span class="kobospan" id="kobo.707.1">number_of_characters</span></strong></span><span><span class="kobospan" id="kobo.708.1">.</span></span></li>
<li class="calibre15"><em class="italic"><span class="kobospan" id="kobo.709.1">Custom logic implementation</span></em><span class="kobospan" id="kobo.710.1">: The backend layer allows for the implementation of custom logic that might not be possible or efficient to handle on the client side. </span><span class="kobospan" id="kobo.710.2">This includes data transformation, complex calculations, or decision-making processes based on the data received </span><span><span class="kobospan" id="kobo.711.1">from OpenAI.</span></span></li>
</ul>
<p class="calibre3"><span class="kobospan" id="kobo.712.1">Overall, in this </span><a id="_idIndexMarker259" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.713.1">chapter, we took the significant next steps toward staging and hosting the OpenAI API and building an intelligent application. </span><span class="kobospan" id="kobo.713.2">We did this by creating a backend layer that took in inputs, processed them, and produced structured outputs, and we proved that we could invoke this endpoint from a </span><span><span class="kobospan" id="kobo.714.1">frontend application.</span></span></p>
</div>
</body></html>