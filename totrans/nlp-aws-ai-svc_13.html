<html><head></head><body><div id="sbo-rt-content"><div id="_idContainer230">
			<h1 id="_idParaDest-129"><em class="italic"><a id="_idTextAnchor133"/>Chapter 11</em>: Using Chatbots for Querying Documents</h1>
			<p>Imagine if you could have a two-way conversation with the text data in your documents. Let's suppose you subscribe to a number of journals that send you research articles on technology trends. These articles may cover multiple industries and technologies, but you are interested in insights about a specific industry and technology. Traditionally, you would have a team of people combing through these documents to interpret, understand, and recommend the direction you need to take. What if you could get all the data and answers you need just by flipping open your phone and talking to a chatbot that gives you the answers from your document corpus? Wouldn't that be awesome? That's the power of combining <strong class="bold">natural language processing</strong> (<strong class="bold">NLP</strong>) technology with chatbots. You can literally talk to your documents, and get a response too.</p>
			<p>In the previous chapter, we discussed how businesses were relying on technology to help them expand internationally, but traditional manual translation to localize customer-facing websites was both time- and cost-prohibitive. We then built a solution that utilized the potential of <strong class="bold">machine learning</strong> (<strong class="bold">ML</strong>) based translation capabilities with <strong class="bold">Amazon</strong> <strong class="bold">Translate</strong> to tackle website localization challenges efficiently. </p>
			<p>In this chapter, as before, we will go back to our favorite banking corporation, <em class="italic">LiveRight Holdings</em>, and help them solve a unique use case with NLP and chatbots. But before we get to the challenge and the solution, let's discuss the philosophy behind combining a conversational interface (aka the chatbot) with a text-based search for documents (more on this soon). Remember how we said the patterns that NLP can help uncover in seemingly unrelated documents is like the treasure in Ali Baba's cave (<a href="B17528_01_Final_SB_ePub.xhtml#_idTextAnchor020"><em class="italic">Chapter 1</em></a>, <em class="italic">NLP in the Business Context and Introduction to AWS AI Services</em> – we know, it feels like eons ago)? What if you had your own personal genie (as in the story of Aladdin) that could give you the insights you needed based on your questions? When we combine NLP and chatbots, it is like asking the genie to dole out treasures from Ali Baba's cave, on-demand, at your convenience. If you recollect, we did cover how to create smart search indexing with NLP before, but the solution we will discuss in this chapter takes it one step further to make searching even more user-friendly. To learn how to build a chatbot for querying documents, we will navigate through the following sections:</p>
			<ul>
				<li>Introducing the chatbot use case</li>
				<li>Creating an <strong class="bold">Amazon</strong> <strong class="bold">Kendra</strong> index with <strong class="bold">Amazon</strong> <strong class="bold">S3</strong> as a data source</li>
				<li>Building an <strong class="bold">Amazon</strong> <strong class="bold">Lex</strong> chatbot</li>
				<li>Deploying the solution with <strong class="bold">AWS</strong> <strong class="bold">CloudFormation</strong></li>
			</ul>
			<h1 id="_idParaDest-130"><a id="_idTextAnchor134"/>Technical requirements</h1>
			<p>For this chapter, you will need access to an <strong class="bold">AWS</strong> <strong class="bold">Account</strong>. Please make sure to follow the instructions specified in the <em class="italic">Technical requirements</em> section in <a href="B17528_02_Final_SB_ePub.xhtml#_idTextAnchor027"><em class="italic">Chapter 2</em></a>, <em class="italic">Introducing Amazon Textract</em>, to create your AWS Account, and log in to the <strong class="bold">AWS</strong> <strong class="bold">Management Console</strong>. If you need to understand how to upload objects to Amazon S3 buckets, please refer to the <em class="italic">Creating an Amazon S3 bucket, a folder, and uploading objects </em>section. Please complete these tasks before trying the steps in <em class="italic">Building a chatbot for querying documents</em>.</p>
			<p>For this chapter, we will be performing all of our tasks using the AWS Management Console. The GitHub repository provides the input documents and the FAQ list we need for our solution, available here: <a href="https://github.com/PacktPublishing/Natural-Language-Processing-with-AWS-AI-Services/tree/main/Chapter%2011">https://github.com/PacktPublishing/Natural-Language-Processing-with-AWS-AI-Services/tree/main/Chapter%2011</a>.</p>
			<p>Please use the instructions in the following sections to build the solution.</p>
			<h1 id="_idParaDest-131"><a id="_idTextAnchor135"/>Introducing the chatbot use case</h1>
			<p>Let's now discuss how using a chatbot with NLP can benefit businesses. Using an example is always <a id="_idIndexMarker636"/>helpful, so let's go back to our fictitious banking corporation <strong class="bold">LiveRight Holdings Private Limited</strong>. The <strong class="bold">Mortgage Product Research</strong> (<strong class="bold">MPR</strong>) department for LiveRight's mortgages business is an important entity within the organization, as their recommendations directly influence what mortgage products, features, and choices are offered to LiveRight's customers. This has a direct impact on LiveRight's revenues and profitability, as mortgage products are responsible for more than 40% of LiveRight's annual revenues. The MPR team receives hundreds of research documents incrementally on a monthly basis, both from mass subscription-based industry analysts and specialized independent researchers. Typically, the documents <a id="_idIndexMarker637"/>provide insights, trend reports, and detailed perspectives on what buyers look for in a home, the role of real estate agents, how home prices impact the sellers, and so on. These documents go to an Amazon S3 bucket that already has thousands of documents and is growing.</p>
			<p>A "day in the life of" scenario for the MPR team is to read these copious documents, analyze their content, identify areas, trends, and metrics of interest and categorize these facts, and eventually, these are collected, assessed together by the team as a whole in a day-long group meeting activity, compared with statistics from the past months, and finally, the recommendations are written down to be sent to executives, as well as fed into ML models for determining mortgage product features. Documents are received either at the end of the previous month or at the beginning of the month, and the team takes the whole month to read, analyze, categorize, discuss, and make recommendations. LiveRight's senior management has long suspected this, rightly, to be a very time-consuming and cost-prohibitive process, and as an organization that prides itself in being economical, wanted to automate the process to save time and reduce costs. Having seen how using NLP with AWS AI services has helped them in some of their other use cases, they reach out to you, the ML Enterprise Architect, to help them re-design this process and build an efficient solution. Additionally, senior management wanted to harness the potential of the very talented researchers in the MPR for new innovations rather than wasting their time on menial and repetitive tasks.</p>
			<p>You find this request from LiveRight both challenging and exciting, as it's a use case that's tailor-made <a id="_idIndexMarker638"/>for NLP and AI. You immediately decide that the best way to help the MPR team discuss and decide on their recommendations would be an <strong class="bold">intelligent AI assistant</strong> that participates in their meetings – listening to their questions and answering <a id="_idIndexMarker639"/>them for them. After some analysis, you decide to go with Amazon Lex (<a href="https://aws.amazon.com/lex/">https://aws.amazon.com/lex/</a>), a fully managed AI service powered by ML models to build intelligent chatbots that can interact in both voice <a id="_idIndexMarker640"/>and text with continuous learning capabilities, and Amazon Kendra (<a href="https://aws.amazon.com/kendra/">https://aws.amazon.com/kendra/</a>), a fully managed ML-powered enterprise search service that uses NLP to create intelligent indexes for your documents, accepts your queries in natural language, and returns responses which <a id="_idIndexMarker641"/>match the context accurately. You check the Amazon Lex pricing (<a href="https://aws.amazon.com/lex/pricing/">https://aws.amazon.com/lex/pricing/</a>) and realize that, for 8,000 speech requests and 2,000 text request interactions with the chatbot in the US East (N. Virginia) region, it will <a id="_idIndexMarker642"/>cost you only $33.50 a month. You check the Amazon Kendra pricing (<a href="https://aws.amazon.com/kendra/pricing/">https://aws.amazon.com/kendra/pricing/</a>) and see that the Developer Edition supports 10,000 <a id="_idIndexMarker643"/>documents and 4,000 queries per day, at a price of $1.125 per hour or $810 per month. You decide to use the Developer Edition for the pilot phase and move to the Enterprise Edition after user acceptance.</p>
			<p class="callout-heading">Note</p>
			<p class="callout">These prices are correct at the time of writing. Please check the links for an up-to-date figure.</p>
			<p>You are now ready to build the solution. As mentioned before, we will be walking through this solution <a id="_idIndexMarker644"/>entirely using the AWS Management Console (<a href="https://aws.amazon.com/console/">https://aws.amazon.com/console/</a>). If you do not have access to the AWS Management Console, please follow the detailed instructions in the <em class="italic">Technical requirements</em> section in <a href="B17528_02_Final_SB_ePub.xhtml#_idTextAnchor027"><em class="italic">Chapter 2</em></a>, <em class="italic">Introducing Amazon Textract</em> of this book.</p>
			<p>First, let's complete the pre-requisites before we move on to the solution build:</p>
			<ol>
				<li>Download the sample home buyer research documents from our GitHub repository. From your local computer, open an internet browser (preferably <strong class="bold">Google</strong> <strong class="bold">Chrome</strong> <em class="italic">version</em> <em class="italic">9.1</em> and above) and go to <a href="https://github.com/PacktPublishing/Natural-Language-Processing-with-AWS-AI-Services/tree/main/Chapter%2011">https://github.com/PacktPublishing/Natural-Language-Processing-with-AWS-AI-Services/tree/main/Chapter%2011</a>.</li>
				<li>Download each of the four documents present by clicking the document name, one document at a time.</li>
				<li>On the document page, click the <strong class="bold">Download</strong> button on the right to download the document to your computer.</li>
				<li>Upload these downloaded documents to an Amazon S3 bucket, as per the instructions <a id="_idIndexMarker645"/>provided in the <em class="italic">Creating an Amazon S3 bucket, a folder, and uploading objects</em> section in <a href="B17528_02_Final_SB_ePub.xhtml#_idTextAnchor027"><em class="italic">Chapter 2</em></a>, <em class="italic">Introducing Amazon Textract,</em> of this book. When creating the Amazon S3 folder in the bucket, please use the following folder/prefix paths – <strong class="source-inline">chapter11/kendra-faq/faqs.csv</strong>, <strong class="source-inline">chapter11/kendra/2019-NAR-HBS.pdf</strong>, <strong class="source-inline">chapter11/kendra/2020-generational-trends-report-03-05-2020.pdf</strong>, <strong class="source-inline">chapter11/kendra/</strong> <strong class="source-inline">Zillow-home-buyers-report.pdf</strong>.</li>
				<li>Now, you are ready to start building the solution.</li>
			</ol>
			<p>In this section, we introduced the need for chatbots with NLP and the business benefits associated with this solution. In the next section, we will walk through the building of the solution step-by-step.</p>
			<h1 id="_idParaDest-132"><a id="_idTextAnchor136"/>Creating an Amazon Kendra index with Amazon S3 as a data source</h1>
			<p>In this section, we will first create an Amazon Kendra index and add the S3 bucket to which we <a id="_idIndexMarker646"/>uploaded our sample research documents in the previous section, as an Amazon S3 data source.</p>
			<p class="callout-heading">Note</p>
			<p class="callout">Before you continue, please ensure you have executed the steps in the <em class="italic">Technical requirements</em> section and the pre-requisites mentioned in the <em class="italic">Introducing the chatbot use case</em> section.</p>
			<p>Please execute the following steps to create your Amazon Kendra index:</p>
			<ol>
				<li value="1">If not already done, log in to your <strong class="bold">AWS Management Console</strong> as per the instructions in the <em class="italic">Technical requirements</em> section in <a href="B17528_02_Final_SB_ePub.xhtml#_idTextAnchor027"><em class="italic">Chapter 2</em></a>, <em class="italic">Introducing Amazon Textract</em>.</li>
				<li>Type <strong class="source-inline">kendra</strong> in the <strong class="bold">Services</strong> search bar in the top center of the page and select <strong class="bold">Amazon Kendra</strong> from the list. When the <strong class="bold">Amazon Kendra</strong> console opens up, click <strong class="bold">Create an Index</strong>, as shown here:<div id="_idContainer204" class="IMG---Figure"><img src="Images/B17528_11_01.jpg" alt="Figure 11.1 – Creating an Amazon Kendra index" width="925" height="525"/></div><p class="figure-caption">Figure 11.1 – Creating an Amazon Kendra index</p></li>
				<li>In the <strong class="bold">Specify index details</strong> page, type a name for your index, add an optional <a id="_idIndexMarker647"/>description, select <strong class="bold">Create a new role (Recommended)</strong> from the <strong class="bold">IAM role</strong> list box, and type a <strong class="bold">Role name</strong>, as shown in the following screenshot. Then, click <strong class="bold">Next</strong> to continue:<div id="_idContainer205" class="IMG---Figure"><img src="Images/B17528_11_02.jpg" alt="Figure 11.2 – Specify index details&#13;&#10;" width="1079" height="807"/></div><p class="figure-caption">Figure 11.2 – Specify index details</p></li>
				<li>Leave the default selections in the <strong class="bold">Configure user access control</strong> page and click <strong class="bold">Next</strong> to continue.</li>
				<li>Leave the default selection to point to <strong class="bold">Developer edition</strong> in the <strong class="bold">Specify provisioning</strong> page and click <strong class="bold">Create</strong>. Amazon Kendra will start the index creation job. It may <a id="_idIndexMarker648"/>take about 15 to 30 minutes, so feel free to grab some snacks and coffee/tea in the meantime.</li>
				<li>When the index has been successfully created, click the <strong class="bold">Add data sources</strong> button to proceed.</li>
				<li>In the <strong class="bold">Add a data source connector to your Amazon Kendra index</strong> page, scroll down and click <strong class="bold">Add connector</strong> in the <strong class="bold">Amazon S3</strong> card under <strong class="bold">Select data source connector type</strong>.</li>
				<li>In the <strong class="bold">Specify data source details</strong> page, type the <strong class="bold">Data source name</strong> and click <strong class="bold">Next</strong>.</li>
				<li>In the <strong class="bold">Configure sync settings</strong> page, provide the name of the Amazon S3 bucket to <a id="_idIndexMarker649"/>which you uploaded your research documents as part of the pre-requisite steps in the <em class="italic">Introducing the chatbot use case</em> section. Scroll down and expand the <strong class="bold">Additional configuration – optional</strong> section, and in the <strong class="bold">Include patterns</strong> tab, select <strong class="bold">Prefix</strong> in the <strong class="bold">Type</strong> list box, type <strong class="source-inline">chapter11/kendra</strong>, and click the <strong class="bold">Add</strong> button:<div id="_idContainer206" class="IMG---Figure"><img src="Images/B17528_11_03.jpg" alt="Figure 11.3 – Configure sync settings&#13;&#10;" width="1076" height="744"/></div><p class="figure-caption">Figure 11.3 – Configure sync settings</p></li>
				<li>Now, scroll <a id="_idIndexMarker650"/>down a little in the page to the <strong class="bold">IAM role</strong> info and select <strong class="bold">Create a new role (Recommended)</strong> in the <strong class="bold">IAM role</strong> list box and type a <strong class="bold">Role name</strong> of your choice. In the <strong class="bold">Sync Run Schedule</strong> info, select <strong class="bold">Run on demand</strong> for <strong class="bold">Frequency</strong>. Click <strong class="bold">Next</strong> to continue.<div id="_idContainer207" class="IMG---Figure"><img src="Images/B17528_11_04.jpg" alt="Figure 11.4 – Data source sync settings IAM role and run schedule&#13;&#10;" width="912" height="723"/></div><p class="figure-caption">Figure 11.4 – Data source sync settings IAM role and run schedule</p></li>
				<li>Review <a id="_idIndexMarker651"/>your inputs and click <strong class="bold">Add data source</strong>. Amazon Kendra will first propagate the IAM role and then create the data source.</li>
				<li>After the data source has been created, click the <strong class="bold">Sync now</strong> button to index our documents for searching.</li>
				<li>The sync will take about 30 minutes (time for your next break). After it completes, you can review the <strong class="bold">Sync run history</strong>.</li>
				<li>Now, we will add a few FAQs to the index to enable adding more context to the search. Select the <strong class="bold">FAQs</strong> option from the left pane under the <strong class="bold">Data management</strong> heading for your index and click <strong class="bold">Add FAQ</strong>.</li>
				<li>Type a <strong class="bold">FAQ name</strong> of your choice. Select <strong class="bold">.csv file – Basic</strong> in the <strong class="bold">FAQ file format</strong> list box. Scroll down to S3 and type the S3 bucket and prefix location <a id="_idIndexMarker652"/>of where you uploaded the <strong class="source-inline">faqs.csv</strong> file in the pre-requisite steps of the <em class="italic">Introducing the chatbot use case</em> section. In the <strong class="bold">IAM role</strong>, select <strong class="bold">Create a new role (Recommended)</strong> and type a <strong class="bold">Role name</strong> of your choice. Scroll down and click <strong class="bold">Add</strong>.</li>
				<li>Amazon Kendra will start the FAQ job which should complete in a few minutes.</li>
			</ol>
			<p>We have now completed the steps required to set up an intelligent search for our sample research documents using Amazon Kendra. In the next section, we will build the steps needed to create an Amazon Lex chatbot.</p>
			<h1 id="_idParaDest-133"><a id="_idTextAnchor137"/>Building an Amazon Lex chatbot</h1>
			<p>In this section, we will execute the steps needed to build an Amazon Lex chatbot and use a built-in <em class="italic">intent</em> (which is a task performed by the bot based on a user request) to integrate our <a id="_idIndexMarker653"/>chatbot with the Amazon Kendra index we created in the preceding section. Please execute the steps as follows:</p>
			<ol>
				<li value="1">In the AWS Management Console, type <strong class="source-inline">lex</strong> in the <strong class="bold">Services</strong> search bar at the top center of the page and select <strong class="bold">Amazon Lex</strong> from the list to go to the Amazon Lex console. On the left pane of the Amazon Lex console, click the <strong class="bold">Switch to the new Lex V2 console</strong> link, as shown in the next screenshot:<div id="_idContainer208" class="IMG---Figure"><img src="Images/B17528_11_05.jpg" alt="Figure 11.5 – Switch to the new Lex V2 console" width="859" height="221"/></div><p class="figure-caption">Figure 11.5 – Switch to the new Lex V2 console</p></li>
				<li>On the <a id="_idIndexMarker654"/>Lex V2 console page, click <strong class="bold">Create bot</strong> on the right, as shown here:<div id="_idContainer209" class="IMG---Figure"><img src="Images/B17528_11_06.jpg" alt="Figure 11.6 – Create bot&#13;&#10;" width="985" height="571"/></div><p class="figure-caption">Figure 11.6 – Create bot</p></li>
				<li>In the <strong class="bold">Configure bot settings</strong> page, select <strong class="bold">Create</strong> for the <strong class="bold">Creation method</strong>. Under <strong class="bold">Bot configuration</strong>, type <strong class="source-inline">HomeBuyerResearch</strong> for the <strong class="bold">Bot name</strong>. In the <strong class="bold">IAM permissions</strong> section, select <strong class="bold">Create a role with basic Amazon Lex permissions</strong> for the <strong class="bold">Runtime role</strong>.<div id="_idContainer210" class="IMG---Figure"><img src="Images/B17528_11_07.jpg" alt="Figure 11.7 – Configure bot settings&#13;&#10;" width="1007" height="612"/></div><p class="figure-caption">Figure 11.7 – Configure bot settings</p></li>
				<li>Scroll down to <strong class="bold">Children's Online Privacy Protection Act (COPPA)</strong> and select <strong class="bold">No</strong>. Type <strong class="source-inline">5</strong> and select <strong class="bold">minute(s)</strong> for the <strong class="bold">Idle session timeout</strong>, and click <strong class="bold">Next</strong> on the bottom right of the page.</li>
				<li>In the <strong class="bold">Add language to bot</strong> page, leave the <strong class="bold">Select language</strong> as <strong class="bold">English (US)</strong>, and select <strong class="bold">Joanna</strong> in the <strong class="bold">Voice interaction</strong> list box. Click <strong class="bold">Done</strong> on the bottom <a id="_idIndexMarker655"/>right of the page.</li>
				<li>When the bot is created, Amazon Lex will automatically add an intent called <strong class="source-inline">NewIntent</strong> to start the bot building process.<div id="_idContainer211" class="IMG---Figure"><img src="Images/B17528_11_08.jpg" alt="Figure 11.8 – &quot;NewIntent&quot; added by Lex&#13;&#10;" width="1074" height="587"/></div><p class="figure-caption">Figure 11.8 – "NewIntent" added by Lex</p></li>
				<li>Scroll <a id="_idIndexMarker656"/>down to the <strong class="bold">Sample utterances</strong> section, type <strong class="source-inline">utterance for new intent</strong> at the bottom, and click <strong class="bold">Add utterance</strong>. <p class="callout-heading">Note</p><p class="callout">Amazon Lex requires one custom intent by default. For our solution, we only need the Kendra built-in intent. So, we will make the <strong class="source-inline">NewIntent</strong> a custom intent (that's mandatory for <a id="_idIndexMarker657"/>building the bot) unresolvable by providing an utterance that will not be used during our interaction with the bot. This will force the resolution to our Amazon Kendra built-in intent.</p></li>
				<li>Scroll down and click <strong class="bold">Save Intent</strong> at the bottom right of the page.</li>
				<li>Now, let's go back <a id="_idIndexMarker658"/>to the intents list. Click <strong class="bold">Back to intents list</strong> on the top left pane under the <strong class="bold">Amazon Lex</strong> heading.</li>
				<li>In the <strong class="bold">Intents</strong> page, click <strong class="bold">Add intent</strong> on the right, and select <strong class="bold">Use built-in intent</strong>, as shown in the following screenshot:<div id="_idContainer212" class="IMG---Figure"><img src="Images/B17528_11_09.jpg" alt="Figure 11.9 – Add built-in intent&#13;&#10;" width="890" height="248"/></div><p class="figure-caption">Figure 11.9 – Add built-in intent</p></li>
				<li>In the <strong class="bold">Use built-in intent</strong> popup, type <strong class="source-inline">kendra</strong> in the list box, and select <strong class="bold">AMAZON.KendraSearchIntent</strong>.<div id="_idContainer213" class="IMG---Figure"><img src="Images/B17528_11_10.jpg" alt="Figure 11.10 – Amazon Kendra built-in intent for Lex&#13;&#10;" width="593" height="363"/></div><p class="figure-caption">Figure 11.10 – Amazon Kendra built-in intent for Lex</p></li>
				<li>In the <strong class="bold">Intent name</strong> field that appears, type <strong class="source-inline">ResearchBuyers</strong>, and in the <strong class="bold">Amazon Kendra index</strong> field that appears, select the index name you created in the <a id="_idIndexMarker659"/>preceding section (which is <strong class="source-inline">chapter11-houses-index</strong> if you used the same name mentioned in the book), and click <strong class="bold">Add</strong>.</li>
				<li>Scroll down to the <strong class="bold">Closing responses</strong> section and type <strong class="source-inline">Here is what I found for your query:((x-amz-lex:kendra-search-response-answer-1))</strong> in the <strong class="bold">Message</strong> field, and click on <strong class="bold">Save Intent</strong>. After the intent is saved, click on <strong class="bold">More response options</strong>.</li>
				<li>In the <strong class="bold">Closing responses editor</strong> window that appears, click on <strong class="bold">Add</strong>, select <strong class="bold">Add text message group</strong>, and in the <strong class="bold">Message group</strong> card that appears, type <strong class="source-inline">I found a FAQ question for you: ((x-amz-lex:kendra-search-response-question_answer-question-1)) and the answer is ((x-amz-lex:kendra-search-response-question_answer-answer-1))</strong> in the <strong class="bold">Message</strong> field, and click <strong class="bold">Update responses</strong>. Click <strong class="bold">Save Intent</strong> once again.<div id="_idContainer214" class="IMG---Figure"><img src="Images/B17528_11_11.jpg" alt="Figure 11.11 – Adding text message group&#13;&#10;" width="1277" height="642"/></div><p class="figure-caption">Figure 11.11 – Adding text message group</p></li>
				<li>Now, scroll to the top of the page and click <strong class="bold">Language: English (US)</strong> from the blue navigation links at the top of the page.</li>
				<li>Scroll down <a id="_idIndexMarker660"/>and click <strong class="bold">Build</strong> at the bottom right of the page. This should take about a couple of minutes, but not more.</li>
				<li>When the bot has been completely built, click the <strong class="bold">Test</strong> button next to the <strong class="bold">Build</strong> button at the bottom of the page.</li>
				<li>The <strong class="bold">Test Draft version</strong> popup appears at the right of the page. Type <strong class="source-inline">Who is a first-time buyer?</strong> in the input widget at the bottom and press <strong class="bold">Enter</strong>.</li>
				<li>The bot responds with an answer from the documents we added to our Amazon Kendra index:<div id="_idContainer215" class="IMG---Figure"><img src="Images/B17528_11_12.jpg" alt="Figure 11.12 – Bot responding to the query with content from the sample research documents&#13;&#10;" width="1173" height="664"/></div><p class="figure-caption">Figure 11.12 – Bot responding to the query with content from the sample research documents</p></li>
				<li>Now, scroll to the top of the page and click <strong class="bold">Versions</strong> on the blue navigation links.</li>
				<li>On the <strong class="bold">Versions</strong> page, click the <strong class="bold">Create version</strong> button on the right.</li>
				<li>Scroll down to the bottom of the page and click the <strong class="bold">Create</strong> button.</li>
				<li>The new <a id="_idIndexMarker661"/>version is successfully created for our bot. Make a note of the version number created, as we will need this in the next few steps.</li>
				<li>Now, in the left pane under the <strong class="bold">Deployment</strong> heading, click on <strong class="bold">Aliases</strong>,</li>
				<li>Click on <strong class="bold">Create Alias</strong> at the right of the page. In the <strong class="bold">Create alias</strong> page, type an <strong class="bold">Alias name</strong> of your choice, or type <strong class="source-inline">hbr-web-ui</strong>. Scroll down and choose the bot version you created in the preceding step by clicking <strong class="bold">Choose an existing version</strong> under <strong class="bold">Associate with a version</strong>, and click the <strong class="bold">Create</strong> button at the bottom right of the page.<p class="callout-heading">Note</p><p class="callout">If you are creating a version for the first time, please select the <strong class="bold">Version 1</strong> that will be displayed for you</p></li>
				<li>When the alias is created, please make a note of the <strong class="bold">Alias ID</strong> for our bot. This is required in the next section when we deploy the bot.</li>
				<li>Also, click your bot's name using the blue navigation links at the top of the page and make a note of your <strong class="bold">Bot ID</strong> – we will also need this for deployment.</li>
			</ol>
			<p>And that is a wrap for building our Amazon Lex chatbot. In the next section, we will use AWS CloudFormation (<a href="https://aws.amazon.com/cloudformation/">https://aws.amazon.com/cloudformation/</a>), a managed service that provides <a id="_idIndexMarker662"/>the ability to write infrastructure-provisioning <a id="_idIndexMarker663"/>tasks as <strong class="bold">JSON</strong> or <strong class="bold">YAML</strong> template code, and thus automate the deployment <a id="_idIndexMarker664"/>of resources we need for building solutions in AWS. The Amazon Lex blog post, <em class="italic">Deploy a Web UI for Your Chatbot</em>, by Oliver Atoa and Bob Strahan, provides an AWS CloudFormation template example for integrating an Amazon Lex chatbot into a website: <a href="https://aws.amazon.com/blogs/machine-learning/deploy-a-web-ui-for-your-chatbot/">https://aws.amazon.com/blogs/machine-learning/deploy-a-web-ui-for-your-chatbot/</a>.</p>
			<p>We will use this template to create a website in which we will embed our chatbot as a widget.</p>
			<h1 id="_idParaDest-134"><a id="_idTextAnchor138"/>Deploying the solution with AWS CloudFormation</h1>
			<p>In the preceding two sections, we saw a step-by-step account of how to create an index and associate documents from an Amazon S3 bucket as a data source using Amazon Kendra, and <a id="_idIndexMarker665"/>how to build an Amazon Lex chatbot and integrate that with our Amazon Kendra index using a built-in intent. This <a id="_idIndexMarker666"/>completes the majority of our solution build. In this section, we will use an AWS CloudFormation template sample from the accompanying repository for the blog post we mentioned in the previous section: <a href="https://github.com/aws-samples/aws-lex-web-ui/tree/master/templates">https://github.com/aws-samples/aws-lex-web-ui/tree/master/templates</a>.</p>
			<p>Let's get started:</p>
			<ol>
				<li value="1">Click <a href="https://github.com/aws-samples/aws-lex-web-ui/tree/master/templates">https://github.com/aws-samples/aws-lex-web-ui/tree/master/templates</a> and scroll down to the <strong class="bold">Launch</strong> section on the web page and click the first <strong class="bold">Launch Stack</strong> button for the <strong class="bold">CodeBuild mode</strong>.<div id="_idContainer216" class="IMG---Figure"><img src="Images/B17528_11_13.jpg" alt="Figure 11.13 – Launching AWS CloudFormation stack&#13;&#10;" width="1005" height="568"/></div><p class="figure-caption">Figure 11.13 – Launching AWS CloudFormation stack</p></li>
				<li>This action <a id="_idIndexMarker667"/>will open the AWS CloudFormation service in your AWS Management Console and take you to the <strong class="bold">Create Stack</strong> page. Click <strong class="bold">Next</strong>.</li>
				<li>Type a <a id="_idIndexMarker668"/>name of your choice for the <strong class="bold">Stack name</strong> and the <strong class="bold">CodeBuildName</strong>. Or you can use the examples provided.</li>
				<li>Scroll down to the section named <strong class="bold">Lex V2 Bot Configuration Parameters</strong>. Type or paste the <strong class="bold">Bot ID</strong> that you copied from the preceding section in the <strong class="bold">LexV2BotId</strong> field. Type or paste the <strong class="bold">Alias ID</strong> you copied from the preceding section in the <strong class="bold">LexV2BotAliasId</strong> field. Leave the <strong class="bold">LexV2BotLocaleId</strong> field as <strong class="source-inline">en_US</strong>.<div id="_idContainer217" class="IMG---Figure"><img src="Images/B17528_11_14.jpg" alt="Figure 11.14 – Creating stack, Lex V2 Bot Configuration Parameters&#13;&#10;" width="982" height="653"/></div><p class="figure-caption">Figure 11.14 – Creating stack, Lex V2 Bot Configuration Parameters</p></li>
				<li>Scroll <a id="_idIndexMarker669"/>down to <strong class="bold">Bot Behavior Parameters</strong> and change the <strong class="bold">ForceCognitoLogin</strong> to <strong class="source-inline">true</strong>. This will force the users to sign up to <strong class="bold">Amazon</strong> <strong class="bold">Cognito</strong> (<a href="https://aws.amazon.com/cognito/">https://aws.amazon.com/cognito/</a>), a fully managed user authentication and authorization <a id="_idIndexMarker670"/>service for web <a id="_idIndexMarker671"/>and mobile applications. Once they have signed up, they can use their credentials to log in to the website to access the chatbot.</li>
				<li>Scroll down a little and provide a name for the <strong class="bold">CognitoIdentityPoolName</strong>.</li>
				<li>Scroll down to the <strong class="bold">Web Application Parameters</strong> section and type <strong class="source-inline">You can ask me questions on home buyers. For example – what is important for home buyers?</strong> in the <strong class="bold">WebAppConfBotInitialText </strong>field. The chatbot <a id="_idIndexMarker672"/>will display <a id="_idIndexMarker673"/>this message when it is launched. Type <strong class="source-inline">Say 'what is important for home buyers' to get started</strong> in the <strong class="bold">WebAppConfBotInitialSpeech</strong> field. The bot will voice prompt the user with this message when the microphone icon is clicked.</li>
				<li>Scroll down a little to the <strong class="bold">WebAppConfToolbarTitle</strong> field and type <strong class="source-inline">ResearchHomeBuyers</strong>. Then, click <strong class="bold">Next</strong>.</li>
				<li>On this page, leave the defaults as they are and click <strong class="bold">Next</strong> at the bottom of the page.</li>
				<li>Scroll down to the <strong class="bold">Capabilities</strong> section and select both the checkboxes to acknowledge the creation of IAM resources and that it may need the capability to auto expand. Click <strong class="bold">Create Stack</strong>.</li>
				<li>It may take about 15 minutes to create all the resources we need for the solution. For details on the resources that will be created, please refer to the following: <a href="https://github.com/aws-samples/aws-lex-web-ui/blob/master/templates/README.md#cloudformation-resources">https://github.com/aws-samples/aws-lex-web-ui/blob/master/templates/README.md#cloudformation-resources</a>.</li>
				<li>When the status of the CloudFormation stack changes to <strong class="source-inline">Create_Complete</strong>, the resources we need have been provisioned. Before we bring up our website, we need to make a change to our parent website to ensure it is sending the right utterance to our chatbot. Click the <strong class="bold">Outputs</strong> tab of your CloudFormation stack to bring up the list of resources that were provisioned. Copy the value for the key called <strong class="bold">WebAppBucket</strong>. This is the name of the Amazon S3 bucket created to host your website:<div id="_idContainer218" class="IMG---Figure"><img src="Images/B17528_11_15.jpg" alt="Figure 11.15 – S3 bucket hosting our website&#13;&#10;" width="666" height="47"/></div><p class="figure-caption">Figure 11.15 – S3 bucket hosting our website</p></li>
				<li>Now, go to your <strong class="bold">Services</strong> search bar at the top center of your page, type <strong class="source-inline">S3</strong>, and click <strong class="bold">Amazon S3</strong> from the list. In the Amazon S3 console, under <strong class="bold">Buckets</strong>, type the value <a id="_idIndexMarker674"/>you copied <a id="_idIndexMarker675"/>in the previous step. This should bring up the S3 bucket. Click the bucket name to display its object list, and click <strong class="source-inline">parent.html</strong> from the list.</li>
				<li>In the <strong class="bold">Object overview</strong> page for <strong class="source-inline">parent.html</strong>, click the <strong class="bold">Download</strong> button in the top-right corner. This will download <strong class="source-inline">parent.html</strong> to your computer:<div id="_idContainer219" class="IMG---Figure"><img src="Images/B17528_11_16.jpg" alt="Figure 11.16 – Downloading parent.html&#13;&#10;" width="1020" height="560"/></div><p class="figure-caption">Figure 11.16 – Downloading parent.html</p></li>
				<li>Open <strong class="source-inline">parent.html</strong> in your favorite text editor and change the value of the panel-heading tag to <strong class="source-inline">Send "what is important for buyers" utterance to iframe</strong>, as shown in the following screenshot. To bring this entry up, search for <strong class="source-inline">Buy Flowers</strong>.<div id="_idContainer220" class="IMG---Figure"><img src="Images/B17528_11_17.jpg" alt="Figure 11.17 – Changing the panel-heading tag in parent.html&#13;&#10;" width="874" height="96"/></div><p class="figure-caption">Figure 11.17 – Changing the panel-heading tag in parent.html</p></li>
				<li>Continue to <a id="_idIndexMarker676"/>search for <strong class="source-inline">Buy Flowers</strong> and <a id="_idIndexMarker677"/>change the parameter for the <strong class="source-inline">sendUtterance</strong> function to <strong class="source-inline">'what is important for buyers?'</strong>, as shown in the following screenshot:<div id="_idContainer221" class="IMG---Figure"><img src="Images/B17528_11_18.jpg" alt="Figure 11.18 – Changing the send utterance function input&#13;&#10;" width="516" height="345"/></div><p class="figure-caption">Figure 11.18 – Changing the send utterance function input</p></li>
				<li>Now, go back to your Amazon S3 console, open the <strong class="bold">WebAppBucket</strong> that you downloaded the <strong class="source-inline">parent.html</strong> from, click <strong class="bold">Upload</strong>, and click on <strong class="bold">Add files</strong>.</li>
				<li>Select the modified <strong class="source-inline">parent.html</strong> from your local computer, scroll down, and click <strong class="bold">Upload</strong>.</li>
				<li>One of the <a id="_idIndexMarker678"/>resources that were provisioned by the CloudFormation stack was a CloudFront distribution. <strong class="bold">Amazon</strong> <strong class="bold">CloudFront </strong>(<a href="https://aws.amazon.com/cloudfront/">https://aws.amazon.com/cloudfront/</a>) is a fully managed content delivery network that enables the delivery of websites, applications, data, and media globally in minutes in a highly secure manner. Since we <a id="_idIndexMarker679"/>modified one of the web application HTML files in the previous steps, we need to invalidate the <a id="_idIndexMarker680"/>cache of our CloudFront distribution so that the changes are reflected in our website. In the <strong class="bold">Services</strong> search bar, type <strong class="source-inline">CloudFront</strong>, and click <strong class="bold">CloudFront</strong> in the list to go to the Amazon CloudFront console:<div id="_idContainer222" class="IMG---Figure"><img src="Images/B17528_11_19.jpg" alt="Figure 11.19 – Navigating to the Amazon CloudFront console" width="740" height="423"/></div><p class="figure-caption">Figure 11.19 – Navigating to the Amazon CloudFront console</p></li>
				<li>In the <strong class="bold">CloudFront distributions</strong> page, check the <strong class="bold">Origin</strong> field. You should see an entry here that matches the name of the <strong class="bold">WebAppBucket</strong> value you copied from the <strong class="bold">Outputs</strong> tab of your CloudFormation stack. Click the <strong class="bold">ID</strong> for this entry.</li>
				<li>In the details page for your CloudFront distribution, click the <strong class="bold">Invalidations</strong> tab to open it. Then, click the <strong class="bold">Create Invalidation</strong> button.<div id="_idContainer223" class="IMG---Figure"><img src="Images/B17528_11_20.jpg" alt="Figure 11.20 – Creating invalidation for your CloudFront distribution&#13;&#10;" width="1122" height="422"/></div><p class="figure-caption">Figure 11.20 – Creating invalidation for your CloudFront distribution</p></li>
				<li>In the <strong class="bold">Create Invalidation</strong> popup that appears, type a forward slash symbol (<strong class="source-inline">/</strong>) in <a id="_idIndexMarker681"/>the <strong class="bold">Object Paths</strong> field <a id="_idIndexMarker682"/>and click <strong class="bold">Invalidate</strong>, as shown in the following screenshot. This should take about 5 minutes or so:<div id="_idContainer224" class="IMG---Figure"><img src="Images/B17528_11_21.jpg" alt="Figure 11.21 – Invalidating CloudFront distribution&#13;&#10;" width="538" height="200"/></div><p class="figure-caption">Figure 11.21 – Invalidating CloudFront distribution</p></li>
				<li>Once the invalidation is completed, go back to the <strong class="bold">Outputs</strong> tab of your stack in the <strong class="bold">Amazon CloudFormation</strong> console and click the <strong class="bold">ParentPageUrl</strong> value:<div id="_idContainer225" class="IMG---Figure"><img src="Images/B17528_11_22.jpg" alt="Figure 11.22 – Clicking ParentPageUrl value&#13;&#10;" width="1373" height="776"/></div><p class="figure-caption">Figure 11.22 – Clicking ParentPageUrl value</p></li>
				<li>This will launch the website you provisioned, along with your chatbot. But before you <a id="_idIndexMarker683"/>can use your chatbot, Amazon Cognito will force you to sign into your website, as shown. If this <a id="_idIndexMarker684"/>is the first time you are accessing the website, click on the <strong class="bold">Sign up</strong> button and follow the instructions to sign up:<div id="_idContainer226" class="IMG---Figure"><img src="Images/B17528_11_23.jpg" alt="Figure 11.23 – Signing up or signing in to your website&#13;&#10;" width="334" height="270"/></div><p class="figure-caption">Figure 11.23 – Signing up or signing in to your website</p></li>
				<li>You will <a id="_idIndexMarker685"/>receive a verification <a id="_idIndexMarker686"/>code in your email after you complete the sign-up process. Enter the verification code to be signed in:<div id="_idContainer227" class="IMG---Figure"><img src="Images/B17528_11_24.jpg" alt="Figure 11.24 – Entering the verification code&#13;&#10;" width="331" height="194"/></div><p class="figure-caption">Figure 11.24 – Entering the verification code</p></li>
				<li>Now that <a id="_idIndexMarker687"/>you have signed in, your website along with your chatbot as a widget will be <a id="_idIndexMarker688"/>displayed. Click the <strong class="bold">Send</strong> button to send the first utterance to the bot. You can type subsequent questions:<div id="_idContainer228" class="IMG---Figure"><img src="Images/B17528_11_25.jpg" alt="Figure 11.25 – Text interaction with your Amazon Lex chatbot widget embedded in parent website" width="1215" height="660"/></div><p class="figure-caption">Figure 11.25 – Text interaction with your Amazon Lex chatbot widget embedded in parent website</p></li>
				<li>Click the microphone button in the chat widget to talk to your bot. The bot will respond back in the voice, as shown in the next screenshot. Accept the notification from your browser to allow it to use the microphone to proceed.</li>
			</ol>
			<div>
				<div id="_idContainer229" class="IMG---Figure">
					<img src="Images/B17528_11_26.jpg" alt="Figure 11.26 – Voice interaction with your chatbot&#13;&#10;" width="1355" height="717"/>
				</div>
			</div>
			<p class="figure-caption">Figure 11.26 – Voice interaction with your chatbot</p>
			<p>And that concludes <a id="_idIndexMarker689"/>the solution build for this chapter. Feel free to try out the solution and leave us your feedback. You can customize <a id="_idIndexMarker690"/>what we built in this chapter for your own needs very easily. For additional ideas on how you can use Amazon Kendra and Amazon Lex for your needs, please refer to the <em class="italic">Further reading</em> section.</p>
			<h1 id="_idParaDest-135"><a id="_idTextAnchor139"/>Summary</h1>
			<p>In this chapter, we built a solution using Amazon Kendra to automate searching for and deriving insights from document corpuses without having to manually read through the documents, understand the context, interpret the meaning, identify content across documents relevant to a common topic, and so on. We also saw how to set up an intelligent AI-based chat assistant using Amazon Lex that implicitly integrated with the Amazon Kendra intelligent search feature to provide a seamless chat and voice interface for (literally) "talking" to the document. Finally, we used a best practices approach with AWS CloudFormation to deploy our chatbot to a parent website as an embedded widget and distributed it using the Amazon CloudFront content delivery network.</p>
			<p>Interestingly, NLP has diverse uses in the field of medicine, as we will see in the next chapter, where we will review how NLP and AI technologies have helped transform modern-day medical claims processing. We will start by discussing how to automatically extract data from medical intake forms, how to understand the clinical data using <strong class="bold">Amazon</strong> <strong class="bold">Comprehend Medical</strong> (<a href="https://aws.amazon.com/comprehend/medical/">https://aws.amazon.com/comprehend/medical/</a>), and how to set up a serverless real-time pipeline for the adjudication of medical claims. As before, we will introduce the use case, discuss how to design the architecture, establish the pre-requisites, and walk through in detail the various steps required to build the solution.</p>
			<h1 id="_idParaDest-136"><a id="_idTextAnchor140"/>Further reading</h1>
			<ul>
				<li><em class="italic">Enhancing enterprise search with Amazon Kendra</em> by Leonardo Gomez: <a href="https://aws.amazon.com/blogs/machine-learning/enhancing-enterprise-search-with-amazon-kendra/">https://aws.amazon.com/blogs/machine-learning/enhancing-enterprise-search-with-amazon-kendra/</a></li>
				<li><em class="italic">How Citibot's chatbot search engine uses AI to find more answers</em> by Francisco Zamora, Bratton Riley, and Nicholas Burden: <a href="https://aws.amazon.com/blogs/machine-learning/how-citibots-chatbot-search-engine-uses-ai-to-find-more-answers/">https://aws.amazon.com/blogs/machine-learning/how-citibots-chatbot-search-engine-uses-ai-to-find-more-answers/</a></li>
				<li><em class="italic">Building an omnichannel Q and A chatbot with Amazon Connect, Amazon Lex, Amazon Kendra, and the open-source QnABot project</em> by Bob Strahan and Michael Widell: <a href="https://aws.amazon.com/blogs/machine-learning/building-a-multi-channel-qa-chatbot-with-amazon-connect-amazon-lex-amazon-kendra-and-the-open-source-qnabot-project/?nc1=b_rp">https://aws.amazon.com/blogs/machine-learning/building-a-multi-channel-qa-chatbot-with-amazon-connect-amazon-lex-amazon-kendra-and-the-open-source-qnabot-project/?nc1=b_rp</a></li>
			</ul>
		</div>
	</div></body></html>