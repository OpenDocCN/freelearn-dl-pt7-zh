<html><head></head><body>
        <section>

                            <header>
                    <h1 class="header-title"><span class="koboSpan" id="kobo.1.1">Genetic Algorithms for IoT</span></h1>
                </header>
            
            <article>
                
<p class="mce-root"><span class="koboSpan" id="kobo.2.1">In the previous chapter, we looked at different deep learning-based algorithms; these algorithms have shown their success in the fields of recognition, detection, reconstruction, and even in the generation of vision, speech, and text data. </span><span class="koboSpan" id="kobo.2.2">While, at present,</span><span><span class="koboSpan" id="kobo.3.1"> </span></span><strong><span class="koboSpan" id="kobo.4.1">deep learning</span></strong><span><span class="koboSpan" id="kobo.5.1"> </span></span><span class="koboSpan" id="kobo.6.1">(</span><strong><span class="koboSpan" id="kobo.7.1">DL</span></strong><span class="koboSpan" id="kobo.8.1">) is on top in terms of both application and employability, it has close competition with evolutionary algorithms. </span><span class="koboSpan" id="kobo.8.2">The algorithms are inspired by the natural process of evolution, the world's best optimizers. </span><span class="koboSpan" id="kobo.8.3">Yes, even we are the result of years of genetic evolution. </span><span class="koboSpan" id="kobo.8.4">In this chapter, you will be introduced to the fascinating world of evolutionary algorithms and learn about a specific type of evolutionary algorithm, genetic algorithms, in more detail. </span><span class="koboSpan" id="kobo.8.5">In this chapter,</span><span><span class="koboSpan" id="kobo.9.1"> </span></span><span class="koboSpan" id="kobo.10.1">you will learn about the following:</span></p>
<ul>
<li class="mce-root"><span class="koboSpan" id="kobo.11.1">What is optimization</span></li>
<li><span class="koboSpan" id="kobo.12.1">Different methods to solve an optimization problem</span></li>
<li><span class="koboSpan" id="kobo.13.1">Understand the intuition behind genetic algorithms</span></li>
<li><span class="koboSpan" id="kobo.14.1">The advantages of genetic algorithms</span></li>
<li><span class="koboSpan" id="kobo.15.1">Understand and implement the processes of cross-over, mutation, and fitness function selection</span></li>
<li><span class="koboSpan" id="kobo.16.1">Use a genetic algorithm to find a lost password</span></li>
<li><span class="koboSpan" id="kobo.17.1">Various uses of genetic algorithms in optimizing your models</span></li>
<li><span class="koboSpan" id="kobo.18.1">The Distributed Evolutionary Algorithms in the Python genetic algorithm library</span></li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title"><span class="koboSpan" id="kobo.1.1">Optimization</span></h1>
                </header>
            
            <article>
                
<p><span class="koboSpan" id="kobo.2.1">Optimization is not a new word; we have used it earlier with respect to both machine learning and DL algorithms, where we used the TensorFlow auto differentiator to find the optimum model weights and biases using a form of gradient descent algorithm. </span><span class="koboSpan" id="kobo.2.2">In this section, we will learn a little more about optimization, optimization problems, and different techniques used to perform optimization.</span></p>
<p class="mce-root"/>
<p><span class="koboSpan" id="kobo.3.1">In its most basic terms,</span><span><span class="koboSpan" id="kobo.4.1"> </span></span><strong><span class="koboSpan" id="kobo.5.1">optimization</span></strong><span><span class="koboSpan" id="kobo.6.1"> </span></span><span class="koboSpan" id="kobo.7.1">is the process of making something better. </span><span class="koboSpan" id="kobo.7.2">The idea is to find the best solution, and obviously when we talk about the best solution, it means there exists more than one solution. </span><span class="koboSpan" id="kobo.7.3">In optimization, we try to adjust our variable parameters/processes/inputs so that we can find the minimum or maximum output. </span><span class="koboSpan" id="kobo.7.4">Normally, the variables constitute the inputs, we have a function called an</span><span><span class="koboSpan" id="kobo.8.1"> </span></span><strong><span class="koboSpan" id="kobo.9.1">objective</span></strong><span><span class="koboSpan" id="kobo.10.1"> </span></span><strong><span class="koboSpan" id="kobo.11.1">function</span></strong><span class="koboSpan" id="kobo.12.1">,</span><span><span class="koboSpan" id="kobo.13.1"> </span></span><strong><span class="koboSpan" id="kobo.14.1">loss</span></strong><span><span class="koboSpan" id="kobo.15.1"> </span></span><strong><span class="koboSpan" id="kobo.16.1">function</span></strong><span class="koboSpan" id="kobo.17.1">, or</span><span><span class="koboSpan" id="kobo.18.1"> </span></span><strong><span class="koboSpan" id="kobo.19.1">fitness</span></strong><span><span class="koboSpan" id="kobo.20.1"> </span></span><strong><span class="koboSpan" id="kobo.21.1">function</span></strong><span class="koboSpan" id="kobo.22.1">, and as output we expect the cost/loss or fitness. </span><span class="koboSpan" id="kobo.22.2">The cost or loss should be minimized, and if we define fitness, then it should be maximized. </span><span class="koboSpan" id="kobo.22.3">Here, we vary the inputs (variables) to achieve a desired (optimized) output.</span></p>
<div class="packt_tip"><span class="koboSpan" id="kobo.23.1">I hope you can appreciate that calling it loss/cost or fitness is just a matter of choice, the function which calculates the cost and needs to be minimized, if we just add a negative sign to it then we expect the modified function to be maximized.</span><span><span class="koboSpan" id="kobo.24.1"> </span></span><span class="koboSpan" id="kobo.25.1">As an example, minimizing</span><span><span class="koboSpan" id="kobo.26.1"> </span></span><em><span class="koboSpan" id="kobo.27.1">2 - x</span><sup><span class="koboSpan" id="kobo.28.1">2</span></sup></em><span><span class="koboSpan" id="kobo.29.1"> </span></span><span class="koboSpan" id="kobo.30.1">over the interval</span><span><span class="koboSpan" id="kobo.31.1"> </span></span><em><span class="koboSpan" id="kobo.32.1">-2 &lt; x&lt; 2</span></em><span><span class="koboSpan" id="kobo.33.1"> </span></span><span class="koboSpan" id="kobo.34.1">is the same as maximizing</span><span><span class="koboSpan" id="kobo.35.1"> </span></span><em><span class="koboSpan" id="kobo.36.1">x</span></em><sup><span class="koboSpan" id="kobo.37.1">2</span></sup><span><span class="koboSpan" id="kobo.38.1"> </span></span><span class="koboSpan" id="kobo.39.1">- 2 over the same interval.</span></div>
<p><span class="koboSpan" id="kobo.40.1">Our daily lives are full of many such optimization tasks. </span><span class="koboSpan" id="kobo.40.2">What will be the best route to take to</span><span><span class="koboSpan" id="kobo.41.1"> </span></span><span><span class="koboSpan" id="kobo.42.1">the </span></span><span class="koboSpan" id="kobo.43.1">office? </span><span class="koboSpan" id="kobo.43.2">Which project should I do first?</span><span><span class="koboSpan" id="kobo.44.1"> </span></span><span class="koboSpan" id="kobo.45.1">Preparing for an interview what topics to read such that your success rate in the interview is maximized. </span><span class="koboSpan" id="kobo.45.2">The following diagram shows the basic relationship between</span><span><span class="koboSpan" id="kobo.46.1"> </span></span><strong><span class="koboSpan" id="kobo.47.1">Input Variables</span></strong><span class="koboSpan" id="kobo.48.1">, the</span><span><span class="koboSpan" id="kobo.49.1"> </span></span><strong><span class="koboSpan" id="kobo.50.1">Function</span></strong><span><span class="koboSpan" id="kobo.51.1"> </span></span><span class="koboSpan" id="kobo.52.1">to be optimized, and the</span><span><span class="koboSpan" id="kobo.53.1"> </span></span><strong><span class="koboSpan" id="kobo.54.1">Output/Cos</span></strong><strong><span class="koboSpan" id="kobo.55.1">t</span></strong><span class="koboSpan" id="kobo.56.1">:</span></p>
<p class="CDPAlignCenter CDPAlign"><span class="koboSpan" id="kobo.57.1"><img class="aligncenter size-full wp-image-988 image-border" src="assets/5faa50e4-a362-4b51-9857-706e8d811926.png" style="width:33.25em;height:10.08em;"/></span></p>
<div class="packt_figref CDPAlignCenter CDPAlign"><span class="koboSpan" id="kobo.58.1"> Relationship between input, the function to be optimized, and the output</span></div>
<p><span class="koboSpan" id="kobo.59.1">The aim is to minimize the cost, such that the constraints specified by the function are satisfied by the input variables. </span><span class="koboSpan" id="kobo.59.2">The mathematical relationship between the cost function, constraints, and input variables determines the complexity of the optimization problem. </span><span class="koboSpan" id="kobo.59.3">One of the key issues is whether the cost function and constraints are convex or non-convex. </span><span class="koboSpan" id="kobo.59.4">If the cost function and constraints are convex, we can be confident that there does exist a feasible solution, and if we search in a sufficiently large domain, we will find one. </span><span class="koboSpan" id="kobo.59.5">The following figure shows an example of a convex cost function:</span></p>
<p class="CDPAlignCenter CDPAlign"/>
<div class="CDPAlignCenter CDPAlign"><span class="koboSpan" id="kobo.60.1"><img src="assets/2cccbeb8-8a44-49be-825a-d01a8de0aa69.png"/></span></div>
<div class="packt_figref CDPAlignCenter CDPAlign"><span class="koboSpan" id="kobo.61.1"> A</span><span><span class="koboSpan" id="kobo.62.1"> </span></span><span class="koboSpan" id="kobo.63.1">convex cost function. </span><span class="koboSpan" id="kobo.63.2">The one on</span><span><span class="koboSpan" id="kobo.64.1"> </span></span><span><span class="koboSpan" id="kobo.65.1">the </span></span><span class="koboSpan" id="kobo.66.1">left is the surface plot and the one on</span><span><span class="koboSpan" id="kobo.67.1"> </span></span><span><span class="koboSpan" id="kobo.68.1">the </span></span><span class="koboSpan" id="kobo.69.1">right shows the contour plot of the same cost function. </span><span class="koboSpan" id="kobo.69.2">The darkest red point in the image corresponds to</span><span><span class="koboSpan" id="kobo.70.1"> </span></span><span><span class="koboSpan" id="kobo.71.1">the </span></span><span class="koboSpan" id="kobo.72.1">optimum solution point.</span></div>
<p><span class="koboSpan" id="kobo.73.1">If, on other hand,</span><span><span class="koboSpan" id="kobo.74.1"> </span></span><span><span class="koboSpan" id="kobo.75.1">the </span></span><span class="koboSpan" id="kobo.76.1">cost function or constraints are non-convex, the optimization problem becomes harder and we cannot be sure that there does exist a solution, or that we can even find one.</span></p>
<p><span class="koboSpan" id="kobo.77.1">There are various methods to solve optimization problems in mathematics and computer programming. </span><span class="koboSpan" id="kobo.77.2">Let's find out a little about each of them next.</span></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title"><span class="koboSpan" id="kobo.1.1">Deterministic and analytic methods</span></h1>
                </header>
            
            <article>
                
<p><span class="koboSpan" id="kobo.2.1">When the objective function is smooth with a continuous second derivative, then we know from the knowledge of calculus that at a local minimum the following are true:</span></p>
<ul>
<li><span class="koboSpan" id="kobo.3.1">The gradient of the objective function at minima</span><span><span class="koboSpan" id="kobo.4.1"> </span></span><em><span class="koboSpan" id="kobo.5.1">x</span></em><span class="koboSpan" id="kobo.6.1">*, that is, </span><em><span class="koboSpan" id="kobo.7.1">f</span></em><span class="koboSpan" id="kobo.8.1">'(</span><em><span class="koboSpan" id="kobo.9.1">x*</span></em><span class="koboSpan" id="kobo.10.1">) =</span><span><span class="koboSpan" id="kobo.11.1"> </span></span><em><span class="koboSpan" id="kobo.12.1">0</span></em></li>
<li><span class="koboSpan" id="kobo.13.1">The second derivative (Hessian</span><span><span class="koboSpan" id="kobo.14.1"> </span></span><em><span class="koboSpan" id="kobo.15.1">H</span></em><span class="koboSpan" id="kobo.16.1">(</span><em><span class="koboSpan" id="kobo.17.1">x</span></em><span class="koboSpan" id="kobo.18.1">*) = ∇</span><sup><span class="koboSpan" id="kobo.19.1">2</span></sup><em><span class="koboSpan" id="kobo.20.1">f</span></em><span class="koboSpan" id="kobo.21.1">(</span><em><span class="koboSpan" id="kobo.22.1">x</span></em><span class="koboSpan" id="kobo.23.1">)) is positively definite</span></li>
</ul>
<p><span class="koboSpan" id="kobo.24.1">In such conditions, for some problems, it is possible to find the solution analytically by determining the zeros of the gradient and verifying</span><span><span class="koboSpan" id="kobo.25.1"> </span></span><span><span class="koboSpan" id="kobo.26.1">the </span></span><span class="koboSpan" id="kobo.27.1">positive definiteness of the Hessian matrix at the zeros. </span><span class="koboSpan" id="kobo.27.2">So, in these cases, we can explore the search space iteratively for the minima of the objective function. </span><span class="koboSpan" id="kobo.27.3">There are various search methods; let's see them.</span></p>
<p class="mce-root"/>
<p class="mce-root"/>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title"><span class="koboSpan" id="kobo.1.1">Gradient descent method</span></h1>
                </header>
            
            <article>
                
<p><span class="koboSpan" id="kobo.2.1">We learned about gradient descent and how it works in earlier chapters, and we saw that the search direction is the direction of the gradient descent, -∇</span><em><span class="koboSpan" id="kobo.3.1">f</span></em><span class="koboSpan" id="kobo.4.1">(</span><em><span class="koboSpan" id="kobo.5.1">x</span></em><span class="koboSpan" id="kobo.6.1">). </span><span class="koboSpan" id="kobo.6.2">It is also called the</span><span><span class="koboSpan" id="kobo.7.1"> </span></span><strong><span class="koboSpan" id="kobo.8.1">Cauchy</span></strong><span><span class="koboSpan" id="kobo.9.1"> </span></span><strong><span class="koboSpan" id="kobo.10.1">method</span></strong><span><span class="koboSpan" id="kobo.11.1"> </span></span><span class="koboSpan" id="kobo.12.1">because it was given by Cauchy, in 1847, and since then it has been very popular. </span><span class="koboSpan" id="kobo.12.2">We start from an arbitrary point on the objective function surface and change the variables (in earlier chapters, these were the weights and biases) along the direction of the gradient. </span><span class="koboSpan" id="kobo.12.3">Mathematically, it is represented as follows:</span></p>
<div class="CDPAlignCenter CDPAlign"><span class="koboSpan" id="kobo.13.1"><img class="fm-editor-equation" src="assets/2a2c400a-a638-4540-80fe-16d068edddeb.png" style="width:14.17em;height:1.67em;"/></span></div>
<p><span class="koboSpan" id="kobo.14.1">Here</span><span><span class="koboSpan" id="kobo.15.1"> </span></span><em><span class="koboSpan" id="kobo.16.1">α</span><sub><span class="koboSpan" id="kobo.17.1">n</span></sub></em><span><span class="koboSpan" id="kobo.18.1"> </span></span><span class="koboSpan" id="kobo.19.1">is the step size (variation/learning rate) at iteration</span><span><span class="koboSpan" id="kobo.20.1"> </span></span><em><span class="koboSpan" id="kobo.21.1">n</span></em><span class="koboSpan" id="kobo.22.1">. </span><span class="koboSpan" id="kobo.22.2">Gradient descent algorithms have worked well in training DL models, but they have some severe drawbacks:</span></p>
<ul>
<li><span class="koboSpan" id="kobo.23.1">The performance of the optimizer used depends greatly on the learning rate and other constants. </span><span class="koboSpan" id="kobo.23.2">If you change them even slightly, there is a big possibility that</span><span><span class="koboSpan" id="kobo.24.1"> </span></span><span><span class="koboSpan" id="kobo.25.1">the </span></span><span class="koboSpan" id="kobo.26.1">network may not converge. </span><span class="koboSpan" id="kobo.26.2">And it is because of this that sometimes researchers call training a model an art, or alchemy.</span></li>
<li><span class="koboSpan" id="kobo.27.1">Since these methods are based on derivatives, they do not work for discrete data.</span></li>
<li><span class="koboSpan" id="kobo.28.1">We cannot reliably apply it when the objective function is non-convex, which is the case in many DL networks (especially models using a non-linear activation function). </span><span class="koboSpan" id="kobo.28.2">The presence of many hidden layers can result in many local minima, and there is a strong possibility that the model gets stuck in a local minimum. </span><span class="koboSpan" id="kobo.28.3">Here, you can see an example of the objective function with many local minima:</span></li>
</ul>
<div class="CDPAlignCenter CDPAlign"><span class="koboSpan" id="kobo.29.1"><img src="assets/461829bc-e0cd-4ba9-afb6-537412c2290b.png" style="width:51.67em;height:25.50em;"/></span></div>
<div class="packt_figref CDPAlignCenter CDPAlign"><span class="koboSpan" id="kobo.30.1"> A</span><span><span class="koboSpan" id="kobo.31.1"> </span></span><span class="koboSpan" id="kobo.32.1">cost function with many local minima. </span><span class="koboSpan" id="kobo.32.2">The one on</span><span><span class="koboSpan" id="kobo.33.1"> </span></span><span><span class="koboSpan" id="kobo.34.1">the </span></span><span class="koboSpan" id="kobo.35.1">left is the surface plot and the one on</span><span><span class="koboSpan" id="kobo.36.1"> </span></span><span><span class="koboSpan" id="kobo.37.1">the </span></span><span class="koboSpan" id="kobo.38.1">right shows the contour plot of the same cost function. </span><span class="koboSpan" id="kobo.38.2">The dark red points in the image correspond to minima.</span></div>
<p><span class="koboSpan" id="kobo.39.1">There are many variants of the gradient descent method, and</span><span><span class="koboSpan" id="kobo.40.1"> </span></span><span><span class="koboSpan" id="kobo.41.1">the </span></span><span class="koboSpan" id="kobo.42.1">most popular of them are available in the TensorFlow optimizers, including the following:</span></p>
<ul>
<li><span class="koboSpan" id="kobo.43.1">Stochastic gradient optimizer</span></li>
<li><span class="koboSpan" id="kobo.44.1">Adam optimizer</span></li>
<li><span class="koboSpan" id="kobo.45.1">Adagrad optimizer</span></li>
<li><span class="koboSpan" id="kobo.46.1">RMSProp optimizer</span></li>
</ul>
<div class="packt_infobox"><span class="koboSpan" id="kobo.47.1">You can learn more about the different optimizers available in TensorFlow from the TensorFlow documentation at </span><a href="https://www.tensorflow.org/api_guides/python/train"><span class="koboSpan" id="kobo.48.1">https://www.tensorflow.org/api_guides/python/train</span></a><span class="koboSpan" id="kobo.49.1">.</span><br/>
<br/><span class="koboSpan" id="kobo.50.1">
A nice source is a blog (</span><a href="http://ruder.io/optimizing-gradient-descent/index.html#gradientdescentoptimizationalgorithms"><span class="koboSpan" id="kobo.51.1">http://ruder.io/optimizing-gradient-descent/index.html#gradientdescentoptimizationalgorithms</span></a><span class="koboSpan" id="kobo.52.1">) by Sebastian Ruder based on his arXiv paper at</span><span><span class="koboSpan" id="kobo.53.1"> </span></span><a href="https://arxiv.org/abs/1609.04747"><span class="koboSpan" id="kobo.54.1">https://arxiv.org/abs/1609.04747</span></a><span class="koboSpan" id="kobo.55.1">.</span></div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title"><span class="koboSpan" id="kobo.1.1">Newton-Raphson method</span></h1>
                </header>
            
            <article>
                
<p><span class="koboSpan" id="kobo.2.1">This method is based on the second order Taylor series expansion of the objective function,</span><span><span class="koboSpan" id="kobo.3.1"> </span></span><em><span class="koboSpan" id="kobo.4.1">f</span></em><span class="koboSpan" id="kobo.5.1">(</span><em><span class="koboSpan" id="kobo.6.1">x</span></em><span class="koboSpan" id="kobo.7.1">), around the point</span><span><span class="koboSpan" id="kobo.8.1"> </span></span><em><span class="koboSpan" id="kobo.9.1">x</span><sup><span class="koboSpan" id="kobo.10.1">*</span></sup><span class="koboSpan" id="kobo.11.1">:</span></em></p>
<div class="CDPAlignCenter CDPAlign"><em><span class="koboSpan" id="kobo.12.1"><img class="fm-editor-equation" src="assets/a11222e4-a00f-4af3-a479-040ed79a23e1.png" style="width:35.17em;height:3.00em;"/></span></em></div>
<p><span class="koboSpan" id="kobo.13.1">Here,</span><span><span class="koboSpan" id="kobo.14.1"> </span></span><em><span class="koboSpan" id="kobo.15.1">x</span></em><span class="koboSpan" id="kobo.16.1">* is the point about which the Taylor series is expanded,</span><span><span class="koboSpan" id="kobo.17.1"> </span></span><em><span class="koboSpan" id="kobo.18.1">x</span></em><span><span class="koboSpan" id="kobo.19.1"> </span></span><span class="koboSpan" id="kobo.20.1">is a point near</span><span><span class="koboSpan" id="kobo.21.1"> </span></span><em><span class="koboSpan" id="kobo.22.1">x</span></em><span class="koboSpan" id="kobo.23.1">*, the superscript</span><span><span class="koboSpan" id="kobo.24.1"> </span></span><em><span class="koboSpan" id="kobo.25.1">T</span></em><span><span class="koboSpan" id="kobo.26.1"> </span></span><span class="koboSpan" id="kobo.27.1">represents the transpose, and</span><span><span class="koboSpan" id="kobo.28.1"> </span></span><em><span class="koboSpan" id="kobo.29.1">H</span></em><span><span class="koboSpan" id="kobo.30.1"> </span></span><span class="koboSpan" id="kobo.31.1">is the Hessian matrix with elements given by the following:</span></p>
<div class="CDPAlignCenter CDPAlign"><em><span class="koboSpan" id="kobo.32.1"><img class="fm-editor-equation" src="assets/937ab061-0f44-4ee3-928f-32bcb2750d9f.png" style="width:9.75em;height:3.50em;"/></span></em></div>
<p><span class="koboSpan" id="kobo.33.1">Taking the gradient of the Taylor series expansion and equating to </span><strong><span class="koboSpan" id="kobo.34.1">0</span></strong><span class="koboSpan" id="kobo.35.1">, we get this:</span></p>
<div class="CDPAlignCenter CDPAlign"><em><span class="koboSpan" id="kobo.36.1"><img class="fm-editor-equation" src="assets/59bfab87-627a-4859-9628-f9b3601c22af.png" style="width:20.75em;height:1.67em;"/></span></em></div>
<p><span class="koboSpan" id="kobo.37.1">Assuming the initial guess as</span><span><span class="koboSpan" id="kobo.38.1"> </span></span><em><span class="koboSpan" id="kobo.39.1">x</span></em><sub><span class="koboSpan" id="kobo.40.1">0</span></sub><span class="koboSpan" id="kobo.41.1">, the next point</span><span><span class="koboSpan" id="kobo.42.1"> </span></span><em><span class="koboSpan" id="kobo.43.1">x</span></em><sub><span class="koboSpan" id="kobo.44.1">n+1</span></sub><span><span class="koboSpan" id="kobo.45.1"> </span></span><span class="koboSpan" id="kobo.46.1">can be obtained from the previous point</span><span><span class="koboSpan" id="kobo.47.1"> </span></span><em><span class="koboSpan" id="kobo.48.1">x</span></em><sub><span class="koboSpan" id="kobo.49.1">n</span></sub><span><span class="koboSpan" id="kobo.50.1"> </span></span><span class="koboSpan" id="kobo.51.1">using this:</span></p>
<div class="CDPAlignCenter CDPAlign"><em><span class="koboSpan" id="kobo.52.1"><img class="fm-editor-equation" src="assets/015ff534-b7eb-48cc-85e1-e831ef67b9b5.png" style="width:15.17em;height:1.83em;"/></span></em></div>
<p><span class="koboSpan" id="kobo.53.1">The method uses both the first and the second partial derivatives of the objective function to find the minima. </span><span class="koboSpan" id="kobo.53.2">At iteration</span><span><span class="koboSpan" id="kobo.54.1"> </span></span><em><span class="koboSpan" id="kobo.55.1">k</span></em><span class="koboSpan" id="kobo.56.1">, it approximates the objective function by a quadratic function around</span><span><span class="koboSpan" id="kobo.57.1"> </span></span><em><span class="koboSpan" id="kobo.58.1">x</span></em><span class="koboSpan" id="kobo.59.1">(</span><em><span class="koboSpan" id="kobo.60.1">k</span></em><span class="koboSpan" id="kobo.61.1">) and moves toward its minima.</span></p>
<p><span class="koboSpan" id="kobo.62.1">Since computing the Hessian matrix is computationally expensive and not normally known, a large number of algorithms exist around approximating the Hessian; these techniques are called</span><span><span class="koboSpan" id="kobo.63.1"> </span></span><strong><span class="koboSpan" id="kobo.64.1">quasi-Newton methods</span></strong><span class="koboSpan" id="kobo.65.1">. </span><span class="koboSpan" id="kobo.65.2">They can be represented as follows:</span></p>
<div class="CDPAlignCenter CDPAlign"><em><span class="koboSpan" id="kobo.66.1"><img class="fm-editor-equation" src="assets/fd1156ee-4259-4c4f-b0c2-10b26246b773.png" style="width:15.92em;height:1.67em;"/></span></em></div>
<p class="mce-root"/>
<p><em><span class="koboSpan" id="kobo.67.1">α</span><sub><span class="koboSpan" id="kobo.68.1">n</span></sub></em><span><span class="koboSpan" id="kobo.69.1"> </span></span><span class="koboSpan" id="kobo.70.1">is the step size (variation/learning rate) at iteration</span><span><span class="koboSpan" id="kobo.71.1"> </span></span><em><span class="koboSpan" id="kobo.72.1">n</span></em><span class="koboSpan" id="kobo.73.1">, and</span><span><span class="koboSpan" id="kobo.74.1"> </span></span><em><span class="koboSpan" id="kobo.75.1">A</span><sub><span class="koboSpan" id="kobo.76.1">n</span></sub></em><span><span class="koboSpan" id="kobo.77.1"> </span></span><span class="koboSpan" id="kobo.78.1">is the approximation to the Hessian matrix at iteration</span><span><span class="koboSpan" id="kobo.79.1"> </span></span><em><span class="koboSpan" id="kobo.80.1">n</span></em><span class="koboSpan" id="kobo.81.1">. </span><span class="koboSpan" id="kobo.81.2">We construct a sequence of approximations to the Hessian, such that the following is true:</span></p>
<div class="CDPAlignCenter CDPAlign"><em><span class="koboSpan" id="kobo.82.1"><img class="fm-editor-equation" src="assets/6b0712ed-5a5b-4685-b6d3-6f4ac7fa192e.png" style="width:9.17em;height:2.42em;"/></span></em></div>
<p><span class="koboSpan" id="kobo.83.1">Two popular quasi-Newton methods are as follows:</span></p>
<ul>
<li><span class="koboSpan" id="kobo.84.1">Davidon-Fletcher-Powell algorithm</span></li>
<li><span class="koboSpan" id="kobo.85.1">Broyden-Fletcher-Goldfarb-Shanno algorithm</span></li>
</ul>
<div class="packt_infobox"><span class="koboSpan" id="kobo.86.1">When the approximation</span><span><span class="koboSpan" id="kobo.87.1"> </span></span><em><span class="koboSpan" id="kobo.88.1">A</span><sub><span class="koboSpan" id="kobo.89.1">n</span></sub></em><span><span class="koboSpan" id="kobo.90.1"> </span></span><span class="koboSpan" id="kobo.91.1">to the Hessian is the identity matrix, the Newton method becomes the gradient descent method.</span></div>
<p><span class="koboSpan" id="kobo.92.1">The major disadvantage of</span><span><span class="koboSpan" id="kobo.93.1"> </span></span><span><span class="koboSpan" id="kobo.94.1">the </span></span><span class="koboSpan" id="kobo.95.1">Newton method is that it is not scalable to problems with a high-dimensional input feature space.</span></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title"><span class="koboSpan" id="kobo.1.1">Natural optimization methods</span></h1>
                </header>
            
            <article>
                
<p><span class="koboSpan" id="kobo.2.1">Natural optimization methods are inspired by some natural processes, that is, a process, existing in nature, that is remarkably successful at optimizing some natural phenomena. </span><span class="koboSpan" id="kobo.2.2">These algorithms do not require taking objective function derivatives, and thus can be employed even for discrete variables and non-continuous objective functions.</span></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title"><span class="koboSpan" id="kobo.1.1">Simulated annealing</span></h1>
                </header>
            
            <article>
                
<p><span class="koboSpan" id="kobo.2.1">Simulated annealing is a stochastic method. </span><span class="koboSpan" id="kobo.2.2">It is inspired by the physical process of annealing, in which a solid is first heated to a high enough temperature so that it melts, and then the temperature is decreased slowly; this allows the particles of the solid to arrange themselves in the lowest possible energy state and thus produce a highly structured lattice.</span></p>
<p><span class="koboSpan" id="kobo.3.1">We start with some random values assigned to each variable; this represents the initial state. </span><span class="koboSpan" id="kobo.3.2">At each step, we pick a variable (or group of variables) at random and then select a random value. </span><span class="koboSpan" id="kobo.3.3">If, upon the assignment of that value to the variable, there is an improvement in the objective function, the algorithm accepts the assignment, there is a new current assignment, and the state of the system changes. </span><span class="koboSpan" id="kobo.3.4">Otherwise, it accepts the assignment with some probability</span><span><span class="koboSpan" id="kobo.4.1"> </span></span><em><span class="koboSpan" id="kobo.5.1">P</span></em><span class="koboSpan" id="kobo.6.1">, which depends on the temperature</span><span><span class="koboSpan" id="kobo.7.1"> </span></span><em><span class="koboSpan" id="kobo.8.1">T</span></em><span><span class="koboSpan" id="kobo.9.1"> </span></span><span class="koboSpan" id="kobo.10.1">and the difference between</span><span><span class="koboSpan" id="kobo.11.1"> </span></span><span><span class="koboSpan" id="kobo.12.1">the </span></span><span class="koboSpan" id="kobo.13.1">values of the objective function in the current state and</span><span><span class="koboSpan" id="kobo.14.1"> </span></span><span><span class="koboSpan" id="kobo.15.1">the </span></span><span class="koboSpan" id="kobo.16.1">new state. </span><span class="koboSpan" id="kobo.16.2">If the change is not accepted, the current state remains unchanged. </span><span class="koboSpan" id="kobo.16.3">The probability</span><span><span class="koboSpan" id="kobo.17.1"> </span></span><em><span class="koboSpan" id="kobo.18.1">P</span></em><span><span class="koboSpan" id="kobo.19.1"> </span></span><span class="koboSpan" id="kobo.20.1">that we will change from state</span><span><span class="koboSpan" id="kobo.21.1"> </span></span><em><span class="koboSpan" id="kobo.22.1">i</span></em><span><span class="koboSpan" id="kobo.23.1"> </span></span><span class="koboSpan" id="kobo.24.1">to state</span><span><span class="koboSpan" id="kobo.25.1"> </span></span><em><span class="koboSpan" id="kobo.26.1">j</span></em><span><span class="koboSpan" id="kobo.27.1"> </span></span><span class="koboSpan" id="kobo.28.1">is as follows:</span></p>
<div class="CDPAlignCenter CDPAlign"><span class="koboSpan" id="kobo.29.1"><img class="fm-editor-equation" src="assets/d5e95f0e-aad9-4b60-9300-738600d75d2f.png" style="width:17.08em;height:3.08em;"/></span></div>
<p><span class="koboSpan" id="kobo.30.1">Here, </span><em><span class="koboSpan" id="kobo.31.1">T</span></em><span><span class="koboSpan" id="kobo.32.1"> </span></span><span class="koboSpan" id="kobo.33.1">represents a variable analogous to temperature in the physical system. </span><span class="koboSpan" id="kobo.33.2">As the temperature approaches </span><em><span class="koboSpan" id="kobo.34.1">0</span></em><span class="koboSpan" id="kobo.35.1">, the simulated annealing algorithm reduces to the gradient descent algorithm.</span></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title"><span class="koboSpan" id="kobo.1.1">Particle Swarm Optimization</span></h1>
                </header>
            
            <article>
                
<p><strong><span class="koboSpan" id="kobo.2.1">Particle Swarm Optimization</span></strong><span><span class="koboSpan" id="kobo.3.1"> </span></span><span class="koboSpan" id="kobo.4.1">(</span><strong><span class="koboSpan" id="kobo.5.1">PSO</span></strong><span class="koboSpan" id="kobo.6.1">) was</span><span><span class="koboSpan" id="kobo.7.1"> </span></span><span><span class="koboSpan" id="kobo.8.1">developed </span></span><span class="koboSpan" id="kobo.9.1">by Edward and Kennedy in 1995. </span><span class="koboSpan" id="kobo.9.2">It is based on the social behavior of animals, such as a flock of birds. </span><span class="koboSpan" id="kobo.9.3">You must have noticed in the sky, birds fly in a V shape. </span><span class="koboSpan" id="kobo.9.4">Those who have studied bird behavior tell us that birds fly like this when in search of food or a better location, with the one leading being nearest to the desired source.</span></p>
<p><span class="koboSpan" id="kobo.10.1">Now, when they fly, the leading bird does not remain the same; instead, it changes as they move. </span><span class="koboSpan" id="kobo.10.2">The bird in the flock that sees the food sends a sound signal, and all other birds then collect around that bird in a V fashion. </span><span class="koboSpan" id="kobo.10.3">This is a continuous repetitive process, and has served birds well for millions of years.</span></p>
<p><span class="koboSpan" id="kobo.11.1">PSO takes inspiration from this bird behavior and uses it to solve optimization problems. </span><span class="koboSpan" id="kobo.11.2">In PSO, every single solution is a bird (called a </span><strong><span class="koboSpan" id="kobo.12.1">particle</span></strong><span class="koboSpan" id="kobo.13.1">) in the search space. </span><span class="koboSpan" id="kobo.13.2">Each particle has a fitness value, which is evaluated by the fitness function to be optimized; they also have velocities, which direct the flying of the particles. </span><span class="koboSpan" id="kobo.13.3">The particles fly through the problem search space by following the current optimum particle.</span></p>
<p><span class="koboSpan" id="kobo.14.1">The particles are moved around in the search space guided by two best fitness values, one their own best known position in the search space (</span><strong><span class="koboSpan" id="kobo.15.1">pbest</span></strong><span class="koboSpan" id="kobo.16.1">: particle best), the other the entire swarm's best known fitness value (</span><strong><span class="koboSpan" id="kobo.17.1">gbest</span></strong><span class="koboSpan" id="kobo.18.1">: global best). </span><span class="koboSpan" id="kobo.18.2">As improved positions are discovered, they are used to guide the movements of the particles of the swarm. </span><span class="koboSpan" id="kobo.18.3">This process is repeated and it is hoped that an optimum solution will eventually be discovered.</span></p>
<p class="mce-root"/>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title"><span class="koboSpan" id="kobo.1.1">Genetic algorithms</span></h1>
                </header>
            
            <article>
                
<p><span class="koboSpan" id="kobo.2.1">When we look around the world and see different species, a question naturally arises: why are these sets of features stable and not others; why should</span><span><span class="koboSpan" id="kobo.3.1"> </span></span><span><span class="koboSpan" id="kobo.4.1">the </span></span><span class="koboSpan" id="kobo.5.1">majority of animals have two legs or four legs, and why not three? </span><span class="koboSpan" id="kobo.5.2">Is it possible that the world that we see today is the result of many iterations in a grand optimization algorithm?</span></p>
<p><span class="koboSpan" id="kobo.6.1">Let's imagine there is a cost function that measures survivability, which should be maximized. </span><span class="koboSpan" id="kobo.6.2">T</span><span><span class="koboSpan" id="kobo.7.1">he characteristics of the organisms of the natural world fit into a topological landscape. </span><span class="koboSpan" id="kobo.7.2">The level of survivability (measured through adaptation) represents the elevation of the landscape. </span><span class="koboSpan" id="kobo.7.3">The highest points correspond to the most-fit conditions, and the constraints are provided by the environment and through interaction between different species.</span></span></p>
<p><span><span class="koboSpan" id="kobo.8.1">Then, the process of evolution can be thought of as a grand optimization algorithm that selects which characteristics produce a species of organism fit for survival. </span><span class="koboSpan" id="kobo.8.2">The peaks of the landscape are populated by living organisms. </span><span class="koboSpan" id="kobo.8.3">Some peaks are broad and hold a wide range of characteristics encompassing many organisms, while other peaks are very narrow and allow only very specific characteristics.</span></span></p>
<p><span><span class="koboSpan" id="kobo.9.1">We can extend this analogy to include valleys between the peaks separating different species. </span><span class="koboSpan" id="kobo.9.2">And, we can think that humankind might be at the global maximum peak of this landscape, since we have intelligence and the ability to alter the environment and ensure better survivability, even in extreme environments.</span></span></p>
<p><span class="koboSpan" id="kobo.10.1">Thus, the world with different life forms can be thought of as a big search space, with different species as the result of many iterations of a grand optimization algorithm. </span><span class="koboSpan" id="kobo.10.2">This idea forms the basis of </span><span><span class="koboSpan" id="kobo.11.1">genetic algorithms</span></span><span><span class="koboSpan" id="kobo.12.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.13.1">Since the main theme of this chapter is genetic algorithms, let's dive into them.</span></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title"><span class="koboSpan" id="kobo.1.1">Introduction to genetic algorithms</span></h1>
                </header>
            
            <article>
                
<p><span class="koboSpan" id="kobo.2.1">According to the work of Charles Darwin, the famous biologist, the animal and plant species that we see today have emerged due to millions of years of evolution. </span><span class="koboSpan" id="kobo.2.2">The process of evolution is guided by the principle of</span><span><span class="koboSpan" id="kobo.3.1"> </span></span><em><span class="koboSpan" id="kobo.4.1">survival of the fittest</span></em><span class="koboSpan" id="kobo.5.1">, selecting the organisms that have a better chance of survivability. </span><span class="koboSpan" id="kobo.5.2">The plants and animals that we see today are the results of millions of years of adaptation to the constraints imposed by the environment. </span><span class="koboSpan" id="kobo.5.3">At any given time, a large number of varied organisms may coexist and compete for the same environmental resources.</span></p>
<p><span class="koboSpan" id="kobo.6.1">The organisms that are most capable of both acquiring the resources and procreation are the ones whose descendants will have more chances of survival. </span><span class="koboSpan" id="kobo.6.2">Organisms that are less capable, on the other hand, will tend to have few or no descendants. </span><span class="koboSpan" id="kobo.6.3">Over time, the entire population will evolve, containing on average organisms that are more fit than the previous generations.</span></p>
<p><span class="koboSpan" id="kobo.7.1">What makes this possible? </span><span class="koboSpan" id="kobo.7.2">What decides that a person will be tall, and a plant will have a particular shape of leaf? </span><span class="koboSpan" id="kobo.7.3">All this is encoded like a set of rules in the program on the blueprint of life itself—genes. </span><span class="koboSpan" id="kobo.7.4">Every living organism on Earth has this set of rules and they describe how that organism is designed (created). </span><span class="koboSpan" id="kobo.7.5">Genes reside in chromosomes. </span><span class="koboSpan" id="kobo.7.6">Each being has a different number of chromosomes and they contain thousands of genes. </span><span class="koboSpan" id="kobo.7.7">For example, we homo sapiens have 46 chromosomes and these chromosomes contain about 20,000 genes. </span><span class="koboSpan" id="kobo.7.8">Each gene represents a specific rule: a person will have blue eyes, will have brown hair, will be a female, and so on. </span><span class="koboSpan" id="kobo.7.9">These genes pass from parents to offspring through the process of reproduction.</span></p>
<p><span class="koboSpan" id="kobo.8.1">There are two ways by which genes pass from parents to offspring:</span></p>
<ul>
<li><strong><span class="koboSpan" id="kobo.9.1">Asexual reproduction</span></strong><span class="koboSpan" id="kobo.10.1">: In this, the child is the duplicate copy of the parent. </span><span class="koboSpan" id="kobo.10.2">It happens during a biological process called</span><span><span class="koboSpan" id="kobo.11.1"> </span></span><strong><span class="koboSpan" id="kobo.12.1">mitosis</span></strong><span class="koboSpan" id="kobo.13.1">; lower organisms such as bacteria and fungi reproduce via mitosis. </span><span class="koboSpan" id="kobo.13.2">Only one parent is needed in this:</span></li>
</ul>
<div class="CDPAlignCenter CDPAlign"><span class="koboSpan" id="kobo.14.1"><img src="assets/1008f76b-7eca-4a10-b1e9-8247fb6e530f.png" style="width:33.83em;height:21.75em;"/></span></div>
<div class="CDPAlignCenter CDPAlign packt_figref"><span class="koboSpan" id="kobo.15.1"> The process of mitosis: the chromosomes of the parent first double, and the cell divides into two</span></div>
<ul>
<li><strong><span class="koboSpan" id="kobo.16.1">Sexual reproduction</span></strong><span class="koboSpan" id="kobo.17.1">: This happens via a biological process called</span><span><span class="koboSpan" id="kobo.18.1"> </span></span><strong><span class="koboSpan" id="kobo.19.1">meiosis</span></strong><span class="koboSpan" id="kobo.20.1">. </span><span class="koboSpan" id="kobo.20.2">In this, two parents are involved initially; each parent cell undergoes a process of crossover, where a part of one chromosome gets interchanged with a part of another chromosome. </span><span class="koboSpan" id="kobo.20.3">This modifies the genetic sequence; the cells then divide into two, but with only half the number of chromosomes each. </span><span class="koboSpan" id="kobo.20.4">The cells containing half the number of chromosomes (haploid) from the two parents then meet together to form a zygote, which later through mitosis and cell differentiation results in the production of an</span><span><span class="koboSpan" id="kobo.21.1"> </span></span><strong><span class="koboSpan" id="kobo.22.1">offspring</span></strong><span><span class="koboSpan" id="kobo.23.1"> </span></span><span class="koboSpan" id="kobo.24.1">similar to, yet different from, the parents:</span></li>
</ul>
<p class="CDPAlignCenter CDPAlign"><span class="koboSpan" id="kobo.25.1"><img class="aligncenter size-full wp-image-1089 image-border" src="assets/7af1402c-aac5-4760-a6ef-88500a7da4bf.png" style="width:29.92em;height:23.50em;"/></span></p>
<div class="packt_figref CDPAlignCenter CDPAlign"><span class="koboSpan" id="kobo.26.1"> The</span><span><span class="koboSpan" id="kobo.27.1"> </span></span><span class="koboSpan" id="kobo.28.1">process of meiosis: parents' cell chromosomes undergo crossover, a part of one chromosome overlaps and changes position with part of another chromosome. </span><span class="koboSpan" id="kobo.28.2">The cells then divide into two, with each divided cell containing only one chromosome (haploids). </span><span class="koboSpan" id="kobo.28.3">The two haploids from two parents then meet together to complete the total number of chromosomes.</span></div>
<p><span class="koboSpan" id="kobo.29.1">Another interesting thing that happens in the natural process of selection and evolution is the phenomenon of mutation. </span><span class="koboSpan" id="kobo.29.2">Here, the genes undergo a sudden change and generate a completely new gene, which was not present in either parent. </span><span class="koboSpan" id="kobo.29.3">This phenomenon generates further diversity. </span></p>
<p><span class="koboSpan" id="kobo.30.1">Sexual reproduction through generations is supposed to bring about evolution and ensure that organisms with the fittest characteristics have more descendants.</span></p>
<p class="mce-root"/>
<p class="mce-root"/>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title"><span class="koboSpan" id="kobo.1.1">The genetic algorithm</span></h1>
                </header>
            
            <article>
                
<p><span class="koboSpan" id="kobo.2.1">Let's now learn how can we implement the genetic algorithm. </span><span class="koboSpan" id="kobo.2.2">This method was developed by John Holland in 1975. </span><span class="koboSpan" id="kobo.2.3">It was shown that it can be used to solve an optimization problem by his student Goldberg, who used</span><span><span class="koboSpan" id="kobo.3.1"> </span></span><span><span class="koboSpan" id="kobo.4.1">genetic algorithm</span></span><span class="koboSpan" id="kobo.5.1">s to control gas pipeline transmission. </span><span class="koboSpan" id="kobo.5.2">Since then,</span><span><span class="koboSpan" id="kobo.6.1"> </span></span><span><span class="koboSpan" id="kobo.7.1">genetic algorithm</span></span><span class="koboSpan" id="kobo.8.1">s have remained popular, and have inspired various other evolutionary programs.</span></p>
<p><span><span class="koboSpan" id="kobo.9.1">To apply genetic algorithms to solving optimization problems using the computer, as the first step we will need to </span><strong><span class="koboSpan" id="kobo.10.1">encode the problem variables into genes</span></strong><span class="koboSpan" id="kobo.11.1">. </span><span class="koboSpan" id="kobo.11.2">The genes can be a string of real numbers or a binary bit string (series of 0s and 1's). </span><span class="koboSpan" id="kobo.11.3">This represents a potential solution (individual) and many such solutions together form the population at time </span><em><span class="koboSpan" id="kobo.12.1">t</span></em><span class="koboSpan" id="kobo.13.1">. </span><span class="koboSpan" id="kobo.13.2">For instance, consider a problem where we need to find two variables,</span></span><span><span class="koboSpan" id="kobo.14.1"> </span></span><span class="koboSpan" id="kobo.15.1">a</span><span><span class="koboSpan" id="kobo.16.1"> </span></span><span><span class="koboSpan" id="kobo.17.1">and</span></span><span><span class="koboSpan" id="kobo.18.1"> </span></span><span class="koboSpan" id="kobo.19.1">b, such that the two lie in the range (0, 255).</span><span><span class="koboSpan" id="kobo.20.1"> </span></span><span><span class="koboSpan" id="kobo.21.1">For binary gene representation, these two variables can be represented by a 16-bit chromosome, with the higher 8 bits representing gene</span></span><span><span class="koboSpan" id="kobo.22.1"> </span></span><span class="koboSpan" id="kobo.23.1">a</span><span><span class="koboSpan" id="kobo.24.1"> </span></span><span><span class="koboSpan" id="kobo.25.1">and the lower 8 bits for</span></span><span><span class="koboSpan" id="kobo.26.1"> </span></span><span class="koboSpan" id="kobo.27.1">b</span><span><span class="koboSpan" id="kobo.28.1">.</span></span><span><span class="koboSpan" id="kobo.29.1"> The encoding will need to be later decoded to get the real values of the variables</span></span><span><span class="koboSpan" id="kobo.30.1"> </span></span><span class="koboSpan" id="kobo.31.1">a</span><span><span class="koboSpan" id="kobo.32.1"> </span></span><span><span class="koboSpan" id="kobo.33.1">and</span></span><span><span class="koboSpan" id="kobo.34.1"> </span></span><span class="koboSpan" id="kobo.35.1">b</span><span><span class="koboSpan" id="kobo.36.1">. </span></span></p>
<p><span><span class="koboSpan" id="kobo.37.1">The second important requirement for genetic algorithms is defining a proper </span><strong><span class="koboSpan" id="kobo.38.1">fitness function</span></strong><span class="koboSpan" id="kobo.39.1">, which calculates the fitness score of any potential solution (in the preceding example, it should calculate the fitness value of the encoded chromosome). </span><span class="koboSpan" id="kobo.39.2">This is the function that we want to optimize by finding the optimum set of parameters of the system or the problem at hand. </span><span class="koboSpan" id="kobo.39.3">The fitness function is problem-dependent. </span><span class="koboSpan" id="kobo.39.4">For example, in the natural process of evolution, the fitness function represents the organism's ability to operate and to survive in its environment.</span></span></p>
<p><span><span class="koboSpan" id="kobo.40.1">Once we have decided the encoding of the problem solution in genes and decided upon the fitness function, the genetic algorithm will then follow these steps:</span></span></p>
<ol>
<li><span><strong><span class="koboSpan" id="kobo.41.1">Population Initialization</span></strong></span><span><span class="koboSpan" id="kobo.42.1">: We need to create an initial population, where all chromosomes are (usually) randomly generated to yield an entire range of possible solutions (the search space). </span><span class="koboSpan" id="kobo.42.2">Occasionally, the solutions may be seeded in areas where optimal solutions are likely to be found. </span><span class="koboSpan" id="kobo.42.3">The population size depends on the nature of the problem, but typically contains several hundred potential solutions encoded into chromosomes.</span></span></li>
<li><span><strong><span class="koboSpan" id="kobo.43.1">Parent Selection</span></strong></span><span><span class="koboSpan" id="kobo.44.1">: For each successive generation, based on the fitness function (or randomly), we next select a certain proportion of the existing population. </span><span class="koboSpan" id="kobo.44.2">This selected proportion of the population will then breed to form a new generation. </span><span class="koboSpan" id="kobo.44.3">This is done by the method of tournament selection: a fixed number of individuals are randomly selected (tournament size) and the individual with the best fitness score is chosen as one of the parents.</span></span></li>
</ol>
<ol start="3">
<li><span><strong><span class="koboSpan" id="kobo.45.1">Reproduction</span></strong></span><span><span class="koboSpan" id="kobo.46.1">: We next generate the successive generation from those selected in step 2, through genetic operators such as</span></span><span><span class="koboSpan" id="kobo.47.1"> </span></span><span><span class="koboSpan" id="kobo.48.1">crossover</span></span><span><span class="koboSpan" id="kobo.49.1"> </span></span><span><span class="koboSpan" id="kobo.50.1">and</span></span><span><span class="koboSpan" id="kobo.51.1"> </span></span><span><span class="koboSpan" id="kobo.52.1">mutation</span></span><span><span class="koboSpan" id="kobo.53.1">. </span><span class="koboSpan" id="kobo.53.2">These genetic operators ultimately result in a child (next generation) population of chromosomes that is different from the initial generation but at the same time shares many of the characteristics of its parents.</span></span></li>
<li><span><strong><span class="koboSpan" id="kobo.54.1">Evaluation</span></strong></span><span><span class="koboSpan" id="kobo.55.1">: The offspring generated are then evaluated using the fitness function, and they replace the least-fit individuals in the population to keep the population size unchanged. </span></span></li>
<li><span><strong><span class="koboSpan" id="kobo.56.1">Termination</span></strong></span><span><span class="koboSpan" id="kobo.57.1">: During the</span></span><span><span class="koboSpan" id="kobo.58.1"> </span></span><em><span><span class="koboSpan" id="kobo.59.1">Evaluation</span></span></em><span><span class="koboSpan" id="kobo.60.1"> </span></span><span><span class="koboSpan" id="kobo.61.1">step, if any of the offspring achieve the objective fitness score or the maximum number of generations is reached, then the genetic algorithm process is terminated. </span><span class="koboSpan" id="kobo.61.2">Otherwise, steps </span><em><span class="koboSpan" id="kobo.62.1">2</span></em><span class="koboSpan" id="kobo.63.1"> to </span><em><span class="koboSpan" id="kobo.64.1">4</span></em><span class="koboSpan" id="kobo.65.1"> are repeated to produce the next generation.</span></span></li>
</ol>
<p class="column"><span><span class="koboSpan" id="kobo.66.1">Two operators that are important for the success of genetic algorithms are crossover and mutation.</span></span></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title"><span class="koboSpan" id="kobo.1.1">Crossover</span></h1>
                </header>
            
            <article>
                
<p class="column"><span class="koboSpan" id="kobo.2.1">To perform the crossover operation, we select a random position on the chromosome of two parents, then</span><span><span class="koboSpan" id="kobo.3.1"> </span></span><span><span class="koboSpan" id="kobo.4.1">the genetic information is swapped between them about this point, with a probability </span><em><span class="koboSpan" id="kobo.5.1">P</span><sub><span class="koboSpan" id="kobo.6.1">x</span></sub></em><span class="koboSpan" id="kobo.7.1">. </span><span class="koboSpan" id="kobo.7.2">This results in two new offspring. </span><span class="koboSpan" id="kobo.7.3">When the crossover takes place over a random point, it is called a </span><strong><span class="koboSpan" id="kobo.8.1">one-point crossover</span></strong><span class="koboSpan" id="kobo.9.1"> (or </span><strong><span class="koboSpan" id="kobo.10.1">Single Point Crossover</span></strong><span class="koboSpan" id="kobo.11.1">):</span><br/></span></p>
<p class="CDPAlignCenter CDPAlign"><span class="koboSpan" id="kobo.12.1"><img src="assets/66fa82f1-5570-4f15-83bf-c73111bfbaf2.png" style="width:31.17em;height:21.25em;"/></span></p>
<div class="column packt_figref CDPAlignCenter CDPAlign"><span class="koboSpan" id="kobo.13.1">One-point crossover: a random point is selected in the parent's chromosomes and the corresponding gene bits are swapped</span></div>
<p class="column"><span class="koboSpan" id="kobo.14.1">We can also have more than one point where parents' genes are swapped; this is called a </span><strong><span class="koboSpan" id="kobo.15.1">Mult</span></strong><strong><span class="koboSpan" id="kobo.16.1">i-Point Crossover</span></strong><span class="koboSpan" id="kobo.17.1">:</span></p>
<p class="CDPAlignCenter CDPAlign"><span class="koboSpan" id="kobo.18.1"><img src="assets/c0da5152-3b46-4ead-9037-328ce748624e.png" style="width:33.17em;height:22.17em;"/></span></p>
<div class="layoutArea CDPAlignCenter CDPAlign packt_figref"><span class="koboSpan" id="kobo.19.1"> Multi-point crossover: there is more than one point where the genes of the parents are swapped. </span><span class="koboSpan" id="kobo.19.2">This is an example of a double-point crossover.</span></div>
<div class="column">
<div class="page">
<div class="layoutArea">
<p><span class="koboSpan" id="kobo.20.1">There exist a lot of crossovers people have tried, for example, uniform crossover, order-based crossover, and cyclic crossover.</span></p>
</div>
</div>
</div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title"><span class="koboSpan" id="kobo.1.1">Mutation</span></h1>
                </header>
            
            <article>
                
<p><span><span class="koboSpan" id="kobo.2.1">While the crossover operation ensures variety and can help speed up the search, it does not generate new solutions. </span><span class="koboSpan" id="kobo.2.2">This is the work of the </span></span><span><span class="koboSpan" id="kobo.3.1">mutation operator, which helps in maintaining and introducing diversity in the population. </span><span class="koboSpan" id="kobo.3.2">The mutation operator</span></span><span><span class="koboSpan" id="kobo.4.1"> </span></span><span><span class="koboSpan" id="kobo.5.1">is applied to certain genes (bits) of the child chromosomes with a probability, </span></span><span><em><span class="koboSpan" id="kobo.6.1">P</span><sub><span class="koboSpan" id="kobo.7.1">m</span></sub></em><span class="koboSpan" id="kobo.8.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.9.1">We can have a bit flip mutation; if we consider our earlier example, then in </span><span><span class="koboSpan" id="kobo.10.1">the 16-bit chromosome, the bit flip mutation will cause a single bit to change its state (from </span><em><span class="koboSpan" id="kobo.11.1">0</span></em><span class="koboSpan" id="kobo.12.1"> to</span><em><span class="koboSpan" id="kobo.13.1"> 1</span></em><span class="koboSpan" id="kobo.14.1"> or from </span><em><span class="koboSpan" id="kobo.15.1">1</span></em><span class="koboSpan" id="kobo.16.1"> to </span><em><span class="koboSpan" id="kobo.17.1">0</span></em></span><span><span class="koboSpan" id="kobo.18.1">)</span></span><span><span class="koboSpan" id="kobo.19.1">.</span></span></p>
<p><span><span class="koboSpan" id="kobo.20.1">There is a possibility that we set the gene to a random value for all possible values. </span><span class="koboSpan" id="kobo.20.2">This is called </span><strong><span class="koboSpan" id="kobo.21.1">random resetting</span></strong><span class="koboSpan" id="kobo.22.1">.</span></span></p>
<p><span><span class="koboSpan" id="kobo.23.1">The probability </span></span><em><span><span class="koboSpan" id="kobo.24.1">P</span><sub><span class="koboSpan" id="kobo.25.1">m</span></sub></span><span class="koboSpan" id="kobo.26.1"> </span></em><span class="koboSpan" id="kobo.27.1">plays an important role; if we assign a very low value to</span><span><span class="koboSpan" id="kobo.28.1"> </span></span><em><span class="koboSpan" id="kobo.29.1">P</span><sub><span class="koboSpan" id="kobo.30.1">m</span></sub></em><span><span class="koboSpan" id="kobo.31.1"> </span></span><span class="koboSpan" id="kobo.32.1">it can </span><span><span class="koboSpan" id="kobo.33.1">lead to genetic drift, but on the other hand, a high </span><em><span class="koboSpan" id="kobo.34.1">P</span><sub><span class="koboSpan" id="kobo.35.1">m</span></sub></em><span class="koboSpan" id="kobo.36.1"> may result in a loss of good solutions.</span></span><span><span class="koboSpan" id="kobo.37.1"> </span></span><span><span class="koboSpan" id="kobo.38.1">We choose a mutation probability such that</span></span><span><span class="koboSpan" id="kobo.39.1"> </span></span><span><span class="koboSpan" id="kobo.40.1">the </span></span><span><span class="koboSpan" id="kobo.41.1">algorithm learns to sacrifice short-term fitness in order to gain longer-term fitness. </span></span></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title"><span class="koboSpan" id="kobo.1.1">Pros and cons</span></h1>
                </header>
            
            <article>
                
<p><span class="koboSpan" id="kobo.2.1">Genetic algorithms sound cool, right! </span><span class="koboSpan" id="kobo.2.2">Now, before we try and build a code around them, let's point out certain advantages and disadvantages of genetic algorithms.</span></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title"><span class="koboSpan" id="kobo.1.1">Advantages</span></h1>
                </header>
            
            <article>
                
<p><span><span class="koboSpan" id="kobo.2.1">Genetic algorithm</span></span><span class="koboSpan" id="kobo.3.1">s offer some intriguing advantages and can produce results when the tradition gradient-based approaches fail:</span></p>
<ul>
<li><span class="koboSpan" id="kobo.4.1">They can be used to optimize either continuous or discrete variables.</span></li>
<li><span class="koboSpan" id="kobo.5.1">Unlike gradient descent, we do not require derivative information, which also means that there is no need for the fitness function to be continuous and differentiable.</span></li>
<li><span class="koboSpan" id="kobo.6.1">It can simultaneously search from a wide sampling of the cost surface.</span></li>
<li><span class="koboSpan" id="kobo.7.1">We can deal with a large number of variables without a significant increase in computation time.</span></li>
<li><span class="koboSpan" id="kobo.8.1">The generation of the population and calculating their fitness values can be performed in parallel, and hence</span><span><span class="koboSpan" id="kobo.9.1"> </span></span><span><span class="koboSpan" id="kobo.10.1">genetic algorithm</span></span><span class="koboSpan" id="kobo.11.1">s are well suited for parallel computers.</span></li>
<li><span class="koboSpan" id="kobo.12.1">They can work even when the topological surface is extremely complex because crossover and mutation operators help them in jumping out of a local minimum.</span></li>
<li><span class="koboSpan" id="kobo.13.1">They can provide more than one optimum solution.</span></li>
<li><span class="koboSpan" id="kobo.14.1">We can use them with numerically generated data, experimental data, or even analytical functions. </span><span class="koboSpan" id="kobo.14.2">They specifically work well for large-scale optimization problems.</span></li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title"><span class="koboSpan" id="kobo.1.1">Disadvantages</span></h1>
                </header>
            
            <article>
                
<p><span class="koboSpan" id="kobo.2.1">Despite the previously mentioned advantages, we still do not find</span><span><span class="koboSpan" id="kobo.3.1"> </span></span><span><span class="koboSpan" id="kobo.4.1">genetic algorithm</span></span><span class="koboSpan" id="kobo.5.1">s to be a ubiquitous solution to all optimization problems. </span><span class="koboSpan" id="kobo.5.2">This is for the following reasons:</span></p>
<ul>
<li><span class="koboSpan" id="kobo.6.1">If the optimization function is a well-behaved convex function, then gradient-based methods will give a faster convergence</span></li>
<li><span class="koboSpan" id="kobo.7.1">The large population of solutions that helps</span><span><span class="koboSpan" id="kobo.8.1"> </span></span><span><span class="koboSpan" id="kobo.9.1">genetic algorithm</span></span><span class="koboSpan" id="kobo.10.1">s cover the search space more extensively also results in slow convergence</span></li>
<li><span class="koboSpan" id="kobo.11.1">Designing a fitness function can be a daunting task</span></li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title"><span class="koboSpan" id="kobo.1.1">Coding genetic algorithms using Distributed Evolutionary Algorithms in Python</span></h1>
                </header>
            
            <article>
                
<p><span class="koboSpan" id="kobo.2.1">Now that we understand how</span><span><span class="koboSpan" id="kobo.3.1"> </span></span><span><span class="koboSpan" id="kobo.4.1">genetic algorithm</span></span><span class="koboSpan" id="kobo.5.1">s work, let's try solving some problems with them. </span><span class="koboSpan" id="kobo.5.2">They have been used to solve NP-hard problems such as the traveling salesman problem. </span><span class="koboSpan" id="kobo.5.3">To make the task of generating a population, performing the crossover, and performing mutation operations easy, we will make use of</span><span><span class="koboSpan" id="kobo.6.1"> </span></span><strong><span class="koboSpan" id="kobo.7.1">Distributed Evolutionary Algorithms in Python</span></strong><span><span class="koboSpan" id="kobo.8.1"> </span></span><span class="koboSpan" id="kobo.9.1">(</span><strong><span class="koboSpan" id="kobo.10.1">DEAP</span></strong><span class="koboSpan" id="kobo.11.1">). </span><span class="koboSpan" id="kobo.11.2">It supports multiprocessing and we can use it for other evolutionary algorithms as well. </span><span class="koboSpan" id="kobo.11.3">You can download DEAP directly from</span><span><span class="koboSpan" id="kobo.12.1"> </span></span><span class="koboSpan" id="kobo.13.1">PyPi</span><span><span class="koboSpan" id="kobo.14.1"> </span></span><span class="koboSpan" id="kobo.15.1">using this:</span></p>
<pre><span class="koboSpan" id="kobo.16.1">pip install deap</span></pre>
<p><span class="koboSpan" id="kobo.17.1">It is compatible with Python 3. </span></p>
<p><span class="koboSpan" id="kobo.18.1">To learn more about DEAP, you can refer to its GitHub repository (</span><a href="https://github.com/DEAP/deap"><span class="koboSpan" id="kobo.19.1">https://github.com/DEAP/deap</span></a><span class="koboSpan" id="kobo.20.1">) and its user's guide (</span><a href="http://deap.readthedocs.io/en/master/"><span class="koboSpan" id="kobo.21.1">http://deap.readthedocs.io/en/master/</span></a><span class="koboSpan" id="kobo.22.1">). </span></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title"><span class="koboSpan" id="kobo.1.1">Guess the word</span></h1>
                </header>
            
            <article>
                
<p><span class="koboSpan" id="kobo.2.1">In this program, we use</span><span><span class="koboSpan" id="kobo.3.1"> </span></span><span><span class="koboSpan" id="kobo.4.1">genetic algorithm</span></span><span class="koboSpan" id="kobo.5.1">s to guess a word. </span><span class="koboSpan" id="kobo.5.2">The genetic algorithm will know the number of letters in the word and will guess those letters until it finds the right answer. </span><span class="koboSpan" id="kobo.5.3">We decide to represent the genes as a single alphanumeric character; strings of these characters thus constitute a chromosome. </span><span class="koboSpan" id="kobo.5.4">And our fitness function is the sum of the characters matching in the individual and the right word:</span></p>
<ol>
<li><span class="koboSpan" id="kobo.6.1">As the first step, we import the modules we will need. </span><span class="koboSpan" id="kobo.6.2">We use</span><span><span class="koboSpan" id="kobo.7.1"> </span></span><span><span class="koboSpan" id="kobo.8.1">the </span></span><kbd><span class="koboSpan" id="kobo.9.1">string</span></kbd><span><span class="koboSpan" id="kobo.10.1"> </span></span><span class="koboSpan" id="kobo.11.1">module and</span><span><span class="koboSpan" id="kobo.12.1"> </span></span><span><span class="koboSpan" id="kobo.13.1">the </span></span><kbd><span class="koboSpan" id="kobo.14.1">random</span></kbd><span><span class="koboSpan" id="kobo.15.1"> </span></span><span class="koboSpan" id="kobo.16.1">module to generate random characters from</span><span><span class="koboSpan" id="kobo.17.1"> </span></span><span class="koboSpan" id="kobo.18.1">(a—z</span><em><span class="koboSpan" id="kobo.19.1">,</span></em><span class="koboSpan" id="kobo.20.1"> A—Z</span><em><span class="koboSpan" id="kobo.21.1">,</span></em><span class="koboSpan" id="kobo.22.1"> and 0—9). </span><span class="koboSpan" id="kobo.22.2">From the DEAP module, we use</span><span><span class="koboSpan" id="kobo.23.1"> </span></span><kbd><span class="koboSpan" id="kobo.24.1">creator</span></kbd><span class="koboSpan" id="kobo.25.1">,</span><span><span class="koboSpan" id="kobo.26.1"> </span></span><kbd><span class="koboSpan" id="kobo.27.1">base</span></kbd><span class="koboSpan" id="kobo.28.1">, and</span><span><span class="koboSpan" id="kobo.29.1"> </span></span><kbd><span class="koboSpan" id="kobo.30.1">tools</span></kbd><span class="koboSpan" id="kobo.31.1">:</span></li>
</ol>
<pre style="padding-left: 60px"><span class="koboSpan" id="kobo.32.1">import string</span><br/><span class="koboSpan" id="kobo.33.1">import random</span><br/><br/><span class="koboSpan" id="kobo.34.1">from deap import base, creator, tools</span></pre>
<ol start="2">
<li><span class="koboSpan" id="kobo.35.1">In DEAP, we start with creating a class that inherits from the</span><span><span class="koboSpan" id="kobo.36.1"> </span></span><kbd><span class="koboSpan" id="kobo.37.1">deep.base</span></kbd><span><span class="koboSpan" id="kobo.38.1"> </span></span><span class="koboSpan" id="kobo.39.1">module. </span><span class="koboSpan" id="kobo.39.2">We need to tell it whether we are going to have a minimization or maximization of the function; this is done using the weights parameter. </span><span class="koboSpan" id="kobo.39.3">A value of</span><span><span class="koboSpan" id="kobo.40.1"> </span></span><kbd><span class="koboSpan" id="kobo.41.1">+1</span></kbd><span><span class="koboSpan" id="kobo.42.1"> </span></span><span class="koboSpan" id="kobo.43.1">means we are maximizing (for minimizing, we give the value</span><span><span class="koboSpan" id="kobo.44.1"> </span></span><kbd><span class="koboSpan" id="kobo.45.1">-1.0</span></kbd><span class="koboSpan" id="kobo.46.1">). </span><span class="koboSpan" id="kobo.46.2">The following code line will create a class, </span><kbd><span class="koboSpan" id="kobo.47.1">FitnessMax</span></kbd><span class="koboSpan" id="kobo.48.1">, that will maximize the function:</span></li>
</ol>
<pre style="padding-left: 60px"><span class="koboSpan" id="kobo.49.1">creator.create("FitnessMax", base.Fitness, weights=(1.0,))  </span></pre>
<ol start="3">
<li><span class="koboSpan" id="kobo.50.1">We also define an</span><span><span class="koboSpan" id="kobo.51.1"> </span></span><kbd><span class="koboSpan" id="kobo.52.1">Individual</span></kbd><span><span class="koboSpan" id="kobo.53.1"> </span></span><span class="koboSpan" id="kobo.54.1">class, which will inherit the class list, and tell the DEAP creator module to assign</span><span><span class="koboSpan" id="kobo.55.1"> </span></span><kbd><span class="koboSpan" id="kobo.56.1">FitnessMax</span></kbd><span><span class="koboSpan" id="kobo.57.1"> </span></span><span class="koboSpan" id="kobo.58.1">as its</span><span><span class="koboSpan" id="kobo.59.1"> </span></span><kbd><span class="koboSpan" id="kobo.60.1">fitness</span></kbd><span><span class="koboSpan" id="kobo.61.1"> </span></span><span class="koboSpan" id="kobo.62.1">attribute:</span></li>
</ol>
<pre style="padding-left: 60px"><span class="koboSpan" id="kobo.63.1">creator.create("Individual", list, fitness=creator.FitnessMax)</span></pre>
<ol start="4">
<li><span class="koboSpan" id="kobo.64.1">Now, with the</span><span><span class="koboSpan" id="kobo.65.1"> </span></span><kbd><span class="koboSpan" id="kobo.66.1">Individual</span></kbd><span><span class="koboSpan" id="kobo.67.1"> </span></span><span class="koboSpan" id="kobo.68.1">class defined, we use the</span><span><span class="koboSpan" id="kobo.69.1"> </span></span><kbd><span class="koboSpan" id="kobo.70.1">toolbox</span></kbd><span><span class="koboSpan" id="kobo.71.1"> </span></span><span class="koboSpan" id="kobo.72.1">of DEAP defined in the base module. </span><span class="koboSpan" id="kobo.72.2">We will use it to create a population and define our gene pool. </span><span><span class="koboSpan" id="kobo.73.1">All the objects that we will need from now onward—an individual, the population, the functions, the operators, and the arguments—are stored in a container called </span><kbd><span class="koboSpan" id="kobo.74.1">toolbox</span></kbd><span class="koboSpan" id="kobo.75.1">. </span></span><span><span class="koboSpan" id="kobo.76.1">We can add or remove content to/from the </span><kbd><span class="koboSpan" id="kobo.77.1">toolbox</span></kbd><span class="koboSpan" id="kobo.78.1"> </span></span><span><span class="koboSpan" id="kobo.79.1">container using the </span><kbd><span class="koboSpan" id="kobo.80.1">register()</span></kbd><span class="koboSpan" id="kobo.81.1"> </span></span><span><span class="koboSpan" id="kobo.82.1">and </span><kbd><span class="koboSpan" id="kobo.83.1">unregister()</span></kbd><span class="koboSpan" id="kobo.84.1"> </span></span><span><span class="koboSpan" id="kobo.85.1">methods:</span></span></li>
</ol>
<pre style="padding-left: 60px"><span class="koboSpan" id="kobo.86.1">toolbox = base.Toolbox()</span><br/><span class="koboSpan" id="kobo.87.1"># Gene Pool</span><br/><span class="koboSpan" id="kobo.88.1">toolbox.register("attr_string", random.choice, \</span><br/><span class="koboSpan" id="kobo.89.1">               string.ascii_letters + string.digits )</span></pre>
<ol start="5">
<li>
<p><span class="koboSpan" id="kobo.90.1">Now that we have defined how the gene pool will be created, we create an individual and then a population by repeatedly using the </span><kbd><span class="koboSpan" id="kobo.91.1">Individual</span></kbd><span class="koboSpan" id="kobo.92.1"> class. </span><span class="koboSpan" id="kobo.92.2">We will pass the class to the toolbox responsible for creating a </span><kbd><span><span class="koboSpan" id="kobo.93.1">N</span></span></kbd><span class="koboSpan" id="kobo.94.1"> parameter</span><span><span class="koboSpan" id="kobo.95.1"> </span></span><span class="koboSpan" id="kobo.96.1">, telling it how many genes to produce:</span></p>
</li>
</ol>
<pre style="padding-left: 60px"><span class="koboSpan" id="kobo.97.1">#Number of characters in word</span><br/><span class="koboSpan" id="kobo.98.1"># The word to be guessed</span><br/><span class="koboSpan" id="kobo.99.1">word = list('hello')</span><br/><span class="koboSpan" id="kobo.100.1">N = len(word)</span><br/><span class="koboSpan" id="kobo.101.1"># Initialize population</span><br/><span class="koboSpan" id="kobo.102.1">toolbox.register("individual", tools.initRepeat, \</span><br/><span class="koboSpan" id="kobo.103.1">         creator.Individual, toolbox.attr_string, N )</span><br/><span class="koboSpan" id="kobo.104.1">toolbox.register("population",tools.initRepeat, list,\</span><br/><span class="koboSpan" id="kobo.105.1">         toolbox.individual)</span></pre>
<ol start="6">
<li><span class="koboSpan" id="kobo.106.1">We define the</span><span><span class="koboSpan" id="kobo.107.1"> </span></span><kbd><span class="koboSpan" id="kobo.108.1">fitness</span></kbd><span><span class="koboSpan" id="kobo.109.1"> </span></span><span class="koboSpan" id="kobo.110.1">function. </span><span class="koboSpan" id="kobo.110.2">Note the comma in</span><span><span class="koboSpan" id="kobo.111.1"> </span></span><span><span class="koboSpan" id="kobo.112.1">the </span></span><span class="koboSpan" id="kobo.113.1">return statement. </span><span class="koboSpan" id="kobo.113.2">This is because</span><span><span class="koboSpan" id="kobo.114.1"> </span></span><span><span class="koboSpan" id="kobo.115.1">the </span></span><span class="koboSpan" id="kobo.116.1">fitness function in DEAP is returned as a tuple to allow multi-objective</span><span><span class="koboSpan" id="kobo.117.1"> </span></span><kbd><span class="koboSpan" id="kobo.118.1">fitness</span></kbd><span><span class="koboSpan" id="kobo.119.1"> </span></span><span class="koboSpan" id="kobo.120.1">functions:</span></li>
</ol>
<pre style="padding-left: 60px"><span class="koboSpan" id="kobo.121.1">def evalWord(individual, word):</span><br/><span class="koboSpan" id="kobo.122.1">    return sum(individual[i] == word[i] for i in\</span><br/><span class="koboSpan" id="kobo.123.1">            range(len(individual))),    </span></pre>
<ol start="7">
<li><span class="koboSpan" id="kobo.124.1">Add the fitness function to the container. </span><span class="koboSpan" id="kobo.124.2">Also, add the crossover operator, mutation operator, and parent selector operator. </span><span class="koboSpan" id="kobo.124.3">You can see that, for this, we are using the register function. </span><span class="koboSpan" id="kobo.124.4">In the first statement, we register the fitness function that we have defined, along with the additional arguments it will take. </span><span class="koboSpan" id="kobo.124.5">The next statement registers the crossover operation; it specifies that here we are using a two-point crossover (</span><kbd><span class="koboSpan" id="kobo.125.1">cxTwoPoint</span></kbd><span class="koboSpan" id="kobo.126.1">). </span><span class="koboSpan" id="kobo.126.2">Next, we register the mutation operator; we choose the</span><span><span class="koboSpan" id="kobo.127.1"> </span></span><kbd><span class="koboSpan" id="kobo.128.1">mutShuffleIndexes</span></kbd><span><span class="koboSpan" id="kobo.129.1"> </span></span><span class="koboSpan" id="kobo.130.1">option, which shuffles the attributes of the input individual with a probability</span><span><span class="koboSpan" id="kobo.131.1"> </span></span><kbd><span class="koboSpan" id="kobo.132.1">indpb=0.05</span></kbd><span class="koboSpan" id="kobo.133.1">. </span><span class="koboSpan" id="kobo.133.2">And finally, we define how the parents are selected; here, we have defined the method of selection as tournament selection with a tournament size of</span><span><span class="koboSpan" id="kobo.134.1"> </span></span><kbd><span class="koboSpan" id="kobo.135.1">3</span></kbd><span class="koboSpan" id="kobo.136.1">:</span></li>
</ol>
<pre style="padding-left: 60px"><span class="koboSpan" id="kobo.137.1">toolbox.register("evaluate", evalWord, word)</span><br/><span class="koboSpan" id="kobo.138.1">toolbox.register("mate", tools.cxTwoPoint)</span><br/><span class="koboSpan" id="kobo.139.1">toolbox.register("mutate", tools.mutShuffleIndexes, indpb=0.05)</span><br/><span class="koboSpan" id="kobo.140.1">toolbox.register("select", tools.selTournament, tournsize=3)</span></pre>
<ol start="8">
<li><span class="koboSpan" id="kobo.141.1">Now we have all the ingredients, so we will</span><span><span class="koboSpan" id="kobo.142.1"> </span></span><span class="koboSpan" id="kobo.143.1">write down</span><span><span class="koboSpan" id="kobo.144.1"> </span></span><span class="koboSpan" id="kobo.145.1">the code of the genetic algorithm, which will perform the steps we mentioned earlier in a repetitive manner:</span></li>
</ol>
<pre style="padding-left: 60px"><span class="koboSpan" id="kobo.146.1">def main():</span><br/><span class="koboSpan" id="kobo.147.1">    random.seed(64)</span><br/><span class="koboSpan" id="kobo.148.1">    # create an initial population of 300 individuals </span><br/><span class="koboSpan" id="kobo.149.1">    pop = toolbox.population(n=300)</span><br/><span class="koboSpan" id="kobo.150.1">    # CXPB is the crossover probability </span><br/><span class="koboSpan" id="kobo.151.1">    # MUTPB is the probability for mutating an individual</span><br/><span class="koboSpan" id="kobo.152.1">    CXPB, MUTPB = 0.5, 0.2</span><br/> <br/><span class="koboSpan" id="kobo.153.1">    print("Start of evolution")</span><br/> <br/><span class="koboSpan" id="kobo.154.1">    # Evaluate the entire population</span><br/><span class="koboSpan" id="kobo.155.1">    fitnesses = list(map(toolbox.evaluate, pop))</span><br/><span class="koboSpan" id="kobo.156.1">    for ind, fit in zip(pop, fitnesses):</span><br/><span class="koboSpan" id="kobo.157.1">        ind.fitness.values = fit</span><br/> <br/><span class="koboSpan" id="kobo.158.1">    print(" Evaluated %i individuals" % len(pop))</span><br/><br/><span class="koboSpan" id="kobo.159.1">    # Extracting all the fitnesses of individuals in a list</span><br/><span class="koboSpan" id="kobo.160.1">    fits = [ind.fitness.values[0] for ind in pop]</span><br/><span class="koboSpan" id="kobo.161.1">    # Variable keeping track of the number of generations</span><br/><span class="koboSpan" id="kobo.162.1">    g = 0</span><br/> <br/><span class="koboSpan" id="kobo.163.1">    # Begin the evolution</span><br/><span class="koboSpan" id="kobo.164.1">    while max(fits) &lt; 5 and g &lt; 1000:</span><br/><span class="koboSpan" id="kobo.165.1">        # A new generation</span><br/><span class="koboSpan" id="kobo.166.1">        g += 1</span><br/><span class="koboSpan" id="kobo.167.1">        print("-- Generation %i --" % g)</span><br/> <br/><span class="koboSpan" id="kobo.168.1">        # Select the next generation individuals</span><br/><span class="koboSpan" id="kobo.169.1">        offspring = toolbox.select(pop, len(pop))</span><br/><span class="koboSpan" id="kobo.170.1">        # Clone the selected individuals</span><br/><span class="koboSpan" id="kobo.171.1">        offspring = list(map(toolbox.clone, offspring))</span><br/> <br/><span class="koboSpan" id="kobo.172.1">        # Apply crossover and mutation on the offspring</span><br/><span class="koboSpan" id="kobo.173.1">        for child1, child2 in zip(offspring[::2], offspring[1::2]):</span><br/><span class="koboSpan" id="kobo.174.1">            # cross two individuals with probability CXPB</span><br/><span class="koboSpan" id="kobo.175.1">            if random.random() &lt; CXPB:    </span><br/><span class="koboSpan" id="kobo.176.1">            toolbox.mate(child1, child2)</span><br/><span class="koboSpan" id="kobo.177.1">            # fitness values of the children</span><br/><span class="koboSpan" id="kobo.178.1">            # must be recalculated later</span><br/><span class="koboSpan" id="kobo.179.1">            del child1.fitness.values</span><br/><span class="koboSpan" id="kobo.180.1">            del child2.fitness.values</span><br/><span class="koboSpan" id="kobo.181.1">        for mutant in offspring:</span><br/><span class="koboSpan" id="kobo.182.1">            # mutate an individual with probability MUTPB</span><br/><span class="koboSpan" id="kobo.183.1">            if random.random() &lt; MUTPB:</span><br/><span class="koboSpan" id="kobo.184.1">                toolbox.mutate(mutant)</span><br/><span class="koboSpan" id="kobo.185.1">                del mutant.fitness.values</span><br/> <br/><span class="koboSpan" id="kobo.186.1">        # Evaluate the individuals with an invalid fitness</span><br/><span class="koboSpan" id="kobo.187.1">        invalid_ind = [ind for ind in offspring if not ind.fitness.valid]</span><br/><span class="koboSpan" id="kobo.188.1">        fitnesses = map(toolbox.evaluate, invalid_ind)</span><br/><span class="koboSpan" id="kobo.189.1">        for ind, fit in zip(invalid_ind, fitnesses):</span><br/><span class="koboSpan" id="kobo.190.1">        ind.fitness.values = fit</span><br/> <br/><span class="koboSpan" id="kobo.191.1">        print(" Evaluated %i individuals" % len(invalid_ind))</span><br/> <br/><span class="koboSpan" id="kobo.192.1">        # The population is entirely replaced by the offspring</span><br/><span class="koboSpan" id="kobo.193.1">        pop[:] = offspring</span><br/> <br/><span class="koboSpan" id="kobo.194.1">        # Gather all the fitnesses in one list and print the stats</span><br/><span class="koboSpan" id="kobo.195.1">        fits = [ind.fitness.values[0] for ind in pop]</span><br/> <br/><span class="koboSpan" id="kobo.196.1">        length = len(pop)</span><br/><span class="koboSpan" id="kobo.197.1">        mean = sum(fits) / length</span><br/><span class="koboSpan" id="kobo.198.1">        sum2 = sum(x*x for x in fits)</span><br/><span class="koboSpan" id="kobo.199.1">        std = abs(sum2 / length - mean**2)**0.5</span><br/> <br/><span class="koboSpan" id="kobo.200.1">        print(" Min %s" % min(fits))</span><br/><span class="koboSpan" id="kobo.201.1">        print(" Max %s" % max(fits))</span><br/><span class="koboSpan" id="kobo.202.1">        print(" Avg %s" % mean)</span><br/><span class="koboSpan" id="kobo.203.1">        print(" Std %s" % std)</span><br/> <br/><span class="koboSpan" id="kobo.204.1">    print("-- End of (successful) evolution --")</span><br/> <br/><span class="koboSpan" id="kobo.205.1">    best_ind = tools.selBest(pop, 1)[0]</span><br/><span class="koboSpan" id="kobo.206.1">    print("Best individual is %s, %s" % (''.join(best_ind),\</span><br/><span class="koboSpan" id="kobo.207.1">             best_ind.fitness.values))</span></pre>
<ol start="9">
<li><span class="koboSpan" id="kobo.208.1">Here, you can see the result of this genetic algorithm. </span><span class="koboSpan" id="kobo.208.2">In seven generations, we reached the right</span><span><span class="koboSpan" id="kobo.209.1"> </span></span><span class="koboSpan" id="kobo.210.1">word:</span></li>
</ol>
<p class="CDPAlignCenter CDPAlign"><span class="koboSpan" id="kobo.211.1"><img class="aligncenter size-full wp-image-991 image-border" src="assets/7e2a7324-5c11-46c4-9a42-61c0ef909cf3.png" style="width:20.17em;height:51.00em;"/></span></p>
<p class="mce-root"/>
<p class="mce-root"/>
<div class="packt_infobox"><span><span class="koboSpan" id="kobo.212.1">DEAP has options to select various crossover tools, different mutation operators, and even how the tournament selection takes place. </span></span><span class="koboSpan" id="kobo.213.1">The complete list of all evolutionary tools offered by DEAP and their description is available at </span><a href="http://deap.readthedocs.io/en/master/api/tools.html#deap.tools.mutFlipBit"><span class="koboSpan" id="kobo.214.1">http://deap.readthedocs.io/en/master/api/tools.html.</span></a></div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title"><span class="koboSpan" id="kobo.1.1">Genetic algorithm for CNN architecture</span></h1>
                </header>
            
            <article>
                
<p><span class="koboSpan" id="kobo.2.1">In</span><span><span class="koboSpan" id="kobo.3.1"> </span></span><a href="cb9d27c5-e98d-44b6-a947-691b0bc64766.xhtml"><span class="koboSpan" id="kobo.4.1">Chapter 4</span></a><span class="koboSpan" id="kobo.5.1">, </span><em><span class="koboSpan" id="kobo.6.1">Deep Learning for IoT,</span></em><span class="koboSpan" id="kobo.7.1"> we learned about different DL models, such as MLP, CNN, RNN, and so on. </span><span class="koboSpan" id="kobo.7.2">Now, we will see how we can use</span><span><span class="koboSpan" id="kobo.8.1"> </span></span><span><span class="koboSpan" id="kobo.9.1">genetic algorithm</span></span><span class="koboSpan" id="kobo.10.1">s with these DL models. </span><span class="koboSpan" id="kobo.10.2">G</span><span><span class="koboSpan" id="kobo.11.1">enetic algorithm</span></span><span class="koboSpan" id="kobo.12.1">s can be used to find the optimized weights and biases, and people have tried them. </span><span class="koboSpan" id="kobo.12.2">But the most common use of</span><span><span class="koboSpan" id="kobo.13.1"> </span></span><span><span class="koboSpan" id="kobo.14.1">genetic algorithm</span></span><span class="koboSpan" id="kobo.15.1">s in DL models has been to find optimum hyperparameters. </span></p>
<p><span class="koboSpan" id="kobo.16.1">Here, we use</span><span><span class="koboSpan" id="kobo.17.1"> </span></span><span><span class="koboSpan" id="kobo.18.1">genetic algorithm</span></span><span class="koboSpan" id="kobo.19.1">s to find the optimum CNN architecture. </span><span class="koboSpan" id="kobo.19.2">The solution here is based on the paper</span><span><span class="koboSpan" id="kobo.20.1"> </span></span><em><span class="koboSpan" id="kobo.21.1">Genetic CNN</span></em><span><span class="koboSpan" id="kobo.22.1"> </span></span><span class="koboSpan" id="kobo.23.1">by Lingxi Xie and Alan Yuille (</span><a href="https://arxiv.org/abs/1703.01513"><span class="koboSpan" id="kobo.24.1">https://arxiv.org/abs/1703.01513</span></a><span class="koboSpan" id="kobo.25.1">). </span><span class="koboSpan" id="kobo.25.2">The first step will be finding the right representation of the problem. </span><span class="koboSpan" id="kobo.25.3">The authors presented a binary string representation for the network architecture. </span><span class="koboSpan" id="kobo.25.4">The family of the network is encoded into fixed-length binary strings. </span><span class="koboSpan" id="kobo.25.5">The network is composed of</span><span><span class="koboSpan" id="kobo.26.1"> </span></span><em><span class="koboSpan" id="kobo.27.1">S</span></em><span><span class="koboSpan" id="kobo.28.1"> </span></span><span class="koboSpan" id="kobo.29.1">stages where the</span><span><span class="koboSpan" id="kobo.30.1"> </span></span><em><span class="koboSpan" id="kobo.31.1">s-th</span></em><span><span class="koboSpan" id="kobo.32.1"> </span></span><span class="koboSpan" id="kobo.33.1">stage</span><span><span class="koboSpan" id="kobo.34.1"> </span></span><em><span class="koboSpan" id="kobo.35.1">s</span></em><span class="koboSpan" id="kobo.36.1">=</span><span><span class="koboSpan" id="kobo.37.1"> </span></span><em><span class="koboSpan" id="kobo.38.1">1</span></em><span class="koboSpan" id="kobo.39.1">, </span><em><span class="koboSpan" id="kobo.40.1">2</span></em><span class="koboSpan" id="kobo.41.1">,....</span><em><span class="koboSpan" id="kobo.42.1">S</span></em><span class="koboSpan" id="kobo.43.1">, contains</span><span><span class="koboSpan" id="kobo.44.1"> </span></span><em><span class="koboSpan" id="kobo.45.1">K</span><sub><span class="koboSpan" id="kobo.46.1">s</span></sub></em><span><span class="koboSpan" id="kobo.47.1"> </span></span><span class="koboSpan" id="kobo.48.1">nodes denoted by </span><span class="koboSpan" id="kobo.49.1"><img class="fm-editor-equation" src="assets/25dcaeb0-a94e-4f85-a30a-48c678a8912f.png" style="width:2.50em;height:1.25em;"/></span><span class="koboSpan" id="kobo.50.1">, here</span><span><span class="koboSpan" id="kobo.51.1"> </span></span><em><span class="koboSpan" id="kobo.52.1">k</span><sub><span class="koboSpan" id="kobo.53.1">s</span></sub></em><span><span class="koboSpan" id="kobo.54.1"> </span></span><span class="koboSpan" id="kobo.55.1">=</span><span><span class="koboSpan" id="kobo.56.1"> </span></span><em><span class="koboSpan" id="kobo.57.1">1</span></em><span class="koboSpan" id="kobo.58.1">, </span><em><span class="koboSpan" id="kobo.59.1">2</span></em><span class="koboSpan" id="kobo.60.1">,...,</span><span><span class="koboSpan" id="kobo.61.1"> </span></span><em><span class="koboSpan" id="kobo.62.1">K</span><sub><span class="koboSpan" id="kobo.63.1">s</span></sub><sub><span class="koboSpan" id="kobo.64.1">.</span></sub></em><span><span class="koboSpan" id="kobo.65.1"> </span></span><span class="koboSpan" id="kobo.66.1">The nodes in each stage are ordered and for proper representation they allow only connections from a lower-numbered node to a higher-numbered node. </span><span class="koboSpan" id="kobo.66.2">Each node represents a convolution layer operation, followed by batch normalization and ReLU activation. </span><span class="koboSpan" id="kobo.66.3">Each bit of the bit string represents the presence or absence of the connection between one convolution layer (node) and the other, the ordering of bits being as follows:</span><span><span class="koboSpan" id="kobo.67.1"> </span></span><span><span class="koboSpan" id="kobo.68.1">the </span></span><span class="koboSpan" id="kobo.69.1">first bit represents the connection</span><span><span class="koboSpan" id="kobo.70.1"> </span></span><span class="koboSpan" id="kobo.71.1">between</span><span><span class="koboSpan" id="kobo.72.1"> </span></span><span class="koboSpan" id="kobo.73.1">(</span><em><span class="koboSpan" id="kobo.74.1">v</span></em><sub><em><span class="koboSpan" id="kobo.75.1">s</span></em><span class="koboSpan" id="kobo.76.1">,1</span></sub><span class="koboSpan" id="kobo.77.1">,</span><span><span class="koboSpan" id="kobo.78.1"> </span></span><em><span class="koboSpan" id="kobo.79.1">v</span></em><sub><em><span class="koboSpan" id="kobo.80.1">s</span></em><span class="koboSpan" id="kobo.81.1">,2</span></sub><span class="koboSpan" id="kobo.82.1">), the following two bits represent the connection between</span><span><span class="koboSpan" id="kobo.83.1"> </span></span><span><span class="koboSpan" id="kobo.84.1">(</span></span><em><span class="koboSpan" id="kobo.85.1">v</span></em><sub><em><span class="koboSpan" id="kobo.86.1">s</span></em><span class="koboSpan" id="kobo.87.1">,1</span></sub><span><span class="koboSpan" id="kobo.88.1">,</span></span><span><span class="koboSpan" id="kobo.89.1"> </span></span><em><span class="koboSpan" id="kobo.90.1">v</span></em><sub><em><span class="koboSpan" id="kobo.91.1">s</span></em><span class="koboSpan" id="kobo.92.1">,3</span></sub><span><span class="koboSpan" id="kobo.93.1">) and (</span><em><span class="koboSpan" id="kobo.94.1">v</span></em><sub><em><span class="koboSpan" id="kobo.95.1">s</span></em><span class="koboSpan" id="kobo.96.1">,2</span></sub><span class="koboSpan" id="kobo.97.1">, </span><em><span class="koboSpan" id="kobo.98.1">v</span></em><sub><em><span class="koboSpan" id="kobo.99.1">s</span></em><span class="koboSpan" id="kobo.100.1">,3</span></sub><span class="koboSpan" id="kobo.101.1">), the following three bits will be (</span><em><span class="koboSpan" id="kobo.102.1">v</span></em><sub><em><span class="koboSpan" id="kobo.103.1">s</span></em><span class="koboSpan" id="kobo.104.1">,1</span></sub><span class="koboSpan" id="kobo.105.1">, </span><em><span class="koboSpan" id="kobo.106.1">v</span></em><sub><em><span class="koboSpan" id="kobo.107.1">s</span></em><span class="koboSpan" id="kobo.108.1">,3</span></sub><span class="koboSpan" id="kobo.109.1">), (</span><em><span class="koboSpan" id="kobo.110.1">v</span></em><sub><em><span class="koboSpan" id="kobo.111.1">s</span></em><span class="koboSpan" id="kobo.112.1">,1</span></sub><span class="koboSpan" id="kobo.113.1">, </span><em><span class="koboSpan" id="kobo.114.1">v</span></em><sub><em><span class="koboSpan" id="kobo.115.1">s</span></em><span class="koboSpan" id="kobo.116.1">,4</span></sub><span class="koboSpan" id="kobo.117.1">), and (</span><em><span class="koboSpan" id="kobo.118.1">v</span></em><sub><em><span class="koboSpan" id="kobo.119.1">s</span></em><span class="koboSpan" id="kobo.120.1">,2</span></sub><span class="koboSpan" id="kobo.121.1">, </span><em><span class="koboSpan" id="kobo.122.1">v</span></em><sub><em><span class="koboSpan" id="kobo.123.1">s</span></em><span class="koboSpan" id="kobo.124.1">,4</span></sub><span class="koboSpan" id="kobo.125.1">), and so on.</span></span></p>
<p><span class="koboSpan" id="kobo.126.1">To understand it better, let's consider a two-stage network (each stage will have the same number of filters and filter size). </span><span class="koboSpan" id="kobo.126.2">Stage</span><span><span class="koboSpan" id="kobo.127.1"> </span></span><em><span class="koboSpan" id="kobo.128.1">S</span></em><sub><span class="koboSpan" id="kobo.129.1">1</span></sub><span class="koboSpan" id="kobo.130.1"> let's say consists of four nodes (that is </span><em><span class="koboSpan" id="kobo.131.1">K</span><sub><span class="koboSpan" id="kobo.132.1">s</span></sub></em><span><span class="koboSpan" id="kobo.133.1"> </span></span><span class="koboSpan" id="kobo.134.1">= 4), thus the total number of bits required to encode it is (</span><em><span class="koboSpan" id="kobo.135.1">4×3×½ =</span></em><span class="koboSpan" id="kobo.136.1">) 6. </span><span class="koboSpan" id="kobo.136.2">The number of convolutional filters in stage</span><span><span class="koboSpan" id="kobo.137.1"> </span></span><em><span class="koboSpan" id="kobo.138.1">1</span></em><span><span class="koboSpan" id="kobo.139.1"> </span></span><span class="koboSpan" id="kobo.140.1">is 3</span><em><span class="koboSpan" id="kobo.141.1">2;</span></em><span class="koboSpan" id="kobo.142.1"> also we ensure that convolutional operation does not change the spatial dimensions of the image (for example, padding is the same). </span><span class="koboSpan" id="kobo.142.2">The following diagram shows the respective bit string encoded and corresponding convolution layer connections. </span><span class="koboSpan" id="kobo.142.3">The connections in red are default connections and are not encoded in the bit string. </span><span class="koboSpan" id="kobo.142.4">The first bit encodes the connection</span><span><span class="koboSpan" id="kobo.143.1"> </span></span><span class="koboSpan" id="kobo.144.1">between</span><span><span class="koboSpan" id="kobo.145.1"> </span></span><span class="koboSpan" id="kobo.146.1">(</span><em><span class="koboSpan" id="kobo.147.1">a1</span></em><span class="koboSpan" id="kobo.148.1">, </span><em><span class="koboSpan" id="kobo.149.1">a2</span></em><span class="koboSpan" id="kobo.150.1">), the next two bits encode the connection between (</span><em><span class="koboSpan" id="kobo.151.1">a1</span></em><span class="koboSpan" id="kobo.152.1">, </span><em><span class="koboSpan" id="kobo.153.1">a3</span></em><span class="koboSpan" id="kobo.154.1">) and (</span><em><span class="koboSpan" id="kobo.155.1">a2</span></em><span class="koboSpan" id="kobo.156.1">, </span><em><span class="koboSpan" id="kobo.157.1">a3</span></em><span class="koboSpan" id="kobo.158.1">), and the last three bits encode the connection between (</span><em><span class="koboSpan" id="kobo.159.1">a1</span></em><span class="koboSpan" id="kobo.160.1">, </span><em><span class="koboSpan" id="kobo.161.1">a4</span></em><span class="koboSpan" id="kobo.162.1">), (</span><em><span class="koboSpan" id="kobo.163.1">a2</span></em><span class="koboSpan" id="kobo.164.1">, </span><em><span class="koboSpan" id="kobo.165.1">a4</span></em><span class="koboSpan" id="kobo.166.1">), and (</span><em><span class="koboSpan" id="kobo.167.1">a3</span></em><span class="koboSpan" id="kobo.168.1">, </span><em><span class="koboSpan" id="kobo.169.1">a4</span></em><span class="koboSpan" id="kobo.170.1">):</span></p>
<p class="CDPAlignCenter CDPAlign"><span class="koboSpan" id="kobo.171.1"><img class="aligncenter size-full wp-image-992 image-border" src="assets/c83c821a-18a1-4f98-aab2-18f165068aee.png" style="width:162.50em;height:41.33em;"/></span></p>
<div class="CDPAlignCenter CDPAlign packt_figref"><span class="koboSpan" id="kobo.172.1">Bit string encoded and corresponding convolution layer connections</span></div>
<p><span class="koboSpan" id="kobo.173.1">Stage</span><span><span class="koboSpan" id="kobo.174.1"> </span></span><em><span class="koboSpan" id="kobo.175.1">1</span></em><span class="koboSpan" id="kobo.176.1"> takes a</span><span><span class="koboSpan" id="kobo.177.1"> </span></span><strong><span class="koboSpan" id="kobo.178.1">32 × 32 × 3</span></strong><span><span class="koboSpan" id="kobo.179.1"> </span></span><span class="koboSpan" id="kobo.180.1">input; all the convolution nodes in this stage have 32 filters. </span><span class="koboSpan" id="kobo.180.2">The red connections are default connections not encoded in the bit string. </span><span class="koboSpan" id="kobo.180.3">The green connection represents the connections according to the encoded bit string</span><span><span class="koboSpan" id="kobo.181.1"> </span></span><span class="koboSpan" id="kobo.182.1">1-00-111. </span><span class="koboSpan" id="kobo.182.2">The output of stage</span><span><span class="koboSpan" id="kobo.183.1"> </span></span><em><span class="koboSpan" id="kobo.184.1">1</span></em><span><span class="koboSpan" id="kobo.185.1"> </span></span><span class="koboSpan" id="kobo.186.1">goes to</span><span><span class="koboSpan" id="kobo.187.1"> </span></span><span><span class="koboSpan" id="kobo.188.1">the </span></span><span class="koboSpan" id="kobo.189.1">pooling layer and reduces by half in the spatial dimension. </span></p>
<p><span class="koboSpan" id="kobo.190.1">Stage 2 has five nodes, and thus will need </span><span><span class="koboSpan" id="kobo.191.1">(5×4×½ =) 10 bits. </span><span class="koboSpan" id="kobo.191.2">It will take the input from stage </span><em><span class="koboSpan" id="kobo.192.1">1</span></em><span class="koboSpan" id="kobo.193.1"> with dimensions </span><strong><span class="koboSpan" id="kobo.194.1">16 × 16 × 32</span></strong><span class="koboSpan" id="kobo.195.1">. </span><span class="koboSpan" id="kobo.195.2">Now, if we take the number of convolution filters in stage </span><em><span class="koboSpan" id="kobo.196.1">2</span></em><span class="koboSpan" id="kobo.197.1"> as </span><em><span class="koboSpan" id="kobo.198.1">64</span></em><span class="koboSpan" id="kobo.199.1">, then after the pooling the output would be 8 × 8 × 64.</span></span></p>
<p><span class="koboSpan" id="kobo.200.1">The code presented here is taken from </span><a href="https://github.com/aqibsaeed/Genetic-CNN"><span class="koboSpan" id="kobo.201.1">https://github.com/aqibsaeed/Genetic-CNN</span></a><span class="koboSpan" id="kobo.202.1">. </span><span class="koboSpan" id="kobo.202.2">Since we need to represent a graph structure, the network is built using</span><span><span class="koboSpan" id="kobo.203.1"> </span></span><strong><span class="koboSpan" id="kobo.204.1">directed acyclic graph</span></strong><span><span class="koboSpan" id="kobo.205.1"> </span></span><span class="koboSpan" id="kobo.206.1">(</span><strong><span><span class="koboSpan" id="kobo.207.1">DAG</span></span></strong><span class="koboSpan" id="kobo.208.1">). </span><span class="koboSpan" id="kobo.208.2">To represent DAG, we define a class, DAG, in which we define methods for adding a new node, deleting an existing node, adding an edge (connection) between two nodes, and deleting an edge between two nodes. </span><span class="koboSpan" id="kobo.208.3">Besides these, the methods are defined to find a node predecessor, the nodes it is connected to, and a list of leaves of the graph. </span><span class="koboSpan" id="kobo.208.4">The complete code is in</span><span><span class="koboSpan" id="kobo.209.1"> </span></span><kbd><span class="koboSpan" id="kobo.210.1">dag.py</span></kbd><span class="koboSpan" id="kobo.211.1">, which you can access from the GitHub link.</span></p>
<p><span class="koboSpan" id="kobo.212.1">The main code is given in the </span><kbd><span class="koboSpan" id="kobo.213.1">Genetic_CNN.ipynb</span></kbd><span><span class="koboSpan" id="kobo.214.1"> </span></span><span class="koboSpan" id="kobo.215.1">Jupyter Notebook. </span><span class="koboSpan" id="kobo.215.2">We use the DEAP library to run the genetic algorithm, and TensorFlow to construct a CNN from the graph constructed by</span><span><span class="koboSpan" id="kobo.216.1"> </span></span><span><span class="koboSpan" id="kobo.217.1">the </span></span><span class="koboSpan" id="kobo.218.1">genetic algorithm. </span><span class="koboSpan" id="kobo.218.2">The fitness function is the accuracy. </span><span class="koboSpan" id="kobo.218.3">The code is built to find the CNN that will give the highest accuracy on</span><span><span class="koboSpan" id="kobo.219.1"> </span></span><span><span class="koboSpan" id="kobo.220.1">the </span></span><span class="koboSpan" id="kobo.221.1">MNIST dataset (the handwritten digits, which we used in</span><span><span class="koboSpan" id="kobo.222.1"> </span></span><a href="cb9d27c5-e98d-44b6-a947-691b0bc64766.xhtml"><span class="koboSpan" id="kobo.223.1">Chapter 4</span></a><span class="koboSpan" id="kobo.224.1">, </span><em><span class="koboSpan" id="kobo.225.1">Deep Learning for IoT</span></em><span class="koboSpan" id="kobo.226.1">; here, we access them directly from</span><span><span class="koboSpan" id="kobo.227.1"> </span></span><span><span class="koboSpan" id="kobo.228.1">the </span></span><span class="koboSpan" id="kobo.229.1">TensorFlow library):</span></p>
<ol>
<li><span class="koboSpan" id="kobo.230.1">The first step is to import the modules. </span><span class="koboSpan" id="kobo.230.2">Here, we will need DEAP and TensorFlow, and we also will import the DAG class we created in</span><span><span class="koboSpan" id="kobo.231.1"> </span></span><kbd><span class="koboSpan" id="kobo.232.1">dag.py</span></kbd><span><span class="koboSpan" id="kobo.233.1"> </span></span><span class="koboSpan" id="kobo.234.1">and the standard Numpy and Random modules:</span></li>
</ol>
<pre style="padding-left: 60px"><span class="kn"><span class="koboSpan" id="kobo.235.1">import</span></span> <span class="nn"><span class="koboSpan" id="kobo.236.1">random</span></span>
<span class="kn"><span class="koboSpan" id="kobo.237.1">import</span></span> <span class="nn"><span class="koboSpan" id="kobo.238.1">numpy</span></span> <span class="k"><span class="koboSpan" id="kobo.239.1">as</span></span> <span class="nn"><span class="koboSpan" id="kobo.240.1">np</span></span>

<span class="kn"><span class="koboSpan" id="kobo.241.1">from</span></span> <span class="nn"><span class="koboSpan" id="kobo.242.1">deap</span></span> <span class="k"><span class="koboSpan" id="kobo.243.1">import</span></span> <span class="n"><span class="koboSpan" id="kobo.244.1">base</span></span><span class="p"><span class="koboSpan" id="kobo.245.1">,</span></span> <span class="n"><span class="koboSpan" id="kobo.246.1">creator</span></span><span class="p"><span class="koboSpan" id="kobo.247.1">,</span></span> <span class="n"><span class="koboSpan" id="kobo.248.1">tools</span></span><span class="p"><span class="koboSpan" id="kobo.249.1">,</span></span> <span class="n"><span class="koboSpan" id="kobo.250.1">algorithms</span></span>
<span class="kn"><span class="koboSpan" id="kobo.251.1">from</span></span> <span class="nn"><span class="koboSpan" id="kobo.252.1">scipy.stats</span></span> <span class="k"><span class="koboSpan" id="kobo.253.1">import</span></span> <span class="n"><span class="koboSpan" id="kobo.254.1">bernoulli</span></span>
<span class="kn"><span class="koboSpan" id="kobo.255.1">from</span></span> <span class="nn"><span class="koboSpan" id="kobo.256.1">dag</span></span> <span class="k"><span class="koboSpan" id="kobo.257.1">import</span></span> <span class="n"><span class="koboSpan" id="kobo.258.1">DAG</span></span><span class="p"><span class="koboSpan" id="kobo.259.1">,</span></span> <span class="n"><span class="koboSpan" id="kobo.260.1">DAGValidationError</span></span>

<span class="kn"><span class="koboSpan" id="kobo.261.1">import</span></span> <span class="nn"><span class="koboSpan" id="kobo.262.1">tensorflow</span></span> <span class="k"><span class="koboSpan" id="kobo.263.1">as</span></span> <span class="nn"><span class="koboSpan" id="kobo.264.1">tf</span></span>
<span class="kn"><span class="koboSpan" id="kobo.265.1">from</span></span> <span class="nn"><span class="koboSpan" id="kobo.266.1">tensorflow.examples.tutorials.mnist</span></span> <span class="k"><span class="koboSpan" id="kobo.267.1">import</span></span> <span class="n"><span class="koboSpan" id="kobo.268.1">input_data</span></span></pre>
<ol start="2">
<li><span class="koboSpan" id="kobo.269.1">We read the data directly from</span><span><span class="koboSpan" id="kobo.270.1"> </span></span><span><span class="koboSpan" id="kobo.271.1">the </span></span><span class="koboSpan" id="kobo.272.1">TensorFlow examples library:</span></li>
</ol>
<pre style="padding-left: 60px"><span class="n"><span class="koboSpan" id="kobo.273.1">mnist</span></span> <span class="o"><span class="koboSpan" id="kobo.274.1">=</span></span> <span class="n"><span class="koboSpan" id="kobo.275.1">input_data</span></span><span class="o"><span class="koboSpan" id="kobo.276.1">.</span></span><span class="n"><span class="koboSpan" id="kobo.277.1">read_data_sets</span></span><span class="p"><span class="koboSpan" id="kobo.278.1">(</span></span><span class="s2"><span class="koboSpan" id="kobo.279.1">"mnist_data/"</span></span><span class="p"><span class="koboSpan" id="kobo.280.1">,</span></span> <span class="n"><span class="koboSpan" id="kobo.281.1">one_hot</span></span><span class="o"><span class="koboSpan" id="kobo.282.1">=</span></span><span class="kc"><span class="koboSpan" id="kobo.283.1">True</span></span><span class="p"><span class="koboSpan" id="kobo.284.1">)</span></span>
<span class="n"><span class="koboSpan" id="kobo.285.1">train_imgs</span></span>   <span class="o"><span class="koboSpan" id="kobo.286.1">=</span></span> <span class="n"><span class="koboSpan" id="kobo.287.1">mnist</span></span><span class="o"><span class="koboSpan" id="kobo.288.1">.</span></span><span class="n"><span class="koboSpan" id="kobo.289.1">train</span></span><span class="o"><span class="koboSpan" id="kobo.290.1">.</span></span><span class="n"><span class="koboSpan" id="kobo.291.1">images</span></span>
<span class="n"><span class="koboSpan" id="kobo.292.1">train_labels</span></span> <span class="o"><span class="koboSpan" id="kobo.293.1">=</span></span> <span class="n"><span class="koboSpan" id="kobo.294.1">mnist</span></span><span class="o"><span class="koboSpan" id="kobo.295.1">.</span></span><span class="n"><span class="koboSpan" id="kobo.296.1">train</span></span><span class="o"><span class="koboSpan" id="kobo.297.1">.</span></span><span class="n"><span class="koboSpan" id="kobo.298.1">labels</span></span>
<span class="n"><span class="koboSpan" id="kobo.299.1">test_imgs</span></span>    <span class="o"><span class="koboSpan" id="kobo.300.1">=</span></span> <span class="n"><span class="koboSpan" id="kobo.301.1">mnist</span></span><span class="o"><span class="koboSpan" id="kobo.302.1">.</span></span><span class="n"><span class="koboSpan" id="kobo.303.1">test</span></span><span class="o"><span class="koboSpan" id="kobo.304.1">.</span></span><span class="n"><span class="koboSpan" id="kobo.305.1">images</span></span>
<span class="n"><span class="koboSpan" id="kobo.306.1">test_labels</span></span>  <span class="o"><span class="koboSpan" id="kobo.307.1">=</span></span> <span class="n"><span class="koboSpan" id="kobo.308.1">mnist</span></span><span class="o"><span class="koboSpan" id="kobo.309.1">.</span></span><span class="n"><span class="koboSpan" id="kobo.310.1">test</span></span><span class="o"><span class="koboSpan" id="kobo.311.1">.</span></span><span class="n"><span class="koboSpan" id="kobo.312.1">labels</span></span>

<span class="n"><span class="koboSpan" id="kobo.313.1">train_imgs</span></span> <span class="o"><span class="koboSpan" id="kobo.314.1">=</span></span> <span class="n"><span class="koboSpan" id="kobo.315.1">np</span></span><span class="o"><span class="koboSpan" id="kobo.316.1">.</span></span><span class="n"><span class="koboSpan" id="kobo.317.1">reshape</span></span><span class="p"><span class="koboSpan" id="kobo.318.1">(</span></span><span class="n"><span class="koboSpan" id="kobo.319.1">train_imgs</span></span><span class="p"><span class="koboSpan" id="kobo.320.1">,[</span></span><span class="o"><span class="koboSpan" id="kobo.321.1">-</span></span><span class="mi"><span class="koboSpan" id="kobo.322.1">1</span></span><span class="p"><span class="koboSpan" id="kobo.323.1">,</span></span><span class="mi"><span class="koboSpan" id="kobo.324.1">28</span></span><span class="p"><span class="koboSpan" id="kobo.325.1">,</span></span><span class="mi"><span class="koboSpan" id="kobo.326.1">28</span></span><span class="p"><span class="koboSpan" id="kobo.327.1">,</span></span><span class="mi"><span class="koboSpan" id="kobo.328.1">1</span></span><span class="p"><span class="koboSpan" id="kobo.329.1">])</span></span>
<span class="n"><span class="koboSpan" id="kobo.330.1">test_imgs</span></span> <span class="o"><span class="koboSpan" id="kobo.331.1">=</span></span> <span class="n"><span class="koboSpan" id="kobo.332.1">np</span></span><span class="o"><span class="koboSpan" id="kobo.333.1">.</span></span><span class="n"><span class="koboSpan" id="kobo.334.1">reshape</span></span><span class="p"><span class="koboSpan" id="kobo.335.1">(</span></span><span class="n"><span class="koboSpan" id="kobo.336.1">test_imgs</span></span><span class="p"><span class="koboSpan" id="kobo.337.1">,[</span></span><span class="o"><span class="koboSpan" id="kobo.338.1">-</span></span><span class="mi"><span class="koboSpan" id="kobo.339.1">1</span></span><span class="p"><span class="koboSpan" id="kobo.340.1">,</span></span><span class="mi"><span class="koboSpan" id="kobo.341.1">28</span></span><span class="p"><span class="koboSpan" id="kobo.342.1">,</span></span><span class="mi"><span class="koboSpan" id="kobo.343.1">28</span></span><span class="p"><span class="koboSpan" id="kobo.344.1">,</span></span><span class="mi"><span class="koboSpan" id="kobo.345.1">1</span></span><span class="p"><span class="koboSpan" id="kobo.346.1">])</span></span></pre>
<ol start="3">
<li><span class="koboSpan" id="kobo.347.1">Now, we build the bit data structure that will hold the network information. </span><span class="koboSpan" id="kobo.347.2">The network we are designing is a three-stage network, with three nodes in stage 1 (3 bits), four nodes in stage 2 (6 bits), and five nodes in stage 3 (10 bits). </span><span class="koboSpan" id="kobo.347.3">Thus, one Individual will be represented by a binary string of</span><span><span class="koboSpan" id="kobo.348.1"> </span></span><em><span class="koboSpan" id="kobo.349.1">3 + 6 + 10 = 19</span></em><span><span class="koboSpan" id="kobo.350.1"> </span></span><span class="koboSpan" id="kobo.351.1">bits:</span></li>
</ol>
<pre style="padding-left: 60px"><span class="n"><span class="koboSpan" id="kobo.352.1">STAGES</span></span> <span class="o"><span class="koboSpan" id="kobo.353.1">=</span></span> <span class="n"><span class="koboSpan" id="kobo.354.1">np</span></span><span class="o"><span class="koboSpan" id="kobo.355.1">.</span></span><span class="n"><span class="koboSpan" id="kobo.356.1">array</span></span><span class="p"><span class="koboSpan" id="kobo.357.1">([</span></span><span class="s2"><span class="koboSpan" id="kobo.358.1">"s1"</span></span><span class="p"><span class="koboSpan" id="kobo.359.1">,</span></span><span class="s2"><span class="koboSpan" id="kobo.360.1">"s2"</span></span><span class="p"><span class="koboSpan" id="kobo.361.1">,</span></span><span class="s2"><span class="koboSpan" id="kobo.362.1">"s3"</span></span><span class="p"><span class="koboSpan" id="kobo.363.1">])</span></span> <span class="c1"><span class="koboSpan" id="kobo.364.1"># S</span></span>
<span class="n"><span class="koboSpan" id="kobo.365.1">NUM_NODES</span></span> <span class="o"><span class="koboSpan" id="kobo.366.1">=</span></span> <span class="n"><span class="koboSpan" id="kobo.367.1">np</span></span><span class="o"><span class="koboSpan" id="kobo.368.1">.</span></span><span class="n"><span class="koboSpan" id="kobo.369.1">array</span></span><span class="p"><span class="koboSpan" id="kobo.370.1">([</span></span><span class="mi"><span class="koboSpan" id="kobo.371.1">3</span></span><span class="p"><span class="koboSpan" id="kobo.372.1">,</span></span><span class="mi"><span class="koboSpan" id="kobo.373.1">4</span></span><span class="p"><span class="koboSpan" id="kobo.374.1">,</span></span><span class="mi"><span class="koboSpan" id="kobo.375.1">5</span></span><span class="p"><span class="koboSpan" id="kobo.376.1">])</span></span> <span class="c1"><span class="koboSpan" id="kobo.377.1"># K</span></span>

<span class="n"><span class="koboSpan" id="kobo.378.1">L</span></span> <span class="o"><span class="koboSpan" id="kobo.379.1">=</span></span>  <span class="mi"><span class="koboSpan" id="kobo.380.1">0</span></span> <span class="c1"><span class="koboSpan" id="kobo.381.1"># genome length</span></span>
<span class="n"><span class="koboSpan" id="kobo.382.1">BITS_INDICES</span></span><span class="p"><span class="koboSpan" id="kobo.383.1">,</span></span> <span class="n"><span class="koboSpan" id="kobo.384.1">l_bpi</span></span> <span class="o"><span class="koboSpan" id="kobo.385.1">=</span></span> <span class="n"><span class="koboSpan" id="kobo.386.1">np</span></span><span class="o"><span class="koboSpan" id="kobo.387.1">.</span></span><span class="n"><span class="koboSpan" id="kobo.388.1">empty</span></span><span class="p"><span class="koboSpan" id="kobo.389.1">((</span></span><span class="mi"><span class="koboSpan" id="kobo.390.1">0</span></span><span class="p"><span class="koboSpan" id="kobo.391.1">,</span></span><span class="mi"><span class="koboSpan" id="kobo.392.1">2</span></span><span class="p"><span class="koboSpan" id="kobo.393.1">),</span></span><span class="n"><span class="koboSpan" id="kobo.394.1">dtype</span></span> <span class="o"><span class="koboSpan" id="kobo.395.1">=</span></span> <span class="n"><span class="koboSpan" id="kobo.396.1">np</span></span><span class="o"><span class="koboSpan" id="kobo.397.1">.</span></span><span class="n"><span class="koboSpan" id="kobo.398.1">int32</span></span><span class="p"><span class="koboSpan" id="kobo.399.1">),</span></span> <span class="mi"><span class="koboSpan" id="kobo.400.1">0</span></span> <span class="c1"><span class="koboSpan" id="kobo.401.1"># to keep track of bits for each stage S</span></span>
<span class="k"><span class="koboSpan" id="kobo.402.1">for</span></span> <span class="n"><span class="koboSpan" id="kobo.403.1">nn</span></span> <span class="ow"><span class="koboSpan" id="kobo.404.1">in</span></span> <span class="n"><span class="koboSpan" id="kobo.405.1">NUM_NODES</span></span><span class="p"><span class="koboSpan" id="kobo.406.1">:</span></span>
    <span class="n"><span class="koboSpan" id="kobo.407.1">t</span></span> <span class="o"><span class="koboSpan" id="kobo.408.1">=</span></span> <span class="n"><span class="koboSpan" id="kobo.409.1">nn</span></span> <span class="o"><span class="koboSpan" id="kobo.410.1">*</span></span> <span class="p"><span class="koboSpan" id="kobo.411.1">(</span></span><span class="n"><span class="koboSpan" id="kobo.412.1">nn</span></span> <span class="o"><span class="koboSpan" id="kobo.413.1">-</span></span> <span class="mi"><span class="koboSpan" id="kobo.414.1">1</span></span><span class="p"><span class="koboSpan" id="kobo.415.1">)</span></span>
    <span class="n"><span class="koboSpan" id="kobo.416.1">BITS_INDICES</span></span> <span class="o"><span class="koboSpan" id="kobo.417.1">=</span></span> <span class="n"><span class="koboSpan" id="kobo.418.1">np</span></span><span class="o"><span class="koboSpan" id="kobo.419.1">.</span></span><span class="n"><span class="koboSpan" id="kobo.420.1">vstack</span></span><span class="p"><span class="koboSpan" id="kobo.421.1">([</span></span><span class="n"><span class="koboSpan" id="kobo.422.1">BITS_INDICES</span></span><span class="p"><span class="koboSpan" id="kobo.423.1">,[</span></span><span class="n"><span class="koboSpan" id="kobo.424.1">l_bpi</span></span><span class="p"><span class="koboSpan" id="kobo.425.1">,</span></span> <span class="n"><span class="koboSpan" id="kobo.426.1">l_bpi</span></span> <span class="o"><span class="koboSpan" id="kobo.427.1">+</span></span> <span class="nb"><span class="koboSpan" id="kobo.428.1">int</span></span><span class="p"><span class="koboSpan" id="kobo.429.1">(</span></span><span class="mf"><span class="koboSpan" id="kobo.430.1">0.5</span></span> <span class="o"><span class="koboSpan" id="kobo.431.1">*</span></span> <span class="n"><span class="koboSpan" id="kobo.432.1">t</span></span><span class="p"><span class="koboSpan" id="kobo.433.1">)]])</span></span>
    <span class="n"><span class="koboSpan" id="kobo.434.1">l_bpi</span></span> <span class="o"><span class="koboSpan" id="kobo.435.1">=</span></span> <span class="nb"><span class="koboSpan" id="kobo.436.1">int</span></span><span class="p"><span class="koboSpan" id="kobo.437.1">(</span></span><span class="mf"><span class="koboSpan" id="kobo.438.1">0.5</span></span> <span class="o"><span class="koboSpan" id="kobo.439.1">*</span></span> <span class="n"><span class="koboSpan" id="kobo.440.1">t</span></span><span class="p"><span class="koboSpan" id="kobo.441.1">)</span></span>
    <span class="n"><span class="koboSpan" id="kobo.442.1">L</span></span> <span class="o"><span class="koboSpan" id="kobo.443.1">+=</span></span> <span class="n"><span class="koboSpan" id="kobo.444.1">t</span></span>
<span class="n"><span class="koboSpan" id="kobo.445.1">L</span></span> <span class="o"><span class="koboSpan" id="kobo.446.1">=</span></span> <span class="nb"><span class="koboSpan" id="kobo.447.1">int</span></span><span class="p"><span class="koboSpan" id="kobo.448.1">(</span></span><span class="mf"><span class="koboSpan" id="kobo.449.1">0.5</span></span> <span class="o"><span class="koboSpan" id="kobo.450.1">*</span></span> <span class="n"><span class="koboSpan" id="kobo.451.1">L</span></span><span class="p"><span class="koboSpan" id="kobo.452.1">)</span></span>

<span class="n"><span class="koboSpan" id="kobo.453.1">TRAINING_EPOCHS</span></span> <span class="o"><span class="koboSpan" id="kobo.454.1">=</span></span> <span class="mi"><span class="koboSpan" id="kobo.455.1">20</span></span>
<span class="n"><span class="koboSpan" id="kobo.456.1">BATCH_SIZE</span></span> <span class="o"><span class="koboSpan" id="kobo.457.1">=</span></span> <span class="mi"><span class="koboSpan" id="kobo.458.1">20</span></span>
<span class="n"><span class="koboSpan" id="kobo.459.1">TOTAL_BATCHES</span></span> <span class="o"><span class="koboSpan" id="kobo.460.1">=</span></span> <span class="n"><span class="koboSpan" id="kobo.461.1">train_imgs</span></span><span class="o"><span class="koboSpan" id="kobo.462.1">.</span></span><span class="n"><span class="koboSpan" id="kobo.463.1">shape</span></span><span class="p"><span class="koboSpan" id="kobo.464.1">[</span></span><span class="mi"><span class="koboSpan" id="kobo.465.1">0</span></span><span class="p"><span class="koboSpan" id="kobo.466.1">]</span></span> <span class="o"><span class="koboSpan" id="kobo.467.1">//</span></span> <span class="n"><span class="koboSpan" id="kobo.468.1">BATCH_SIZE</span></span></pre>
<p class="mce-root"/>
<p class="mce-root"/>
<ol start="4">
<li><span class="koboSpan" id="kobo.469.1">Now comes the part where we build the graph according to the encoded bit string. </span><span class="koboSpan" id="kobo.469.2">This will help build the population for the genetic algorithm. </span><span class="koboSpan" id="kobo.469.3">First, we define the functions we will need to build a CNN (</span><kbd><span class="koboSpan" id="kobo.470.1">weight_variable</span></kbd><span class="koboSpan" id="kobo.471.1">: creates the weight variable for a convolutional node; </span><kbd><span class="koboSpan" id="kobo.472.1">bias_variable</span></kbd><span class="koboSpan" id="kobo.473.1">: creates the bias variable </span><span><span class="koboSpan" id="kobo.474.1">for a convolutional node; </span><kbd><span class="koboSpan" id="kobo.475.1">apply_convolution</span></kbd><span class="koboSpan" id="kobo.476.1">: the function that performs the convolution operation; </span><kbd><span class="koboSpan" id="kobo.477.1">apply_pool</span></kbd><span class="koboSpan" id="kobo.478.1">: the function that will perform the pooling operation after each stage; and finally the last fully connected layer using the </span><kbd><span class="koboSpan" id="kobo.479.1">linear_layer</span></kbd><span class="koboSpan" id="kobo.480.1"> function):</span></span></li>
</ol>
<pre style="padding-left: 60px"><span class="k"><span class="koboSpan" id="kobo.481.1">def</span></span> <span class="nf"><span class="koboSpan" id="kobo.482.1">weight_variable</span></span><span class="p"><span class="koboSpan" id="kobo.483.1">(</span></span><span class="n"><span class="koboSpan" id="kobo.484.1">weight_name</span></span><span class="p"><span class="koboSpan" id="kobo.485.1">,</span></span> <span class="n"><span class="koboSpan" id="kobo.486.1">weight_shape</span></span><span class="p"><span class="koboSpan" id="kobo.487.1">):</span></span>
    <span class="k"><span class="koboSpan" id="kobo.488.1">return</span></span> <span class="n"><span class="koboSpan" id="kobo.489.1">tf</span></span><span class="o"><span class="koboSpan" id="kobo.490.1">.</span></span><span class="n"><span class="koboSpan" id="kobo.491.1">Variable</span></span><span class="p"><span class="koboSpan" id="kobo.492.1">(</span></span><span class="n"><span class="koboSpan" id="kobo.493.1">tf</span></span><span class="o"><span class="koboSpan" id="kobo.494.1">.</span></span><span class="n"><span class="koboSpan" id="kobo.495.1">truncated_normal</span></span><span class="p"><span class="koboSpan" id="kobo.496.1">(</span></span><span class="n"><span class="koboSpan" id="kobo.497.1">weight_shape</span></span><span class="p"><span class="koboSpan" id="kobo.498.1">,</span></span> <span class="n"><span class="koboSpan" id="kobo.499.1">stddev</span></span> <span class="o"><span class="koboSpan" id="kobo.500.1">=</span></span> <span class="mf"><span class="koboSpan" id="kobo.501.1">0.1</span></span><span class="p"><span class="koboSpan" id="kobo.502.1">),</span></span><span class="n"><span class="koboSpan" id="kobo.503.1">name</span></span> <span class="o"><span class="koboSpan" id="kobo.504.1">=</span></span> <span class="s1"><span class="koboSpan" id="kobo.505.1">''</span></span><span class="o"><span class="koboSpan" id="kobo.506.1">.</span></span><span class="n"><span class="koboSpan" id="kobo.507.1">join</span></span><span class="p"><span class="koboSpan" id="kobo.508.1">([</span></span><span class="s2"><span class="koboSpan" id="kobo.509.1">"weight_"</span></span><span class="p"><span class="koboSpan" id="kobo.510.1">,</span></span> <span class="n"><span class="koboSpan" id="kobo.511.1">weight_name</span></span><span class="p"><span class="koboSpan" id="kobo.512.1">]))</span></span>

<span class="k"><span class="koboSpan" id="kobo.513.1">def</span></span> <span class="nf"><span class="koboSpan" id="kobo.514.1">bias_variable</span></span><span class="p"><span class="koboSpan" id="kobo.515.1">(</span></span><span class="n"><span class="koboSpan" id="kobo.516.1">bias_name</span></span><span class="p"><span class="koboSpan" id="kobo.517.1">,</span></span><span class="n"><span class="koboSpan" id="kobo.518.1">bias_shape</span></span><span class="p"><span class="koboSpan" id="kobo.519.1">):</span></span>
    <span class="k"><span class="koboSpan" id="kobo.520.1">return</span></span> <span class="n"><span class="koboSpan" id="kobo.521.1">tf</span></span><span class="o"><span class="koboSpan" id="kobo.522.1">.</span></span><span class="n"><span class="koboSpan" id="kobo.523.1">Variable</span></span><span class="p"><span class="koboSpan" id="kobo.524.1">(</span></span><span class="n"><span class="koboSpan" id="kobo.525.1">tf</span></span><span class="o"><span class="koboSpan" id="kobo.526.1">.</span></span><span class="n"><span class="koboSpan" id="kobo.527.1">constant</span></span><span class="p"><span class="koboSpan" id="kobo.528.1">(</span></span><span class="mf"><span class="koboSpan" id="kobo.529.1">0.01</span></span><span class="p"><span class="koboSpan" id="kobo.530.1">,</span></span> <span class="n"><span class="koboSpan" id="kobo.531.1">shape</span></span> <span class="o"><span class="koboSpan" id="kobo.532.1">=</span></span> <span class="n"><span class="koboSpan" id="kobo.533.1">bias_shape</span></span><span class="p"><span class="koboSpan" id="kobo.534.1">),</span></span><span class="n"><span class="koboSpan" id="kobo.535.1">name</span></span> <span class="o"><span class="koboSpan" id="kobo.536.1">=</span></span> <span class="s1"><span class="koboSpan" id="kobo.537.1">''</span></span><span class="o"><span class="koboSpan" id="kobo.538.1">.</span></span><span class="n"><span class="koboSpan" id="kobo.539.1">join</span></span><span class="p"><span class="koboSpan" id="kobo.540.1">([</span></span><span class="s2"><span class="koboSpan" id="kobo.541.1">"bias_"</span></span><span class="p"><span class="koboSpan" id="kobo.542.1">,</span></span> <span class="n"><span class="koboSpan" id="kobo.543.1">bias_name</span></span><span class="p"><span class="koboSpan" id="kobo.544.1">]))</span></span>

<span class="k"><span class="koboSpan" id="kobo.545.1">def</span></span> <span class="nf"><span class="koboSpan" id="kobo.546.1">linear_layer</span></span><span class="p"><span class="koboSpan" id="kobo.547.1">(</span></span><span class="n"><span class="koboSpan" id="kobo.548.1">x</span></span><span class="p"><span class="koboSpan" id="kobo.549.1">,</span></span><span class="n"><span class="koboSpan" id="kobo.550.1">n_hidden_units</span></span><span class="p"><span class="koboSpan" id="kobo.551.1">,</span></span><span class="n"><span class="koboSpan" id="kobo.552.1">layer_name</span></span><span class="p"><span class="koboSpan" id="kobo.553.1">):</span></span>
    <span class="n"><span class="koboSpan" id="kobo.554.1">n_input</span></span> <span class="o"><span class="koboSpan" id="kobo.555.1">=</span></span> <span class="nb"><span class="koboSpan" id="kobo.556.1">int</span></span><span class="p"><span class="koboSpan" id="kobo.557.1">(</span></span><span class="n"><span class="koboSpan" id="kobo.558.1">x</span></span><span class="o"><span class="koboSpan" id="kobo.559.1">.</span></span><span class="n"><span class="koboSpan" id="kobo.560.1">get_shape</span></span><span class="p"><span class="koboSpan" id="kobo.561.1">()[</span></span><span class="mi"><span class="koboSpan" id="kobo.562.1">1</span></span><span class="p"><span class="koboSpan" id="kobo.563.1">])</span></span>
    <span class="n"><span class="koboSpan" id="kobo.564.1">weights</span></span> <span class="o"><span class="koboSpan" id="kobo.565.1">=</span></span> <span class="n"><span class="koboSpan" id="kobo.566.1">weight_variable</span></span><span class="p"><span class="koboSpan" id="kobo.567.1">(</span></span><span class="n"><span class="koboSpan" id="kobo.568.1">layer_name</span></span><span class="p"><span class="koboSpan" id="kobo.569.1">,[</span></span><span class="n"><span class="koboSpan" id="kobo.570.1">n_input</span></span><span class="p"><span class="koboSpan" id="kobo.571.1">,</span></span> <span class="n"><span class="koboSpan" id="kobo.572.1">n_hidden_units</span></span><span class="p"><span class="koboSpan" id="kobo.573.1">])</span></span>
    <span class="n"><span class="koboSpan" id="kobo.574.1">biases</span></span> <span class="o"><span class="koboSpan" id="kobo.575.1">=</span></span> <span class="n"><span class="koboSpan" id="kobo.576.1">bias_variable</span></span><span class="p"><span class="koboSpan" id="kobo.577.1">(</span></span><span class="n"><span class="koboSpan" id="kobo.578.1">layer_name</span></span><span class="p"><span class="koboSpan" id="kobo.579.1">,[</span></span><span class="n"><span class="koboSpan" id="kobo.580.1">n_hidden_units</span></span><span class="p"><span class="koboSpan" id="kobo.581.1">])</span></span>
    <span class="k"><span class="koboSpan" id="kobo.582.1">return</span></span> <span class="n"><span class="koboSpan" id="kobo.583.1">tf</span></span><span class="o"><span class="koboSpan" id="kobo.584.1">.</span></span><span class="n"><span class="koboSpan" id="kobo.585.1">add</span></span><span class="p"><span class="koboSpan" id="kobo.586.1">(</span></span><span class="n"><span class="koboSpan" id="kobo.587.1">tf</span></span><span class="o"><span class="koboSpan" id="kobo.588.1">.</span></span><span class="n"><span class="koboSpan" id="kobo.589.1">matmul</span></span><span class="p"><span class="koboSpan" id="kobo.590.1">(</span></span><span class="n"><span class="koboSpan" id="kobo.591.1">x</span></span><span class="p"><span class="koboSpan" id="kobo.592.1">,</span></span><span class="n"><span class="koboSpan" id="kobo.593.1">weights</span></span><span class="p"><span class="koboSpan" id="kobo.594.1">),</span></span><span class="n"><span class="koboSpan" id="kobo.595.1">biases</span></span><span class="p"><span class="koboSpan" id="kobo.596.1">)</span></span>

<span class="k"><span class="koboSpan" id="kobo.597.1">def</span></span> <span class="nf"><span class="koboSpan" id="kobo.598.1">apply_convolution</span></span><span class="p"><span class="koboSpan" id="kobo.599.1">(</span></span><span class="n"><span class="koboSpan" id="kobo.600.1">x</span></span><span class="p"><span class="koboSpan" id="kobo.601.1">,</span></span><span class="n"><span class="koboSpan" id="kobo.602.1">kernel_height</span></span><span class="p"><span class="koboSpan" id="kobo.603.1">,</span></span><span class="n"><span class="koboSpan" id="kobo.604.1">kernel_width</span></span><span class="p"><span class="koboSpan" id="kobo.605.1">,</span></span><span class="n"><span class="koboSpan" id="kobo.606.1">num_channels</span></span><span class="p"><span class="koboSpan" id="kobo.607.1">,</span></span><span class="n"><span class="koboSpan" id="kobo.608.1">depth</span></span><span class="p"><span class="koboSpan" id="kobo.609.1">,</span></span><span class="n"><span class="koboSpan" id="kobo.610.1">layer_name</span></span><span class="p"><span class="koboSpan" id="kobo.611.1">):</span></span>
    <span class="n"><span class="koboSpan" id="kobo.612.1">weights</span></span> <span class="o"><span class="koboSpan" id="kobo.613.1">=</span></span> <span class="n"><span class="koboSpan" id="kobo.614.1">weight_variable</span></span><span class="p"><span class="koboSpan" id="kobo.615.1">(</span></span><span class="n"><span class="koboSpan" id="kobo.616.1">layer_name</span></span><span class="p"><span class="koboSpan" id="kobo.617.1">,[</span></span><span class="n"><span class="koboSpan" id="kobo.618.1">kernel_height</span></span><span class="p"><span class="koboSpan" id="kobo.619.1">,</span></span> <span class="n"><span class="koboSpan" id="kobo.620.1">kernel_width</span></span><span class="p"><span class="koboSpan" id="kobo.621.1">,</span></span> <span class="n"><span class="koboSpan" id="kobo.622.1">num_channels</span></span><span class="p"><span class="koboSpan" id="kobo.623.1">,</span></span> <span class="n"><span class="koboSpan" id="kobo.624.1">depth</span></span><span class="p"><span class="koboSpan" id="kobo.625.1">])</span></span>
    <span class="n"><span class="koboSpan" id="kobo.626.1">biases</span></span> <span class="o"><span class="koboSpan" id="kobo.627.1">=</span></span> <span class="n"><span class="koboSpan" id="kobo.628.1">bias_variable</span></span><span class="p"><span class="koboSpan" id="kobo.629.1">(</span></span><span class="n"><span class="koboSpan" id="kobo.630.1">layer_name</span></span><span class="p"><span class="koboSpan" id="kobo.631.1">,[</span></span><span class="n"><span class="koboSpan" id="kobo.632.1">depth</span></span><span class="p"><span class="koboSpan" id="kobo.633.1">])</span></span>
    <span class="k"><span class="koboSpan" id="kobo.634.1">return</span></span> <span class="n"><span class="koboSpan" id="kobo.635.1">tf</span></span><span class="o"><span class="koboSpan" id="kobo.636.1">.</span></span><span class="n"><span class="koboSpan" id="kobo.637.1">nn</span></span><span class="o"><span class="koboSpan" id="kobo.638.1">.</span></span><span class="n"><span class="koboSpan" id="kobo.639.1">relu</span></span><span class="p"><span class="koboSpan" id="kobo.640.1">(</span></span><span class="n"><span class="koboSpan" id="kobo.641.1">tf</span></span><span class="o"><span class="koboSpan" id="kobo.642.1">.</span></span><span class="n"><span class="koboSpan" id="kobo.643.1">add</span></span><span class="p"><span class="koboSpan" id="kobo.644.1">(</span></span><span class="n"><span class="koboSpan" id="kobo.645.1">tf</span></span><span class="o"><span class="koboSpan" id="kobo.646.1">.</span></span><span class="n"><span class="koboSpan" id="kobo.647.1">nn</span></span><span class="o"><span class="koboSpan" id="kobo.648.1">.</span></span><span class="n"><span class="koboSpan" id="kobo.649.1">conv2d</span></span><span class="p"><span class="koboSpan" id="kobo.650.1">(</span></span><span class="n"><span class="koboSpan" id="kobo.651.1">x</span></span><span class="p"><span class="koboSpan" id="kobo.652.1">,</span></span> <span class="n"><span class="koboSpan" id="kobo.653.1">weights</span></span><span class="p"><span class="koboSpan" id="kobo.654.1">,[</span></span><span class="mi"><span class="koboSpan" id="kobo.655.1">1</span></span><span class="p"><span class="koboSpan" id="kobo.656.1">,</span></span><span class="mi"><span class="koboSpan" id="kobo.657.1">2</span></span><span class="p"><span class="koboSpan" id="kobo.658.1">,</span></span><span class="mi"><span class="koboSpan" id="kobo.659.1">2</span></span><span class="p"><span class="koboSpan" id="kobo.660.1">,</span></span><span class="mi"><span class="koboSpan" id="kobo.661.1">1</span></span><span class="p"><span class="koboSpan" id="kobo.662.1">],</span></span><span class="n"><span class="koboSpan" id="kobo.663.1">padding</span></span> <span class="o"><span class="koboSpan" id="kobo.664.1">=</span></span> <span class="s2"><span class="koboSpan" id="kobo.665.1">"SAME"</span></span><span class="p"><span class="koboSpan" id="kobo.666.1">),</span></span><span class="n"><span class="koboSpan" id="kobo.667.1">biases</span></span><span class="p"><span class="koboSpan" id="kobo.668.1">))</span></span> 

<span class="k"><span class="koboSpan" id="kobo.669.1">def</span></span> <span class="nf"><span class="koboSpan" id="kobo.670.1">apply_pool</span></span><span class="p"><span class="koboSpan" id="kobo.671.1">(</span></span><span class="n"><span class="koboSpan" id="kobo.672.1">x</span></span><span class="p"><span class="koboSpan" id="kobo.673.1">,</span></span><span class="n"><span class="koboSpan" id="kobo.674.1">kernel_height</span></span><span class="p"><span class="koboSpan" id="kobo.675.1">,</span></span><span class="n"><span class="koboSpan" id="kobo.676.1">kernel_width</span></span><span class="p"><span class="koboSpan" id="kobo.677.1">,</span></span><span class="n"><span class="koboSpan" id="kobo.678.1">stride_size</span></span><span class="p"><span class="koboSpan" id="kobo.679.1">):</span></span>
    <span class="k"><span class="koboSpan" id="kobo.680.1">return</span></span> <span class="n"><span class="koboSpan" id="kobo.681.1">tf</span></span><span class="o"><span class="koboSpan" id="kobo.682.1">.</span></span><span class="n"><span class="koboSpan" id="kobo.683.1">nn</span></span><span class="o"><span class="koboSpan" id="kobo.684.1">.</span></span><span class="n"><span class="koboSpan" id="kobo.685.1">max_pool</span></span><span class="p"><span class="koboSpan" id="kobo.686.1">(</span></span><span class="n"><span class="koboSpan" id="kobo.687.1">x</span></span><span class="p"><span class="koboSpan" id="kobo.688.1">,</span></span> <span class="n"><span class="koboSpan" id="kobo.689.1">ksize</span></span><span class="o"><span class="koboSpan" id="kobo.690.1">=</span></span><span class="p"><span class="koboSpan" id="kobo.691.1">[</span></span><span class="mi"><span class="koboSpan" id="kobo.692.1">1</span></span><span class="p"><span class="koboSpan" id="kobo.693.1">,</span></span> <span class="n"><span class="koboSpan" id="kobo.694.1">kernel_height</span></span><span class="p"><span class="koboSpan" id="kobo.695.1">,</span></span> <span class="n"><span class="koboSpan" id="kobo.696.1">kernel_width</span></span><span class="p"><span class="koboSpan" id="kobo.697.1">,</span></span> <span class="mi"><span class="koboSpan" id="kobo.698.1">1</span></span><span class="p"><span class="koboSpan" id="kobo.699.1">],</span></span> 
            <span class="n"><span class="koboSpan" id="kobo.700.1">strides</span></span><span class="o"><span class="koboSpan" id="kobo.701.1">=</span></span><span class="p"><span class="koboSpan" id="kobo.702.1">[</span></span><span class="mi"><span class="koboSpan" id="kobo.703.1">1</span></span><span class="p"><span class="koboSpan" id="kobo.704.1">,</span></span> <span class="mi"><span class="koboSpan" id="kobo.705.1">1</span></span><span class="p"><span class="koboSpan" id="kobo.706.1">,</span></span> <span class="n"><span class="koboSpan" id="kobo.707.1">stride_size</span></span><span class="p"><span class="koboSpan" id="kobo.708.1">,</span></span> <span class="mi"><span class="koboSpan" id="kobo.709.1">1</span></span><span class="p"><span class="koboSpan" id="kobo.710.1">],</span></span> <span class="n"><span class="koboSpan" id="kobo.711.1">padding</span></span> <span class="o"><span class="koboSpan" id="kobo.712.1">=</span></span> <span class="s2"><span class="koboSpan" id="kobo.713.1">"SAME"</span></span><span class="p"><span class="koboSpan" id="kobo.714.1">)</span></span></pre>
<ol start="5">
<li><span class="koboSpan" id="kobo.715.1">Now, we can build the network based on the encoded bit string. </span><span class="koboSpan" id="kobo.715.2">So, we generate the DAG using </span><span><span class="koboSpan" id="kobo.716.1">the </span></span><kbd><span class="koboSpan" id="kobo.717.1">generate_dag</span></kbd><span><span class="koboSpan" id="kobo.718.1"> </span></span><span class="koboSpan" id="kobo.719.1">function:</span></li>
</ol>
<pre style="padding-left: 60px"><span class="k"><span class="koboSpan" id="kobo.720.1">def</span></span> <span class="nf"><span class="koboSpan" id="kobo.721.1">generate_dag</span></span><span class="p"><span class="koboSpan" id="kobo.722.1">(</span></span><span class="n"><span class="koboSpan" id="kobo.723.1">optimal_indvidual</span></span><span class="p"><span class="koboSpan" id="kobo.724.1">,</span></span><span class="n"><span class="koboSpan" id="kobo.725.1">stage_name</span></span><span class="p"><span class="koboSpan" id="kobo.726.1">,</span></span><span class="n"><span class="koboSpan" id="kobo.727.1">num_nodes</span></span><span class="p"><span class="koboSpan" id="kobo.728.1">):</span></span>
    <span class="c1"><span class="koboSpan" id="kobo.729.1"># create nodes for the graph</span></span>
    <span class="n"><span class="koboSpan" id="kobo.730.1">nodes</span></span> <span class="o"><span class="koboSpan" id="kobo.731.1">=</span></span> <span class="n"><span class="koboSpan" id="kobo.732.1">np</span></span><span class="o"><span class="koboSpan" id="kobo.733.1">.</span></span><span class="n"><span class="koboSpan" id="kobo.734.1">empty</span></span><span class="p"><span class="koboSpan" id="kobo.735.1">((</span></span><span class="mi"><span class="koboSpan" id="kobo.736.1">0</span></span><span class="p"><span class="koboSpan" id="kobo.737.1">),</span></span> <span class="n"><span class="koboSpan" id="kobo.738.1">dtype</span></span> <span class="o"><span class="koboSpan" id="kobo.739.1">=</span></span> <span class="n"><span class="koboSpan" id="kobo.740.1">np</span></span><span class="o"><span class="koboSpan" id="kobo.741.1">.</span></span><span class="n"><span class="koboSpan" id="kobo.742.1">str</span></span><span class="p"><span class="koboSpan" id="kobo.743.1">)</span></span>
    <span class="k"><span class="koboSpan" id="kobo.744.1">for</span></span> <span class="n"><span class="koboSpan" id="kobo.745.1">n</span></span> <span class="ow"><span class="koboSpan" id="kobo.746.1">in</span></span> <span class="nb"><span class="koboSpan" id="kobo.747.1">range</span></span><span class="p"><span class="koboSpan" id="kobo.748.1">(</span></span><span class="mi"><span class="koboSpan" id="kobo.749.1">1</span></span><span class="p"><span class="koboSpan" id="kobo.750.1">,(</span></span><span class="n"><span class="koboSpan" id="kobo.751.1">num_nodes</span></span> <span class="o"><span class="koboSpan" id="kobo.752.1">+</span></span> <span class="mi"><span class="koboSpan" id="kobo.753.1">1</span></span><span class="p"><span class="koboSpan" id="kobo.754.1">)):</span></span>
        <span class="n"><span class="koboSpan" id="kobo.755.1">nodes</span></span> <span class="o"><span class="koboSpan" id="kobo.756.1">=</span></span> <span class="n"><span class="koboSpan" id="kobo.757.1">np</span></span><span class="o"><span class="koboSpan" id="kobo.758.1">.</span></span><span class="n"><span class="koboSpan" id="kobo.759.1">append</span></span><span class="p"><span class="koboSpan" id="kobo.760.1">(</span></span><span class="n"><span class="koboSpan" id="kobo.761.1">nodes</span></span><span class="p"><span class="koboSpan" id="kobo.762.1">,</span></span><span class="s1"><span class="koboSpan" id="kobo.763.1">''</span></span><span class="o"><span class="koboSpan" id="kobo.764.1">.</span></span><span class="n"><span class="koboSpan" id="kobo.765.1">join</span></span><span class="p"><span class="koboSpan" id="kobo.766.1">([</span></span><span class="n"><span class="koboSpan" id="kobo.767.1">stage_name</span></span><span class="p"><span class="koboSpan" id="kobo.768.1">,</span></span><span class="s2"><span class="koboSpan" id="kobo.769.1">"_"</span></span><span class="p"><span class="koboSpan" id="kobo.770.1">,</span></span><span class="nb"><span class="koboSpan" id="kobo.771.1">str</span></span><span class="p"><span class="koboSpan" id="kobo.772.1">(</span></span><span class="n"><span class="koboSpan" id="kobo.773.1">n</span></span><span class="p"><span class="koboSpan" id="kobo.774.1">)]))</span></span>
    
    <span class="c1"><span class="koboSpan" id="kobo.775.1"># initialize directed asyclic graph (DAG) and add nodes to it</span></span>
    <span class="n"><span class="koboSpan" id="kobo.776.1">dag</span></span> <span class="o"><span class="koboSpan" id="kobo.777.1">=</span></span> <span class="n"><span class="koboSpan" id="kobo.778.1">DAG</span></span><span class="p"><span class="koboSpan" id="kobo.779.1">()</span></span>
    <span class="k"><span class="koboSpan" id="kobo.780.1">for</span></span> <span class="n"><span class="koboSpan" id="kobo.781.1">n</span></span> <span class="ow"><span class="koboSpan" id="kobo.782.1">in</span></span> <span class="n"><span class="koboSpan" id="kobo.783.1">nodes</span></span><span class="p"><span class="koboSpan" id="kobo.784.1">:</span></span>
        <span class="n"><span class="koboSpan" id="kobo.785.1">dag</span></span><span class="o"><span class="koboSpan" id="kobo.786.1">.</span></span><span class="n"><span class="koboSpan" id="kobo.787.1">add_node</span></span><span class="p"><span class="koboSpan" id="kobo.788.1">(</span></span><span class="n"><span class="koboSpan" id="kobo.789.1">n</span></span><span class="p"><span class="koboSpan" id="kobo.790.1">)</span></span>

    <span class="c1"><span class="koboSpan" id="kobo.791.1"># split best indvidual found via genetic algorithm to identify vertices connections and connect them in DAG </span></span>
    <span class="n"><span class="koboSpan" id="kobo.792.1">edges</span></span> <span class="o"><span class="koboSpan" id="kobo.793.1">=</span></span> <span class="n"><span class="koboSpan" id="kobo.794.1">np</span></span><span class="o"><span class="koboSpan" id="kobo.795.1">.</span></span><span class="n"><span class="koboSpan" id="kobo.796.1">split</span></span><span class="p"><span class="koboSpan" id="kobo.797.1">(</span></span><span class="n"><span class="koboSpan" id="kobo.798.1">optimal_indvidual</span></span><span class="p"><span class="koboSpan" id="kobo.799.1">,</span></span><span class="n"><span class="koboSpan" id="kobo.800.1">np</span></span><span class="o"><span class="koboSpan" id="kobo.801.1">.</span></span><span class="n"><span class="koboSpan" id="kobo.802.1">cumsum</span></span><span class="p"><span class="koboSpan" id="kobo.803.1">(</span></span><span class="nb"><span class="koboSpan" id="kobo.804.1">range</span></span><span class="p"><span class="koboSpan" id="kobo.805.1">(</span></span><span class="n"><span class="koboSpan" id="kobo.806.1">num_nodes</span></span> <span class="o"><span class="koboSpan" id="kobo.807.1">-</span></span> <span class="mi"><span class="koboSpan" id="kobo.808.1">1</span></span><span class="p"><span class="koboSpan" id="kobo.809.1">)))[</span></span><span class="mi"><span class="koboSpan" id="kobo.810.1">1</span></span><span class="p"><span class="koboSpan" id="kobo.811.1">:]</span></span>
    <span class="n"><span class="koboSpan" id="kobo.812.1">v2</span></span> <span class="o"><span class="koboSpan" id="kobo.813.1">=</span></span> <span class="mi"><span class="koboSpan" id="kobo.814.1">2</span></span>
    <span class="k"><span class="koboSpan" id="kobo.815.1">for</span></span> <span class="n"><span class="koboSpan" id="kobo.816.1">e</span></span> <span class="ow"><span class="koboSpan" id="kobo.817.1">in</span></span> <span class="n"><span class="koboSpan" id="kobo.818.1">edges</span></span><span class="p"><span class="koboSpan" id="kobo.819.1">:</span></span>
        <span class="n"><span class="koboSpan" id="kobo.820.1">v1</span></span> <span class="o"><span class="koboSpan" id="kobo.821.1">=</span></span> <span class="mi"><span class="koboSpan" id="kobo.822.1">1</span></span>
        <span class="k"><span class="koboSpan" id="kobo.823.1">for</span></span> <span class="n"><span class="koboSpan" id="kobo.824.1">i</span></span> <span class="ow"><span class="koboSpan" id="kobo.825.1">in</span></span> <span class="n"><span class="koboSpan" id="kobo.826.1">e</span></span><span class="p"><span class="koboSpan" id="kobo.827.1">:</span></span>
            <span class="k"><span class="koboSpan" id="kobo.828.1">if</span></span> <span class="n"><span class="koboSpan" id="kobo.829.1">i</span></span><span class="p"><span class="koboSpan" id="kobo.830.1">:</span></span>
                <span class="n"><span class="koboSpan" id="kobo.831.1">dag</span></span><span class="o"><span class="koboSpan" id="kobo.832.1">.</span></span><span class="n"><span class="koboSpan" id="kobo.833.1">add_edge</span></span><span class="p"><span class="koboSpan" id="kobo.834.1">(</span></span><span class="s1"><span class="koboSpan" id="kobo.835.1">''</span></span><span class="o"><span class="koboSpan" id="kobo.836.1">.</span></span><span class="n"><span class="koboSpan" id="kobo.837.1">join</span></span><span class="p"><span class="koboSpan" id="kobo.838.1">([</span></span><span class="n"><span class="koboSpan" id="kobo.839.1">stage_name</span></span><span class="p"><span class="koboSpan" id="kobo.840.1">,</span></span><span class="s2"><span class="koboSpan" id="kobo.841.1">"_"</span></span><span class="p"><span class="koboSpan" id="kobo.842.1">,</span></span><span class="nb"><span class="koboSpan" id="kobo.843.1">str</span></span><span class="p"><span class="koboSpan" id="kobo.844.1">(</span></span><span class="n"><span class="koboSpan" id="kobo.845.1">v1</span></span><span class="p"><span class="koboSpan" id="kobo.846.1">)]),</span></span><span class="s1"><span class="koboSpan" id="kobo.847.1">''</span></span><span class="o"><span class="koboSpan" id="kobo.848.1">.</span></span><span class="n"><span class="koboSpan" id="kobo.849.1">join</span></span><span class="p"><span class="koboSpan" id="kobo.850.1">([</span></span><span class="n"><span class="koboSpan" id="kobo.851.1">stage_name</span></span><span class="p"><span class="koboSpan" id="kobo.852.1">,</span></span><span class="s2"><span class="koboSpan" id="kobo.853.1">"_"</span></span><span class="p"><span class="koboSpan" id="kobo.854.1">,</span></span><span class="nb"><span class="koboSpan" id="kobo.855.1">str</span></span><span class="p"><span class="koboSpan" id="kobo.856.1">(</span></span><span class="n"><span class="koboSpan" id="kobo.857.1">v2</span></span><span class="p"><span class="koboSpan" id="kobo.858.1">)]))</span></span> 
            <span class="n"><span class="koboSpan" id="kobo.859.1">v1</span></span> <span class="o"><span class="koboSpan" id="kobo.860.1">+=</span></span> <span class="mi"><span class="koboSpan" id="kobo.861.1">1</span></span>
        <span class="n"><span class="koboSpan" id="kobo.862.1">v2</span></span> <span class="o"><span class="koboSpan" id="kobo.863.1">+=</span></span> <span class="mi"><span class="koboSpan" id="kobo.864.1">1</span></span>

    <span class="c1"><span class="koboSpan" id="kobo.865.1"># delete nodes not connected to anyother node from DAG</span></span>
    <span class="k"><span class="koboSpan" id="kobo.866.1">for</span></span> <span class="n"><span class="koboSpan" id="kobo.867.1">n</span></span> <span class="ow"><span class="koboSpan" id="kobo.868.1">in</span></span> <span class="n"><span class="koboSpan" id="kobo.869.1">nodes</span></span><span class="p"><span class="koboSpan" id="kobo.870.1">:</span></span>
        <span class="k"><span class="koboSpan" id="kobo.871.1">if</span></span> <span class="nb"><span class="koboSpan" id="kobo.872.1">len</span></span><span class="p"><span class="koboSpan" id="kobo.873.1">(</span></span><span class="n"><span class="koboSpan" id="kobo.874.1">dag</span></span><span class="o"><span class="koboSpan" id="kobo.875.1">.</span></span><span class="n"><span class="koboSpan" id="kobo.876.1">predecessors</span></span><span class="p"><span class="koboSpan" id="kobo.877.1">(</span></span><span class="n"><span class="koboSpan" id="kobo.878.1">n</span></span><span class="p"><span class="koboSpan" id="kobo.879.1">))</span></span> <span class="o"><span class="koboSpan" id="kobo.880.1">==</span></span> <span class="mi"><span class="koboSpan" id="kobo.881.1">0</span></span> <span class="ow"><span class="koboSpan" id="kobo.882.1">and</span></span> <span class="nb"><span class="koboSpan" id="kobo.883.1">len</span></span><span class="p"><span class="koboSpan" id="kobo.884.1">(</span></span><span class="n"><span class="koboSpan" id="kobo.885.1">dag</span></span><span class="o"><span class="koboSpan" id="kobo.886.1">.</span></span><span class="n"><span class="koboSpan" id="kobo.887.1">downstream</span></span><span class="p"><span class="koboSpan" id="kobo.888.1">(</span></span><span class="n"><span class="koboSpan" id="kobo.889.1">n</span></span><span class="p"><span class="koboSpan" id="kobo.890.1">))</span></span> <span class="o"><span class="koboSpan" id="kobo.891.1">==</span></span> <span class="mi"><span class="koboSpan" id="kobo.892.1">0</span></span><span class="p"><span class="koboSpan" id="kobo.893.1">:</span></span>
            <span class="n"><span class="koboSpan" id="kobo.894.1">dag</span></span><span class="o"><span class="koboSpan" id="kobo.895.1">.</span></span><span class="n"><span class="koboSpan" id="kobo.896.1">delete_node</span></span><span class="p"><span class="koboSpan" id="kobo.897.1">(</span></span><span class="n"><span class="koboSpan" id="kobo.898.1">n</span></span><span class="p"><span class="koboSpan" id="kobo.899.1">)</span></span>
            <span class="n"><span class="koboSpan" id="kobo.900.1">nodes</span></span> <span class="o"><span class="koboSpan" id="kobo.901.1">=</span></span> <span class="n"><span class="koboSpan" id="kobo.902.1">np</span></span><span class="o"><span class="koboSpan" id="kobo.903.1">.</span></span><span class="n"><span class="koboSpan" id="kobo.904.1">delete</span></span><span class="p"><span class="koboSpan" id="kobo.905.1">(</span></span><span class="n"><span class="koboSpan" id="kobo.906.1">nodes</span></span><span class="p"><span class="koboSpan" id="kobo.907.1">,</span></span> <span class="n"><span class="koboSpan" id="kobo.908.1">np</span></span><span class="o"><span class="koboSpan" id="kobo.909.1">.</span></span><span class="n"><span class="koboSpan" id="kobo.910.1">where</span></span><span class="p"><span class="koboSpan" id="kobo.911.1">(</span></span><span class="n"><span class="koboSpan" id="kobo.912.1">nodes</span></span> <span class="o"><span class="koboSpan" id="kobo.913.1">==</span></span> <span class="n"><span class="koboSpan" id="kobo.914.1">n</span></span><span class="p"><span class="koboSpan" id="kobo.915.1">)[</span></span><span class="mi"><span class="koboSpan" id="kobo.916.1">0</span></span><span class="p"><span class="koboSpan" id="kobo.917.1">][</span></span><span class="mi"><span class="koboSpan" id="kobo.918.1">0</span></span><span class="p"><span class="koboSpan" id="kobo.919.1">])</span></span>
    
    <span class="k"><span class="koboSpan" id="kobo.920.1">return</span></span> <span class="n"><span class="koboSpan" id="kobo.921.1">dag</span></span><span class="p"><span class="koboSpan" id="kobo.922.1">,</span></span> <span class="n"><span class="koboSpan" id="kobo.923.1">nodes</span></span></pre>
<ol start="6">
<li><span class="koboSpan" id="kobo.924.1">The graph generated is used to build the TensorFlow graph using </span><span><span class="koboSpan" id="kobo.925.1">the</span></span><span class="koboSpan" id="kobo.926.1"> </span><kbd><span class="koboSpan" id="kobo.927.1">generate_tensorflow_graph</span></kbd><span class="koboSpan" id="kobo.928.1"> function. </span><span class="koboSpan" id="kobo.928.2">This function makes use of</span><span><span class="koboSpan" id="kobo.929.1"> </span></span><span><span class="koboSpan" id="kobo.930.1">the </span></span><kbd><span class="koboSpan" id="kobo.931.1">add_node</span></kbd><span><span class="koboSpan" id="kobo.932.1"> </span></span><span class="koboSpan" id="kobo.933.1">function to add a convolution layer, and</span><span><span class="koboSpan" id="kobo.934.1"> </span></span><span><span class="koboSpan" id="kobo.935.1">the </span></span><kbd><span class="koboSpan" id="kobo.936.1">sum_tensors</span></kbd><span><span class="koboSpan" id="kobo.937.1"> </span></span><span class="koboSpan" id="kobo.938.1">function to combine the input of more than one convolution layer:</span></li>
</ol>
<pre style="padding-left: 60px"><span class="k"><span class="koboSpan" id="kobo.939.1">def</span></span> <span class="nf"><span class="koboSpan" id="kobo.940.1">generate_tensorflow_graph</span></span><span class="p"><span class="koboSpan" id="kobo.941.1">(</span></span><span class="n"><span class="koboSpan" id="kobo.942.1">individual</span></span><span class="p"><span class="koboSpan" id="kobo.943.1">,</span></span><span class="n"><span class="koboSpan" id="kobo.944.1">stages</span></span><span class="p"><span class="koboSpan" id="kobo.945.1">,</span></span><span class="n"><span class="koboSpan" id="kobo.946.1">num_nodes</span></span><span class="p"><span class="koboSpan" id="kobo.947.1">,</span></span><span class="n"><span class="koboSpan" id="kobo.948.1">bits_indices</span></span><span class="p"><span class="koboSpan" id="kobo.949.1">):</span></span>
    <span class="n"><span class="koboSpan" id="kobo.950.1">activation_function_pattern</span></span> <span class="o"><span class="koboSpan" id="kobo.951.1">=</span></span> <span class="s2"><span class="koboSpan" id="kobo.952.1">"/Relu:0"</span></span>
    
    <span class="n"><span class="koboSpan" id="kobo.953.1">tf</span></span><span class="o"><span class="koboSpan" id="kobo.954.1">.</span></span><span class="n"><span class="koboSpan" id="kobo.955.1">reset_default_graph</span></span><span class="p"><span class="koboSpan" id="kobo.956.1">()</span></span>
    <span class="n"><span class="koboSpan" id="kobo.957.1">X</span></span> <span class="o"><span class="koboSpan" id="kobo.958.1">=</span></span> <span class="n"><span class="koboSpan" id="kobo.959.1">tf</span></span><span class="o"><span class="koboSpan" id="kobo.960.1">.</span></span><span class="n"><span class="koboSpan" id="kobo.961.1">placeholder</span></span><span class="p"><span class="koboSpan" id="kobo.962.1">(</span></span><span class="n"><span class="koboSpan" id="kobo.963.1">tf</span></span><span class="o"><span class="koboSpan" id="kobo.964.1">.</span></span><span class="n"><span class="koboSpan" id="kobo.965.1">float32</span></span><span class="p"><span class="koboSpan" id="kobo.966.1">,</span></span> <span class="n"><span class="koboSpan" id="kobo.967.1">shape</span></span> <span class="o"><span class="koboSpan" id="kobo.968.1">=</span></span> <span class="p"><span class="koboSpan" id="kobo.969.1">[</span></span><span class="kc"><span class="koboSpan" id="kobo.970.1">None</span></span><span class="p"><span class="koboSpan" id="kobo.971.1">,</span></span><span class="mi"><span class="koboSpan" id="kobo.972.1">28</span></span><span class="p"><span class="koboSpan" id="kobo.973.1">,</span></span><span class="mi"><span class="koboSpan" id="kobo.974.1">28</span></span><span class="p"><span class="koboSpan" id="kobo.975.1">,</span></span><span class="mi"><span class="koboSpan" id="kobo.976.1">1</span></span><span class="p"><span class="koboSpan" id="kobo.977.1">],</span></span> <span class="n"><span class="koboSpan" id="kobo.978.1">name</span></span> <span class="o"><span class="koboSpan" id="kobo.979.1">=</span></span> <span class="s2"><span class="koboSpan" id="kobo.980.1">"X"</span></span><span class="p"><span class="koboSpan" id="kobo.981.1">)</span></span>
    <span class="n"><span class="koboSpan" id="kobo.982.1">Y</span></span> <span class="o"><span class="koboSpan" id="kobo.983.1">=</span></span> <span class="n"><span class="koboSpan" id="kobo.984.1">tf</span></span><span class="o"><span class="koboSpan" id="kobo.985.1">.</span></span><span class="n"><span class="koboSpan" id="kobo.986.1">placeholder</span></span><span class="p"><span class="koboSpan" id="kobo.987.1">(</span></span><span class="n"><span class="koboSpan" id="kobo.988.1">tf</span></span><span class="o"><span class="koboSpan" id="kobo.989.1">.</span></span><span class="n"><span class="koboSpan" id="kobo.990.1">float32</span></span><span class="p"><span class="koboSpan" id="kobo.991.1">,[</span></span><span class="kc"><span class="koboSpan" id="kobo.992.1">None</span></span><span class="p"><span class="koboSpan" id="kobo.993.1">,</span></span><span class="mi"><span class="koboSpan" id="kobo.994.1">10</span></span><span class="p"><span class="koboSpan" id="kobo.995.1">],</span></span><span class="n"><span class="koboSpan" id="kobo.996.1">name</span></span> <span class="o"><span class="koboSpan" id="kobo.997.1">=</span></span> <span class="s2"><span class="koboSpan" id="kobo.998.1">"Y"</span></span><span class="p"><span class="koboSpan" id="kobo.999.1">)</span></span>
        
    <span class="n"><span class="koboSpan" id="kobo.1000.1">d_node</span></span> <span class="o"><span class="koboSpan" id="kobo.1001.1">=</span></span> <span class="n"><span class="koboSpan" id="kobo.1002.1">X</span></span>
    <span class="k"><span class="koboSpan" id="kobo.1003.1">for</span></span> <span class="n"><span class="koboSpan" id="kobo.1004.1">stage_name</span></span><span class="p"><span class="koboSpan" id="kobo.1005.1">,</span></span><span class="n"><span class="koboSpan" id="kobo.1006.1">num_node</span></span><span class="p"><span class="koboSpan" id="kobo.1007.1">,</span></span><span class="n"><span class="koboSpan" id="kobo.1008.1">bpi</span></span> <span class="ow"><span class="koboSpan" id="kobo.1009.1">in</span></span> <span class="nb"><span class="koboSpan" id="kobo.1010.1">zip</span></span><span class="p"><span class="koboSpan" id="kobo.1011.1">(</span></span><span class="n"><span class="koboSpan" id="kobo.1012.1">stages</span></span><span class="p"><span class="koboSpan" id="kobo.1013.1">,</span></span><span class="n"><span class="koboSpan" id="kobo.1014.1">num_nodes</span></span><span class="p"><span class="koboSpan" id="kobo.1015.1">,</span></span><span class="n"><span class="koboSpan" id="kobo.1016.1">bits_indices</span></span><span class="p"><span class="koboSpan" id="kobo.1017.1">):</span></span>
        <span class="n"><span class="koboSpan" id="kobo.1018.1">indv</span></span> <span class="o"><span class="koboSpan" id="kobo.1019.1">=</span></span> <span class="n"><span class="koboSpan" id="kobo.1020.1">individual</span></span><span class="p"><span class="koboSpan" id="kobo.1021.1">[</span></span><span class="n"><span class="koboSpan" id="kobo.1022.1">bpi</span></span><span class="p"><span class="koboSpan" id="kobo.1023.1">[</span></span><span class="mi"><span class="koboSpan" id="kobo.1024.1">0</span></span><span class="p"><span class="koboSpan" id="kobo.1025.1">]:</span></span><span class="n"><span class="koboSpan" id="kobo.1026.1">bpi</span></span><span class="p"><span class="koboSpan" id="kobo.1027.1">[</span></span><span class="mi"><span class="koboSpan" id="kobo.1028.1">1</span></span><span class="p"><span class="koboSpan" id="kobo.1029.1">]]</span></span>

        <span class="n"><span class="koboSpan" id="kobo.1030.1">add_node</span></span><span class="p"><span class="koboSpan" id="kobo.1031.1">(</span></span><span class="s1"><span class="koboSpan" id="kobo.1032.1">''</span></span><span class="o"><span class="koboSpan" id="kobo.1033.1">.</span></span><span class="n"><span class="koboSpan" id="kobo.1034.1">join</span></span><span class="p"><span class="koboSpan" id="kobo.1035.1">([</span></span><span class="n"><span class="koboSpan" id="kobo.1036.1">stage_name</span></span><span class="p"><span class="koboSpan" id="kobo.1037.1">,</span></span><span class="s2"><span class="koboSpan" id="kobo.1038.1">"_input"</span></span><span class="p"><span class="koboSpan" id="kobo.1039.1">]),</span></span><span class="n"><span class="koboSpan" id="kobo.1040.1">d_node</span></span><span class="o"><span class="koboSpan" id="kobo.1041.1">.</span></span><span class="n"><span class="koboSpan" id="kobo.1042.1">name</span></span><span class="p"><span class="koboSpan" id="kobo.1043.1">)</span></span>
        <span class="n"><span class="koboSpan" id="kobo.1044.1">pooling_layer_name</span></span> <span class="o"><span class="koboSpan" id="kobo.1045.1">=</span></span> <span class="s1"><span class="koboSpan" id="kobo.1046.1">''</span></span><span class="o"><span class="koboSpan" id="kobo.1047.1">.</span></span><span class="n"><span class="koboSpan" id="kobo.1048.1">join</span></span><span class="p"><span class="koboSpan" id="kobo.1049.1">([</span></span><span class="n"><span class="koboSpan" id="kobo.1050.1">stage_name</span></span><span class="p"><span class="koboSpan" id="kobo.1051.1">,</span></span><span class="s2"><span class="koboSpan" id="kobo.1052.1">"_input"</span></span><span class="p"><span class="koboSpan" id="kobo.1053.1">,</span></span><span class="n"><span class="koboSpan" id="kobo.1054.1">activation_function_pattern</span></span><span class="p"><span class="koboSpan" id="kobo.1055.1">])</span></span>

        <span class="k"><span class="koboSpan" id="kobo.1056.1">if</span></span> <span class="ow"><span class="koboSpan" id="kobo.1057.1">not</span></span> <span class="n"><span class="koboSpan" id="kobo.1058.1">has_same_elements</span></span><span class="p"><span class="koboSpan" id="kobo.1059.1">(</span></span><span class="n"><span class="koboSpan" id="kobo.1060.1">indv</span></span><span class="p"><span class="koboSpan" id="kobo.1061.1">):</span></span>
            <span class="c1"><span class="koboSpan" id="kobo.1062.1"># ------------------- Temporary DAG to hold all connections implied by genetic algorithm solution ------------- #  </span></span>

            <span class="c1"><span class="koboSpan" id="kobo.1063.1"># get DAG and nodes in the graph</span></span>
            <span class="n"><span class="koboSpan" id="kobo.1064.1">dag</span></span><span class="p"><span class="koboSpan" id="kobo.1065.1">,</span></span> <span class="n"><span class="koboSpan" id="kobo.1066.1">nodes</span></span> <span class="o"><span class="koboSpan" id="kobo.1067.1">=</span></span> <span class="n"><span class="koboSpan" id="kobo.1068.1">generate_dag</span></span><span class="p"><span class="koboSpan" id="kobo.1069.1">(</span></span><span class="n"><span class="koboSpan" id="kobo.1070.1">indv</span></span><span class="p"><span class="koboSpan" id="kobo.1071.1">,</span></span><span class="n"><span class="koboSpan" id="kobo.1072.1">stage_name</span></span><span class="p"><span class="koboSpan" id="kobo.1073.1">,</span></span><span class="n"><span class="koboSpan" id="kobo.1074.1">num_node</span></span><span class="p"><span class="koboSpan" id="kobo.1075.1">)</span></span> 
            <span class="c1"><span class="koboSpan" id="kobo.1076.1"># get nodes without any predecessor, these will be connected to input node</span></span>
            <span class="n"><span class="koboSpan" id="kobo.1077.1">without_predecessors</span></span> <span class="o"><span class="koboSpan" id="kobo.1078.1">=</span></span> <span class="n"><span class="koboSpan" id="kobo.1079.1">dag</span></span><span class="o"><span class="koboSpan" id="kobo.1080.1">.</span></span><span class="n"><span class="koboSpan" id="kobo.1081.1">ind_nodes</span></span><span class="p"><span class="koboSpan" id="kobo.1082.1">()</span></span> 
            <span class="c1"><span class="koboSpan" id="kobo.1083.1"># get nodes without any successor, these will be connected to output node</span></span>
            <span class="n"><span class="koboSpan" id="kobo.1084.1">without_successors</span></span> <span class="o"><span class="koboSpan" id="kobo.1085.1">=</span></span> <span class="n"><span class="koboSpan" id="kobo.1086.1">dag</span></span><span class="o"><span class="koboSpan" id="kobo.1087.1">.</span></span><span class="n"><span class="koboSpan" id="kobo.1088.1">all_leaves</span></span><span class="p"><span class="koboSpan" id="kobo.1089.1">()</span></span>

            <span class="c1"><span class="koboSpan" id="kobo.1090.1"># ----------------------------------------------------------------------------------------------- #</span></span>

            <span class="c1"><span class="koboSpan" id="kobo.1091.1"># --------------------------- Initialize tensforflow graph based on DAG ------------------------- #</span></span>

            <span class="k"><span class="koboSpan" id="kobo.1092.1">for</span></span> <span class="n"><span class="koboSpan" id="kobo.1093.1">wop</span></span> <span class="ow"><span class="koboSpan" id="kobo.1094.1">in</span></span> <span class="n"><span class="koboSpan" id="kobo.1095.1">without_predecessors</span></span><span class="p"><span class="koboSpan" id="kobo.1096.1">:</span></span>
                <span class="n"><span class="koboSpan" id="kobo.1097.1">add_node</span></span><span class="p"><span class="koboSpan" id="kobo.1098.1">(</span></span><span class="n"><span class="koboSpan" id="kobo.1099.1">wop</span></span><span class="p"><span class="koboSpan" id="kobo.1100.1">,</span></span><span class="s1"><span class="koboSpan" id="kobo.1101.1">''</span></span><span class="o"><span class="koboSpan" id="kobo.1102.1">.</span></span><span class="n"><span class="koboSpan" id="kobo.1103.1">join</span></span><span class="p"><span class="koboSpan" id="kobo.1104.1">([</span></span><span class="n"><span class="koboSpan" id="kobo.1105.1">stage_name</span></span><span class="p"><span class="koboSpan" id="kobo.1106.1">,</span></span><span class="s2"><span class="koboSpan" id="kobo.1107.1">"_input"</span></span><span class="p"><span class="koboSpan" id="kobo.1108.1">,</span></span><span class="n"><span class="koboSpan" id="kobo.1109.1">activation_function_pattern</span></span><span class="p"><span class="koboSpan" id="kobo.1110.1">]))</span></span>

            <span class="k"><span class="koboSpan" id="kobo.1111.1">for</span></span> <span class="n"><span class="koboSpan" id="kobo.1112.1">n</span></span> <span class="ow"><span class="koboSpan" id="kobo.1113.1">in</span></span> <span class="n"><span class="koboSpan" id="kobo.1114.1">nodes</span></span><span class="p"><span class="koboSpan" id="kobo.1115.1">:</span></span>
                <span class="n"><span class="koboSpan" id="kobo.1116.1">predecessors</span></span> <span class="o"><span class="koboSpan" id="kobo.1117.1">=</span></span> <span class="n"><span class="koboSpan" id="kobo.1118.1">dag</span></span><span class="o"><span class="koboSpan" id="kobo.1119.1">.</span></span><span class="n"><span class="koboSpan" id="kobo.1120.1">predecessors</span></span><span class="p"><span class="koboSpan" id="kobo.1121.1">(</span></span><span class="n"><span class="koboSpan" id="kobo.1122.1">n</span></span><span class="p"><span class="koboSpan" id="kobo.1123.1">)</span></span>
                <span class="k"><span class="koboSpan" id="kobo.1124.1">if</span></span> <span class="nb"><span class="koboSpan" id="kobo.1125.1">len</span></span><span class="p"><span class="koboSpan" id="kobo.1126.1">(</span></span><span class="n"><span class="koboSpan" id="kobo.1127.1">predecessors</span></span><span class="p"><span class="koboSpan" id="kobo.1128.1">)</span></span> <span class="o"><span class="koboSpan" id="kobo.1129.1">==</span></span> <span class="mi"><span class="koboSpan" id="kobo.1130.1">0</span></span><span class="p"><span class="koboSpan" id="kobo.1131.1">:</span></span>
                    <span class="k"><span class="koboSpan" id="kobo.1132.1">continue</span></span>
                <span class="k"><span class="koboSpan" id="kobo.1133.1">elif</span></span> <span class="nb"><span class="koboSpan" id="kobo.1134.1">len</span></span><span class="p"><span class="koboSpan" id="kobo.1135.1">(</span></span><span class="n"><span class="koboSpan" id="kobo.1136.1">predecessors</span></span><span class="p"><span class="koboSpan" id="kobo.1137.1">)</span></span> <span class="o"><span class="koboSpan" id="kobo.1138.1">&gt;</span></span> <span class="mi"><span class="koboSpan" id="kobo.1139.1">1</span></span><span class="p"><span class="koboSpan" id="kobo.1140.1">:</span></span>
                    <span class="n"><span class="koboSpan" id="kobo.1141.1">first_predecessor</span></span> <span class="o"><span class="koboSpan" id="kobo.1142.1">=</span></span> <span class="n"><span class="koboSpan" id="kobo.1143.1">predecessors</span></span><span class="p"><span class="koboSpan" id="kobo.1144.1">[</span></span><span class="mi"><span class="koboSpan" id="kobo.1145.1">0</span></span><span class="p"><span class="koboSpan" id="kobo.1146.1">]</span></span>
                    <span class="k"><span class="koboSpan" id="kobo.1147.1">for</span></span> <span class="n"><span class="koboSpan" id="kobo.1148.1">prd</span></span> <span class="ow"><span class="koboSpan" id="kobo.1149.1">in</span></span> <span class="nb"><span class="koboSpan" id="kobo.1150.1">range</span></span><span class="p"><span class="koboSpan" id="kobo.1151.1">(</span></span><span class="mi"><span class="koboSpan" id="kobo.1152.1">1</span></span><span class="p"><span class="koboSpan" id="kobo.1153.1">,</span></span><span class="nb"><span class="koboSpan" id="kobo.1154.1">len</span></span><span class="p"><span class="koboSpan" id="kobo.1155.1">(</span></span><span class="n"><span class="koboSpan" id="kobo.1156.1">predecessors</span></span><span class="p"><span class="koboSpan" id="kobo.1157.1">)):</span></span>
                        <span class="n"><span class="koboSpan" id="kobo.1158.1">t</span></span> <span class="o"><span class="koboSpan" id="kobo.1159.1">=</span></span> <span class="n"><span class="koboSpan" id="kobo.1160.1">sum_tensors</span></span><span class="p"><span class="koboSpan" id="kobo.1161.1">(</span></span><span class="n"><span class="koboSpan" id="kobo.1162.1">first_predecessor</span></span><span class="p"><span class="koboSpan" id="kobo.1163.1">,</span></span><span class="n"><span class="koboSpan" id="kobo.1164.1">predecessors</span></span><span class="p"><span class="koboSpan" id="kobo.1165.1">[</span></span><span class="n"><span class="koboSpan" id="kobo.1166.1">prd</span></span><span class="p"><span class="koboSpan" id="kobo.1167.1">],</span></span><span class="n"><span class="koboSpan" id="kobo.1168.1">activation_function_pattern</span></span><span class="p"><span class="koboSpan" id="kobo.1169.1">)</span></span>
                        <span class="n"><span class="koboSpan" id="kobo.1170.1">first_predecessor</span></span> <span class="o"><span class="koboSpan" id="kobo.1171.1">=</span></span> <span class="n"><span class="koboSpan" id="kobo.1172.1">t</span></span><span class="o"><span class="koboSpan" id="kobo.1173.1">.</span></span><span class="n"><span class="koboSpan" id="kobo.1174.1">name</span></span>
                    <span class="n"><span class="koboSpan" id="kobo.1175.1">add_node</span></span><span class="p"><span class="koboSpan" id="kobo.1176.1">(</span></span><span class="n"><span class="koboSpan" id="kobo.1177.1">n</span></span><span class="p"><span class="koboSpan" id="kobo.1178.1">,</span></span><span class="n"><span class="koboSpan" id="kobo.1179.1">first_predecessor</span></span><span class="p"><span class="koboSpan" id="kobo.1180.1">)</span></span>
                <span class="k"><span class="koboSpan" id="kobo.1181.1">elif</span></span> <span class="n"><span class="koboSpan" id="kobo.1182.1">predecessors</span></span><span class="p"><span class="koboSpan" id="kobo.1183.1">:</span></span>
                    <span class="n"><span class="koboSpan" id="kobo.1184.1">add_node</span></span><span class="p"><span class="koboSpan" id="kobo.1185.1">(</span></span><span class="n"><span class="koboSpan" id="kobo.1186.1">n</span></span><span class="p"><span class="koboSpan" id="kobo.1187.1">,</span></span><span class="s1"><span class="koboSpan" id="kobo.1188.1">''</span></span><span class="o"><span class="koboSpan" id="kobo.1189.1">.</span></span><span class="n"><span class="koboSpan" id="kobo.1190.1">join</span></span><span class="p"><span class="koboSpan" id="kobo.1191.1">([</span></span><span class="n"><span class="koboSpan" id="kobo.1192.1">predecessors</span></span><span class="p"><span class="koboSpan" id="kobo.1193.1">[</span></span><span class="mi"><span class="koboSpan" id="kobo.1194.1">0</span></span><span class="p"><span class="koboSpan" id="kobo.1195.1">],</span></span><span class="n"><span class="koboSpan" id="kobo.1196.1">activation_function_pattern</span></span><span class="p"><span class="koboSpan" id="kobo.1197.1">]))</span></span>

            <span class="k"><span class="koboSpan" id="kobo.1198.1">if</span></span> <span class="nb"><span class="koboSpan" id="kobo.1199.1">len</span></span><span class="p"><span class="koboSpan" id="kobo.1200.1">(</span></span><span class="n"><span class="koboSpan" id="kobo.1201.1">without_successors</span></span><span class="p"><span class="koboSpan" id="kobo.1202.1">)</span></span> <span class="o"><span class="koboSpan" id="kobo.1203.1">&gt;</span></span> <span class="mi"><span class="koboSpan" id="kobo.1204.1">1</span></span><span class="p"><span class="koboSpan" id="kobo.1205.1">:</span></span>
                <span class="n"><span class="koboSpan" id="kobo.1206.1">first_successor</span></span> <span class="o"><span class="koboSpan" id="kobo.1207.1">=</span></span> <span class="n"><span class="koboSpan" id="kobo.1208.1">without_successors</span></span><span class="p"><span class="koboSpan" id="kobo.1209.1">[</span></span><span class="mi"><span class="koboSpan" id="kobo.1210.1">0</span></span><span class="p"><span class="koboSpan" id="kobo.1211.1">]</span></span>
                <span class="k"><span class="koboSpan" id="kobo.1212.1">for</span></span> <span class="n"><span class="koboSpan" id="kobo.1213.1">suc</span></span> <span class="ow"><span class="koboSpan" id="kobo.1214.1">in</span></span> <span class="nb"><span class="koboSpan" id="kobo.1215.1">range</span></span><span class="p"><span class="koboSpan" id="kobo.1216.1">(</span></span><span class="mi"><span class="koboSpan" id="kobo.1217.1">1</span></span><span class="p"><span class="koboSpan" id="kobo.1218.1">,</span></span><span class="nb"><span class="koboSpan" id="kobo.1219.1">len</span></span><span class="p"><span class="koboSpan" id="kobo.1220.1">(</span></span><span class="n"><span class="koboSpan" id="kobo.1221.1">without_successors</span></span><span class="p"><span class="koboSpan" id="kobo.1222.1">)):</span></span>
                    <span class="n"><span class="koboSpan" id="kobo.1223.1">t</span></span> <span class="o"><span class="koboSpan" id="kobo.1224.1">=</span></span> <span class="n"><span class="koboSpan" id="kobo.1225.1">sum_tensors</span></span><span class="p"><span class="koboSpan" id="kobo.1226.1">(</span></span><span class="n"><span class="koboSpan" id="kobo.1227.1">first_successor</span></span><span class="p"><span class="koboSpan" id="kobo.1228.1">,</span></span><span class="n"><span class="koboSpan" id="kobo.1229.1">without_successors</span></span><span class="p"><span class="koboSpan" id="kobo.1230.1">[</span></span><span class="n"><span class="koboSpan" id="kobo.1231.1">suc</span></span><span class="p"><span class="koboSpan" id="kobo.1232.1">],</span></span><span class="n"><span class="koboSpan" id="kobo.1233.1">activation_function_pattern</span></span><span class="p"><span class="koboSpan" id="kobo.1234.1">)</span></span>
                    <span class="n"><span class="koboSpan" id="kobo.1235.1">first_successor</span></span> <span class="o"><span class="koboSpan" id="kobo.1236.1">=</span></span> <span class="n"><span class="koboSpan" id="kobo.1237.1">t</span></span><span class="o"><span class="koboSpan" id="kobo.1238.1">.</span></span><span class="n"><span class="koboSpan" id="kobo.1239.1">name</span></span>
                <span class="n"><span class="koboSpan" id="kobo.1240.1">add_node</span></span><span class="p"><span class="koboSpan" id="kobo.1241.1">(</span></span><span class="s1"><span class="koboSpan" id="kobo.1242.1">''</span></span><span class="o"><span class="koboSpan" id="kobo.1243.1">.</span></span><span class="n"><span class="koboSpan" id="kobo.1244.1">join</span></span><span class="p"><span class="koboSpan" id="kobo.1245.1">([</span></span><span class="n"><span class="koboSpan" id="kobo.1246.1">stage_name</span></span><span class="p"><span class="koboSpan" id="kobo.1247.1">,</span></span><span class="s2"><span class="koboSpan" id="kobo.1248.1">"_output"</span></span><span class="p"><span class="koboSpan" id="kobo.1249.1">]),</span></span><span class="n"><span class="koboSpan" id="kobo.1250.1">first_successor</span></span><span class="p"><span class="koboSpan" id="kobo.1251.1">)</span></span> 
            <span class="k"><span class="koboSpan" id="kobo.1252.1">else</span></span><span class="p"><span class="koboSpan" id="kobo.1253.1">:</span></span>
                <span class="n"><span class="koboSpan" id="kobo.1254.1">add_node</span></span><span class="p"><span class="koboSpan" id="kobo.1255.1">(</span></span><span class="s1"><span class="koboSpan" id="kobo.1256.1">''</span></span><span class="o"><span class="koboSpan" id="kobo.1257.1">.</span></span><span class="n"><span class="koboSpan" id="kobo.1258.1">join</span></span><span class="p"><span class="koboSpan" id="kobo.1259.1">([</span></span><span class="n"><span class="koboSpan" id="kobo.1260.1">stage_name</span></span><span class="p"><span class="koboSpan" id="kobo.1261.1">,</span></span><span class="s2"><span class="koboSpan" id="kobo.1262.1">"_output"</span></span><span class="p"><span class="koboSpan" id="kobo.1263.1">]),</span></span><span class="s1"><span class="koboSpan" id="kobo.1264.1">''</span></span><span class="o"><span class="koboSpan" id="kobo.1265.1">.</span></span><span class="n"><span class="koboSpan" id="kobo.1266.1">join</span></span><span class="p"><span class="koboSpan" id="kobo.1267.1">([</span></span><span class="n"><span class="koboSpan" id="kobo.1268.1">without_successors</span></span><span class="p"><span class="koboSpan" id="kobo.1269.1">[</span></span><span class="mi"><span class="koboSpan" id="kobo.1270.1">0</span></span><span class="p"><span class="koboSpan" id="kobo.1271.1">],</span></span><span class="n"><span class="koboSpan" id="kobo.1272.1">activation_function_pattern</span></span><span class="p"><span class="koboSpan" id="kobo.1273.1">]))</span></span> 

            <span class="n"><span class="koboSpan" id="kobo.1274.1">pooling_layer_name</span></span> <span class="o"><span class="koboSpan" id="kobo.1275.1">=</span></span> <span class="s1"><span class="koboSpan" id="kobo.1276.1">''</span></span><span class="o"><span class="koboSpan" id="kobo.1277.1">.</span></span><span class="n"><span class="koboSpan" id="kobo.1278.1">join</span></span><span class="p"><span class="koboSpan" id="kobo.1279.1">([</span></span><span class="n"><span class="koboSpan" id="kobo.1280.1">stage_name</span></span><span class="p"><span class="koboSpan" id="kobo.1281.1">,</span></span><span class="s2"><span class="koboSpan" id="kobo.1282.1">"_output"</span></span><span class="p"><span class="koboSpan" id="kobo.1283.1">,</span></span><span class="n"><span class="koboSpan" id="kobo.1284.1">activation_function_pattern</span></span><span class="p"><span class="koboSpan" id="kobo.1285.1">])</span></span>
            <span class="c1"><span class="koboSpan" id="kobo.1286.1"># ------------------------------------------------------------------------------------------ #</span></span>

        <span class="n"><span class="koboSpan" id="kobo.1287.1">d_node</span></span> <span class="o"><span class="koboSpan" id="kobo.1288.1">=</span></span>  <span class="n"><span class="koboSpan" id="kobo.1289.1">apply_pool</span></span><span class="p"><span class="koboSpan" id="kobo.1290.1">(</span></span><span class="n"><span class="koboSpan" id="kobo.1291.1">tf</span></span><span class="o"><span class="koboSpan" id="kobo.1292.1">.</span></span><span class="n"><span class="koboSpan" id="kobo.1293.1">get_default_graph</span></span><span class="p"><span class="koboSpan" id="kobo.1294.1">()</span></span><span class="o"><span class="koboSpan" id="kobo.1295.1">.</span></span><span class="n"><span class="koboSpan" id="kobo.1296.1">get_tensor_by_name</span></span><span class="p"><span class="koboSpan" id="kobo.1297.1">(</span></span><span class="n"><span class="koboSpan" id="kobo.1298.1">pooling_layer_name</span></span><span class="p"><span class="koboSpan" id="kobo.1299.1">),</span></span> 
                                 <span class="n"><span class="koboSpan" id="kobo.1300.1">kernel_height</span></span> <span class="o"><span class="koboSpan" id="kobo.1301.1">=</span></span> <span class="mi"><span class="koboSpan" id="kobo.1302.1">16</span></span><span class="p"><span class="koboSpan" id="kobo.1303.1">,</span></span> <span class="n"><span class="koboSpan" id="kobo.1304.1">kernel_width</span></span> <span class="o"><span class="koboSpan" id="kobo.1305.1">=</span></span> <span class="mi"><span class="koboSpan" id="kobo.1306.1">16</span></span><span class="p"><span class="koboSpan" id="kobo.1307.1">,</span></span><span class="n"><span class="koboSpan" id="kobo.1308.1">stride_size</span></span> <span class="o"><span class="koboSpan" id="kobo.1309.1">=</span></span> <span class="mi"><span class="koboSpan" id="kobo.1310.1">2</span></span><span class="p"><span class="koboSpan" id="kobo.1311.1">)</span></span>

    <span class="n"><span class="koboSpan" id="kobo.1312.1">shape</span></span> <span class="o"><span class="koboSpan" id="kobo.1313.1">=</span></span> <span class="n"><span class="koboSpan" id="kobo.1314.1">d_node</span></span><span class="o"><span class="koboSpan" id="kobo.1315.1">.</span></span><span class="n"><span class="koboSpan" id="kobo.1316.1">get_shape</span></span><span class="p"><span class="koboSpan" id="kobo.1317.1">()</span></span><span class="o"><span class="koboSpan" id="kobo.1318.1">.</span></span><span class="n"><span class="koboSpan" id="kobo.1319.1">as_list</span></span><span class="p"><span class="koboSpan" id="kobo.1320.1">()</span></span>
    <span class="n"><span class="koboSpan" id="kobo.1321.1">flat</span></span> <span class="o"><span class="koboSpan" id="kobo.1322.1">=</span></span> <span class="n"><span class="koboSpan" id="kobo.1323.1">tf</span></span><span class="o"><span class="koboSpan" id="kobo.1324.1">.</span></span><span class="n"><span class="koboSpan" id="kobo.1325.1">reshape</span></span><span class="p"><span class="koboSpan" id="kobo.1326.1">(</span></span><span class="n"><span class="koboSpan" id="kobo.1327.1">d_node</span></span><span class="p"><span class="koboSpan" id="kobo.1328.1">,</span></span> <span class="p"><span class="koboSpan" id="kobo.1329.1">[</span></span><span class="o"><span class="koboSpan" id="kobo.1330.1">-</span></span><span class="mi"><span class="koboSpan" id="kobo.1331.1">1</span></span><span class="p"><span class="koboSpan" id="kobo.1332.1">,</span></span> <span class="n"><span class="koboSpan" id="kobo.1333.1">shape</span></span><span class="p"><span class="koboSpan" id="kobo.1334.1">[</span></span><span class="mi"><span class="koboSpan" id="kobo.1335.1">1</span></span><span class="p"><span class="koboSpan" id="kobo.1336.1">]</span></span> <span class="o"><span class="koboSpan" id="kobo.1337.1">*</span></span> <span class="n"><span class="koboSpan" id="kobo.1338.1">shape</span></span><span class="p"><span class="koboSpan" id="kobo.1339.1">[</span></span><span class="mi"><span class="koboSpan" id="kobo.1340.1">2</span></span><span class="p"><span class="koboSpan" id="kobo.1341.1">]</span></span> <span class="o"><span class="koboSpan" id="kobo.1342.1">*</span></span> <span class="n"><span class="koboSpan" id="kobo.1343.1">shape</span></span><span class="p"><span class="koboSpan" id="kobo.1344.1">[</span></span><span class="mi"><span class="koboSpan" id="kobo.1345.1">3</span></span><span class="p"><span class="koboSpan" id="kobo.1346.1">]])</span></span>
    <span class="n"><span class="koboSpan" id="kobo.1347.1">logits</span></span> <span class="o"><span class="koboSpan" id="kobo.1348.1">=</span></span> <span class="n"><span class="koboSpan" id="kobo.1349.1">linear_layer</span></span><span class="p"><span class="koboSpan" id="kobo.1350.1">(</span></span><span class="n"><span class="koboSpan" id="kobo.1351.1">flat</span></span><span class="p"><span class="koboSpan" id="kobo.1352.1">,</span></span><span class="mi"><span class="koboSpan" id="kobo.1353.1">10</span></span><span class="p"><span class="koboSpan" id="kobo.1354.1">,</span></span><span class="s2"><span class="koboSpan" id="kobo.1355.1">"logits"</span></span><span class="p"><span class="koboSpan" id="kobo.1356.1">)</span></span>
    
    <span class="n"><span class="koboSpan" id="kobo.1357.1">xentropy</span></span> <span class="o"><span class="koboSpan" id="kobo.1358.1">=</span></span>  <span class="n"><span class="koboSpan" id="kobo.1359.1">tf</span></span><span class="o"><span class="koboSpan" id="kobo.1360.1">.</span></span><span class="n"><span class="koboSpan" id="kobo.1361.1">nn</span></span><span class="o"><span class="koboSpan" id="kobo.1362.1">.</span></span><span class="n"><span class="koboSpan" id="kobo.1363.1">softmax_cross_entropy_with_logits</span></span><span class="p"><span class="koboSpan" id="kobo.1364.1">(</span></span><span class="n"><span class="koboSpan" id="kobo.1365.1">logits</span></span> <span class="o"><span class="koboSpan" id="kobo.1366.1">=</span></span> <span class="n"><span class="koboSpan" id="kobo.1367.1">logits</span></span><span class="p"><span class="koboSpan" id="kobo.1368.1">,</span></span> <span class="n"><span class="koboSpan" id="kobo.1369.1">labels</span></span> <span class="o"><span class="koboSpan" id="kobo.1370.1">=</span></span> <span class="n"><span class="koboSpan" id="kobo.1371.1">Y</span></span><span class="p"><span class="koboSpan" id="kobo.1372.1">)</span></span>
    <span class="n"><span class="koboSpan" id="kobo.1373.1">loss_function</span></span> <span class="o"><span class="koboSpan" id="kobo.1374.1">=</span></span> <span class="n"><span class="koboSpan" id="kobo.1375.1">tf</span></span><span class="o"><span class="koboSpan" id="kobo.1376.1">.</span></span><span class="n"><span class="koboSpan" id="kobo.1377.1">reduce_mean</span></span><span class="p"><span class="koboSpan" id="kobo.1378.1">(</span></span><span class="n"><span class="koboSpan" id="kobo.1379.1">xentropy</span></span><span class="p"><span class="koboSpan" id="kobo.1380.1">)</span></span>
    <span class="n"><span class="koboSpan" id="kobo.1381.1">optimizer</span></span> <span class="o"><span class="koboSpan" id="kobo.1382.1">=</span></span> <span class="n"><span class="koboSpan" id="kobo.1383.1">tf</span></span><span class="o"><span class="koboSpan" id="kobo.1384.1">.</span></span><span class="n"><span class="koboSpan" id="kobo.1385.1">train</span></span><span class="o"><span class="koboSpan" id="kobo.1386.1">.</span></span><span class="n"><span class="koboSpan" id="kobo.1387.1">AdamOptimizer</span></span><span class="p"><span class="koboSpan" id="kobo.1388.1">()</span></span><span class="o"><span class="koboSpan" id="kobo.1389.1">.</span></span><span class="n"><span class="koboSpan" id="kobo.1390.1">minimize</span></span><span class="p"><span class="koboSpan" id="kobo.1391.1">(</span></span><span class="n"><span class="koboSpan" id="kobo.1392.1">loss_function</span></span><span class="p"><span class="koboSpan" id="kobo.1393.1">)</span></span> 
    <span class="n"><span class="koboSpan" id="kobo.1394.1">accuracy</span></span> <span class="o"><span class="koboSpan" id="kobo.1395.1">=</span></span> <span class="n"><span class="koboSpan" id="kobo.1396.1">tf</span></span><span class="o"><span class="koboSpan" id="kobo.1397.1">.</span></span><span class="n"><span class="koboSpan" id="kobo.1398.1">reduce_mean</span></span><span class="p"><span class="koboSpan" id="kobo.1399.1">(</span></span><span class="n"><span class="koboSpan" id="kobo.1400.1">tf</span></span><span class="o"><span class="koboSpan" id="kobo.1401.1">.</span></span><span class="n"><span class="koboSpan" id="kobo.1402.1">cast</span></span><span class="p"><span class="koboSpan" id="kobo.1403.1">(</span></span> <span class="n"><span class="koboSpan" id="kobo.1404.1">tf</span></span><span class="o"><span class="koboSpan" id="kobo.1405.1">.</span></span><span class="n"><span class="koboSpan" id="kobo.1406.1">equal</span></span><span class="p"><span class="koboSpan" id="kobo.1407.1">(</span></span><span class="n"><span class="koboSpan" id="kobo.1408.1">tf</span></span><span class="o"><span class="koboSpan" id="kobo.1409.1">.</span></span><span class="n"><span class="koboSpan" id="kobo.1410.1">argmax</span></span><span class="p"><span class="koboSpan" id="kobo.1411.1">(</span></span><span class="n"><span class="koboSpan" id="kobo.1412.1">tf</span></span><span class="o"><span class="koboSpan" id="kobo.1413.1">.</span></span><span class="n"><span class="koboSpan" id="kobo.1414.1">nn</span></span><span class="o"><span class="koboSpan" id="kobo.1415.1">.</span></span><span class="n"><span class="koboSpan" id="kobo.1416.1">softmax</span></span><span class="p"><span class="koboSpan" id="kobo.1417.1">(</span></span><span class="n"><span class="koboSpan" id="kobo.1418.1">logits</span></span><span class="p"><span class="koboSpan" id="kobo.1419.1">),</span></span><span class="mi"><span class="koboSpan" id="kobo.1420.1">1</span></span><span class="p"><span class="koboSpan" id="kobo.1421.1">),</span></span> <span class="n"><span class="koboSpan" id="kobo.1422.1">tf</span></span><span class="o"><span class="koboSpan" id="kobo.1423.1">.</span></span><span class="n"><span class="koboSpan" id="kobo.1424.1">argmax</span></span><span class="p"><span class="koboSpan" id="kobo.1425.1">(</span></span><span class="n"><span class="koboSpan" id="kobo.1426.1">Y</span></span><span class="p"><span class="koboSpan" id="kobo.1427.1">,</span></span><span class="mi"><span class="koboSpan" id="kobo.1428.1">1</span></span><span class="p"><span class="koboSpan" id="kobo.1429.1">)),</span></span> <span class="n"><span class="koboSpan" id="kobo.1430.1">tf</span></span><span class="o"><span class="koboSpan" id="kobo.1431.1">.</span></span><span class="n"><span class="koboSpan" id="kobo.1432.1">float32</span></span><span class="p"><span class="koboSpan" id="kobo.1433.1">))</span></span>
    
    <span class="k"><span class="koboSpan" id="kobo.1434.1">return</span></span>  <span class="n"><span class="koboSpan" id="kobo.1435.1">X</span></span><span class="p"><span class="koboSpan" id="kobo.1436.1">,</span></span> <span class="n"><span class="koboSpan" id="kobo.1437.1">Y</span></span><span class="p"><span class="koboSpan" id="kobo.1438.1">,</span></span> <span class="n"><span class="koboSpan" id="kobo.1439.1">optimizer</span></span><span class="p"><span class="koboSpan" id="kobo.1440.1">,</span></span> <span class="n"><span class="koboSpan" id="kobo.1441.1">loss_function</span></span><span class="p"><span class="koboSpan" id="kobo.1442.1">,</span></span> <span class="n"><span class="koboSpan" id="kobo.1443.1">accuracy</span><br/><br/><span class="koboSpan" id="kobo.1444.1"># Function to add nodes</span><br/></span><span class="k"><span class="koboSpan" id="kobo.1445.1">def</span></span> <span class="nf"><span class="koboSpan" id="kobo.1446.1">add_node</span></span><span class="p"><span class="koboSpan" id="kobo.1447.1">(</span></span><span class="n"><span class="koboSpan" id="kobo.1448.1">node_name</span></span><span class="p"><span class="koboSpan" id="kobo.1449.1">,</span></span> <span class="n"><span class="koboSpan" id="kobo.1450.1">connector_node_name</span></span><span class="p"><span class="koboSpan" id="kobo.1451.1">,</span></span> <span class="n"><span class="koboSpan" id="kobo.1452.1">h</span></span> <span class="o"><span class="koboSpan" id="kobo.1453.1">=</span></span> <span class="mi"><span class="koboSpan" id="kobo.1454.1">5</span></span><span class="p"><span class="koboSpan" id="kobo.1455.1">,</span></span> <span class="n"><span class="koboSpan" id="kobo.1456.1">w</span></span> <span class="o"><span class="koboSpan" id="kobo.1457.1">=</span></span> <span class="mi"><span class="koboSpan" id="kobo.1458.1">5</span></span><span class="p"><span class="koboSpan" id="kobo.1459.1">,</span></span> <span class="n"><span class="koboSpan" id="kobo.1460.1">nc</span></span> <span class="o"><span class="koboSpan" id="kobo.1461.1">=</span></span> <span class="mi"><span class="koboSpan" id="kobo.1462.1">1</span></span><span class="p"><span class="koboSpan" id="kobo.1463.1">,</span></span> <span class="n"><span class="koboSpan" id="kobo.1464.1">d</span></span> <span class="o"><span class="koboSpan" id="kobo.1465.1">=</span></span> <span class="mi"><span class="koboSpan" id="kobo.1466.1">1</span></span><span class="p"><span class="koboSpan" id="kobo.1467.1">):</span></span>
    <span class="k"><span class="koboSpan" id="kobo.1468.1">with</span></span> <span class="n"><span class="koboSpan" id="kobo.1469.1">tf</span></span><span class="o"><span class="koboSpan" id="kobo.1470.1">.</span></span><span class="n"><span class="koboSpan" id="kobo.1471.1">name_scope</span></span><span class="p"><span class="koboSpan" id="kobo.1472.1">(</span></span><span class="n"><span class="koboSpan" id="kobo.1473.1">node_name</span></span><span class="p"><span class="koboSpan" id="kobo.1474.1">)</span></span> <span class="k"><span class="koboSpan" id="kobo.1475.1">as</span></span> <span class="n"><span class="koboSpan" id="kobo.1476.1">scope</span></span><span class="p"><span class="koboSpan" id="kobo.1477.1">:</span></span>
        <span class="n"><span class="koboSpan" id="kobo.1478.1">conv</span></span> <span class="o"><span class="koboSpan" id="kobo.1479.1">=</span></span> <span class="n"><span class="koboSpan" id="kobo.1480.1">apply_convolution</span></span><span class="p"><span class="koboSpan" id="kobo.1481.1">(</span></span><span class="n"><span class="koboSpan" id="kobo.1482.1">tf</span></span><span class="o"><span class="koboSpan" id="kobo.1483.1">.</span></span><span class="n"><span class="koboSpan" id="kobo.1484.1">get_default_graph</span></span><span class="p"><span class="koboSpan" id="kobo.1485.1">()</span></span><span class="o"><span class="koboSpan" id="kobo.1486.1">.</span></span><span class="n"><span class="koboSpan" id="kobo.1487.1">get_tensor_by_name</span></span><span class="p"><span class="koboSpan" id="kobo.1488.1">(</span></span><span class="n"><span class="koboSpan" id="kobo.1489.1">connector_node_name</span></span><span class="p"><span class="koboSpan" id="kobo.1490.1">),</span></span> 
                   <span class="n"><span class="koboSpan" id="kobo.1491.1">kernel_height</span></span> <span class="o"><span class="koboSpan" id="kobo.1492.1">=</span></span> <span class="n"><span class="koboSpan" id="kobo.1493.1">h</span></span><span class="p"><span class="koboSpan" id="kobo.1494.1">,</span></span> <span class="n"><span class="koboSpan" id="kobo.1495.1">kernel_width</span></span> <span class="o"><span class="koboSpan" id="kobo.1496.1">=</span></span> <span class="n"><span class="koboSpan" id="kobo.1497.1">w</span></span><span class="p"><span class="koboSpan" id="kobo.1498.1">,</span></span> <span class="n"><span class="koboSpan" id="kobo.1499.1">num_channels</span></span> <span class="o"><span class="koboSpan" id="kobo.1500.1">=</span></span> <span class="n"><span class="koboSpan" id="kobo.1501.1">nc</span></span> <span class="p"><span class="koboSpan" id="kobo.1502.1">,</span></span> <span class="n"><span class="koboSpan" id="kobo.1503.1">depth</span></span> <span class="o"><span class="koboSpan" id="kobo.1504.1">=</span></span> <span class="n"><span class="koboSpan" id="kobo.1505.1">d</span></span><span class="p"><span class="koboSpan" id="kobo.1506.1">,</span></span> 
                   <span class="n"><span class="koboSpan" id="kobo.1507.1">layer_name</span></span> <span class="o"><span class="koboSpan" id="kobo.1508.1">=</span></span> <span class="s1"><span class="koboSpan" id="kobo.1509.1">''</span></span><span class="o"><span class="koboSpan" id="kobo.1510.1">.</span></span><span class="n"><span class="koboSpan" id="kobo.1511.1">join</span></span><span class="p"><span class="koboSpan" id="kobo.1512.1">([</span></span><span class="s2"><span class="koboSpan" id="kobo.1513.1">"conv_"</span></span><span class="p"><span class="koboSpan" id="kobo.1514.1">,</span></span><span class="n"><span class="koboSpan" id="kobo.1515.1">node_name</span></span><span class="p"><span class="koboSpan" id="kobo.1516.1">]))</span></span>

<span class="k"><span class="koboSpan" id="kobo.1517.1">def</span></span> <span class="nf"><span class="koboSpan" id="kobo.1518.1">sum_tensors</span></span><span class="p"><span class="koboSpan" id="kobo.1519.1">(</span></span><span class="n"><span class="koboSpan" id="kobo.1520.1">tensor_a</span></span><span class="p"><span class="koboSpan" id="kobo.1521.1">,</span></span><span class="n"><span class="koboSpan" id="kobo.1522.1">tensor_b</span></span><span class="p"><span class="koboSpan" id="kobo.1523.1">,</span></span><span class="n"><span class="koboSpan" id="kobo.1524.1">activation_function_pattern</span></span><span class="p"><span class="koboSpan" id="kobo.1525.1">):</span></span>
    <span class="k"><span class="koboSpan" id="kobo.1526.1">if</span></span> <span class="ow"><span class="koboSpan" id="kobo.1527.1">not</span></span> <span class="n"><span class="koboSpan" id="kobo.1528.1">tensor_a</span></span><span class="o"><span class="koboSpan" id="kobo.1529.1">.</span></span><span class="n"><span class="koboSpan" id="kobo.1530.1">startswith</span></span><span class="p"><span class="koboSpan" id="kobo.1531.1">(</span></span><span class="s2"><span class="koboSpan" id="kobo.1532.1">"Add"</span></span><span class="p"><span class="koboSpan" id="kobo.1533.1">):</span></span>
        <span class="n"><span class="koboSpan" id="kobo.1534.1">tensor_a</span></span> <span class="o"><span class="koboSpan" id="kobo.1535.1">=</span></span> <span class="s1"><span class="koboSpan" id="kobo.1536.1">''</span></span><span class="o"><span class="koboSpan" id="kobo.1537.1">.</span></span><span class="n"><span class="koboSpan" id="kobo.1538.1">join</span></span><span class="p"><span class="koboSpan" id="kobo.1539.1">([</span></span><span class="n"><span class="koboSpan" id="kobo.1540.1">tensor_a</span></span><span class="p"><span class="koboSpan" id="kobo.1541.1">,</span></span><span class="n"><span class="koboSpan" id="kobo.1542.1">activation_function_pattern</span></span><span class="p"><span class="koboSpan" id="kobo.1543.1">])</span></span>
        
    <span class="k"><span class="koboSpan" id="kobo.1544.1">return</span></span> <span class="n"><span class="koboSpan" id="kobo.1545.1">tf</span></span><span class="o"><span class="koboSpan" id="kobo.1546.1">.</span></span><span class="n"><span class="koboSpan" id="kobo.1547.1">add</span></span><span class="p"><span class="koboSpan" id="kobo.1548.1">(</span></span><span class="n"><span class="koboSpan" id="kobo.1549.1">tf</span></span><span class="o"><span class="koboSpan" id="kobo.1550.1">.</span></span><span class="n"><span class="koboSpan" id="kobo.1551.1">get_default_graph</span></span><span class="p"><span class="koboSpan" id="kobo.1552.1">()</span></span><span class="o"><span class="koboSpan" id="kobo.1553.1">.</span></span><span class="n"><span class="koboSpan" id="kobo.1554.1">get_tensor_by_name</span></span><span class="p"><span class="koboSpan" id="kobo.1555.1">(</span></span><span class="n"><span class="koboSpan" id="kobo.1556.1">tensor_a</span></span><span class="p"><span class="koboSpan" id="kobo.1557.1">),</span></span>
                 <span class="n"><span class="koboSpan" id="kobo.1558.1">tf</span></span><span class="o"><span class="koboSpan" id="kobo.1559.1">.</span></span><span class="n"><span class="koboSpan" id="kobo.1560.1">get_default_graph</span></span><span class="p"><span class="koboSpan" id="kobo.1561.1">()</span></span><span class="o"><span class="koboSpan" id="kobo.1562.1">.</span></span><span class="n"><span class="koboSpan" id="kobo.1563.1">get_tensor_by_name</span></span><span class="p"><span class="koboSpan" id="kobo.1564.1">(</span></span><span class="s1"><span class="koboSpan" id="kobo.1565.1">''</span></span><span class="o"><span class="koboSpan" id="kobo.1566.1">.</span></span><span class="n"><span class="koboSpan" id="kobo.1567.1">join</span></span><span class="p"><span class="koboSpan" id="kobo.1568.1">([</span></span><span class="n"><span class="koboSpan" id="kobo.1569.1">tensor_b</span></span><span class="p"><span class="koboSpan" id="kobo.1570.1">,</span></span><span class="n"><span class="koboSpan" id="kobo.1571.1">activation_function_pattern</span></span><span class="p"><span class="koboSpan" id="kobo.1572.1">])))</span></span>

<span class="k"><span class="koboSpan" id="kobo.1573.1">def</span></span> <span class="nf"><span class="koboSpan" id="kobo.1574.1">has_same_elements</span></span><span class="p"><span class="koboSpan" id="kobo.1575.1">(</span></span><span class="n"><span class="koboSpan" id="kobo.1576.1">x</span></span><span class="p"><span class="koboSpan" id="kobo.1577.1">):</span></span>
    <span class="k"><span class="koboSpan" id="kobo.1578.1">return</span></span> <span class="nb"><span class="koboSpan" id="kobo.1579.1">len</span></span><span class="p"><span class="koboSpan" id="kobo.1580.1">(</span></span><span class="nb"><span class="koboSpan" id="kobo.1581.1">set</span></span><span class="p"><span class="koboSpan" id="kobo.1582.1">(</span></span><span class="n"><span class="koboSpan" id="kobo.1583.1">x</span></span><span class="p"><span class="koboSpan" id="kobo.1584.1">))</span></span> <span class="o"><span class="koboSpan" id="kobo.1585.1">&lt;=</span></span> <span class="mi"><span class="koboSpan" id="kobo.1586.1">1</span></span></pre>
<ol start="7">
<li><span class="koboSpan" id="kobo.1587.1">The fitness function evaluates the accuracy of the generated CNN architecture:</span></li>
</ol>
<pre style="padding-left: 60px"><span class="k"><span class="koboSpan" id="kobo.1588.1">def</span></span> <span class="nf"><span class="koboSpan" id="kobo.1589.1">evaluateModel</span></span><span class="p"><span class="koboSpan" id="kobo.1590.1">(</span></span><span class="n"><span class="koboSpan" id="kobo.1591.1">individual</span></span><span class="p"><span class="koboSpan" id="kobo.1592.1">):</span></span>
    <span class="n"><span class="koboSpan" id="kobo.1593.1">score</span></span> <span class="o"><span class="koboSpan" id="kobo.1594.1">=</span></span> <span class="mf"><span class="koboSpan" id="kobo.1595.1">0.0</span></span>
    <span class="n"><span class="koboSpan" id="kobo.1596.1">X</span></span><span class="p"><span class="koboSpan" id="kobo.1597.1">,</span></span> <span class="n"><span class="koboSpan" id="kobo.1598.1">Y</span></span><span class="p"><span class="koboSpan" id="kobo.1599.1">,</span></span> <span class="n"><span class="koboSpan" id="kobo.1600.1">optimizer</span></span><span class="p"><span class="koboSpan" id="kobo.1601.1">,</span></span> <span class="n"><span class="koboSpan" id="kobo.1602.1">loss_function</span></span><span class="p"><span class="koboSpan" id="kobo.1603.1">,</span></span> <span class="n"><span class="koboSpan" id="kobo.1604.1">accuracy</span></span> <span class="o"><span class="koboSpan" id="kobo.1605.1">=</span></span> <span class="n"><span class="koboSpan" id="kobo.1606.1">generate_tensorflow_graph</span></span><span class="p"><span class="koboSpan" id="kobo.1607.1">(</span></span><span class="n"><span class="koboSpan" id="kobo.1608.1">individual</span></span><span class="p"><span class="koboSpan" id="kobo.1609.1">,</span></span><span class="n"><span class="koboSpan" id="kobo.1610.1">STAGES</span></span><span class="p"><span class="koboSpan" id="kobo.1611.1">,</span></span><span class="n"><span class="koboSpan" id="kobo.1612.1">NUM_NODES</span></span><span class="p"><span class="koboSpan" id="kobo.1613.1">,</span></span><span class="n"><span class="koboSpan" id="kobo.1614.1">BITS_INDICES</span></span><span class="p"><span class="koboSpan" id="kobo.1615.1">)</span></span>
    <span class="k"><span class="koboSpan" id="kobo.1616.1">with</span></span> <span class="n"><span class="koboSpan" id="kobo.1617.1">tf</span></span><span class="o"><span class="koboSpan" id="kobo.1618.1">.</span></span><span class="n"><span class="koboSpan" id="kobo.1619.1">Session</span></span><span class="p"><span class="koboSpan" id="kobo.1620.1">()</span></span> <span class="k"><span class="koboSpan" id="kobo.1621.1">as</span></span> <span class="n"><span class="koboSpan" id="kobo.1622.1">session</span></span><span class="p"><span class="koboSpan" id="kobo.1623.1">:</span></span>
        <span class="n"><span class="koboSpan" id="kobo.1624.1">tf</span></span><span class="o"><span class="koboSpan" id="kobo.1625.1">.</span></span><span class="n"><span class="koboSpan" id="kobo.1626.1">global_variables_initializer</span></span><span class="p"><span class="koboSpan" id="kobo.1627.1">()</span></span><span class="o"><span class="koboSpan" id="kobo.1628.1">.</span></span><span class="n"><span class="koboSpan" id="kobo.1629.1">run</span></span><span class="p"><span class="koboSpan" id="kobo.1630.1">()</span></span>
        <span class="k"><span class="koboSpan" id="kobo.1631.1">for</span></span> <span class="n"><span class="koboSpan" id="kobo.1632.1">epoch</span></span> <span class="ow"><span class="koboSpan" id="kobo.1633.1">in</span></span> <span class="nb"><span class="koboSpan" id="kobo.1634.1">range</span></span><span class="p"><span class="koboSpan" id="kobo.1635.1">(</span></span><span class="n"><span class="koboSpan" id="kobo.1636.1">TRAINING_EPOCHS</span></span><span class="p"><span class="koboSpan" id="kobo.1637.1">):</span></span>
            <span class="k"><span class="koboSpan" id="kobo.1638.1">for</span></span> <span class="n"><span class="koboSpan" id="kobo.1639.1">b</span></span> <span class="ow"><span class="koboSpan" id="kobo.1640.1">in</span></span> <span class="nb"><span class="koboSpan" id="kobo.1641.1">range</span></span><span class="p"><span class="koboSpan" id="kobo.1642.1">(</span></span><span class="n"><span class="koboSpan" id="kobo.1643.1">TOTAL_BATCHES</span></span><span class="p"><span class="koboSpan" id="kobo.1644.1">):</span></span>
                <span class="n"><span class="koboSpan" id="kobo.1645.1">offset</span></span> <span class="o"><span class="koboSpan" id="kobo.1646.1">=</span></span> <span class="p"><span class="koboSpan" id="kobo.1647.1">(</span></span><span class="n"><span class="koboSpan" id="kobo.1648.1">epoch</span></span> <span class="o"><span class="koboSpan" id="kobo.1649.1">*</span></span> <span class="n"><span class="koboSpan" id="kobo.1650.1">BATCH_SIZE</span></span><span class="p"><span class="koboSpan" id="kobo.1651.1">)</span></span> <span class="o"><span class="koboSpan" id="kobo.1652.1">%</span></span> <span class="p"><span class="koboSpan" id="kobo.1653.1">(</span></span><span class="n"><span class="koboSpan" id="kobo.1654.1">train_labels</span></span><span class="o"><span class="koboSpan" id="kobo.1655.1">.</span></span><span class="n"><span class="koboSpan" id="kobo.1656.1">shape</span></span><span class="p"><span class="koboSpan" id="kobo.1657.1">[</span></span><span class="mi"><span class="koboSpan" id="kobo.1658.1">0</span></span><span class="p"><span class="koboSpan" id="kobo.1659.1">]</span></span> <span class="o"><span class="koboSpan" id="kobo.1660.1">-</span></span> <span class="n"><span class="koboSpan" id="kobo.1661.1">BATCH_SIZE</span></span><span class="p"><span class="koboSpan" id="kobo.1662.1">)</span></span>
                <span class="n"><span class="koboSpan" id="kobo.1663.1">batch_x</span></span> <span class="o"><span class="koboSpan" id="kobo.1664.1">=</span></span> <span class="n"><span class="koboSpan" id="kobo.1665.1">train_imgs</span></span><span class="p"><span class="koboSpan" id="kobo.1666.1">[</span></span><span class="n"><span class="koboSpan" id="kobo.1667.1">offset</span></span><span class="p"><span class="koboSpan" id="kobo.1668.1">:(</span></span><span class="n"><span class="koboSpan" id="kobo.1669.1">offset</span></span> <span class="o"><span class="koboSpan" id="kobo.1670.1">+</span></span> <span class="n"><span class="koboSpan" id="kobo.1671.1">BATCH_SIZE</span></span><span class="p"><span class="koboSpan" id="kobo.1672.1">),</span></span> <span class="p"><span class="koboSpan" id="kobo.1673.1">:,</span></span> <span class="p"><span class="koboSpan" id="kobo.1674.1">:,</span></span> <span class="p"><span class="koboSpan" id="kobo.1675.1">:]</span></span>
                <span class="n"><span class="koboSpan" id="kobo.1676.1">batch_y</span></span> <span class="o"><span class="koboSpan" id="kobo.1677.1">=</span></span> <span class="n"><span class="koboSpan" id="kobo.1678.1">train_labels</span></span><span class="p"><span class="koboSpan" id="kobo.1679.1">[</span></span><span class="n"><span class="koboSpan" id="kobo.1680.1">offset</span></span><span class="p"><span class="koboSpan" id="kobo.1681.1">:(</span></span><span class="n"><span class="koboSpan" id="kobo.1682.1">offset</span></span> <span class="o"><span class="koboSpan" id="kobo.1683.1">+</span></span> <span class="n"><span class="koboSpan" id="kobo.1684.1">BATCH_SIZE</span></span><span class="p"><span class="koboSpan" id="kobo.1685.1">),</span></span> <span class="p"><span class="koboSpan" id="kobo.1686.1">:]</span></span>
                <span class="n"><span class="koboSpan" id="kobo.1687.1">_</span></span><span class="p"><span class="koboSpan" id="kobo.1688.1">,</span></span> <span class="n"><span class="koboSpan" id="kobo.1689.1">c</span></span> <span class="o"><span class="koboSpan" id="kobo.1690.1">=</span></span> <span class="n"><span class="koboSpan" id="kobo.1691.1">session</span></span><span class="o"><span class="koboSpan" id="kobo.1692.1">.</span></span><span class="n"><span class="koboSpan" id="kobo.1693.1">run</span></span><span class="p"><span class="koboSpan" id="kobo.1694.1">([</span></span><span class="n"><span class="koboSpan" id="kobo.1695.1">optimizer</span></span><span class="p"><span class="koboSpan" id="kobo.1696.1">,</span></span> <span class="n"><span class="koboSpan" id="kobo.1697.1">loss_function</span></span><span class="p"><span class="koboSpan" id="kobo.1698.1">],</span></span><span class="n"><span class="koboSpan" id="kobo.1699.1">feed_dict</span></span><span class="o"><span class="koboSpan" id="kobo.1700.1">=</span></span><span class="p"><span class="koboSpan" id="kobo.1701.1">{</span></span><span class="n"><span class="koboSpan" id="kobo.1702.1">X</span></span><span class="p"><span class="koboSpan" id="kobo.1703.1">:</span></span> <span class="n"><span class="koboSpan" id="kobo.1704.1">batch_x</span></span><span class="p"><span class="koboSpan" id="kobo.1705.1">,</span></span> <span class="n"><span class="koboSpan" id="kobo.1706.1">Y</span></span> <span class="p"><span class="koboSpan" id="kobo.1707.1">:</span></span> <span class="n"><span class="koboSpan" id="kobo.1708.1">batch_y</span></span><span class="p"><span class="koboSpan" id="kobo.1709.1">})</span></span>
                
        <span class="n"><span class="koboSpan" id="kobo.1710.1">score</span></span> <span class="o"><span class="koboSpan" id="kobo.1711.1">=</span></span> <span class="n"><span class="koboSpan" id="kobo.1712.1">session</span></span><span class="o"><span class="koboSpan" id="kobo.1713.1">.</span></span><span class="n"><span class="koboSpan" id="kobo.1714.1">run</span></span><span class="p"><span class="koboSpan" id="kobo.1715.1">(</span></span><span class="n"><span class="koboSpan" id="kobo.1716.1">accuracy</span></span><span class="p"><span class="koboSpan" id="kobo.1717.1">,</span></span> <span class="n"><span class="koboSpan" id="kobo.1718.1">feed_dict</span></span><span class="o"><span class="koboSpan" id="kobo.1719.1">=</span></span><span class="p"><span class="koboSpan" id="kobo.1720.1">{</span></span><span class="n"><span class="koboSpan" id="kobo.1721.1">X</span></span><span class="p"><span class="koboSpan" id="kobo.1722.1">:</span></span> <span class="n"><span class="koboSpan" id="kobo.1723.1">test_imgs</span></span><span class="p"><span class="koboSpan" id="kobo.1724.1">,</span></span> <span class="n"><span class="koboSpan" id="kobo.1725.1">Y</span></span><span class="p"><span class="koboSpan" id="kobo.1726.1">:</span></span> <span class="n"><span class="koboSpan" id="kobo.1727.1">test_labels</span></span><span class="p"><span class="koboSpan" id="kobo.1728.1">})</span></span>
        <span class="c1"><span class="koboSpan" id="kobo.1729.1">#print('Accuracy: ',score)</span></span>
    <span class="k"><span class="koboSpan" id="kobo.1730.1">return</span></span> <span class="n"><span class="koboSpan" id="kobo.1731.1">score</span></span><span class="p"><span class="koboSpan" id="kobo.1732.1">,</span></span></pre>
<ol start="8">
<li><span class="koboSpan" id="kobo.1733.1">So, now we are ready to implement</span><span><span class="koboSpan" id="kobo.1734.1"> </span></span><span><span class="koboSpan" id="kobo.1735.1">the </span></span><span class="koboSpan" id="kobo.1736.1">genetic algorithm: our fitness function will be a max function (</span><kbd><span class="koboSpan" id="kobo.1737.1">weights=(1.0,)</span></kbd><span class="koboSpan" id="kobo.1738.1">), we initialize the binary string using Bernoulli's distribution (</span><kbd><span class="koboSpan" id="kobo.1739.1">bernoulli.rvs</span></kbd><span class="koboSpan" id="kobo.1740.1">), the individuals are created of length</span><span><span class="koboSpan" id="kobo.1741.1"> </span></span><kbd><span class="koboSpan" id="kobo.1742.1">L= 19</span></kbd><span class="koboSpan" id="kobo.1743.1">, and the population is generated with each population consisting of</span><span><span class="koboSpan" id="kobo.1744.1"> </span></span><kbd><span class="koboSpan" id="kobo.1745.1">20</span></kbd><span><span class="koboSpan" id="kobo.1746.1"> </span></span><span class="koboSpan" id="kobo.1747.1">individuals. </span><span class="koboSpan" id="kobo.1747.2">This time, we chose an ordered crossover, where a substring is selected from the first parent and copied into the offspring in the same location; the remaining positions are filled from the second parent, ensuring the nodes in</span><span><span class="koboSpan" id="kobo.1748.1"> </span></span><span><span class="koboSpan" id="kobo.1749.1">the </span></span><span class="koboSpan" id="kobo.1750.1">sub-string are not repeated. </span><span class="koboSpan" id="kobo.1750.2">We kept the same mutation operator as before, </span><kbd><span class="koboSpan" id="kobo.1751.1">mutShuffleIndexes</span></kbd><span class="koboSpan" id="kobo.1752.1">; the tournament selection method is</span><span><span class="koboSpan" id="kobo.1753.1"> </span></span><kbd><span class="koboSpan" id="kobo.1754.1">selRoulette</span></kbd><span class="koboSpan" id="kobo.1755.1">, which makes the selection using</span><span><span class="koboSpan" id="kobo.1756.1"> </span></span><span><span class="koboSpan" id="kobo.1757.1">the </span></span><span class="koboSpan" id="kobo.1758.1">roulette wheel selection method (we choose</span><span><span class="koboSpan" id="kobo.1759.1"> </span></span><kbd><span class="koboSpan" id="kobo.1760.1">k</span></kbd><span><span class="koboSpan" id="kobo.1761.1"> </span></span><span class="koboSpan" id="kobo.1762.1">individuals and from them select the ones with the highest fitness). </span><span class="koboSpan" id="kobo.1762.2">This time, instead of coding the genetic algorithm, we make use of the DEAP eaSimple algorithm, which is the basic genetic algorithm:</span></li>
</ol>
<pre style="padding-left: 60px"><span class="koboSpan" id="kobo.1763.1">population_size = 20</span><br/><span class="koboSpan" id="kobo.1764.1">num_generations = 3</span><br/><span class="koboSpan" id="kobo.1765.1">creator.create("FitnessMax", base.Fitness, weights = (1.0,))</span><br/><span class="koboSpan" id="kobo.1766.1">creator.create("Individual", list , fitness = creator.FitnessMax)</span><br/><span class="koboSpan" id="kobo.1767.1">toolbox = base.Toolbox()</span><br/><span class="koboSpan" id="kobo.1768.1">toolbox.register("binary", bernoulli.rvs, 0.5)</span><br/><span class="koboSpan" id="kobo.1769.1">toolbox.register("individual", tools.initRepeat, creator.Individual, toolbox.binary, n = L)</span><br/><span class="koboSpan" id="kobo.1770.1">toolbox.register("population", tools.initRepeat, list , toolbox.individual)</span><br/><span class="koboSpan" id="kobo.1771.1">toolbox.register("mate", tools.cxOrdered)</span><br/><span class="koboSpan" id="kobo.1772.1">toolbox.register("mutate", tools.mutShuffleIndexes, indpb = 0.8)</span><br/><span class="koboSpan" id="kobo.1773.1">toolbox.register("select", tools.selRoulette)</span><br/><span class="koboSpan" id="kobo.1774.1">toolbox.register("evaluate", evaluateModel)</span><br/><span class="koboSpan" id="kobo.1775.1">popl = toolbox.population(n = population_size)</span><br/><br/><span class="koboSpan" id="kobo.1776.1">import time</span><br/><span class="koboSpan" id="kobo.1777.1">t = time.time()</span><br/><span class="koboSpan" id="kobo.1778.1">result = algorithms.eaSimple(popl, toolbox, cxpb = 0.4, mutpb = 0.05, ngen = num_generations, verbose = True)</span><br/><span class="koboSpan" id="kobo.1779.1">t1 = time.time() - t</span><br/><span class="koboSpan" id="kobo.1780.1">print(t1)</span></pre>
<ol start="9">
<li><span class="koboSpan" id="kobo.1781.1">The</span><span><span class="koboSpan" id="kobo.1782.1"> </span></span><span class="koboSpan" id="kobo.1783.1">algorithm will take some time; on i7 with NVIDIA 1070 GTX GPU it took about 1.5 hours. </span><span class="koboSpan" id="kobo.1783.2">The best three solutions are the following:</span></li>
</ol>
<pre style="padding-left: 60px"><span class="koboSpan" id="kobo.1784.1">best_individuals = tools.selBest(popl, k = 3)</span><br/><span class="koboSpan" id="kobo.1785.1">for bi in best_individuals:</span><br/><span class="koboSpan" id="kobo.1786.1">    print(bi)</span></pre>
<p class="CDPAlignCenter CDPAlign"><span class="koboSpan" id="kobo.1787.1"><img class="aligncenter size-full wp-image-993 image-border" src="assets/df1133c2-6bcc-49c0-9f8e-cb070b515cd3.png" style="width:33.75em;height:4.17em;"/></span></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title"><span class="koboSpan" id="kobo.1.1">Genetic algorithm for LSTM optimization</span></h1>
                </header>
            
            <article>
                
<p><span class="koboSpan" id="kobo.2.1">In a genetic CNN, we use </span><span><span class="koboSpan" id="kobo.3.1">genetic algorithm</span></span><span class="koboSpan" id="kobo.4.1">s to estimate the optimum CNN architecture; in genetic RNN, we will now use a genetic algorithm to find</span><span><span class="koboSpan" id="kobo.5.1"> </span></span><span><span class="koboSpan" id="kobo.6.1">the </span></span><span class="koboSpan" id="kobo.7.1">optimum hyperparameters of</span><span><span class="koboSpan" id="kobo.8.1"> </span></span><span><span class="koboSpan" id="kobo.9.1">the </span></span><span class="koboSpan" id="kobo.10.1">RNN, the window size, and the number of hidden units. </span><span class="koboSpan" id="kobo.10.2">We will find the parameters that reduce the</span><span><span class="koboSpan" id="kobo.11.1"> </span></span><strong><span class="koboSpan" id="kobo.12.1">root-mean-square error</span></strong><span><span class="koboSpan" id="kobo.13.1"> </span></span><span class="koboSpan" id="kobo.14.1">(</span><strong><span class="koboSpan" id="kobo.15.1">RMSE</span></strong><span class="koboSpan" id="kobo.16.1">) of the model.</span></p>
<p><span class="koboSpan" id="kobo.17.1">The hyperparameters window size and number of units are again encoded in a binary string with 6 bits for window size and 4 bits for the number of units. </span><span class="koboSpan" id="kobo.17.2">Thus, the complete encoded chromosome will be of 10 bits. </span><span class="koboSpan" id="kobo.17.3">The LSTM is implemented using Keras. </span></p>
<p class="mce-root"/>
<p class="mce-root"/>
<p><span class="koboSpan" id="kobo.18.1">The code we implement is taken from</span><span><span class="koboSpan" id="kobo.19.1"> </span></span><a href="https://github.com/aqibsaeed/Genetic-Algorithm-RNN"><span class="koboSpan" id="kobo.20.1">https://github.com/aqibsaeed/Genetic-Algorithm-RNN</span></a><span class="koboSpan" id="kobo.21.1">:</span></p>
<ol>
<li><span class="koboSpan" id="kobo.22.1">The necessary modules are imported. </span><span class="koboSpan" id="kobo.22.2">This time, we are using Keras to implement</span><span><span class="koboSpan" id="kobo.23.1"> </span></span><span><span class="koboSpan" id="kobo.24.1">the </span></span><span class="koboSpan" id="kobo.25.1">LSTM model:</span></li>
</ol>
<pre style="padding-left: 60px"><span class="kn"><span class="koboSpan" id="kobo.26.1">import</span></span> <span class="nn"><span class="koboSpan" id="kobo.27.1">numpy</span></span> <span class="k"><span class="koboSpan" id="kobo.28.1">as</span></span> <span class="nn"><span class="koboSpan" id="kobo.29.1">np</span></span>
<span class="kn"><span class="koboSpan" id="kobo.30.1">import</span></span> <span class="nn"><span class="koboSpan" id="kobo.31.1">pandas</span></span> <span class="k"><span class="koboSpan" id="kobo.32.1">as</span></span> <span class="nn"><span class="koboSpan" id="kobo.33.1">pd</span></span>
<span class="kn"><span class="koboSpan" id="kobo.34.1">from</span></span> <span class="nn"><span class="koboSpan" id="kobo.35.1">sklearn.metrics</span></span> <span class="k"><span class="koboSpan" id="kobo.36.1">import</span></span> <span class="n"><span class="koboSpan" id="kobo.37.1">mean_squared_error</span></span>
<span class="kn"><span class="koboSpan" id="kobo.38.1">from</span></span> <span class="nn"><span class="koboSpan" id="kobo.39.1">sklearn.model_selection</span></span> <span class="k"><span class="koboSpan" id="kobo.40.1">import</span></span> <span class="n"><span class="koboSpan" id="kobo.41.1">train_test_split</span></span> <span class="k"><span class="koboSpan" id="kobo.42.1">as</span></span> <span class="n"><span class="koboSpan" id="kobo.43.1">split</span></span>

<span class="kn"><span class="koboSpan" id="kobo.44.1">from</span></span> <span class="nn"><span class="koboSpan" id="kobo.45.1">keras.layers</span></span> <span class="k"><span class="koboSpan" id="kobo.46.1">import</span></span> <span class="n"><span class="koboSpan" id="kobo.47.1">LSTM</span></span><span class="p"><span class="koboSpan" id="kobo.48.1">,</span></span> <span class="n"><span class="koboSpan" id="kobo.49.1">Input</span></span><span class="p"><span class="koboSpan" id="kobo.50.1">,</span></span> <span class="n"><span class="koboSpan" id="kobo.51.1">Dense</span></span>
<span class="kn"><span class="koboSpan" id="kobo.52.1">from</span></span> <span class="nn"><span class="koboSpan" id="kobo.53.1">keras.models</span></span> <span class="k"><span class="koboSpan" id="kobo.54.1">import</span></span> <span class="n"><span class="koboSpan" id="kobo.55.1">Model</span></span>

<span class="kn"><span class="koboSpan" id="kobo.56.1">from</span></span> <span class="nn"><span class="koboSpan" id="kobo.57.1">deap</span></span> <span class="k"><span class="koboSpan" id="kobo.58.1">import</span></span> <span class="n"><span class="koboSpan" id="kobo.59.1">base</span></span><span class="p"><span class="koboSpan" id="kobo.60.1">,</span></span> <span class="n"><span class="koboSpan" id="kobo.61.1">creator</span></span><span class="p"><span class="koboSpan" id="kobo.62.1">,</span></span> <span class="n"><span class="koboSpan" id="kobo.63.1">tools</span></span><span class="p"><span class="koboSpan" id="kobo.64.1">,</span></span> <span class="n"><span class="koboSpan" id="kobo.65.1">algorithms</span></span>
<span class="kn"><span class="koboSpan" id="kobo.66.1">from</span></span> <span class="nn"><span class="koboSpan" id="kobo.67.1">scipy.stats</span></span> <span class="k"><span class="koboSpan" id="kobo.68.1">import</span></span> <span class="n"><span class="koboSpan" id="kobo.69.1">bernoulli</span></span>
<span class="kn"><span class="koboSpan" id="kobo.70.1">from</span></span> <span class="nn"><span class="koboSpan" id="kobo.71.1">bitstring</span></span> <span class="k"><span class="koboSpan" id="kobo.72.1">import</span></span> <span class="n"><span class="koboSpan" id="kobo.73.1">BitArray</span></span>

<span class="n"><span class="koboSpan" id="kobo.74.1">np</span></span><span class="o"><span class="koboSpan" id="kobo.75.1">.</span></span><span class="n"><span class="koboSpan" id="kobo.76.1">random</span></span><span class="o"><span class="koboSpan" id="kobo.77.1">.</span></span><span class="n"><span class="koboSpan" id="kobo.78.1">seed</span></span><span class="p"><span class="koboSpan" id="kobo.79.1">(</span></span><span class="mi"><span class="koboSpan" id="kobo.80.1">1120</span></span><span class="p"><span class="koboSpan" id="kobo.81.1">)</span></span></pre>
<ol start="2">
<li><span class="koboSpan" id="kobo.82.1">The dataset we need for LSTM has to be time series data; we use the wind-power forecasting data from Kaggle (</span><a href="https://www.kaggle.com/c/GEF2012-wind-forecasting/data"><span class="koboSpan" id="kobo.83.1">https://www.kaggle.com/c/GEF2012-wind-forecasting/data</span></a><span class="koboSpan" id="kobo.84.1">):</span></li>
</ol>
<pre style="padding-left: 60px"><span class="n"><span class="koboSpan" id="kobo.85.1">data</span></span> <span class="o"><span class="koboSpan" id="kobo.86.1">=</span></span> <span class="n"><span class="koboSpan" id="kobo.87.1">pd</span></span><span class="o"><span class="koboSpan" id="kobo.88.1">.</span></span><span class="n"><span class="koboSpan" id="kobo.89.1">read_csv</span></span><span class="p"><span class="koboSpan" id="kobo.90.1">(</span></span><span class="s1"><span class="koboSpan" id="kobo.91.1">'train.csv'</span></span><span class="p"><span class="koboSpan" id="kobo.92.1">)</span></span>
<span class="n"><span class="koboSpan" id="kobo.93.1">data</span></span> <span class="o"><span class="koboSpan" id="kobo.94.1">=</span></span> <span class="n"><span class="koboSpan" id="kobo.95.1">np</span></span><span class="o"><span class="koboSpan" id="kobo.96.1">.</span></span><span class="n"><span class="koboSpan" id="kobo.97.1">reshape</span></span><span class="p"><span class="koboSpan" id="kobo.98.1">(</span></span><span class="n"><span class="koboSpan" id="kobo.99.1">np</span></span><span class="o"><span class="koboSpan" id="kobo.100.1">.</span></span><span class="n"><span class="koboSpan" id="kobo.101.1">array</span></span><span class="p"><span class="koboSpan" id="kobo.102.1">(</span></span><span class="n"><span class="koboSpan" id="kobo.103.1">data</span></span><span class="p"><span class="koboSpan" id="kobo.104.1">[</span></span><span class="s1"><span class="koboSpan" id="kobo.105.1">'wp1'</span></span><span class="p"><span class="koboSpan" id="kobo.106.1">]),(</span></span><span class="nb"><span class="koboSpan" id="kobo.107.1">len</span></span><span class="p"><span class="koboSpan" id="kobo.108.1">(</span></span><span class="n"><span class="koboSpan" id="kobo.109.1">data</span></span><span class="p"><span class="koboSpan" id="kobo.110.1">[</span></span><span class="s1"><span class="koboSpan" id="kobo.111.1">'wp1'</span></span><span class="p"><span class="koboSpan" id="kobo.112.1">]),</span></span><span class="mi"><span class="koboSpan" id="kobo.113.1">1</span></span><span class="p"><span class="koboSpan" id="kobo.114.1">))</span></span>

<span class="n"><span class="koboSpan" id="kobo.115.1">train_data</span></span> <span class="o"><span class="koboSpan" id="kobo.116.1">=</span></span> <span class="n"><span class="koboSpan" id="kobo.117.1">data</span></span><span class="p"><span class="koboSpan" id="kobo.118.1">[</span></span><span class="mi"><span class="koboSpan" id="kobo.119.1">0</span></span><span class="p"><span class="koboSpan" id="kobo.120.1">:</span></span><span class="mi"><span class="koboSpan" id="kobo.121.1">17257</span></span><span class="p"><span class="koboSpan" id="kobo.122.1">]</span></span>
<span class="n"><span class="koboSpan" id="kobo.123.1">test_data</span></span> <span class="o"><span class="koboSpan" id="kobo.124.1">=</span></span> <span class="n"><span class="koboSpan" id="kobo.125.1">data</span></span><span class="p"><span class="koboSpan" id="kobo.126.1">[</span></span><span class="mi"><span class="koboSpan" id="kobo.127.1">17257</span></span><span class="p"><span class="koboSpan" id="kobo.128.1">:]</span></span></pre>
<ol start="3">
<li><span class="koboSpan" id="kobo.129.1">Define a function to prepare the dataset depending upon the chosen</span><span><span class="koboSpan" id="kobo.130.1"> </span></span><kbd><span class="koboSpan" id="kobo.131.1">window_size</span></kbd><span class="koboSpan" id="kobo.132.1">:</span></li>
</ol>
<pre style="padding-left: 60px"><span class="k"><span class="koboSpan" id="kobo.133.1">def</span></span> <span class="nf"><span class="koboSpan" id="kobo.134.1">prepare_dataset</span></span><span class="p"><span class="koboSpan" id="kobo.135.1">(</span></span><span class="n"><span class="koboSpan" id="kobo.136.1">data</span></span><span class="p"><span class="koboSpan" id="kobo.137.1">,</span></span> <span class="n"><span class="koboSpan" id="kobo.138.1">window_size</span></span><span class="p"><span class="koboSpan" id="kobo.139.1">):</span></span>
    <span class="n"><span class="koboSpan" id="kobo.140.1">X</span></span><span class="p"><span class="koboSpan" id="kobo.141.1">,</span></span> <span class="n"><span class="koboSpan" id="kobo.142.1">Y</span></span> <span class="o"><span class="koboSpan" id="kobo.143.1">=</span></span> <span class="n"><span class="koboSpan" id="kobo.144.1">np</span></span><span class="o"><span class="koboSpan" id="kobo.145.1">.</span></span><span class="n"><span class="koboSpan" id="kobo.146.1">empty</span></span><span class="p"><span class="koboSpan" id="kobo.147.1">((</span></span><span class="mi"><span class="koboSpan" id="kobo.148.1">0</span></span><span class="p"><span class="koboSpan" id="kobo.149.1">,</span></span><span class="n"><span class="koboSpan" id="kobo.150.1">window_size</span></span><span class="p"><span class="koboSpan" id="kobo.151.1">)),</span></span> <span class="n"><span class="koboSpan" id="kobo.152.1">np</span></span><span class="o"><span class="koboSpan" id="kobo.153.1">.</span></span><span class="n"><span class="koboSpan" id="kobo.154.1">empty</span></span><span class="p"><span class="koboSpan" id="kobo.155.1">((</span></span><span class="mi"><span class="koboSpan" id="kobo.156.1">0</span></span><span class="p"><span class="koboSpan" id="kobo.157.1">))</span></span>
    <span class="k"><span class="koboSpan" id="kobo.158.1">for</span></span> <span class="n"><span class="koboSpan" id="kobo.159.1">i</span></span> <span class="ow"><span class="koboSpan" id="kobo.160.1">in</span></span> <span class="nb"><span class="koboSpan" id="kobo.161.1">range</span></span><span class="p"><span class="koboSpan" id="kobo.162.1">(</span></span><span class="nb"><span class="koboSpan" id="kobo.163.1">len</span></span><span class="p"><span class="koboSpan" id="kobo.164.1">(</span></span><span class="n"><span class="koboSpan" id="kobo.165.1">data</span></span><span class="p"><span class="koboSpan" id="kobo.166.1">)</span></span><span class="o"><span class="koboSpan" id="kobo.167.1">-</span></span><span class="n"><span class="koboSpan" id="kobo.168.1">window_size</span></span><span class="o"><span class="koboSpan" id="kobo.169.1">-</span></span><span class="mi"><span class="koboSpan" id="kobo.170.1">1</span></span><span class="p"><span class="koboSpan" id="kobo.171.1">):</span></span>
        <span class="n"><span class="koboSpan" id="kobo.172.1">X</span></span> <span class="o"><span class="koboSpan" id="kobo.173.1">=</span></span> <span class="n"><span class="koboSpan" id="kobo.174.1">np</span></span><span class="o"><span class="koboSpan" id="kobo.175.1">.</span></span><span class="n"><span class="koboSpan" id="kobo.176.1">vstack</span></span><span class="p"><span class="koboSpan" id="kobo.177.1">([</span></span><span class="n"><span class="koboSpan" id="kobo.178.1">X</span></span><span class="p"><span class="koboSpan" id="kobo.179.1">,</span></span><span class="n"><span class="koboSpan" id="kobo.180.1">data</span></span><span class="p"><span class="koboSpan" id="kobo.181.1">[</span></span><span class="n"><span class="koboSpan" id="kobo.182.1">i</span></span><span class="p"><span class="koboSpan" id="kobo.183.1">:(</span></span><span class="n"><span class="koboSpan" id="kobo.184.1">i</span></span> <span class="o"><span class="koboSpan" id="kobo.185.1">+</span></span> <span class="n"><span class="koboSpan" id="kobo.186.1">window_size</span></span><span class="p"><span class="koboSpan" id="kobo.187.1">),</span></span><span class="mi"><span class="koboSpan" id="kobo.188.1">0</span></span><span class="p"><span class="koboSpan" id="kobo.189.1">]])</span></span>
        <span class="n"><span class="koboSpan" id="kobo.190.1">Y</span></span> <span class="o"><span class="koboSpan" id="kobo.191.1">=</span></span> <span class="n"><span class="koboSpan" id="kobo.192.1">np</span></span><span class="o"><span class="koboSpan" id="kobo.193.1">.</span></span><span class="n"><span class="koboSpan" id="kobo.194.1">append</span></span><span class="p"><span class="koboSpan" id="kobo.195.1">(</span></span><span class="n"><span class="koboSpan" id="kobo.196.1">Y</span></span><span class="p"><span class="koboSpan" id="kobo.197.1">,</span></span><span class="n"><span class="koboSpan" id="kobo.198.1">data</span></span><span class="p"><span class="koboSpan" id="kobo.199.1">[</span></span><span class="n"><span class="koboSpan" id="kobo.200.1">i</span></span> <span class="o"><span class="koboSpan" id="kobo.201.1">+</span></span> <span class="n"><span class="koboSpan" id="kobo.202.1">window_size</span></span><span class="p"><span class="koboSpan" id="kobo.203.1">,</span></span><span class="mi"><span class="koboSpan" id="kobo.204.1">0</span></span><span class="p"><span class="koboSpan" id="kobo.205.1">])</span></span>   
    <span class="n"><span class="koboSpan" id="kobo.206.1">X</span></span> <span class="o"><span class="koboSpan" id="kobo.207.1">=</span></span> <span class="n"><span class="koboSpan" id="kobo.208.1">np</span></span><span class="o"><span class="koboSpan" id="kobo.209.1">.</span></span><span class="n"><span class="koboSpan" id="kobo.210.1">reshape</span></span><span class="p"><span class="koboSpan" id="kobo.211.1">(</span></span><span class="n"><span class="koboSpan" id="kobo.212.1">X</span></span><span class="p"><span class="koboSpan" id="kobo.213.1">,(</span></span><span class="nb"><span class="koboSpan" id="kobo.214.1">len</span></span><span class="p"><span class="koboSpan" id="kobo.215.1">(</span></span><span class="n"><span class="koboSpan" id="kobo.216.1">X</span></span><span class="p"><span class="koboSpan" id="kobo.217.1">),</span></span><span class="n"><span class="koboSpan" id="kobo.218.1">window_size</span></span><span class="p"><span class="koboSpan" id="kobo.219.1">,</span></span><span class="mi"><span class="koboSpan" id="kobo.220.1">1</span></span><span class="p"><span class="koboSpan" id="kobo.221.1">))</span></span>
    <span class="n"><span class="koboSpan" id="kobo.222.1">Y</span></span> <span class="o"><span class="koboSpan" id="kobo.223.1">=</span></span> <span class="n"><span class="koboSpan" id="kobo.224.1">np</span></span><span class="o"><span class="koboSpan" id="kobo.225.1">.</span></span><span class="n"><span class="koboSpan" id="kobo.226.1">reshape</span></span><span class="p"><span class="koboSpan" id="kobo.227.1">(</span></span><span class="n"><span class="koboSpan" id="kobo.228.1">Y</span></span><span class="p"><span class="koboSpan" id="kobo.229.1">,(</span></span><span class="nb"><span class="koboSpan" id="kobo.230.1">len</span></span><span class="p"><span class="koboSpan" id="kobo.231.1">(</span></span><span class="n"><span class="koboSpan" id="kobo.232.1">Y</span></span><span class="p"><span class="koboSpan" id="kobo.233.1">),</span></span><span class="mi"><span class="koboSpan" id="kobo.234.1">1</span></span><span class="p"><span class="koboSpan" id="kobo.235.1">))</span></span>
    <span class="k"><span class="koboSpan" id="kobo.236.1">return</span></span> <span class="n"><span class="koboSpan" id="kobo.237.1">X</span></span><span class="p"><span class="koboSpan" id="kobo.238.1">,</span></span> <span class="n"><span class="koboSpan" id="kobo.239.1">Y</span></span></pre>
<p class="mce-root"/>
<p class="mce-root"/>
<ol start="4">
<li><span class="koboSpan" id="kobo.240.1">The</span><span><span class="koboSpan" id="kobo.241.1"> </span></span><kbd><span class="koboSpan" id="kobo.242.1">train_evaluate</span></kbd><span class="koboSpan" id="kobo.243.1"> function creates the LSTM network for a given individual and returns its RMSE value (fitness function):</span></li>
</ol>
<pre style="padding-left: 60px"><span class="k"><span class="koboSpan" id="kobo.244.1">def</span></span> <span class="nf"><span class="koboSpan" id="kobo.245.1">train_evaluate</span></span><span class="p"><span class="koboSpan" id="kobo.246.1">(</span></span><span class="n"><span class="koboSpan" id="kobo.247.1">ga_individual_solution</span></span><span class="p"><span class="koboSpan" id="kobo.248.1">):</span></span>   
    <span class="c1"><span class="koboSpan" id="kobo.249.1"># Decode genetic algorithm solution to integer for window_size and num_units</span></span>
    <span class="n"><span class="koboSpan" id="kobo.250.1">window_size_bits</span></span> <span class="o"><span class="koboSpan" id="kobo.251.1">=</span></span> <span class="n"><span class="koboSpan" id="kobo.252.1">BitArray</span></span><span class="p"><span class="koboSpan" id="kobo.253.1">(</span></span><span class="n"><span class="koboSpan" id="kobo.254.1">ga_individual_solution</span></span><span class="p"><span class="koboSpan" id="kobo.255.1">[</span></span><span class="mi"><span class="koboSpan" id="kobo.256.1">0</span></span><span class="p"><span class="koboSpan" id="kobo.257.1">:</span></span><span class="mi"><span class="koboSpan" id="kobo.258.1">6</span></span><span class="p"><span class="koboSpan" id="kobo.259.1">])</span></span>
    <span class="n"><span class="koboSpan" id="kobo.260.1">num_units_bits</span></span> <span class="o"><span class="koboSpan" id="kobo.261.1">=</span></span> <span class="n"><span class="koboSpan" id="kobo.262.1">BitArray</span></span><span class="p"><span class="koboSpan" id="kobo.263.1">(</span></span><span class="n"><span class="koboSpan" id="kobo.264.1">ga_individual_solution</span></span><span class="p"><span class="koboSpan" id="kobo.265.1">[</span></span><span class="mi"><span class="koboSpan" id="kobo.266.1">6</span></span><span class="p"><span class="koboSpan" id="kobo.267.1">:])</span></span> 
    <span class="n"><span class="koboSpan" id="kobo.268.1">window_size</span></span> <span class="o"><span class="koboSpan" id="kobo.269.1">=</span></span> <span class="n"><span class="koboSpan" id="kobo.270.1">window_size_bits</span></span><span class="o"><span class="koboSpan" id="kobo.271.1">.</span></span><span class="n"><span class="koboSpan" id="kobo.272.1">uint</span></span>
    <span class="n"><span class="koboSpan" id="kobo.273.1">num_units</span></span> <span class="o"><span class="koboSpan" id="kobo.274.1">=</span></span> <span class="n"><span class="koboSpan" id="kobo.275.1">num_units_bits</span></span><span class="o"><span class="koboSpan" id="kobo.276.1">.</span></span><span class="n"><span class="koboSpan" id="kobo.277.1">uint</span></span>
    <span class="nb"><span class="koboSpan" id="kobo.278.1">print</span></span><span class="p"><span class="koboSpan" id="kobo.279.1">(</span></span><span class="s1"><span class="koboSpan" id="kobo.280.1">'</span></span><span class="se"><span class="koboSpan" id="kobo.281.1">\n</span></span><span class="s1"><span class="koboSpan" id="kobo.282.1">Window Size: '</span></span><span class="p"><span class="koboSpan" id="kobo.283.1">,</span></span> <span class="n"><span class="koboSpan" id="kobo.284.1">window_size</span></span><span class="p"><span class="koboSpan" id="kobo.285.1">,</span></span> <span class="s1"><span class="koboSpan" id="kobo.286.1">', Num of Units: '</span></span><span class="p"><span class="koboSpan" id="kobo.287.1">,</span></span> <span class="n"><span class="koboSpan" id="kobo.288.1">num_units</span></span><span class="p"><span class="koboSpan" id="kobo.289.1">)</span></span>
    
    <span class="c1"><span class="koboSpan" id="kobo.290.1"># Return fitness score of 100 if window_size or num_unit is zero</span></span>
    <span class="k"><span class="koboSpan" id="kobo.291.1">if</span></span> <span class="n"><span class="koboSpan" id="kobo.292.1">window_size</span></span> <span class="o"><span class="koboSpan" id="kobo.293.1">==</span></span> <span class="mi"><span class="koboSpan" id="kobo.294.1">0</span></span> <span class="ow"><span class="koboSpan" id="kobo.295.1">or</span></span> <span class="n"><span class="koboSpan" id="kobo.296.1">num_units</span></span> <span class="o"><span class="koboSpan" id="kobo.297.1">==</span></span> <span class="mi"><span class="koboSpan" id="kobo.298.1">0</span></span><span class="p"><span class="koboSpan" id="kobo.299.1">:</span></span>
        <span class="k"><span class="koboSpan" id="kobo.300.1">return</span></span> <span class="mi"><span class="koboSpan" id="kobo.301.1">100</span></span><span class="p"><span class="koboSpan" id="kobo.302.1">,</span></span> 
    
    <span class="c1"><span class="koboSpan" id="kobo.303.1"># Segment the train_data based on new window_size; split into train and validation (80/20)</span></span>
    <span class="n"><span class="koboSpan" id="kobo.304.1">X</span></span><span class="p"><span class="koboSpan" id="kobo.305.1">,</span></span><span class="n"><span class="koboSpan" id="kobo.306.1">Y</span></span> <span class="o"><span class="koboSpan" id="kobo.307.1">=</span></span> <span class="n"><span class="koboSpan" id="kobo.308.1">prepare_dataset</span></span><span class="p"><span class="koboSpan" id="kobo.309.1">(</span></span><span class="n"><span class="koboSpan" id="kobo.310.1">train_data</span></span><span class="p"><span class="koboSpan" id="kobo.311.1">,</span></span><span class="n"><span class="koboSpan" id="kobo.312.1">window_size</span></span><span class="p"><span class="koboSpan" id="kobo.313.1">)</span></span>
    <span class="n"><span class="koboSpan" id="kobo.314.1">X_train</span></span><span class="p"><span class="koboSpan" id="kobo.315.1">,</span></span> <span class="n"><span class="koboSpan" id="kobo.316.1">X_val</span></span><span class="p"><span class="koboSpan" id="kobo.317.1">,</span></span> <span class="n"><span class="koboSpan" id="kobo.318.1">y_train</span></span><span class="p"><span class="koboSpan" id="kobo.319.1">,</span></span> <span class="n"><span class="koboSpan" id="kobo.320.1">y_val</span></span> <span class="o"><span class="koboSpan" id="kobo.321.1">=</span></span> <span class="n"><span class="koboSpan" id="kobo.322.1">split</span></span><span class="p"><span class="koboSpan" id="kobo.323.1">(</span></span><span class="n"><span class="koboSpan" id="kobo.324.1">X</span></span><span class="p"><span class="koboSpan" id="kobo.325.1">,</span></span> <span class="n"><span class="koboSpan" id="kobo.326.1">Y</span></span><span class="p"><span class="koboSpan" id="kobo.327.1">,</span></span> <span class="n"><span class="koboSpan" id="kobo.328.1">test_size</span></span> <span class="o"><span class="koboSpan" id="kobo.329.1">=</span></span> <span class="mf"><span class="koboSpan" id="kobo.330.1">0.20</span></span><span class="p"><span class="koboSpan" id="kobo.331.1">,</span></span> <span class="n"><span class="koboSpan" id="kobo.332.1">random_state</span></span> <span class="o"><span class="koboSpan" id="kobo.333.1">=</span></span> <span class="mi"><span class="koboSpan" id="kobo.334.1">1120</span></span><span class="p"><span class="koboSpan" id="kobo.335.1">)</span></span>
    
    <span class="c1"><span class="koboSpan" id="kobo.336.1"># Train LSTM model and predict on validation set</span></span>
    <span class="n"><span class="koboSpan" id="kobo.337.1">inputs</span></span> <span class="o"><span class="koboSpan" id="kobo.338.1">=</span></span> <span class="n"><span class="koboSpan" id="kobo.339.1">Input</span></span><span class="p"><span class="koboSpan" id="kobo.340.1">(</span></span><span class="n"><span class="koboSpan" id="kobo.341.1">shape</span></span><span class="o"><span class="koboSpan" id="kobo.342.1">=</span></span><span class="p"><span class="koboSpan" id="kobo.343.1">(</span></span><span class="n"><span class="koboSpan" id="kobo.344.1">window_size</span></span><span class="p"><span class="koboSpan" id="kobo.345.1">,</span></span><span class="mi"><span class="koboSpan" id="kobo.346.1">1</span></span><span class="p"><span class="koboSpan" id="kobo.347.1">))</span></span>
    <span class="n"><span class="koboSpan" id="kobo.348.1">x</span></span> <span class="o"><span class="koboSpan" id="kobo.349.1">=</span></span> <span class="n"><span class="koboSpan" id="kobo.350.1">LSTM</span></span><span class="p"><span class="koboSpan" id="kobo.351.1">(</span></span><span class="n"><span class="koboSpan" id="kobo.352.1">num_units</span></span><span class="p"><span class="koboSpan" id="kobo.353.1">,</span></span> <span class="n"><span class="koboSpan" id="kobo.354.1">input_shape</span></span><span class="o"><span class="koboSpan" id="kobo.355.1">=</span></span><span class="p"><span class="koboSpan" id="kobo.356.1">(</span></span><span class="n"><span class="koboSpan" id="kobo.357.1">window_size</span></span><span class="p"><span class="koboSpan" id="kobo.358.1">,</span></span><span class="mi"><span class="koboSpan" id="kobo.359.1">1</span></span><span class="p"><span class="koboSpan" id="kobo.360.1">))(</span></span><span class="n"><span class="koboSpan" id="kobo.361.1">inputs</span></span><span class="p"><span class="koboSpan" id="kobo.362.1">)</span></span>
    <span class="n"><span class="koboSpan" id="kobo.363.1">predictions</span></span> <span class="o"><span class="koboSpan" id="kobo.364.1">=</span></span> <span class="n"><span class="koboSpan" id="kobo.365.1">Dense</span></span><span class="p"><span class="koboSpan" id="kobo.366.1">(</span></span><span class="mi"><span class="koboSpan" id="kobo.367.1">1</span></span><span class="p"><span class="koboSpan" id="kobo.368.1">,</span></span> <span class="n"><span class="koboSpan" id="kobo.369.1">activation</span></span><span class="o"><span class="koboSpan" id="kobo.370.1">=</span></span><span class="s1"><span class="koboSpan" id="kobo.371.1">'linear'</span></span><span class="p"><span class="koboSpan" id="kobo.372.1">)(</span></span><span class="n"><span class="koboSpan" id="kobo.373.1">x</span></span><span class="p"><span class="koboSpan" id="kobo.374.1">)</span></span>
    <span class="n"><span class="koboSpan" id="kobo.375.1">model</span></span> <span class="o"><span class="koboSpan" id="kobo.376.1">=</span></span> <span class="n"><span class="koboSpan" id="kobo.377.1">Model</span></span><span class="p"><span class="koboSpan" id="kobo.378.1">(</span></span><span class="n"><span class="koboSpan" id="kobo.379.1">inputs</span></span><span class="o"><span class="koboSpan" id="kobo.380.1">=</span></span><span class="n"><span class="koboSpan" id="kobo.381.1">inputs</span></span><span class="p"><span class="koboSpan" id="kobo.382.1">,</span></span> <span class="n"><span class="koboSpan" id="kobo.383.1">outputs</span></span><span class="o"><span class="koboSpan" id="kobo.384.1">=</span></span><span class="n"><span class="koboSpan" id="kobo.385.1">predictions</span></span><span class="p"><span class="koboSpan" id="kobo.386.1">)</span></span>
    <span class="n"><span class="koboSpan" id="kobo.387.1">model</span></span><span class="o"><span class="koboSpan" id="kobo.388.1">.</span></span><span class="n"><span class="koboSpan" id="kobo.389.1">compile</span></span><span class="p"><span class="koboSpan" id="kobo.390.1">(</span></span><span class="n"><span class="koboSpan" id="kobo.391.1">optimizer</span></span><span class="o"><span class="koboSpan" id="kobo.392.1">=</span></span><span class="s1"><span class="koboSpan" id="kobo.393.1">'adam'</span></span><span class="p"><span class="koboSpan" id="kobo.394.1">,</span></span><span class="n"><span class="koboSpan" id="kobo.395.1">loss</span></span><span class="o"><span class="koboSpan" id="kobo.396.1">=</span></span><span class="s1"><span class="koboSpan" id="kobo.397.1">'mean_squared_error'</span></span><span class="p"><span class="koboSpan" id="kobo.398.1">)</span></span>
    <span class="n"><span class="koboSpan" id="kobo.399.1">model</span></span><span class="o"><span class="koboSpan" id="kobo.400.1">.</span></span><span class="n"><span class="koboSpan" id="kobo.401.1">fit</span></span><span class="p"><span class="koboSpan" id="kobo.402.1">(</span></span><span class="n"><span class="koboSpan" id="kobo.403.1">X_train</span></span><span class="p"><span class="koboSpan" id="kobo.404.1">,</span></span> <span class="n"><span class="koboSpan" id="kobo.405.1">y_train</span></span><span class="p"><span class="koboSpan" id="kobo.406.1">,</span></span> <span class="n"><span class="koboSpan" id="kobo.407.1">epochs</span></span><span class="o"><span class="koboSpan" id="kobo.408.1">=</span></span><span class="mi"><span class="koboSpan" id="kobo.409.1">5</span></span><span class="p"><span class="koboSpan" id="kobo.410.1">,</span></span> <span class="n"><span class="koboSpan" id="kobo.411.1">batch_size</span></span><span class="o"><span class="koboSpan" id="kobo.412.1">=</span></span><span class="mi"><span class="koboSpan" id="kobo.413.1">10</span></span><span class="p"><span class="koboSpan" id="kobo.414.1">,</span></span><span class="n"><span class="koboSpan" id="kobo.415.1">shuffle</span></span><span class="o"><span class="koboSpan" id="kobo.416.1">=</span></span><span class="kc"><span class="koboSpan" id="kobo.417.1">True</span></span><span class="p"><span class="koboSpan" id="kobo.418.1">)</span></span>
    <span class="n"><span class="koboSpan" id="kobo.419.1">y_pred</span></span> <span class="o"><span class="koboSpan" id="kobo.420.1">=</span></span> <span class="n"><span class="koboSpan" id="kobo.421.1">model</span></span><span class="o"><span class="koboSpan" id="kobo.422.1">.</span></span><span class="n"><span class="koboSpan" id="kobo.423.1">predict</span></span><span class="p"><span class="koboSpan" id="kobo.424.1">(</span></span><span class="n"><span class="koboSpan" id="kobo.425.1">X_val</span></span><span class="p"><span class="koboSpan" id="kobo.426.1">)</span></span>
    
    <span class="c1"><span class="koboSpan" id="kobo.427.1"># Calculate the RMSE score as fitness score for GA</span></span>
    <span class="n"><span class="koboSpan" id="kobo.428.1">rmse</span></span> <span class="o"><span class="koboSpan" id="kobo.429.1">=</span></span> <span class="n"><span class="koboSpan" id="kobo.430.1">np</span></span><span class="o"><span class="koboSpan" id="kobo.431.1">.</span></span><span class="n"><span class="koboSpan" id="kobo.432.1">sqrt</span></span><span class="p"><span class="koboSpan" id="kobo.433.1">(</span></span><span class="n"><span class="koboSpan" id="kobo.434.1">mean_squared_error</span></span><span class="p"><span class="koboSpan" id="kobo.435.1">(</span></span><span class="n"><span class="koboSpan" id="kobo.436.1">y_val</span></span><span class="p"><span class="koboSpan" id="kobo.437.1">,</span></span> <span class="n"><span class="koboSpan" id="kobo.438.1">y_pred</span></span><span class="p"><span class="koboSpan" id="kobo.439.1">))</span></span>
    <span class="nb"><span class="koboSpan" id="kobo.440.1">print</span></span><span class="p"><span class="koboSpan" id="kobo.441.1">(</span></span><span class="s1"><span class="koboSpan" id="kobo.442.1">'Validation RMSE: '</span></span><span class="p"><span class="koboSpan" id="kobo.443.1">,</span></span> <span class="n"><span class="koboSpan" id="kobo.444.1">rmse</span></span><span class="p"><span class="koboSpan" id="kobo.445.1">,</span></span><span class="s1"><span class="koboSpan" id="kobo.446.1">'</span></span><span class="se"><span class="koboSpan" id="kobo.447.1">\n</span></span><span class="s1"><span class="koboSpan" id="kobo.448.1">'</span></span><span class="p"><span class="koboSpan" id="kobo.449.1">)</span></span>
    
    <span class="k"><span class="koboSpan" id="kobo.450.1">return</span></span> <span class="n"><span class="koboSpan" id="kobo.451.1">rmse</span></span><span class="p"><span class="koboSpan" id="kobo.452.1">,</span></span></pre>
<ol start="5">
<li><span class="koboSpan" id="kobo.453.1">Next, we use DEAP tools to define Individual (again, since the chromosome is represented by a binary encoded string (10 bits), we use Bernoulli's distribution), create the population, use ordered crossover, use mutShuffleIndexes mutation, and use the roulette wheel selection for selecting the parents:</span></li>
</ol>
<pre style="padding-left: 60px"><span class="n"><span class="koboSpan" id="kobo.454.1">population_size</span></span> <span class="o"><span class="koboSpan" id="kobo.455.1">=</span></span> <span class="mi"><span class="koboSpan" id="kobo.456.1">4</span></span>
<span class="n"><span class="koboSpan" id="kobo.457.1">num_generations</span></span> <span class="o"><span class="koboSpan" id="kobo.458.1">=</span></span> <span class="mi"><span class="koboSpan" id="kobo.459.1">4</span></span>
<span class="n"><span class="koboSpan" id="kobo.460.1">gene_length</span></span> <span class="o"><span class="koboSpan" id="kobo.461.1">=</span></span> <span class="mi"><span class="koboSpan" id="kobo.462.1">10</span></span>

<span class="c1"><span class="koboSpan" id="kobo.463.1"># As we are trying to minimize the RMSE score, that's why using -1.0. </span></span>
<span class="c1"><span class="koboSpan" id="kobo.464.1"># In case, when you want to maximize accuracy for instance, use 1.0</span></span>
<span class="n"><span class="koboSpan" id="kobo.465.1">creator</span></span><span class="o"><span class="koboSpan" id="kobo.466.1">.</span></span><span class="n"><span class="koboSpan" id="kobo.467.1">create</span></span><span class="p"><span class="koboSpan" id="kobo.468.1">(</span></span><span class="s1"><span class="koboSpan" id="kobo.469.1">'FitnessMax'</span></span><span class="p"><span class="koboSpan" id="kobo.470.1">,</span></span> <span class="n"><span class="koboSpan" id="kobo.471.1">base</span></span><span class="o"><span class="koboSpan" id="kobo.472.1">.</span></span><span class="n"><span class="koboSpan" id="kobo.473.1">Fitness</span></span><span class="p"><span class="koboSpan" id="kobo.474.1">,</span></span> <span class="n"><span class="koboSpan" id="kobo.475.1">weights</span></span> <span class="o"><span class="koboSpan" id="kobo.476.1">=</span></span> <span class="p"><span class="koboSpan" id="kobo.477.1">(</span></span><span class="o"><span class="koboSpan" id="kobo.478.1">-</span></span><span class="mf"><span class="koboSpan" id="kobo.479.1">1.0</span></span><span class="p"><span class="koboSpan" id="kobo.480.1">,))</span></span>
<span class="n"><span class="koboSpan" id="kobo.481.1">creator</span></span><span class="o"><span class="koboSpan" id="kobo.482.1">.</span></span><span class="n"><span class="koboSpan" id="kobo.483.1">create</span></span><span class="p"><span class="koboSpan" id="kobo.484.1">(</span></span><span class="s1"><span class="koboSpan" id="kobo.485.1">'Individual'</span></span><span class="p"><span class="koboSpan" id="kobo.486.1">,</span></span> <span class="nb"><span class="koboSpan" id="kobo.487.1">list</span></span> <span class="p"><span class="koboSpan" id="kobo.488.1">,</span></span> <span class="n"><span class="koboSpan" id="kobo.489.1">fitness</span></span> <span class="o"><span class="koboSpan" id="kobo.490.1">=</span></span> <span class="n"><span class="koboSpan" id="kobo.491.1">creator</span></span><span class="o"><span class="koboSpan" id="kobo.492.1">.</span></span><span class="n"><span class="koboSpan" id="kobo.493.1">FitnessMax</span></span><span class="p"><span class="koboSpan" id="kobo.494.1">)</span></span>

<span class="n"><span class="koboSpan" id="kobo.495.1">toolbox</span></span> <span class="o"><span class="koboSpan" id="kobo.496.1">=</span></span> <span class="n"><span class="koboSpan" id="kobo.497.1">base</span></span><span class="o"><span class="koboSpan" id="kobo.498.1">.</span></span><span class="n"><span class="koboSpan" id="kobo.499.1">Toolbox</span></span><span class="p"><span class="koboSpan" id="kobo.500.1">()</span></span>
<span class="n"><span class="koboSpan" id="kobo.501.1">toolbox</span></span><span class="o"><span class="koboSpan" id="kobo.502.1">.</span></span><span class="n"><span class="koboSpan" id="kobo.503.1">register</span></span><span class="p"><span class="koboSpan" id="kobo.504.1">(</span></span><span class="s1"><span class="koboSpan" id="kobo.505.1">'binary'</span></span><span class="p"><span class="koboSpan" id="kobo.506.1">,</span></span> <span class="n"><span class="koboSpan" id="kobo.507.1">bernoulli</span></span><span class="o"><span class="koboSpan" id="kobo.508.1">.</span></span><span class="n"><span class="koboSpan" id="kobo.509.1">rvs</span></span><span class="p"><span class="koboSpan" id="kobo.510.1">,</span></span> <span class="mf"><span class="koboSpan" id="kobo.511.1">0.5</span></span><span class="p"><span class="koboSpan" id="kobo.512.1">)</span></span>
<span class="n"><span class="koboSpan" id="kobo.513.1">toolbox</span></span><span class="o"><span class="koboSpan" id="kobo.514.1">.</span></span><span class="n"><span class="koboSpan" id="kobo.515.1">register</span></span><span class="p"><span class="koboSpan" id="kobo.516.1">(</span></span><span class="s1"><span class="koboSpan" id="kobo.517.1">'individual'</span></span><span class="p"><span class="koboSpan" id="kobo.518.1">,</span></span> <span class="n"><span class="koboSpan" id="kobo.519.1">tools</span></span><span class="o"><span class="koboSpan" id="kobo.520.1">.</span></span><span class="n"><span class="koboSpan" id="kobo.521.1">initRepeat</span></span><span class="p"><span class="koboSpan" id="kobo.522.1">,</span></span> <span class="n"><span class="koboSpan" id="kobo.523.1">creator</span></span><span class="o"><span class="koboSpan" id="kobo.524.1">.</span></span><span class="n"><span class="koboSpan" id="kobo.525.1">Individual</span></span><span class="p"><span class="koboSpan" id="kobo.526.1">,</span></span> <span class="n"><span class="koboSpan" id="kobo.527.1">toolbox</span></span><span class="o"><span class="koboSpan" id="kobo.528.1">.</span></span><span class="n"><span class="koboSpan" id="kobo.529.1">binary</span></span><span class="p"><span class="koboSpan" id="kobo.530.1">,</span></span> <span class="n"><span class="koboSpan" id="kobo.531.1">n</span></span> <span class="o"><span class="koboSpan" id="kobo.532.1">=</span></span> <span class="n"><span class="koboSpan" id="kobo.533.1">gene_length</span></span><span class="p"><span class="koboSpan" id="kobo.534.1">)</span></span>
<span class="n"><span class="koboSpan" id="kobo.535.1">toolbox</span></span><span class="o"><span class="koboSpan" id="kobo.536.1">.</span></span><span class="n"><span class="koboSpan" id="kobo.537.1">register</span></span><span class="p"><span class="koboSpan" id="kobo.538.1">(</span></span><span class="s1"><span class="koboSpan" id="kobo.539.1">'population'</span></span><span class="p"><span class="koboSpan" id="kobo.540.1">,</span></span> <span class="n"><span class="koboSpan" id="kobo.541.1">tools</span></span><span class="o"><span class="koboSpan" id="kobo.542.1">.</span></span><span class="n"><span class="koboSpan" id="kobo.543.1">initRepeat</span></span><span class="p"><span class="koboSpan" id="kobo.544.1">,</span></span> <span class="nb"><span class="koboSpan" id="kobo.545.1">list</span></span> <span class="p"><span class="koboSpan" id="kobo.546.1">,</span></span> <span class="n"><span class="koboSpan" id="kobo.547.1">toolbox</span></span><span class="o"><span class="koboSpan" id="kobo.548.1">.</span></span><span class="n"><span class="koboSpan" id="kobo.549.1">individual</span></span><span class="p"><span class="koboSpan" id="kobo.550.1">)</span></span>

<span class="n"><span class="koboSpan" id="kobo.551.1">toolbox</span></span><span class="o"><span class="koboSpan" id="kobo.552.1">.</span></span><span class="n"><span class="koboSpan" id="kobo.553.1">register</span></span><span class="p"><span class="koboSpan" id="kobo.554.1">(</span></span><span class="s1"><span class="koboSpan" id="kobo.555.1">'mate'</span></span><span class="p"><span class="koboSpan" id="kobo.556.1">,</span></span> <span class="n"><span class="koboSpan" id="kobo.557.1">tools</span></span><span class="o"><span class="koboSpan" id="kobo.558.1">.</span></span><span class="n"><span class="koboSpan" id="kobo.559.1">cxOrdered</span></span><span class="p"><span class="koboSpan" id="kobo.560.1">)</span></span>
<span class="n"><span class="koboSpan" id="kobo.561.1">toolbox</span></span><span class="o"><span class="koboSpan" id="kobo.562.1">.</span></span><span class="n"><span class="koboSpan" id="kobo.563.1">register</span></span><span class="p"><span class="koboSpan" id="kobo.564.1">(</span></span><span class="s1"><span class="koboSpan" id="kobo.565.1">'mutate'</span></span><span class="p"><span class="koboSpan" id="kobo.566.1">,</span></span> <span class="n"><span class="koboSpan" id="kobo.567.1">tools</span></span><span class="o"><span class="koboSpan" id="kobo.568.1">.</span></span><span class="n"><span class="koboSpan" id="kobo.569.1">mutShuffleIndexes</span></span><span class="p"><span class="koboSpan" id="kobo.570.1">,</span></span> <span class="n"><span class="koboSpan" id="kobo.571.1">indpb</span></span> <span class="o"><span class="koboSpan" id="kobo.572.1">=</span></span> <span class="mf"><span class="koboSpan" id="kobo.573.1">0.6</span></span><span class="p"><span class="koboSpan" id="kobo.574.1">)</span></span>
<span class="n"><span class="koboSpan" id="kobo.575.1">toolbox</span></span><span class="o"><span class="koboSpan" id="kobo.576.1">.</span></span><span class="n"><span class="koboSpan" id="kobo.577.1">register</span></span><span class="p"><span class="koboSpan" id="kobo.578.1">(</span></span><span class="s1"><span class="koboSpan" id="kobo.579.1">'select'</span></span><span class="p"><span class="koboSpan" id="kobo.580.1">,</span></span> <span class="n"><span class="koboSpan" id="kobo.581.1">tools</span></span><span class="o"><span class="koboSpan" id="kobo.582.1">.</span></span><span class="n"><span class="koboSpan" id="kobo.583.1">selRoulette</span></span><span class="p"><span class="koboSpan" id="kobo.584.1">)</span></span>
<span class="n"><span class="koboSpan" id="kobo.585.1">toolbox</span></span><span class="o"><span class="koboSpan" id="kobo.586.1">.</span></span><span class="n"><span class="koboSpan" id="kobo.587.1">register</span></span><span class="p"><span class="koboSpan" id="kobo.588.1">(</span></span><span class="s1"><span class="koboSpan" id="kobo.589.1">'evaluate'</span></span><span class="p"><span class="koboSpan" id="kobo.590.1">,</span></span> <span class="n"><span class="koboSpan" id="kobo.591.1">train_evaluate</span></span><span class="p"><span class="koboSpan" id="kobo.592.1">)</span></span>

<span class="n"><span class="koboSpan" id="kobo.593.1">population</span></span> <span class="o"><span class="koboSpan" id="kobo.594.1">=</span></span> <span class="n"><span class="koboSpan" id="kobo.595.1">toolbox</span></span><span class="o"><span class="koboSpan" id="kobo.596.1">.</span></span><span class="n"><span class="koboSpan" id="kobo.597.1">population</span></span><span class="p"><span class="koboSpan" id="kobo.598.1">(</span></span><span class="n"><span class="koboSpan" id="kobo.599.1">n</span></span> <span class="o"><span class="koboSpan" id="kobo.600.1">=</span></span> <span class="n"><span class="koboSpan" id="kobo.601.1">population_size</span></span><span class="p"><span class="koboSpan" id="kobo.602.1">)</span></span>
<span class="n"><span class="koboSpan" id="kobo.603.1">r</span></span> <span class="o"><span class="koboSpan" id="kobo.604.1">=</span></span> <span class="n"><span class="koboSpan" id="kobo.605.1">algorithms</span></span><span class="o"><span class="koboSpan" id="kobo.606.1">.</span></span><span class="n"><span class="koboSpan" id="kobo.607.1">eaSimple</span></span><span class="p"><span class="koboSpan" id="kobo.608.1">(</span></span><span class="n"><span class="koboSpan" id="kobo.609.1">population</span></span><span class="p"><span class="koboSpan" id="kobo.610.1">,</span></span> <span class="n"><span class="koboSpan" id="kobo.611.1">toolbox</span></span><span class="p"><span class="koboSpan" id="kobo.612.1">,</span></span> <span class="n"><span class="koboSpan" id="kobo.613.1">cxpb</span></span> <span class="o"><span class="koboSpan" id="kobo.614.1">=</span></span> <span class="mf"><span class="koboSpan" id="kobo.615.1">0.4</span></span><span class="p"><span class="koboSpan" id="kobo.616.1">,</span></span> <span class="n"><span class="koboSpan" id="kobo.617.1">mutpb</span></span> <span class="o"><span class="koboSpan" id="kobo.618.1">=</span></span> <span class="mf"><span class="koboSpan" id="kobo.619.1">0.1</span></span><span class="p"><span class="koboSpan" id="kobo.620.1">,</span></span> <span class="n"><span class="koboSpan" id="kobo.621.1">ngen</span></span> <span class="o"><span class="koboSpan" id="kobo.622.1">=</span></span> <span class="n"><span class="koboSpan" id="kobo.623.1">num_generations</span></span><span class="p"><span class="koboSpan" id="kobo.624.1">,</span></span> <span class="n"><span class="koboSpan" id="kobo.625.1">verbose</span></span> <span class="o"><span class="koboSpan" id="kobo.626.1">=</span></span> <span class="kc"><span class="koboSpan" id="kobo.627.1">False</span></span><span class="p"><span class="koboSpan" id="kobo.628.1">)</span></span></pre>
<ol start="6">
<li><span class="koboSpan" id="kobo.629.1">We get the best solution, as follows: </span></li>
</ol>
<pre style="padding-left: 60px"><span class="n"><span class="koboSpan" id="kobo.630.1">best_individuals</span></span> <span class="o"><span class="koboSpan" id="kobo.631.1">=</span></span> <span class="n"><span class="koboSpan" id="kobo.632.1">tools</span></span><span class="o"><span class="koboSpan" id="kobo.633.1">.</span></span><span class="n"><span class="koboSpan" id="kobo.634.1">selBest</span></span><span class="p"><span class="koboSpan" id="kobo.635.1">(</span></span><span class="n"><span class="koboSpan" id="kobo.636.1">population</span></span><span class="p"><span class="koboSpan" id="kobo.637.1">,</span></span><span class="n"><span class="koboSpan" id="kobo.638.1">k</span></span> <span class="o"><span class="koboSpan" id="kobo.639.1">=</span></span> <span class="mi"><span class="koboSpan" id="kobo.640.1">1</span></span><span class="p"><span class="koboSpan" id="kobo.641.1">)</span></span>
<span class="n"><span class="koboSpan" id="kobo.642.1">best_window_size</span></span> <span class="o"><span class="koboSpan" id="kobo.643.1">=</span></span> <span class="kc"><span class="koboSpan" id="kobo.644.1">None</span></span>
<span class="n"><span class="koboSpan" id="kobo.645.1">best_num_units</span></span> <span class="o"><span class="koboSpan" id="kobo.646.1">=</span></span> <span class="kc"><span class="koboSpan" id="kobo.647.1">None</span></span>

<span class="k"><span class="koboSpan" id="kobo.648.1">for</span></span> <span class="n"><span class="koboSpan" id="kobo.649.1">bi</span></span> <span class="ow"><span class="koboSpan" id="kobo.650.1">in</span></span> <span class="n"><span class="koboSpan" id="kobo.651.1">best_individuals</span></span><span class="p"><span class="koboSpan" id="kobo.652.1">:</span></span>
    <span class="n"><span class="koboSpan" id="kobo.653.1">window_size_bits</span></span> <span class="o"><span class="koboSpan" id="kobo.654.1">=</span></span> <span class="n"><span class="koboSpan" id="kobo.655.1">BitArray</span></span><span class="p"><span class="koboSpan" id="kobo.656.1">(</span></span><span class="n"><span class="koboSpan" id="kobo.657.1">bi</span></span><span class="p"><span class="koboSpan" id="kobo.658.1">[</span></span><span class="mi"><span class="koboSpan" id="kobo.659.1">0</span></span><span class="p"><span class="koboSpan" id="kobo.660.1">:</span></span><span class="mi"><span class="koboSpan" id="kobo.661.1">6</span></span><span class="p"><span class="koboSpan" id="kobo.662.1">])</span></span>
    <span class="n"><span class="koboSpan" id="kobo.663.1">num_units_bits</span></span> <span class="o"><span class="koboSpan" id="kobo.664.1">=</span></span> <span class="n"><span class="koboSpan" id="kobo.665.1">BitArray</span></span><span class="p"><span class="koboSpan" id="kobo.666.1">(</span></span><span class="n"><span class="koboSpan" id="kobo.667.1">bi</span></span><span class="p"><span class="koboSpan" id="kobo.668.1">[</span></span><span class="mi"><span class="koboSpan" id="kobo.669.1">6</span></span><span class="p"><span class="koboSpan" id="kobo.670.1">:])</span></span> 
    <span class="n"><span class="koboSpan" id="kobo.671.1">best_window_size</span></span> <span class="o"><span class="koboSpan" id="kobo.672.1">=</span></span> <span class="n"><span class="koboSpan" id="kobo.673.1">window_size_bits</span></span><span class="o"><span class="koboSpan" id="kobo.674.1">.</span></span><span class="n"><span class="koboSpan" id="kobo.675.1">uint</span></span>
    <span class="n"><span class="koboSpan" id="kobo.676.1">best_num_units</span></span> <span class="o"><span class="koboSpan" id="kobo.677.1">=</span></span> <span class="n"><span class="koboSpan" id="kobo.678.1">num_units_bits</span></span><span class="o"><span class="koboSpan" id="kobo.679.1">.</span></span><span class="n"><span class="koboSpan" id="kobo.680.1">uint</span></span>
    <span class="nb"><span class="koboSpan" id="kobo.681.1">print</span></span><span class="p"><span class="koboSpan" id="kobo.682.1">(</span></span><span class="s1"><span class="koboSpan" id="kobo.683.1">'</span></span><span class="se"><span class="koboSpan" id="kobo.684.1">\n</span></span><span class="s1"><span class="koboSpan" id="kobo.685.1">Window Size: '</span></span><span class="p"><span class="koboSpan" id="kobo.686.1">,</span></span> <span class="n"><span class="koboSpan" id="kobo.687.1">best_window_size</span></span><span class="p"><span class="koboSpan" id="kobo.688.1">,</span></span> <span class="s1"><span class="koboSpan" id="kobo.689.1">', Num of Units: '</span></span><span class="p"><span class="koboSpan" id="kobo.690.1">,</span></span> <span class="n"><span class="koboSpan" id="kobo.691.1">best_num_units</span></span><span class="p"><span class="koboSpan" id="kobo.692.1">)</span></span></pre>
<ol start="7">
<li><span class="koboSpan" id="kobo.693.1">And finally</span><span><span class="koboSpan" id="kobo.694.1">, we implement the best LSTM solution:</span></span></li>
</ol>
<pre style="padding-left: 60px"><span class="n"><span class="koboSpan" id="kobo.695.1">X_train</span></span><span class="p"><span class="koboSpan" id="kobo.696.1">,</span></span><span class="n"><span class="koboSpan" id="kobo.697.1">y_train</span></span> <span class="o"><span class="koboSpan" id="kobo.698.1">=</span></span> <span class="n"><span class="koboSpan" id="kobo.699.1">prepare_dataset</span></span><span class="p"><span class="koboSpan" id="kobo.700.1">(</span></span><span class="n"><span class="koboSpan" id="kobo.701.1">train_data</span></span><span class="p"><span class="koboSpan" id="kobo.702.1">,</span></span><span class="n"><span class="koboSpan" id="kobo.703.1">best_window_size</span></span><span class="p"><span class="koboSpan" id="kobo.704.1">)</span></span>
<span class="n"><span class="koboSpan" id="kobo.705.1">X_test</span></span><span class="p"><span class="koboSpan" id="kobo.706.1">,</span></span> <span class="n"><span class="koboSpan" id="kobo.707.1">y_test</span></span> <span class="o"><span class="koboSpan" id="kobo.708.1">=</span></span> <span class="n"><span class="koboSpan" id="kobo.709.1">prepare_dataset</span></span><span class="p"><span class="koboSpan" id="kobo.710.1">(</span></span><span class="n"><span class="koboSpan" id="kobo.711.1">test_data</span></span><span class="p"><span class="koboSpan" id="kobo.712.1">,</span></span><span class="n"><span class="koboSpan" id="kobo.713.1">best_window_size</span></span><span class="p"><span class="koboSpan" id="kobo.714.1">)</span></span>

<span class="n"><span class="koboSpan" id="kobo.715.1">inputs</span></span> <span class="o"><span class="koboSpan" id="kobo.716.1">=</span></span> <span class="n"><span class="koboSpan" id="kobo.717.1">Input</span></span><span class="p"><span class="koboSpan" id="kobo.718.1">(</span></span><span class="n"><span class="koboSpan" id="kobo.719.1">shape</span></span><span class="o"><span class="koboSpan" id="kobo.720.1">=</span></span><span class="p"><span class="koboSpan" id="kobo.721.1">(</span></span><span class="n"><span class="koboSpan" id="kobo.722.1">best_window_size</span></span><span class="p"><span class="koboSpan" id="kobo.723.1">,</span></span><span class="mi"><span class="koboSpan" id="kobo.724.1">1</span></span><span class="p"><span class="koboSpan" id="kobo.725.1">))</span></span>
<span class="n"><span class="koboSpan" id="kobo.726.1">x</span></span> <span class="o"><span class="koboSpan" id="kobo.727.1">=</span></span> <span class="n"><span class="koboSpan" id="kobo.728.1">LSTM</span></span><span class="p"><span class="koboSpan" id="kobo.729.1">(</span></span><span class="n"><span class="koboSpan" id="kobo.730.1">best_num_units</span></span><span class="p"><span class="koboSpan" id="kobo.731.1">,</span></span> <span class="n"><span class="koboSpan" id="kobo.732.1">input_shape</span></span><span class="o"><span class="koboSpan" id="kobo.733.1">=</span></span><span class="p"><span class="koboSpan" id="kobo.734.1">(</span></span><span class="n"><span class="koboSpan" id="kobo.735.1">best_window_size</span></span><span class="p"><span class="koboSpan" id="kobo.736.1">,</span></span><span class="mi"><span class="koboSpan" id="kobo.737.1">1</span></span><span class="p"><span class="koboSpan" id="kobo.738.1">))(</span></span><span class="n"><span class="koboSpan" id="kobo.739.1">inputs</span></span><span class="p"><span class="koboSpan" id="kobo.740.1">)</span></span>
<span class="n"><span class="koboSpan" id="kobo.741.1">predictions</span></span> <span class="o"><span class="koboSpan" id="kobo.742.1">=</span></span> <span class="n"><span class="koboSpan" id="kobo.743.1">Dense</span></span><span class="p"><span class="koboSpan" id="kobo.744.1">(</span></span><span class="mi"><span class="koboSpan" id="kobo.745.1">1</span></span><span class="p"><span class="koboSpan" id="kobo.746.1">,</span></span> <span class="n"><span class="koboSpan" id="kobo.747.1">activation</span></span><span class="o"><span class="koboSpan" id="kobo.748.1">=</span></span><span class="s1"><span class="koboSpan" id="kobo.749.1">'linear'</span></span><span class="p"><span class="koboSpan" id="kobo.750.1">)(</span></span><span class="n"><span class="koboSpan" id="kobo.751.1">x</span></span><span class="p"><span class="koboSpan" id="kobo.752.1">)</span></span>
<span class="n"><span class="koboSpan" id="kobo.753.1">model</span></span> <span class="o"><span class="koboSpan" id="kobo.754.1">=</span></span> <span class="n"><span class="koboSpan" id="kobo.755.1">Model</span></span><span class="p"><span class="koboSpan" id="kobo.756.1">(</span></span><span class="n"><span class="koboSpan" id="kobo.757.1">inputs</span></span> <span class="o"><span class="koboSpan" id="kobo.758.1">=</span></span> <span class="n"><span class="koboSpan" id="kobo.759.1">inputs</span></span><span class="p"><span class="koboSpan" id="kobo.760.1">,</span></span> <span class="n"><span class="koboSpan" id="kobo.761.1">outputs</span></span> <span class="o"><span class="koboSpan" id="kobo.762.1">=</span></span> <span class="n"><span class="koboSpan" id="kobo.763.1">predictions</span></span><span class="p"><span class="koboSpan" id="kobo.764.1">)</span></span>
<span class="n"><span class="koboSpan" id="kobo.765.1">model</span></span><span class="o"><span class="koboSpan" id="kobo.766.1">.</span></span><span class="n"><span class="koboSpan" id="kobo.767.1">compile</span></span><span class="p"><span class="koboSpan" id="kobo.768.1">(</span></span><span class="n"><span class="koboSpan" id="kobo.769.1">optimizer</span></span><span class="o"><span class="koboSpan" id="kobo.770.1">=</span></span><span class="s1"><span class="koboSpan" id="kobo.771.1">'adam'</span></span><span class="p"><span class="koboSpan" id="kobo.772.1">,</span></span><span class="n"><span class="koboSpan" id="kobo.773.1">loss</span></span><span class="o"><span class="koboSpan" id="kobo.774.1">=</span></span><span class="s1"><span class="koboSpan" id="kobo.775.1">'mean_squared_error'</span></span><span class="p"><span class="koboSpan" id="kobo.776.1">)</span></span>
<span class="n"><span class="koboSpan" id="kobo.777.1">model</span></span><span class="o"><span class="koboSpan" id="kobo.778.1">.</span></span><span class="n"><span class="koboSpan" id="kobo.779.1">fit</span></span><span class="p"><span class="koboSpan" id="kobo.780.1">(</span></span><span class="n"><span class="koboSpan" id="kobo.781.1">X_train</span></span><span class="p"><span class="koboSpan" id="kobo.782.1">,</span></span> <span class="n"><span class="koboSpan" id="kobo.783.1">y_train</span></span><span class="p"><span class="koboSpan" id="kobo.784.1">,</span></span> <span class="n"><span class="koboSpan" id="kobo.785.1">epochs</span></span><span class="o"><span class="koboSpan" id="kobo.786.1">=</span></span><span class="mi"><span class="koboSpan" id="kobo.787.1">5</span></span><span class="p"><span class="koboSpan" id="kobo.788.1">,</span></span> <span class="n"><span class="koboSpan" id="kobo.789.1">batch_size</span></span><span class="o"><span class="koboSpan" id="kobo.790.1">=</span></span><span class="mi"><span class="koboSpan" id="kobo.791.1">10</span></span><span class="p"><span class="koboSpan" id="kobo.792.1">,</span></span><span class="n"><span class="koboSpan" id="kobo.793.1">shuffle</span></span><span class="o"><span class="koboSpan" id="kobo.794.1">=</span></span><span class="kc"><span class="koboSpan" id="kobo.795.1">True</span></span><span class="p"><span class="koboSpan" id="kobo.796.1">)</span></span>
<span class="n"><span class="koboSpan" id="kobo.797.1">y_pred</span></span> <span class="o"><span class="koboSpan" id="kobo.798.1">=</span></span> <span class="n"><span class="koboSpan" id="kobo.799.1">model</span></span><span class="o"><span class="koboSpan" id="kobo.800.1">.</span></span><span class="n"><span class="koboSpan" id="kobo.801.1">predict</span></span><span class="p"><span class="koboSpan" id="kobo.802.1">(</span></span><span class="n"><span class="koboSpan" id="kobo.803.1">X_test</span></span><span class="p"><span class="koboSpan" id="kobo.804.1">)</span></span>

<span class="n"><span class="koboSpan" id="kobo.805.1">rmse</span></span> <span class="o"><span class="koboSpan" id="kobo.806.1">=</span></span> <span class="n"><span class="koboSpan" id="kobo.807.1">np</span></span><span class="o"><span class="koboSpan" id="kobo.808.1">.</span></span><span class="n"><span class="koboSpan" id="kobo.809.1">sqrt</span></span><span class="p"><span class="koboSpan" id="kobo.810.1">(</span></span><span class="n"><span class="koboSpan" id="kobo.811.1">mean_squared_error</span></span><span class="p"><span class="koboSpan" id="kobo.812.1">(</span></span><span class="n"><span class="koboSpan" id="kobo.813.1">y_test</span></span><span class="p"><span class="koboSpan" id="kobo.814.1">,</span></span> <span class="n"><span class="koboSpan" id="kobo.815.1">y_pred</span></span><span class="p"><span class="koboSpan" id="kobo.816.1">))</span></span>
<span class="nb"><span class="koboSpan" id="kobo.817.1">print</span></span><span class="p"><span class="koboSpan" id="kobo.818.1">(</span></span><span class="s1"><span class="koboSpan" id="kobo.819.1">'Test RMSE: '</span></span><span class="p"><span class="koboSpan" id="kobo.820.1">,</span></span> <span class="n"><span class="koboSpan" id="kobo.821.1">rmse</span></span><span class="p"><span class="koboSpan" id="kobo.822.1">)</span></span></pre>
<p class="mce-root"/>
<p class="mce-root"/>
<p><span class="koboSpan" id="kobo.823.1">Yay! </span><span class="koboSpan" id="kobo.823.2">Now, you have the best LSTM network for predicting wind power. </span></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title"><span class="koboSpan" id="kobo.1.1">Summary</span></h1>
                </header>
            
            <article>
                
<p><span class="koboSpan" id="kobo.2.1">This chapter introduced an interesting nature-inspired algorithm family: genetic algorithms. </span><span class="koboSpan" id="kobo.2.2">We covered various standard optimization algorithms, varying from deterministic models, to gradient-based algorithms, to evolutionary algorithms. </span><span class="koboSpan" id="kobo.2.3">The biological process of evolution through natural selection was covered. </span><span class="koboSpan" id="kobo.2.4">We then learned how to convert our optimization problems into a form suitable for genetic algorithms. </span><span class="koboSpan" id="kobo.2.5">Crossover and mutation, two very crucial operations in genetic algorithms, were explained. </span><span class="koboSpan" id="kobo.2.6">While it is not possible to extensively cover all the crossover and mutation methods, we did learn about the popular ones. </span></p>
<p><span class="koboSpan" id="kobo.3.1">We applied what we learned on three very different optimization problems. </span><span class="koboSpan" id="kobo.3.2">We used it to guess a word. </span><span class="koboSpan" id="kobo.3.3">The example was of a five-letter word; had we used simple brute force, it would take a search of a </span><em><span class="koboSpan" id="kobo.4.1">61</span><sup><span class="koboSpan" id="kobo.5.1">5</span></sup></em><span><span class="koboSpan" id="kobo.6.1"> </span></span><span class="koboSpan" id="kobo.7.1">search space. </span><span class="koboSpan" id="kobo.7.2">We used</span><span><span class="koboSpan" id="kobo.8.1"> </span></span><span><span class="koboSpan" id="kobo.9.1">genetic algorithm</span></span><span class="koboSpan" id="kobo.10.1">s to optimize the CNN architecture; again note that, with</span><span><span class="koboSpan" id="kobo.11.1"> </span></span><em><span class="koboSpan" id="kobo.12.1">19</span></em><span><span class="koboSpan" id="kobo.13.1"> </span></span><span class="koboSpan" id="kobo.14.1">possible bits, the search space is</span><span><span class="koboSpan" id="kobo.15.1"> </span></span><em><span class="koboSpan" id="kobo.16.1">2</span><sup><span class="koboSpan" id="kobo.17.1">19</span></sup></em><span class="koboSpan" id="kobo.18.1">. </span><span class="koboSpan" id="kobo.18.2">Then, we used it to find</span><span><span class="koboSpan" id="kobo.19.1"> </span></span><span><span class="koboSpan" id="kobo.20.1">the </span></span><span class="koboSpan" id="kobo.21.1">optimum hyperparameters for an LSTM network. </span></p>
<p><span class="koboSpan" id="kobo.22.1">In the next chapter, we will talk about another intriguing learning paradigm: reinforcement learning. </span><span class="koboSpan" id="kobo.22.2">This is another natural learning paradigm, in the sense that in nature we normally do not have supervised learning; rather, we learn through our interactions with the environment. </span><span class="koboSpan" id="kobo.22.3">In the same manner, here the agent is not told anything except the rewards and punishments it receives from the environment after its action. </span></p>


            </article>

            
        </section>
    </body></html>